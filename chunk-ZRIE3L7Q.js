import{a as G}from"./chunk-Q3TLDL2I.js";import{A as P,Aa as C,Gb as H,Hb as V,Ka as f,Kb as q,M as k,Ma as d,Ob as N,Pa as i,Q as b,Qa as t,Ra as M,Tb as W,Ua as L,V as T,Va as U,Wa as p,Y as R,ab as n,bb as s,cb as O,db as g,ea as j,fa as F,h as I,ib as Y,k as D,kb as $,l as A,lb as B,p as h,s as w,wa as z,za as o}from"./chunk-BAV3NUKA.js";var S=class l{constructor(r){this.http=r}apiUrl="https://www.strava.com/api/v3";getAthleteProfile(){return this.http.get(`${this.apiUrl}/athlete`).pipe(P(r=>(console.error("Erreur lors de la r\xE9cup\xE9ration du profil:",r),h(()=>new Error("Impossible de r\xE9cup\xE9rer le profil de l'athl\xE8te")))))}getAthleteSummary(){return localStorage.getItem("strava_athlete_id")?this.getAllActivities().pipe(w(e=>{let a=new Date().getFullYear(),c=e.filter(m=>new Date(m.start_date).getFullYear()===a),u=e.filter(m=>m.type==="Run"),Q=e.filter(m=>m.type==="Ride"),X=c.filter(m=>m.type==="Run"),Z=c.filter(m=>m.type==="Ride"),v=this.findBiggestClimb(c),_=this.findLongestRun(c),y=this.findBiggestClimb(e),x=this.findLongestRun(e);return{all_run_totals:this.calculateTotals(u),all_ride_totals:this.calculateTotals(Q),ytd_run_totals:this.calculateTotals(X),ytd_ride_totals:this.calculateTotals(Z),current_year_records:{biggest_climb:{value:v?.total_elevation_gain||0,activity_type:v?.type||"",activity_name:v?.name||"Aucune activit\xE9",activity_date:v?.start_date.toString()||"",activity_period:"current_year"},longest_run:{value:_?.distance||0,activity_type:_?.type||"",activity_name:_?.name||"Aucune activit\xE9",activity_date:_?.start_date.toString()||"",activity_period:"current_year"}},all_time_records:{biggest_climb:{value:y?.total_elevation_gain||0,activity_type:y?.type||"",activity_name:y?.name||"Aucune activit\xE9",activity_date:y?.start_date.toString()||"",activity_period:"all_time"},longest_run:{value:x?.distance||0,activity_type:x?.type||"",activity_name:x?.name||"Aucune activit\xE9",activity_date:x?.start_date.toString()||"",activity_period:"all_time"}}}}),P(e=>(console.error("Erreur lors de la r\xE9cup\xE9ration des statistiques:",e),h(()=>new Error("Impossible de r\xE9cup\xE9rer les statistiques de l'athl\xE8te"))))):h(()=>new Error("ID de l'athl\xE8te non trouv\xE9"))}getAllActivities(){return new I(r=>{let e=(a,c=[])=>{this.http.get(`${this.apiUrl}/athlete/activities`,{params:{per_page:"200",page:a.toString()}}).subscribe({next:u=>{u.length===0?(r.next(c),r.complete()):e(a+1,[...c,...u])},error:u=>r.error(u)})};e(1)})}filterCurrentYear(r){let e=new Date().getFullYear();return r.filter(a=>new Date(a.start_date).getFullYear()===e)}calculateTotals(r){return{count:r.length,distance:r.reduce((e,a)=>e+(a.distance||0),0),moving_time:r.reduce((e,a)=>e+(a.moving_time||0),0),elapsed_time:r.reduce((e,a)=>e+(a.elapsed_time||0),0),elevation_gain:r.reduce((e,a)=>e+(a.total_elevation_gain||0),0)}}findBiggestClimb(r){let e=r.filter(a=>a.type==="Run"||a.type==="Walk"||a.type==="Hike");if(e.length!==0)return e.reduce((a,c)=>!a||c.total_elevation_gain>a.total_elevation_gain?c:a,e[0])}findLongestRun(r){let e=r.filter(a=>a.type==="Run"||a.type==="Walk"||a.type==="Hike");if(e.length!==0)return e.reduce((a,c)=>!a||c.distance>a.distance?c:a,e[0])}static \u0275fac=function(e){return new(e||l)(T(N))};static \u0275prov=b({token:l,factory:l.\u0275fac,providedIn:"root"})};var E=class l{cache={profile:null,summary:null,lastUpdate:null};profileSubject=new A(this.cache);setProfileData(r,e){this.cache={profile:r,summary:e,lastUpdate:new Date},this.profileSubject.next(this.cache)}getProfileData$(){return this.profileSubject.asObservable()}needsRefresh(){if(!this.cache.lastUpdate||!this.cache.profile||!this.cache.summary)return!0;let r=new Date(Date.now()-30*60*1e3);return this.cache.lastUpdate<r}clear(){this.cache={profile:null,summary:null,lastUpdate:null},this.profileSubject.next(this.cache)}static \u0275fac=function(e){return new(e||l)};static \u0275prov=b({token:l,factory:l.\u0275fac,providedIn:"root"})};function ie(l,r){l&1&&M(0,"app-spinner")}function ne(l,r){if(l&1&&(i(0,"div",5),n(1),t()),l&2){let e=p();o(),O(" ",e.error," ")}}function re(l,r){if(l&1&&(i(0,"span",13)(1,"i",14),n(2,"\u{1F4CD}"),t(),n(3),t()),l&2){let e=p(2);o(3),g(" ",e.profile.city,", ",e.profile.country," ")}}function ae(l,r){if(l&1&&(i(0,"div",16)(1,"div",17)(2,"div",18)(3,"div",19),n(4,"\u{1F3C3}"),t(),i(5,"h3"),n(6,"Course \xE0 pied - Total"),t()(),i(7,"div",20)(8,"div",21)(9,"span",22),n(10),t(),i(11,"span",23),n(12,"distance totale"),t()(),i(13,"div",21)(14,"span",22),n(15),t(),i(16,"span",23),n(17,"temps total"),t()(),i(18,"div",21)(19,"span",22),n(20),t(),i(21,"span",23),n(22,"sorties"),t()(),i(23,"div",21)(24,"span",22),n(25),t(),i(26,"span",23),n(27,"d\xE9nivel\xE9 total"),t()()()(),i(28,"div",24)(29,"div",18)(30,"div",25),n(31,"\u{1F6B4}"),t(),i(32,"h3"),n(33,"V\xE9lo - Total"),t()(),i(34,"div",20)(35,"div",21)(36,"span",22),n(37),t(),i(38,"span",23),n(39,"distance totale"),t()(),i(40,"div",21)(41,"span",22),n(42),t(),i(43,"span",23),n(44,"temps total"),t()(),i(45,"div",21)(46,"span",22),n(47),t(),i(48,"span",23),n(49,"sorties"),t()(),i(50,"div",21)(51,"span",22),n(52),t(),i(53,"span",23),n(54,"d\xE9nivel\xE9 total"),t()()()(),i(55,"div",26)(56,"div",18)(57,"div",27),n(58,"\u{1F3C6}"),t(),i(59,"h3"),n(60,"Records (Course/Marche uniquement)"),t()(),i(61,"div",20)(62,"div",28)(63,"div",29)(64,"span",30),n(65,"Plus grand d\xE9nivel\xE9"),t(),i(66,"span",31),n(67),t(),i(68,"span",32),n(69),t(),i(70,"span",33),n(71),t()()(),i(72,"div",28)(73,"div",29)(74,"span",30),n(75,"Plus longue sortie"),t(),i(76,"span",31),n(77),t(),i(78,"span",32),n(79),t(),i(80,"span",33),n(81),t()()()()(),i(82,"div",34)(83,"div",18)(84,"div",19),n(85,"\u{1F3C3}"),t(),i(86,"h3"),n(87,"Course \xE0 pied - Cette ann\xE9e"),t()(),i(88,"div",20)(89,"div",21)(90,"span",22),n(91),t(),i(92,"span",23),n(93,"distance parcourue"),t()(),i(94,"div",21)(95,"span",22),n(96),t(),i(97,"span",23),n(98,"temps total"),t()(),i(99,"div",21)(100,"span",22),n(101),t(),i(102,"span",23),n(103,"sorties"),t()(),i(104,"div",21)(105,"span",22),n(106),t(),i(107,"span",23),n(108,"d\xE9nivel\xE9 total"),t()()()(),i(109,"div",35)(110,"div",18)(111,"div",25),n(112,"\u{1F6B4}"),t(),i(113,"h3"),n(114,"V\xE9lo - Cette ann\xE9e"),t()(),i(115,"div",20)(116,"div",21)(117,"span",22),n(118),t(),i(119,"span",23),n(120,"distance parcourue"),t()(),i(121,"div",21)(122,"span",22),n(123),t(),i(124,"span",23),n(125,"temps total"),t()(),i(126,"div",21)(127,"span",22),n(128),t(),i(129,"span",23),n(130,"sorties"),t()(),i(131,"div",21)(132,"span",22),n(133),t(),i(134,"span",23),n(135,"d\xE9nivel\xE9 total"),t()()()()()),l&2){let e=p(2);o(10),s(e.formatDistance(e.summary.all_run_totals.distance)),o(5),s(e.formatDuration(e.summary.all_run_totals.moving_time)),o(5),s(e.summary.all_run_totals.count),o(5),s(e.formatElevation(e.summary.all_run_totals.elevation_gain)),o(12),s(e.formatDistance(e.summary.all_ride_totals.distance)),o(5),s(e.formatDuration(e.summary.all_ride_totals.moving_time)),o(5),s(e.summary.all_ride_totals.count),o(5),s(e.formatElevation(e.summary.all_ride_totals.elevation_gain)),o(15),s(e.formatElevation(e.summary.all_time_records.biggest_climb.value)),o(2),g(" ",e.summary.all_time_records.biggest_climb.activity_name," (",e.summary.all_time_records.biggest_climb.activity_type,") "),o(2),s(e.formatDate(e.summary.all_time_records.biggest_climb.activity_date)),o(6),s(e.formatDistance(e.summary.all_time_records.longest_run.value)),o(2),g(" ",e.summary.all_time_records.longest_run.activity_name," (",e.summary.all_time_records.longest_run.activity_type,") "),o(2),s(e.formatDate(e.summary.all_time_records.longest_run.activity_date)),o(10),s(e.formatDistance(e.summary.ytd_run_totals.distance)),o(5),s(e.formatDuration(e.summary.ytd_run_totals.moving_time)),o(5),s(e.summary.ytd_run_totals.count),o(5),s(e.formatElevation(e.summary.ytd_run_totals.elevation_gain)),o(12),s(e.formatDistance(e.summary.ytd_ride_totals.distance)),o(5),s(e.formatDuration(e.summary.ytd_ride_totals.moving_time)),o(5),s(e.summary.ytd_ride_totals.count),o(5),s(e.formatElevation(e.summary.ytd_ride_totals.elevation_gain))}}function oe(l,r){if(l&1&&(i(0,"div",6)(1,"div",7)(2,"div",8),M(3,"img",9),t(),i(4,"div",10)(5,"h1"),n(6),t(),i(7,"div",11),f(8,re,4,2,"span",12),i(9,"span",13)(10,"i",14),n(11,"\u{1F3AF}"),t(),n(12),$(13,"date"),t()()()(),f(14,ae,136,24,"div",15),t()),l&2){let e=p();o(3),d("src",e.profile.profile||"/assets/images/default-avatar.png",z)("alt",e.profile.firstname),o(3),g("",e.profile.firstname," ",e.profile.lastname,""),o(2),d("ngIf",e.profile.city||e.profile.country),o(4),O(" Membre depuis ",B(13,7,e.profile.created_at,"MMMM yyyy")," "),o(2),d("ngIf",e.summary)}}function le(l,r){if(l&1){let e=L();i(0,"div",36)(1,"div",5)(2,"div",37),n(3,"\u26A0\uFE0F"),t(),i(4,"p"),n(5),t(),i(6,"button",38),U("click",function(){j(e);let c=p();return F(c.reconnect())}),n(7," Se reconnecter \xE0 Strava "),t()()()}if(l&2){let e=p();o(5),s(e.error)}}var K=class l{constructor(r,e,a){this.athleteService=r;this.profileCache=e;this.stravaService=a}profile=null;summary=null;isLoading=!0;error=null;destroy$=new D;ngOnInit(){this.profileCache.getProfileData$().pipe(k(this.destroy$)).subscribe(r=>{r.profile&&r.summary&&(this.profile=r.profile,this.summary=r.summary,this.isLoading=!1)}),this.loadProfile()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}formatDistance(r){return(r/1e3).toFixed(1)+" km"}formatDuration(r){let e=Math.floor(r/3600),a=Math.floor(r%3600/60);return`${e}h ${a}min`}formatElevation(r){return Math.round(r)+" m"}formatDate(r){return new Date(r).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}reconnect(){this.profileCache.clear(),this.stravaService.authenticate()}loadProfile(){if(!this.profileCache.needsRefresh()){this.isLoading=!1;return}this.isLoading=!0,this.error=null,Promise.all([this.athleteService.getAthleteProfile().toPromise(),this.athleteService.getAthleteSummary().toPromise()]).then(([r,e])=>{r&&e&&this.profileCache.setProfileData(r,e),this.isLoading=!1}).catch(r=>{console.error("Error loading profile:",r),this.error="Une erreur est survenue lors du chargement du profil.",this.isLoading=!1})}static \u0275fac=function(e){return new(e||l)(C(S),C(E),C(W))};static \u0275cmp=R({type:l,selectors:[["app-profile"]],standalone:!0,features:[Y],decls:5,vars:4,consts:[[1,"profile-container"],[4,"ngIf"],["class","error-message",4,"ngIf"],["class","profile-content",4,"ngIf"],["class","error-container",4,"ngIf"],[1,"error-message"],[1,"profile-content"],[1,"profile-card"],[1,"profile-avatar"],[3,"src","alt"],[1,"profile-info"],[1,"profile-details"],["class","detail-item",4,"ngIf"],[1,"detail-item"],[1,"icon"],["class","stats-container",4,"ngIf"],[1,"stats-container"],[1,"stats-card","total-running"],[1,"stats-header"],[1,"stats-icon","running"],[1,"stats-body"],[1,"metric"],[1,"metric-value"],[1,"metric-label"],[1,"stats-card","total-cycling"],[1,"stats-icon","cycling"],[1,"stats-card"],[1,"stats-icon","trophy"],[1,"record-item"],[1,"record-info"],[1,"record-title"],[1,"record-value"],[1,"record-details"],[1,"record-date"],[1,"stats-card","ytd-running"],[1,"stats-card","ytd-cycling"],[1,"error-container"],[1,"error-icon"],[1,"reconnect-button",3,"click"]],template:function(e,a){e&1&&(i(0,"div",0),f(1,ie,1,0,"app-spinner",1)(2,ne,2,1,"div",2)(3,oe,15,10,"div",3),t(),f(4,le,8,1,"div",4)),e&2&&(o(),d("ngIf",a.isLoading),o(),d("ngIf",a.error),o(),d("ngIf",!a.isLoading&&!a.error&&a.profile),o(),d("ngIf",a.error))},dependencies:[q,H,V,G],styles:[".profile-container[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto;padding:2rem}.profile-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2rem}.profile-card[_ngcontent-%COMP%]{display:flex;align-items:center;gap:2rem;background:var(--bg-primary);padding:2rem;border-radius:16px;box-shadow:var(--shadow-sm)}.profile-avatar[_ngcontent-%COMP%]{width:150px;height:150px;border-radius:50%;overflow:hidden;flex-shrink:0}.profile-avatar[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.profile-info[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:2rem;color:var(--text-primary);margin-bottom:1rem}.profile-details[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:1.5rem}.detail-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;color:var(--text-secondary);font-size:.95rem}.icon[_ngcontent-%COMP%]{font-size:1.2rem}.stats-container[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(350px,1fr));gap:1.5rem}.stats-card[_ngcontent-%COMP%]{background:var(--bg-primary);border-radius:var(--radius-md);padding:1.5rem;box-shadow:var(--shadow-sm);display:flex;flex-direction:column;gap:1.5rem;transition:transform .2s,box-shadow .2s}.stats-card[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 4px 6px #0000001a}.stats-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem}.stats-icon[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:1.5rem;flex-shrink:0}.stats-icon.running[_ngcontent-%COMP%]{background-color:#ffe0b2}.stats-icon.cycling[_ngcontent-%COMP%]{background-color:#b3e5fc}.stats-icon.trophy[_ngcontent-%COMP%]{background-color:#ffe0b2}.stats-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.1rem;color:var(--text-primary);margin:0}.stats-body[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:1rem}.metric[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.metric-value[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:600;color:var(--text-primary)}.metric-label[_ngcontent-%COMP%]{font-size:.85rem;color:var(--text-secondary)}.record-item[_ngcontent-%COMP%]{border-left:3px solid var(--primary-color);padding-left:1rem;margin-bottom:1rem}.record-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem}.record-title[_ngcontent-%COMP%]{font-size:.9rem;color:var(--gray-600);text-transform:uppercase}.record-value[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:600;color:var(--gray-800)}.record-details[_ngcontent-%COMP%]{font-size:.9rem;color:var(--gray-800)}.record-date[_ngcontent-%COMP%]{font-size:.85rem;color:var(--gray-600);font-style:italic}.error-message[_ngcontent-%COMP%]{text-align:center;padding:2rem;color:var(--danger-color);background-color:#ffebee;border-radius:8px;margin:2rem 0}@media (max-width: 768px){.profile-container[_ngcontent-%COMP%]{padding:1rem}.profile-card[_ngcontent-%COMP%]{flex-direction:column;text-align:center;padding:1.5rem}.profile-avatar[_ngcontent-%COMP%]{width:120px;height:120px}.profile-details[_ngcontent-%COMP%]{justify-content:center}.stats-container[_ngcontent-%COMP%]{grid-template-columns:1fr}.stats-card[_ngcontent-%COMP%]{padding:1rem}.stats-body[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr)}}@media (max-width: 480px){.stats-body[_ngcontent-%COMP%]{grid-template-columns:1fr}}.error-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;padding:2rem}.error-message[_ngcontent-%COMP%]{background-color:#ffebee;border-radius:8px;padding:2rem;text-align:center;max-width:400px;width:100%}.error-icon[_ngcontent-%COMP%]{font-size:2rem;margin-bottom:1rem}.error-message[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--danger-color);margin-bottom:1.5rem}.reconnect-button[_ngcontent-%COMP%]{background-color:var(--primary-color);color:#fff;border:none;padding:.75rem 1.5rem;border-radius:6px;font-size:1rem;font-weight:500;cursor:pointer;transition:background-color .2s}.reconnect-button[_ngcontent-%COMP%]:hover{background-color:var(--primary-dark)}.reconnect-button[_ngcontent-%COMP%]:active{transform:translateY(1px)}"]})};export{K as ProfileComponent};
