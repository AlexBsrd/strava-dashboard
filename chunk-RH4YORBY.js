import{a as tt,b as $,c as ae,d as nt,e as xe,f as it,g as rt,h as at,i as ot,j as st,k as oe,l as se,m as le,n as lt,o as ct,p as Me,q as dt,r as vt}from"./chunk-OEA7F2AF.js";import{a as yt,b as Ct,c as ce,d as Pe,e as De,f as bt,g as ke,h as Oe,i as Ie,j as Te,k as Ee,m as Ae,n as xt}from"./chunk-PSEWUJ6B.js";import{b as mt,d as Se,e as pt,f as gt}from"./chunk-M74YWQY7.js";import{a as _t}from"./chunk-JZY57ICF.js";import{b as ut}from"./chunk-E4KTUAA4.js";import{$ as o,C as K,D as x,E as M,F as T,G as V,Ha as L,Ia as F,J as q,L as Xe,Ma as be,O as l,P as A,Pa as Je,Qa as I,V as C,W as ve,X as d,Y as J,Z as N,Za as et,_ as a,a as H,aa as y,b as qe,ba as ee,bb as R,ca as te,cb as we,da as E,db as ft,ea as b,fa as v,g as Qe,ga as Q,gb as ht,h as ge,ha as U,ia as X,ja as fe,ka as c,la as P,ma as S,na as Ye,oa as Ze,p as Ue,pa as he,q as ue,qa as _e,ra as ye,ta as O,u as Y,va as z,wa as Z,xa as me,ya as Ce,z as k}from"./chunk-AMP4RADT.js";function Dt(r,t){if(r&1&&(a(0,"div",7)(1,"span",8),c(2),o(),a(3,"span",9),c(4,"h"),o()()),r&2){let e=v(2);l(2),P(e.timeValues.hours)}}function kt(r,t){if(r&1&&(ee(0),a(1,"div",5),C(2,Dt,5,1,"div",6),a(3,"div",7)(4,"span",8),c(5),o(),a(6,"span",9),c(7,"min"),o()()(),te()),r&2){let e=v();l(),N("animating",e.animationFrameId!==null),l(),d("ngIf",e.timeValues.hours>0),l(3),P(e.timeValues.minutes)}}function Ot(r,t){if(r&1&&(a(0,"div",10),c(1),a(2,"span",11),c(3),o()()),r&2){let e=v();N("animating",e.animationFrameId!==null),l(),S(" ",e.formattedValue," "),l(2),P(e.unit)}}var Fe=class r{constructor(t){this.elementRef=t}title="";value=0;unit="";isTime=!1;currentValue=0;animationFrameId=null;ANIMATION_DURATION=2e3;hasAnimated=!1;startTime=null;observer=null;get timeValues(){if(!this.isTime)return{hours:0,minutes:0};let t=this.currentValue,e=Math.floor(t/3600),n=Math.floor(t%3600/60);return{hours:e,minutes:n}}get formattedValue(){return this.isTime?"":this.currentValue.toFixed(1)}ngOnInit(){}ngAfterViewInit(){this.setupIntersectionObserver()}ngOnChanges(t){t.value&&!t.value.firstChange&&this.startAnimation()}ngOnDestroy(){this.animationFrameId!==null&&cancelAnimationFrame(this.animationFrameId),this.observer&&this.observer.disconnect()}setupIntersectionObserver(){let t={root:null,rootMargin:"0px",threshold:.1};this.observer=new IntersectionObserver(e=>{e.forEach(n=>{n.isIntersecting&&!this.hasAnimated&&(this.startAnimation(),this.hasAnimated=!0)})},t),this.observer.observe(this.elementRef.nativeElement)}startAnimation(){this.animationFrameId!==null&&cancelAnimationFrame(this.animationFrameId);let t=this.currentValue,e=this.value;this.startTime=null;let n=i=>{this.startTime===null&&(this.startTime=i);let s=i-this.startTime,m=Math.min(s/this.ANIMATION_DURATION,1),u=(p=>1-Math.pow(1-p,4))(m);this.currentValue=t+(e-t)*u,m<1?this.animationFrameId=requestAnimationFrame(n):(this.currentValue=e,this.animationFrameId=null)};this.animationFrameId=requestAnimationFrame(n)}static \u0275fac=function(e){return new(e||r)(A(Xe))};static \u0275cmp=k({type:r,selectors:[["app-stats-card"]],inputs:{title:"title",value:"value",unit:"unit",isTime:"isTime"},standalone:!0,features:[K,O],decls:7,vars:5,consts:[["defaultValue",""],[1,"stats-card"],[1,"stats-title"],[1,"stats-value"],[4,"ngIf","ngIfElse"],[1,"time-display"],["class","time-group",4,"ngIf"],[1,"time-group"],[1,"time-number"],[1,"time-unit"],[1,"number-display"],[1,"stats-unit"]],template:function(e,n){if(e&1&&(a(0,"div",1)(1,"div",2),c(2),o(),a(3,"div",3),C(4,kt,8,4,"ng-container",4)(5,Ot,4,4,"ng-template",null,0,Ce),o()()),e&2){let i=fe(6);N("visible",n.hasAnimated),l(2),P(n.title),l(2),d("ngIf",n.isTime)("ngIfElse",i)}},dependencies:[I,F],styles:[".stats-card[_ngcontent-%COMP%]{background:var(--bg-primary);border:1px solid var(--gray-200);border-radius:var(--radius-md);box-shadow:var(--shadow-sm);display:flex;flex-direction:column;height:100%;justify-content:center;padding:1.5rem;text-align:center;transition:transform .3s,box-shadow .3s}.stats-card[_ngcontent-%COMP%]:hover{box-shadow:var(--shadow-md);transform:translateY(-2px)}.stats-title[_ngcontent-%COMP%]{color:var(--text-secondary);font-size:.875rem;font-weight:500;letter-spacing:.5px;margin-bottom:.75rem;text-transform:uppercase}.stats-value[_ngcontent-%COMP%]{color:var(--primary-500);font-size:2rem;font-weight:600;line-height:1.2;margin-bottom:.25rem}.number-display[_ngcontent-%COMP%], .time-display[_ngcontent-%COMP%]{font-variant-numeric:tabular-nums;transition:color .3s ease}.number-display.animating[_ngcontent-%COMP%], .time-display.animating[_ngcontent-%COMP%]{color:var(--primary-600)}.stats-unit[_ngcontent-%COMP%]{color:var(--text-secondary);font-size:.875rem;margin-left:.25rem}.time-display[_ngcontent-%COMP%]{display:flex;align-items:baseline;justify-content:center;gap:.75rem}.time-group[_ngcontent-%COMP%]{display:flex;align-items:baseline;gap:.15rem}.time-number[_ngcontent-%COMP%]{color:var(--primary-color);font-size:2.25rem;font-weight:600;line-height:1}.time-unit[_ngcontent-%COMP%]{color:var(--gray-600);font-size:1.25rem;font-weight:400}.time-display[_ngcontent-%COMP%]:not(:has(.hours))   .time-number[_ngcontent-%COMP%]{color:var(--primary-color)}@media (max-width: 768px){.time-display[_ngcontent-%COMP%]{gap:.5rem}.time-number[_ngcontent-%COMP%]{font-size:1.75rem}.time-unit[_ngcontent-%COMP%]{font-size:1rem}.stats-card[_ngcontent-%COMP%]{padding:1rem}}","@keyframes _ngcontent-%COMP%_slideInFromBottom{0%{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}@keyframes _ngcontent-%COMP%_countUp{0%{opacity:0;transform:translateY(10px)}20%{opacity:1}to{opacity:1;transform:translateY(0)}}.stats-card[_ngcontent-%COMP%]{opacity:0}.stats-card.visible[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_slideInFromBottom .6s ease-out forwards}.stats-value[_ngcontent-%COMP%]{opacity:0}.stats-card.visible[_ngcontent-%COMP%]   .stats-value[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_countUp .8s ease-out forwards;animation-delay:.3s}.stats-card.visible[_ngcontent-%COMP%]:nth-child(1){animation-delay:.1s}.stats-card.visible[_ngcontent-%COMP%]:nth-child(2){animation-delay:.2s}.stats-card.visible[_ngcontent-%COMP%]:nth-child(3){animation-delay:.3s}.stats-card.visible[_ngcontent-%COMP%]:nth-child(4){animation-delay:.4s}@keyframes _ngcontent-%COMP%_glowPulse{0%{color:var(--primary-500)}50%{color:var(--primary-600)}to{color:var(--primary-500)}}.time-display.animating[_ngcontent-%COMP%]   .time-number[_ngcontent-%COMP%], .number-display.animating[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_glowPulse 2s ease-in-out}"]})};var It=["canvas"],pe=class r{canvasRef;stats;title;period="7 derniers jours";selectedTheme="modern";themes=[{value:"modern",label:"Moderne"},{value:"minimal",label:"Minimal"},{value:"dark",label:"Sombre"}];CANVAS_WIDTH=1080;CANVAS_HEIGHT=1920;themeConfigs={modern:{value:"modern",label:"Moderne",colors:{background:["#F8F9FF","#E8EFFF"],card:"#FFFFFF",cardBorder:"rgba(147, 157, 255, 0.2)",text:"#1E2243",textSecondary:"#626894",accent:"#5B6CFF",accentGradient:["#5B6CFF","#8595FF"]}},minimal:{value:"minimal",label:"Minimal",colors:{background:["#FFFFFF","#F5F5F5"],card:"#FFFFFF",cardBorder:"rgba(0, 0, 0, 0.1)",text:"#2C2C2C",textSecondary:"#757575",accent:"#2196F3",accentGradient:["#2196F3","#64B5F6"]}},dark:{value:"dark",label:"Sombre",colors:{background:["#13141C","#1C1E2C"],card:"#242736",cardBorder:"rgba(255, 255, 255, 0.1)",text:"#FFFFFF",textSecondary:"#A0A5BD",accent:"#7C85FF",accentGradient:["#7C85FF","#5B6CFF"]}}};ngAfterViewInit(){this.drawCard()}changeTheme(t){this.selectedTheme=t,this.drawCard()}generateAndDownload(){let t=this.canvasRef.nativeElement,e=document.createElement("a");e.download=`strava-stats-${Date.now()}.png`,e.href=t.toDataURL("image/png"),e.click()}createRoundRect(t,e,n,i,s,m){t.beginPath(),t.moveTo(e+m,n),t.lineTo(e+i-m,n),t.quadraticCurveTo(e+i,n,e+i,n+m),t.lineTo(e+i,n+s-m),t.quadraticCurveTo(e+i,n+s,e+i-m,n+s),t.lineTo(e+m,n+s),t.quadraticCurveTo(e,n+s,e,n+s-m),t.lineTo(e,n+m),t.quadraticCurveTo(e,n,e+m,n),t.closePath()}drawCard(){let t=this.canvasRef.nativeElement,e=t.getContext("2d"),n=this.themeConfigs[this.selectedTheme];t.width=this.CANVAS_WIDTH,t.height=this.CANVAS_HEIGHT;let i=e.createLinearGradient(0,0,0,this.CANVAS_HEIGHT);i.addColorStop(0,n.colors.background[0]),i.addColorStop(1,n.colors.background[1]),e.fillStyle=i,e.fillRect(0,0,this.CANVAS_WIDTH,this.CANVAS_HEIGHT),this.drawTexture(e,n),this.drawHeader(e,n),this.drawStats(e,n),this.drawFooter(e,n)}drawTexture(t,e){t.save(),t.globalAlpha=.03;for(let n=0;n<this.CANVAS_HEIGHT;n+=30)t.beginPath(),t.moveTo(0,n),t.lineTo(this.CANVAS_WIDTH,n),t.strokeStyle=e.colors.text,t.lineWidth=1,t.stroke();t.restore()}drawHeader(t,e){t.save(),t.globalAlpha=.1,t.fillStyle=e.colors.accent,t.beginPath(),t.arc(100,100,300,0,Math.PI*2),t.fill(),t.beginPath(),t.arc(this.CANVAS_WIDTH-150,250,200,0,Math.PI*2),t.fill(),t.restore(),t.save(),t.font="bold 92px Inter",t.fillStyle=e.colors.text,t.textAlign="center",t.fillText(this.title.toUpperCase(),this.CANVAS_WIDTH/2,200),t.font="40px Inter",t.fillStyle=e.colors.textSecondary,t.fillText(this.period,this.CANVAS_WIDTH/2,280),t.restore()}drawStats(t,e){let n=[{label:"Distance",value:this.formatDistance(this.stats.totalDistance),icon:"\u{1F3C3}"},{label:"Temps",value:this.formatDuration(this.stats.totalElapsedTime),icon:"\u23F1\uFE0F"},{label:"Vitesse",value:this.formatSpeed(this.stats.averageSpeed),icon:"\u26A1"},{label:"D\xE9nivel\xE9",value:this.formatElevation(this.stats.totalElevation),icon:"\u26F0\uFE0F"}],i=500,s=220,m=40;n.forEach((g,u)=>{let p=i+(s+m)*u;t.save(),t.shadowColor="rgba(0, 0, 0, 0.1)",t.shadowBlur=20,t.shadowOffsetY=10,this.createRoundRect(t,120,p,this.CANVAS_WIDTH-240,s,30),t.fillStyle=e.colors.card,t.fill(),t.strokeStyle=e.colors.cardBorder,t.lineWidth=2,t.stroke(),t.restore(),t.save();let f=180,_=p+s/2-30,h=t.createLinearGradient(f,_,f,_+60);h.addColorStop(0,e.colors.accentGradient[0]),h.addColorStop(1,e.colors.accentGradient[1]),this.createRoundRect(t,f,_,60,60,15),t.fillStyle=h,t.fill(),t.restore(),t.font="30px sans-serif",t.textAlign="center",t.textBaseline="middle",t.fillText(g.icon,f+30,_+30),t.font="bold 64px Inter",t.fillStyle=e.colors.text,t.textAlign="right",t.fillText(g.value,this.CANVAS_WIDTH-180,p+s/2-10),t.font="32px Inter",t.fillStyle=e.colors.textSecondary,t.fillText(g.label,this.CANVAS_WIDTH-180,p+s/2+40)})}drawFooter(t,e){t.font="32px Inter",t.fillStyle=e.colors.textSecondary,t.textAlign="center";let n=this.CANVAS_HEIGHT-100;t.save();let i=t.createLinearGradient(this.CANVAS_WIDTH/2-100,n,this.CANVAS_WIDTH/2+100,n);i.addColorStop(0,e.colors.accentGradient[0]),i.addColorStop(1,e.colors.accentGradient[1]),t.fillStyle=i,t.font="bold 36px Inter",t.fillText("STRAVA DASHBOARD",this.CANVAS_WIDTH/2,n),t.restore()}formatDistance(t){return`${t.toFixed(1)} km`}formatDuration(t){let e=Math.floor(t/3600),n=Math.floor(t%3600/60);return`${e}h ${n}min`}formatSpeed(t){return`${t.toFixed(1)} km/h`}formatElevation(t){return`${Math.round(t)}m`}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=k({type:r,selectors:[["app-instagram-card"]],viewQuery:function(e,n){if(e&1&&Q(It,5),e&2){let i;U(i=X())&&(n.canvasRef=i.first)}},inputs:{stats:"stats",title:"title",period:"period",selectedTheme:"selectedTheme"},standalone:!0,features:[O],decls:3,vars:0,consts:[["canvas",""],[1,"preview-canvas"]],template:function(e,n){e&1&&(a(0,"div",1),y(1,"canvas",null,0),o())},dependencies:[I],styles:[".preview-canvas[_ngcontent-%COMP%]{display:flex;justify-content:center;margin:1rem 0}canvas[_ngcontent-%COMP%]{width:360px;height:640px;border-radius:var(--radius-md);box-shadow:var(--shadow-lg)}@media (max-width: 768px){canvas[_ngcontent-%COMP%]{width:270px;height:480px}}"]})};function Tt(r,t){if(r&1){let e=E();a(0,"button",16),b("click",function(){let i=x(e).$implicit,s=v(2);return M(s.changeTheme(i.value))}),c(1),o()}if(r&2){let e=t.$implicit,n=v(2);N("active",n.selectedTheme===e.value),l(),S(" ",e.label," ")}}function Et(r,t){if(r&1){let e=E();a(0,"div",1),b("click",function(){x(e);let i=v();return M(i.close())}),a(1,"div",2),b("click",function(i){return x(e),M(i.stopPropagation())}),a(2,"div",3)(3,"h2",4),c(4,"Cr\xE9er une story Instagram"),o(),a(5,"button",5),b("click",function(){x(e);let i=v();return M(i.close())}),T(),a(6,"svg",6),y(7,"line",7)(8,"line",8),o()()(),V(),a(9,"div",9),C(10,Tt,2,3,"button",10),o(),a(11,"div",11),y(12,"app-instagram-card",12),o(),a(13,"div",13)(14,"button",14),b("click",function(){x(e);let i=v();return M(i.close())}),c(15,"Annuler"),o(),a(16,"button",15),b("click",function(){x(e);let i=v();return M(i.download())}),c(17,"T\xE9l\xE9charger"),o()()()()}if(r&2){let e=v();l(10),d("ngForOf",e.themes),l(2),d("stats",e.stats)("title",e.title)("period",e.period)("selectedTheme",e.selectedTheme)}}var Ve=class r{instagramCard;isOpen=!1;stats;title;period;closeModal=new q;selectedTheme="modern";themes=[{value:"modern",label:"Moderne"},{value:"minimal",label:"Minimal"},{value:"dark",label:"Sombre"}];close(){this.closeModal.emit()}changeTheme(t){this.selectedTheme=t,this.instagramCard&&setTimeout(()=>{this.instagramCard.changeTheme(t)})}download(){this.instagramCard&&this.instagramCard.generateAndDownload()}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=k({type:r,selectors:[["app-share-modal"]],viewQuery:function(e,n){if(e&1&&Q(pe,5),e&2){let i;U(i=X())&&(n.instagramCard=i.first)}},inputs:{isOpen:"isOpen",stats:"stats",title:"title",period:"period"},outputs:{closeModal:"closeModal"},standalone:!0,features:[O],decls:1,vars:1,consts:[["class","modal-overlay",3,"click",4,"ngIf"],[1,"modal-overlay",3,"click"],[1,"modal-content",3,"click"],[1,"modal-header"],[1,"modal-title"],[1,"close-button",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["x1","18","y1","6","x2","6","y2","18"],["x1","6","y1","6","x2","18","y2","18"],[1,"theme-selector"],["class","theme-button",3,"active","click",4,"ngFor","ngForOf"],[1,"preview"],[3,"stats","title","period","selectedTheme"],[1,"action-buttons"],[1,"cancel-btn",3,"click"],[1,"generate-btn",3,"click"],[1,"theme-button",3,"click"]],template:function(e,n){e&1&&C(0,Et,18,5,"div",0),e&2&&d("ngIf",n.isOpen)},dependencies:[I,L,F,pe],styles:[".modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#00000080;display:flex;justify-content:center;align-items:center;z-index:1000;-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px)}.modal-content[_ngcontent-%COMP%]{background:var(--bg-primary);border-radius:var(--radius-lg);padding:2rem;width:90%;max-width:600px;max-height:90vh;overflow-y:auto;box-shadow:var(--shadow-xl)}.modal-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem}.modal-title[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:600;color:var(--text-primary);margin:0}.close-button[_ngcontent-%COMP%]{background:none;border:none;padding:.5rem;cursor:pointer;color:var(--text-secondary);border-radius:var(--radius-sm);transition:all .2s}.close-button[_ngcontent-%COMP%]:hover{background:var(--gray-100);color:var(--text-primary)}.preview[_ngcontent-%COMP%]{display:flex;justify-content:center;margin:1rem 0}.theme-selector[_ngcontent-%COMP%]{display:flex;gap:1rem;margin-bottom:1.5rem;justify-content:center}.theme-button[_ngcontent-%COMP%]{padding:.5rem 1rem;border:2px solid var(--primary-500);border-radius:var(--radius-md);background:transparent;color:var(--text-primary);cursor:pointer;transition:all .2s}.theme-button.active[_ngcontent-%COMP%]{background:var(--primary-500);color:#fff}.action-buttons[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:1rem;margin-top:1.5rem;padding-top:1rem;border-top:1px solid var(--gray-200)}.cancel-btn[_ngcontent-%COMP%], .generate-btn[_ngcontent-%COMP%]{padding:.75rem 1.5rem;border-radius:var(--radius-md);cursor:pointer;border:none;font-weight:500;transition:all .2s}.cancel-btn[_ngcontent-%COMP%]{background:var(--gray-200);color:var(--text-primary)}.generate-btn[_ngcontent-%COMP%]{background:var(--primary-500);color:#fff}.cancel-btn[_ngcontent-%COMP%]:hover{background:var(--gray-300)}.generate-btn[_ngcontent-%COMP%]:hover{background:var(--primary-600)}@media (max-width: 768px){.modal-content[_ngcontent-%COMP%]{width:95%;padding:1.5rem}}"]})};function At(r,t){if(r&1&&y(0,"app-stats-card",19),r&2){let e=v();d("value",e.stats.totalElapsedTime)("isTime",!0)}}function Ft(r,t){if(r&1&&y(0,"app-stats-card",20),r&2){let e=v();d("value",e.stats.averageSpeed)}}function Vt(r,t){if(r&1&&y(0,"app-stats-card",21),r&2){let e=v();d("value",e.stats.totalDistance)}}function Gt(r,t){if(r&1&&y(0,"app-stats-card",22),r&2){let e=v();d("value",e.stats.averageDistance)}}function zt(r,t){if(r&1&&y(0,"app-stats-card",23),r&2){let e=v();d("value",e.stats.totalElevation)}}function Rt(r,t){if(r&1&&y(0,"app-stats-card",24),r&2){let e=v();d("value",e.stats.averageElevation)}}function Nt(r,t){if(r&1){let e=E();a(0,"app-share-modal",25),b("closeModal",function(){x(e);let i=v();return M(i.closeShareModal())}),o()}if(r&2){let e=v();d("isOpen",e.showShareModal)("stats",e.stats)("title",e.title)("period",e.getPeriodLabel())}}var Ge=class r{stats;title;selectedPeriod="week";groupColor;groupIcon;visibleMetrics;showShareModal=!1;isMetricVisible(t){return(this.visibleMetrics||mt).includes(t)}get activityType(){return this.title.toLowerCase()}get displayColor(){if(this.groupColor)return this.groupColor;switch(this.title.toLowerCase()){case"run":case"course":return"#ef4444";case"walk":case"marche":return"#22c55e";case"bike":case"v\xE9lo":return"#3b82f6";default:return"#6366f1"}}openShareModal(){this.showShareModal=!0}closeShareModal(){this.showShareModal=!1}getPeriodLabel(){switch(this.selectedPeriod){case"week":return"7 derniers jours";case"month":return"30 derniers jours";case"current_year":return"Depuis le 1er janvier";default:let t=parseInt(this.selectedPeriod,10);return isNaN(t)?"":`Ann\xE9e ${t}`}}getIconEmoji(t){return{run:"\u{1F3C3}",bike:"\u{1F6B4}",walk:"\u{1F6B6}",hike:"\u{1F97E}",trail:"\u{1F3C3}\u200D\u2642\uFE0F",swim:"\u{1F3CA}",ski:"\u26F7\uFE0F",weight:"\u{1F3CB}\uFE0F",yoga:"\u{1F9D8}",activity:"\u{1F4AA}",fitness:"\u{1F4AA}",workout:"\u{1F3C3}",crossfit:"\u{1F3CB}\uFE0F\u200D\u2642\uFE0F"}[t]||"\u{1F3C3}"}getDisplayIcon(){if(this.groupIcon)return this.getIconEmoji(this.groupIcon);let t=this.title.toLowerCase();return t.includes("course")||t.includes("run")?"\u{1F3C3}":t.includes("v\xE9lo")||t.includes("bike")?"\u{1F6B4}":t.includes("marche")||t.includes("walk")?"\u{1F6B6}":"\u{1F4AA}"}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=k({type:r,selectors:[["app-stats-list"]],inputs:{stats:"stats",title:"title",selectedPeriod:"selectedPeriod",groupColor:"groupColor",groupIcon:"groupIcon",visibleMetrics:"visibleMetrics"},standalone:!0,features:[O],decls:23,vars:12,consts:[[1,"activity-header"],[1,"title-section"],[1,"activity-icon"],[1,"icon-emoji"],[1,"activity-info"],[1,"activity-count"],[1,"share-button",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["x","2","y","2","width","20","height","20","rx","5","ry","5"],["cx","12","cy","12","r","4"],["cx","18","cy","6","r","1.5"],[1,"stats-grid"],["class","double-row","title","Temps total","unit","",3,"value","isTime",4,"ngIf"],["class","double-row","title","Vitesse moyenne","unit","km/h",3,"value",4,"ngIf"],["title","Distance totale","unit","km",3,"value",4,"ngIf"],["title","Distance moyenne/sortie","unit","km",3,"value",4,"ngIf"],["title","D\xE9nivel\xE9 total","unit","m",3,"value",4,"ngIf"],["title","D\xE9nivel\xE9 moyen/sortie","unit","m",3,"value",4,"ngIf"],[3,"isOpen","stats","title","period","closeModal",4,"ngIf"],["title","Temps total","unit","",1,"double-row",3,"value","isTime"],["title","Vitesse moyenne","unit","km/h",1,"double-row",3,"value"],["title","Distance totale","unit","km",3,"value"],["title","Distance moyenne/sortie","unit","km",3,"value"],["title","D\xE9nivel\xE9 total","unit","m",3,"value"],["title","D\xE9nivel\xE9 moyen/sortie","unit","m",3,"value"],[3,"closeModal","isOpen","stats","title","period"]],template:function(e,n){e&1&&(a(0,"div",0)(1,"div",1)(2,"div",2)(3,"span",3),c(4),o()(),a(5,"div",4)(6,"h2"),c(7),o(),a(8,"span",5),c(9),o()()(),a(10,"button",6),b("click",function(){return n.openShareModal()}),T(),a(11,"svg",7),y(12,"rect",8)(13,"circle",9)(14,"circle",10),o()()(),V(),a(15,"div",11),C(16,At,1,2,"app-stats-card",12)(17,Ft,1,1,"app-stats-card",13)(18,Vt,1,1,"app-stats-card",14)(19,Gt,1,1,"app-stats-card",15)(20,zt,1,1,"app-stats-card",16)(21,Rt,1,1,"app-stats-card",17),o(),C(22,Nt,1,4,"app-share-modal",18)),e&2&&(l(2),J("background-color",n.displayColor),l(2),P(n.getDisplayIcon()),l(3),P(n.title),l(2),S("",n.stats.numberOfActivities," activit\xE9(s)"),l(7),d("ngIf",n.isMetricVisible("totalElapsedTime")),l(),d("ngIf",n.isMetricVisible("averageSpeed")),l(),d("ngIf",n.isMetricVisible("totalDistance")),l(),d("ngIf",n.isMetricVisible("averageDistance")),l(),d("ngIf",n.isMetricVisible("totalElevation")),l(),d("ngIf",n.isMetricVisible("averageElevation")),l(),d("ngIf",n.showShareModal))},dependencies:[I,F,Fe,Ve],styles:[`@media (max-width: 640px){.stats-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}.activity-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;margin-bottom:1rem;margin-top:2rem}.activity-header[_ngcontent-%COMP%]:first-child{margin-top:0}.activity-icon[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:8px;display:flex;align-items:center;justify-content:center;position:relative}.activity-icon[_ngcontent-%COMP%]:before{content:"";position:absolute;inset:0;border-radius:8px;opacity:.15}.activity-info[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-family:Inter,sans-serif;font-size:1.5rem;font-weight:600;color:#2d2d2d;margin:0;padding:0}.activity-count[_ngcontent-%COMP%]{font-size:.9rem;color:var(--gray-600)}.activity-icon[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{width:24px;height:24px;background-repeat:no-repeat;background-position:center;background-size:contain}.activity-icon[_ngcontent-%COMP%]   .icon-emoji[_ngcontent-%COMP%]{font-size:24px;line-height:1;filter:brightness(0) invert(1)}.activity-icon.run[_ngcontent-%COMP%]{color:#ff5722}.activity-icon.run[_ngcontent-%COMP%]:before{background-color:#ff5722}.activity-icon.run[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23FF5722'%3E%3Cpath d='M13.49 5.48c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm-3.6 13.9l1-4.4 2.1 2v6h2v-7.5l-2.1-2 .6-3c1.3 1.5 3.3 2.5 5.5 2.5v-2c-1.9 0-3.5-1-4.3-2.4l-1-1.6c-.4-.6-1-1-1.7-1-.3 0-.5.1-.8.1l-5.2 2.2v4.7h2v-3.4l1.8-.7-1.6 8.1-4.9-1-.4 2 7 1.4z'/%3E%3C/svg%3E")}.activity-icon.walk[_ngcontent-%COMP%]{color:#4caf50}.activity-icon.walk[_ngcontent-%COMP%]:before{background-color:#4caf50}.activity-icon.walk[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%234CAF50' viewBox='0 0 24 24'%3E%3Cpath d='M13.5 5.5c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zM9.8 8.9L7 23h2.1l1.8-8 2.1 2v6h2v-7.5l-2.1-2 .6-3C14.8 12 16.8 13 19 13v-2c-1.9 0-3.5-1-4.3-2.4l-1-1.6c-.4-.6-1-1-1.7-1-.3 0-.5.1-.8.1L6 8.3V13h2V9.6l1.8-.7'/%3E%3C/svg%3E")}.activity-icon.bike[_ngcontent-%COMP%]{color:#2196f3}.activity-icon.bike[_ngcontent-%COMP%]:before{background-color:#2196f3}.activity-icon.bike[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%232196F3' viewBox='0 0 24 24'%3E%3Cpath d='M15.5 5.5c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zM5 12c-2.8 0-5 2.2-5 5s2.2 5 5 5 5-2.2 5-5-2.2-5-5-5zm0 8.5c-1.9 0-3.5-1.6-3.5-3.5s1.6-3.5 3.5-3.5 3.5 1.6 3.5 3.5-1.6 3.5-3.5 3.5zm5.8-10l2.4-2.4.8.8c1.3 1.3 3 2.1 5.1 2.1V9c-1.5 0-2.7-.6-3.6-1.5l-1.9-1.9c-.5-.4-1-.6-1.6-.6s-1.1.2-1.4.6L7.8 8.4c-.4.4-.6.9-.6 1.4 0 .6.2 1.1.6 1.4L11 14v5h2v-6.2l-2.2-2.3zM19 12c-2.8 0-5 2.2-5 5s2.2 5 5 5 5-2.2 5-5-2.2-5-5-5zm0 8.5c-1.9 0-3.5-1.6-3.5-3.5s1.6-3.5 3.5-3.5 3.5 1.6 3.5 3.5-1.6 3.5-3.5 3.5z'/%3E%3C/svg%3E")}@media (max-width: 768px){.activity-icon[_ngcontent-%COMP%]{width:32px;height:32px}.activity-info[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.25rem}.activity-count[_ngcontent-%COMP%]{font-size:.8rem}}@media (max-width: 1024px){.stats-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr)}.double-row[_ngcontent-%COMP%]{grid-row:span 2;grid-column:span 1}}.activity-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;margin-bottom:1.5rem}.title-section[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem}.activity-icon[_ngcontent-%COMP%]{width:48px;height:48px;border-radius:12px;display:flex;align-items:center;justify-content:center;position:relative}.activity-icon[_ngcontent-%COMP%]:before{content:"";position:absolute;inset:0;border-radius:12px;opacity:.15}.activity-info[_ngcontent-%COMP%]{display:flex;flex-direction:column}.activity-info[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-family:Inter,sans-serif;font-size:1.5rem;font-weight:600;color:var(--text-primary);margin:0}.activity-count[_ngcontent-%COMP%]{font-size:.9rem;color:var(--text-secondary)}.share-button[_ngcontent-%COMP%]{background:linear-gradient(45deg,#f09433,#e6683c,#dc2743,#cc2366,#bc1888);color:#fff;border:none;width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .2s ease;box-shadow:var(--shadow-sm)}.share-button[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:var(--shadow-md);filter:brightness(1.1)}.share-button[_ngcontent-%COMP%]:active{transform:translateY(0)}.share-button[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{filter:drop-shadow(0px 1px 2px rgba(0,0,0,.1))}.stats-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(4,1fr);gap:16px}.double-row[_ngcontent-%COMP%]{grid-row:span 2;grid-column:span 1}@media (max-width: 1024px){.stats-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr)}}@media (max-width: 640px){.stats-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr);gap:12px}.double-row[_ngcontent-%COMP%]{grid-row:span 1}}`,"@keyframes _ngcontent-%COMP%_fadeSlideIn{0%{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}.activity-header[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeSlideIn .8s ease-out forwards;opacity:0}.stats-grid[_ngcontent-%COMP%]{opacity:0;animation:_ngcontent-%COMP%_fadeSlideIn .8s ease-out forwards;animation-delay:.2s}@keyframes _ngcontent-%COMP%_rotateIn{0%{opacity:0;transform:rotate(-180deg) scale(.3)}to{opacity:1;transform:rotate(0) scale(1)}}.share-button[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_rotateIn .8s cubic-bezier(.34,1.56,.64,1) backwards;animation-delay:1s}.share-button[_ngcontent-%COMP%]:hover   svg[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_shake .82s cubic-bezier(.36,.07,.19,.97) both;transform:translateZ(0);backface-visibility:hidden;perspective:1000px}@keyframes _ngcontent-%COMP%_shake{10%,90%{transform:translate3d(-1px,0,0)}20%,80%{transform:translate3d(2px,0,0)}30%,50%,70%{transform:translate3d(-4px,0,0)}40%,60%{transform:translate3d(4px,0,0)}}@keyframes _ngcontent-%COMP%_bounceIn{0%{opacity:0;transform:scale(.3)}50%{opacity:.9;transform:scale(1.1)}80%{transform:scale(.89)}to{opacity:1;transform:scale(1)}}.activity-icon[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_bounceIn .8s cubic-bezier(.68,-.55,.265,1.55) forwards}.activity-icon[_ngcontent-%COMP%]:before{animation:_ngcontent-%COMP%_pulseBackground 2s ease-in-out infinite}@keyframes _ngcontent-%COMP%_pulseBackground{0%{opacity:.1}50%{opacity:.2}to{opacity:.1}}"]})};var ze=class r{analyzePerformances(t){let e={value:0,date:new Date,activityName:""},n={fiveKm:H({},e),tenKm:H({},e),semi:H({},e),marathon:H({},e)};return t.forEach(i=>{let s=i.average_speed,m=i.distance;m>=41.695&&(s>n.marathon.value||n.marathon.value===0)&&(n.marathon={value:s,date:new Date(i.start_date),activityName:i.name}),m>=20.6&&(s>n.semi.value||n.semi.value===0)&&(n.semi={value:s,date:new Date(i.start_date),activityName:i.name}),m>=9.5&&(s>n.tenKm.value||n.tenKm.value===0)&&(n.tenKm={value:s,date:new Date(i.start_date),activityName:i.name}),m>=4.7&&(s>n.fiveKm.value||n.fiveKm.value===0)&&(n.fiveKm={value:s,date:new Date(i.start_date),activityName:i.name})}),{bestRaces:n}}static \u0275fac=function(e){return new(e||r)};static \u0275prov=Y({token:r,factory:r.\u0275fac,providedIn:"root"})};function jt(r,t){if(r&1&&(a(0,"div",7)(1,"div",8),c(2,"5 KM"),o(),a(3,"div",9),c(4),z(5,"number"),o(),a(6,"div",10),c(7),o(),a(8,"div",11),c(9),a(10,"small"),c(11),o()()()),r&2){let e=v(2);l(4),S("",me(5,4,e.metrics.bestRaces.fiveKm.value,"1.1-1")," km/h"),l(3),S("",e.calculatePace(e.metrics.bestRaces.fiveKm.value)," min/km"),l(2),S(" ",e.metrics.bestRaces.fiveKm.activityName," "),l(2),P(e.formatDate(e.metrics.bestRaces.fiveKm.date))}}function Ht(r,t){if(r&1&&(a(0,"div",7)(1,"div",8),c(2,"10 KM"),o(),a(3,"div",9),c(4),z(5,"number"),o(),a(6,"div",10),c(7),o(),a(8,"div",11),c(9),a(10,"small"),c(11),o()()()),r&2){let e=v(2);l(4),S("",me(5,4,e.metrics.bestRaces.tenKm.value,"1.1-1")," km/h"),l(3),S("",e.calculatePace(e.metrics.bestRaces.tenKm.value)," min/km"),l(2),S(" ",e.metrics.bestRaces.tenKm.activityName," "),l(2),P(e.formatDate(e.metrics.bestRaces.tenKm.date))}}function $t(r,t){if(r&1&&(a(0,"div",7)(1,"div",8),c(2,"Semi-Marathon"),o(),a(3,"div",9),c(4),z(5,"number"),o(),a(6,"div",10),c(7),o(),a(8,"div",11),c(9),a(10,"small"),c(11),o()()()),r&2){let e=v(2);l(4),S("",me(5,4,e.metrics.bestRaces.semi.value,"1.1-1")," km/h"),l(3),S("",e.calculatePace(e.metrics.bestRaces.semi.value)," min/km"),l(2),S(" ",e.metrics.bestRaces.semi.activityName," "),l(2),P(e.formatDate(e.metrics.bestRaces.semi.date))}}function Bt(r,t){if(r&1&&(a(0,"div",7)(1,"div",8),c(2,"Marathon"),o(),a(3,"div",9),c(4),z(5,"number"),o(),a(6,"div",10),c(7),o(),a(8,"div",11),c(9),a(10,"small"),c(11),o()()()),r&2){let e=v(2);l(4),S("",me(5,4,e.metrics.bestRaces.marathon.value,"1.1-1")," km/h"),l(3),S("",e.calculatePace(e.metrics.bestRaces.marathon.value)," min/km"),l(2),S(" ",e.metrics.bestRaces.marathon.activityName," "),l(2),P(e.formatDate(e.metrics.bestRaces.marathon.date))}}function Wt(r,t){if(r&1&&(ee(0),a(1,"div",2)(2,"div",3)(3,"p",4),c(4,"\u{1F4A1} Cliquez sur \u2699\uFE0F en bas \xE0 droite pour changer la p\xE9riode"),o(),a(5,"h2"),c(6,"Records Personnels (sur la p\xE9riode)"),o(),a(7,"div",5),C(8,jt,12,7,"div",6)(9,Ht,12,7,"div",6)(10,$t,12,7,"div",6)(11,Bt,12,7,"div",6),o()()(),te()),r&2){let e=v();l(8),d("ngIf",e.metrics==null||e.metrics.bestRaces==null||e.metrics.bestRaces.fiveKm==null?null:e.metrics.bestRaces.fiveKm.value),l(),d("ngIf",e.metrics==null||e.metrics.bestRaces==null||e.metrics.bestRaces.tenKm==null?null:e.metrics.bestRaces.tenKm.value),l(),d("ngIf",e.metrics==null||e.metrics.bestRaces==null||e.metrics.bestRaces.semi==null?null:e.metrics.bestRaces.semi.value),l(),d("ngIf",e.metrics==null||e.metrics.bestRaces==null||e.metrics.bestRaces.marathon==null?null:e.metrics.bestRaces.marathon.value)}}function Yt(r,t){r&1&&(a(0,"div",2)(1,"div",12)(2,"div",13)(3,"i",14),c(4,"\u{1F3C3}"),o(),a(5,"div",15)(6,"h2"),c(7,"Aucun record sur cette p\xE9riode"),o(),a(8,"p"),c(9,"Continuez \xE0 vous entra\xEEner pour \xE9tablir de nouveaux records sur :"),o(),a(10,"ul")(11,"li"),c(12,"5 kilom\xE8tres"),o(),a(13,"li"),c(14,"10 kilom\xE8tres"),o(),a(15,"li"),c(16,"Semi-marathon"),o(),a(17,"li"),c(18,"Marathon"),o()()()()()())}var Re=class r{constructor(t){this.performanceService=t}activities=[];metrics;ngOnChanges(){this.activities.length&&(this.metrics=this.performanceService.analyzePerformances(this.activities))}hasRecords(){return this.metrics?.bestRaces?!!(this.metrics.bestRaces.fiveKm.value||this.metrics.bestRaces.tenKm.value||this.metrics.bestRaces.semi.value||this.metrics.bestRaces.marathon.value):!1}formatDate(t){return new Date(t).toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric"})}calculatePace(t){let e=60/t,n=Math.floor(e),i=Math.round((e-n)*60);return`${n}'${i.toString().padStart(2,"0")}"`}static \u0275fac=function(e){return new(e||r)(A(ze))};static \u0275cmp=k({type:r,selectors:[["app-performance-dashboard"]],inputs:{activities:"activities"},standalone:!0,features:[K,O],decls:3,vars:2,consts:[["noRecords",""],[4,"ngIf","ngIfElse"],[1,"performance-container"],[1,"section","best-performances"],[1,"mobile-hint"],[1,"records-grid"],["class","record-card",4,"ngIf"],[1,"record-card"],[1,"record-title"],[1,"record-value"],[1,"record-pace"],[1,"record-details"],[1,"section","empty-state"],[1,"empty-state-content"],[1,"empty-state-icon"],[1,"empty-state-text"]],template:function(e,n){if(e&1&&C(0,Wt,12,4,"ng-container",1)(1,Yt,19,0,"ng-template",null,0,Ce),e&2){let i=fe(2);d("ngIf",n.hasRecords())("ngIfElse",i)}},dependencies:[I,F,Je],styles:['.performance-container[_ngcontent-%COMP%]{padding:.75rem}.section[_ngcontent-%COMP%]{margin-bottom:1rem;background:var(--bg-primary);border-radius:var(--radius-md);padding:1rem;box-shadow:var(--shadow-sm)}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:1.5rem 1rem;display:flex;align-items:center;justify-content:center;background:var(--bg-primary);border-radius:var(--radius-md);box-shadow:var(--shadow-sm)}.empty-state-content[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;max-width:100%}.empty-state-icon[_ngcontent-%COMP%]{font-size:2rem;margin:0}.empty-state-text[_ngcontent-%COMP%]{text-align:left}.empty-state[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:var(--text-primary);font-size:1.1rem;margin-bottom:.5rem}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--text-secondary);margin-bottom:.5rem;font-size:.9rem}.empty-state[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style:none;padding:0;color:var(--text-secondary);margin:0;display:flex;gap:1rem;flex-wrap:wrap}.empty-state[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin:0;font-weight:500;font-size:.9rem}.empty-state[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:not(:last-child):after{content:"\\2022";margin-left:1rem}.mobile-hint[_ngcontent-%COMP%]{display:none;color:var(--text-secondary);font-size:.75rem;margin:0 0 1rem;padding:.5rem .75rem;background:var(--bg-secondary);border-radius:var(--radius-sm);border-left:3px solid var(--primary-500)}h2[_ngcontent-%COMP%]{color:var(--text-primary);font-size:1.25rem;margin-bottom:1.5rem;font-weight:600}.records-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:1.5rem}.record-card[_ngcontent-%COMP%]{background:linear-gradient(to bottom right,var(--primary-100),var(--bg-primary));padding:1.5rem;border-radius:var(--radius-md);box-shadow:var(--shadow-sm);transition:transform .2s,box-shadow .2s;position:relative;overflow:hidden}[data-theme=light][_ngcontent-%COMP%]   .record-card[_ngcontent-%COMP%]:before{content:"";position:absolute;inset:0;background:linear-gradient(135deg,#fff3,#fff6,#ffffff1a);pointer-events:none}[data-theme=dark][_ngcontent-%COMP%]   .record-card[_ngcontent-%COMP%]:before{content:"";position:absolute;inset:0;background:linear-gradient(135deg,#ffffff0d,#ffffff1a,#ffffff05);pointer-events:none}.record-card[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:var(--shadow-md)}.record-title[_ngcontent-%COMP%]{font-weight:600;color:var(--primary-500);font-size:1.1rem;margin-bottom:.5rem;position:relative}.record-value[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700;color:var(--text-primary);margin-bottom:.25rem;position:relative}.record-pace[_ngcontent-%COMP%]{font-size:.9rem;color:var(--text-secondary);margin-bottom:.75rem;font-weight:500;position:relative}.record-details[_ngcontent-%COMP%]{font-size:.875rem;color:var(--text-secondary);position:relative}.record-details[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{display:block;margin-top:.25rem}@media (max-width: 768px){.mobile-hint[_ngcontent-%COMP%]{display:block}.performance-container[_ngcontent-%COMP%], .section[_ngcontent-%COMP%]{padding:1rem}.records-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:1rem}.empty-state[_ngcontent-%COMP%]{padding:2rem 1rem}}']})};var de=class r{isFullscreenSubject=new ge(!1);isFullscreen$=this.isFullscreenSubject.asObservable();toggleFullscreen(t){document.fullscreenElement?(document.exitFullscreen(),this.isFullscreenSubject.next(!1)):(t.requestFullscreen().catch(e=>{console.error(`Erreur lors du passage en plein \xE9cran : ${e.message}`)}),this.isFullscreenSubject.next(!0),document.addEventListener("fullscreenchange",this.handleFullscreenChange))}handleFullscreenChange=()=>{document.fullscreenElement||this.isFullscreenSubject.next(!1)};static \u0275fac=function(e){return new(e||r)};static \u0275prov=Y({token:r,factory:r.\u0275fac,providedIn:"root"})};var Kt=["chartContainer"];function qt(r,t){if(r&1&&(a(0,"option",21),c(1),o()),r&2){let e=t.$implicit;d("value",e),l(),S(" ",e," ")}}function Qt(r,t){if(r&1){let e=E();a(0,"div",22)(1,"div",23)(2,"label",24)(3,"input",25),b("change",function(){x(e);let i=v();return M(i.onGroupingChange("none"))}),o(),c(4," Aucun "),o(),a(5,"label",24)(6,"input",26),b("change",function(){x(e);let i=v();return M(i.onGroupingChange("week"))}),o(),c(7," Par semaine "),o(),a(8,"label",24)(9,"input",27),b("change",function(){x(e);let i=v();return M(i.onGroupingChange("month"))}),o(),c(10," Par mois "),o()()()}if(r&2){let e=v();l(3),d("checked",e.groupingType==="none"),l(3),d("checked",e.groupingType==="week"),l(3),d("checked",e.groupingType==="month")}}function Ut(r,t){if(r&1){let e=E();a(0,"button",28),b("click",function(){let i=x(e).$implicit,s=v();return M(s.toggleMetric(i.value))}),c(1),o()}if(r&2){let e=t.$implicit,n=v();J("--metric-color",e.color),N("active",n.isMetricSelected(e.value)),l(),S(" ",e.label," ")}}function Xt(r,t){r&1&&(T(),y(0,"path",29))}function Zt(r,t){r&1&&(T(),y(0,"path",30))}ce.register(Ee,Te,De,Pe,yt,Oe,Ie,ke,bt,Ae);var Ne=class r{constructor(t){this.fullscreenService=t;this.isFullscreen$=this.fullscreenService.isFullscreen$}activities=[];period="week";selectedActivityType="Run";selectedMetrics=["speed"];chart=null;groupingType="none";activityTypes=["Run","Ride","Walk/Hike"];metrics=[{value:"speed",label:"Vitesse (km/h)",color:"#2196F3"},{value:"distance",label:"Distance (km)",color:"#4CAF50"},{value:"elevation",label:"D\xE9nivel\xE9 (m)",color:"#FF9800"},{value:"duration",label:"Dur\xE9e (h)",color:"#9C27B0"}];chartContainer;isFullscreen$;toggleFullscreen(){this.chartContainer&&this.fullscreenService.toggleFullscreen(this.chartContainer.nativeElement)}isYearOrCurrentYear(){return this.period==="current_year"||R(this.period)}ngOnChanges(t){(t.activities||t.period)&&this.activities&&this.updateChart()}onActivityTypeChange(t){this.selectedActivityType=t,this.updateChart()}onGroupingChange(t){this.groupingType=t,this.updateChart()}toggleMetric(t){let e=this.selectedMetrics.indexOf(t);e===-1?this.selectedMetrics.push(t):this.selectedMetrics.splice(e,1),this.updateChart()}isMetricSelected(t){return this.selectedMetrics.includes(t)}zoomIn(){this.chart&&this.chart.zoom(1.2)}zoomOut(){this.chart&&this.chart.zoom(.8)}resetZoom(){this.chart&&this.chart.resetZoom()}getWeekNumber(t){let e=new Date(t.getFullYear(),0,1),n=(t.getTime()-e.getTime())/864e5;return Math.ceil((n+e.getDay()+1)/7)}getWeekRange(t){let e=new Date(t);e.setDate(t.getDate()-t.getDay()+1);let n=new Date(e);return n.setDate(e.getDate()+6),{start:e,end:n}}groupActivitiesByWeek(t){if(!t.length)return[];let e=new Map;return t.forEach(n=>{let i=new Date(n.start_date),s=this.getWeekNumber(i),m=this.getWeekRange(i);e.has(s)||e.set(s,{weekNumber:s,weekLabel:`S${s}`,weekStart:m.start,weekEnd:m.end,totalDistance:0,totalDuration:0,averageSpeed:0,totalElevation:0,activitiesCount:0,activities:[]});let g=e.get(s);g.totalDistance+=n.distance,g.totalDuration+=n.elapsed_time,g.totalElevation+=n.total_elevation_gain,g.activitiesCount+=1,g.activities.push({name:n.name,date:new Date(n.start_date)})}),e.forEach(n=>{n.averageSpeed=n.totalDistance/(n.totalDuration/3600)||0,n.activities.sort((i,s)=>s.date.getTime()-i.date.getTime())}),Array.from(e.values()).sort((n,i)=>n.weekNumber-i.weekNumber)}groupActivitiesByMonth(t){if(!t.length)return[];let e=new Map;return t.forEach(n=>{let i=new Date(n.start_date),s=i.getMonth(),m=i.getFullYear(),g=m*100+s;if(!e.has(g)){let p=new Date(m,s,1),f=new Date(m,s+1,0),_=p.toLocaleDateString("fr-FR",{month:"long"});e.set(g,{monthNumber:s,monthLabel:_,monthStart:p,monthEnd:f,totalDistance:0,totalDuration:0,averageSpeed:0,totalElevation:0,activitiesCount:0,activities:[]})}let u=e.get(g);u.totalDistance+=n.distance,u.totalDuration+=n.elapsed_time,u.totalElevation+=n.total_elevation_gain,u.activitiesCount+=1,u.activities.push({name:n.name,date:new Date(n.start_date)})}),e.forEach(n=>{n.averageSpeed=n.totalDistance/(n.totalDuration/3600)||0,n.activities.sort((i,s)=>s.date.getTime()-i.date.getTime())}),Array.from(e.values()).sort((n,i)=>n.monthStart.getTime()-i.monthStart.getTime())}getFilteredActivities(){if(!this.activities)return[];let t=[...this.activities];switch(this.selectedActivityType){case"Run":t=t.filter(e=>e.type.includes("Run"));break;case"Ride":t=t.filter(e=>e.type.includes("Ride"));break;case"Walk/Hike":t=t.filter(e=>e.type.includes("Hike")||e.type.includes("Walk"));break}return t.sort((e,n)=>new Date(e.start_date).getTime()-new Date(n.start_date).getTime())}generateDateLabels(){let t=new Date,e=[],n=[];if((this.period==="current_year"||R(this.period))&&this.groupingType==="week"){let i=we(this.period)??t.getFullYear(),s=new Date(i,0,1),m=new Date(i,11,31),g=new Date(s);g.setDate(g.getDate()+(8-g.getDay())%7);let u=[],p=new Date(g);for(;p<=m;){let _=this.getWeekNumber(p),h=this.getWeekRange(p);u.push({weekNumber:_,weekLabel:`S${_}`,weekStart:new Date(h.start),weekEnd:new Date(h.end),totalDistance:0,totalDuration:0,averageSpeed:0,totalElevation:0,activitiesCount:0,activities:[]}),p.setDate(p.getDate()+7)}this.getFilteredActivities().forEach(_=>{let h=new Date(_.start_date),D=this.getWeekNumber(h),w=u.find(ne=>ne.weekNumber===D);w&&(w.totalDistance+=_.distance,w.totalDuration+=_.elapsed_time,w.totalElevation+=_.total_elevation_gain,w.activitiesCount+=1,w.activities.push({name:_.name,date:new Date(_.start_date)}))}),u.forEach(_=>{_.averageSpeed=_.totalDistance/(_.totalDuration/3600)||0,_.activities.sort((h,D)=>D.date.getTime()-h.date.getTime())}),e.push(...u.map(_=>_.weekStart)),n=u}else if((this.period==="current_year"||R(this.period))&&this.groupingType==="month"){let i=we(this.period)??t.getFullYear(),s=[];for(let g=0;g<12;g++){let u=new Date(i,g,1),p=new Date(i,g+1,0),f=u.toLocaleDateString("fr-FR",{month:"long"});s.push({monthNumber:g,monthLabel:f,monthStart:u,monthEnd:p,totalDistance:0,totalDuration:0,averageSpeed:0,totalElevation:0,activitiesCount:0,activities:[]})}this.getFilteredActivities().forEach(g=>{let p=new Date(g.start_date).getMonth(),f=s.find(_=>_.monthNumber===p);f&&(f.totalDistance+=g.distance,f.totalDuration+=g.elapsed_time,f.totalElevation+=g.total_elevation_gain,f.activitiesCount+=1,f.activities.push({name:g.name,date:new Date(g.start_date)}))}),s.forEach(g=>{g.averageSpeed=g.totalDistance/(g.totalDuration/3600)||0,g.activities.sort((u,p)=>p.date.getTime()-u.date.getTime())}),e.push(...s.map(g=>g.monthStart)),n=s}else{let i,s=new Date(t);switch(this.period){case"week":i=new Date(t),i.setDate(t.getDate()-6);break;case"month":i=new Date(t),i.setDate(t.getDate()-29);break;case"current_year":i=new Date(t.getFullYear(),0,1),i.setHours(0,0,0,0);break;default:let g=we(this.period);g!==null?(i=new Date(g,0,1),s=new Date(g,11,31)):(i=new Date(t),i.setDate(t.getDate()-6));break}let m=new Date(i);for(;m<=s;)e.push(new Date(m)),m.setDate(m.getDate()+1);n=this.getFilteredActivities()}return[e,n]}createDataMap(t,e){let n=new Map;return(this.period==="current_year"||R(this.period))&&this.groupingType==="week"?e.forEach(i=>{n.set(i.weekNumber.toString(),i)}):(this.period==="current_year"||R(this.period))&&this.groupingType==="month"?e.forEach(i=>{n.set(i.monthNumber.toString(),i)}):e.forEach(i=>{let m=new Date(i.start_date).toISOString().split("T")[0];n.set(m,i)}),n}formatDuration(t){let e=Math.round(t*60),n=Math.floor(e/60),i=e%60;return`${n}h${i>0?` ${i}min`:""}`}getMetricValue(t,e){if(!t)return null;if("weekNumber"in t){let n=t;switch(e){case"speed":return n.averageSpeed;case"distance":return n.totalDistance;case"elevation":return n.totalElevation;case"duration":return n.totalDuration/3600;default:return null}}else if("monthNumber"in t){let n=t;switch(e){case"speed":return n.averageSpeed;case"distance":return n.totalDistance;case"elevation":return n.totalElevation;case"duration":return n.totalDuration/3600;default:return null}}else{let n=t;switch(e){case"speed":return n.average_speed;case"distance":return n.distance;case"elevation":return n.total_elevation_gain;case"duration":return n.elapsed_time/3600;default:return null}}}handleLegendClick(t,e){let n=e.datasetIndex;n!==void 0&&n>=0&&n<this.selectedMetrics.length&&this.toggleMetric(this.selectedMetrics[n])}updateChart(){this.chart&&this.chart.destroy();let t=document.getElementById("activityChart");if(!t)return;let[e,n]=this.generateDateLabels(),i=this.createDataMap(e,n),s=this.selectedMetrics.map(p=>{let f=this.metrics.find(h=>h.value===p),_=e.map(h=>{if(!h)return null;if((this.period==="current_year"||R(this.period))&&this.groupingType==="week"){let D=this.getWeekNumber(h),w=i.get(D.toString());return this.getMetricValue(w,p)}else if((this.period==="current_year"||R(this.period))&&this.groupingType==="month"){let D=h.getMonth(),w=i.get(D.toString());return this.getMetricValue(w,p)}else{let D=h.toISOString().split("T")[0],w=i.get(D);return this.getMetricValue(w,p)}});return{label:f.label,data:_,borderColor:f.color,backgroundColor:`${f.color}33`,borderWidth:2,tension:.1,fill:!1,yAxisID:p,spanGaps:!0,pointRadius:_.map(h=>h===null?0:3)}}),m={labels:e.map(p=>p?(this.period==="current_year"||R(this.period))&&this.groupingType==="week"?`Sem. ${this.getWeekNumber(p)}`:(this.period==="current_year"||R(this.period))&&this.groupingType==="month"?p.toLocaleDateString("fr-FR",{month:"short"}):p.toLocaleDateString("fr-FR",{month:"short",day:"numeric"}):""),datasets:s},g={x:{type:"category",grid:{color:"rgba(0, 0, 0, 0.05)"}}};this.selectedMetrics.forEach((p,f)=>{let _=this.metrics.find(h=>h.value===p);g[p]={type:"linear",display:!0,position:f%2===0?"left":"right",grid:{color:`${_.color}22`},title:{display:!0,text:_.label},beginAtZero:!0}});let u=(p,f)=>{if((this.period==="current_year"||R(this.period))&&this.groupingType==="week"){let _=this.getWeekNumber(p),h=f.get(_.toString());if(!h)return"";let D=`Semaine ${h.weekNumber}
`;return D+=`Du ${h.weekStart.toLocaleDateString("fr-FR")} au ${h.weekEnd.toLocaleDateString("fr-FR")}

`,D+=`Activit\xE9s de la semaine:
`,h.activities.forEach(w=>{D+=`- ${w.date.toLocaleDateString("fr-FR")}: ${w.name}
`}),D}else if((this.period==="current_year"||R(this.period))&&this.groupingType==="month"){let _=p.getMonth(),h=f.get(_.toString());if(!h)return"";let D=`${h.monthLabel.charAt(0).toUpperCase()+h.monthLabel.slice(1)}
`;return D+=`Du ${h.monthStart.toLocaleDateString("fr-FR")} au ${h.monthEnd.toLocaleDateString("fr-FR")}

`,D+=`Activit\xE9s du mois:
`,h.activities.forEach(w=>{D+=`- ${w.date.toLocaleDateString("fr-FR")}: ${w.name}
`}),D}else{let _=p.toISOString().split("T")[0],h=f.get(_);return h?`${p.toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long"})}
${h.name}`:""}};this.chart=new ce(t,{type:"line",data:m,options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,position:"top",onClick:(p,f)=>this.handleLegendClick(p,f)},tooltip:{mode:"index",intersect:!1,backgroundColor:"rgba(255, 255, 255, 0.9)",titleColor:"#000",bodyColor:"#666",borderColor:"#ddd",borderWidth:1,callbacks:{title:p=>{let f=p[0].dataIndex;return e[f]?u(e[f],i):""},label:p=>{let f=p.raw;return p.dataset.yAxisID==="duration"?`${p.dataset.label}: ${this.formatDuration(f)}`:`${p.dataset.label}: ${f.toFixed(1)}`}}},zoom:{pan:{enabled:!0,mode:"x",modifierKey:"ctrl"},zoom:{wheel:{enabled:!0,modifierKey:"ctrl"},pinch:{enabled:!0},mode:"x"},limits:{x:{min:"original",max:"original"}}}},scales:g}})}static \u0275fac=function(e){return new(e||r)(A(de))};static \u0275cmp=k({type:r,selectors:[["app-modern-activity-chart"]],viewQuery:function(e,n){if(e&1&&Q(Kt,5),e&2){let i;U(i=X())&&(n.chartContainer=i.first)}},inputs:{activities:"activities",period:"period"},standalone:!0,features:[K,O],decls:32,vars:13,consts:[["chartContainer",""],[1,"card"],[1,"card-header"],[1,"header-main"],[1,"card-title"],[1,"primary-controls"],[1,"select",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["class","grouping-control",4,"ngIf"],[1,"metrics-toggles"],["class","metric-toggle",3,"active","--metric-color","click",4,"ngFor","ngForOf"],[1,"zoom-controls"],[1,"zoom-button",3,"click"],[1,"zoom-icon"],[1,"card-content"],[1,"chart-container"],[1,"fullscreen-button",3,"click"],["viewBox","0 0 24 24",1,"fullscreen-icon"],["d","M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z",4,"ngIf"],["d","M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z",4,"ngIf"],["id","activityChart"],[3,"value"],[1,"grouping-control"],[1,"grouping-options"],[1,"grouping-label"],["type","radio","name","grouping","value","none",3,"change","checked"],["type","radio","name","grouping","value","week",3,"change","checked"],["type","radio","name","grouping","value","month",3,"change","checked"],[1,"metric-toggle",3,"click"],["d","M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"],["d","M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"]],template:function(e,n){if(e&1){let i=E();a(0,"div",1)(1,"div",2)(2,"div",3)(3,"h2",4),c(4,"\xC9volution des performances"),o(),a(5,"div",5)(6,"select",6),ye("ngModelChange",function(m){return x(i),_e(n.selectedActivityType,m)||(n.selectedActivityType=m),M(m)}),b("ngModelChange",function(m){return x(i),M(n.onActivityTypeChange(m))}),C(7,qt,2,2,"option",7),o(),C(8,Qt,11,3,"div",8),a(9,"div",9),C(10,Ut,2,5,"button",10),o()()(),a(11,"div",11)(12,"button",12),b("click",function(){return x(i),M(n.resetZoom())}),a(13,"span",13),c(14,"\u{1F504}"),o()(),a(15,"button",12),b("click",function(){return x(i),M(n.zoomIn())}),a(16,"span",13),c(17,"+"),o()(),a(18,"button",12),b("click",function(){return x(i),M(n.zoomOut())}),a(19,"span",13),c(20,"-"),o()()()(),a(21,"div",14)(22,"div",15,0)(24,"button",16),z(25,"async"),b("click",function(){return x(i),M(n.toggleFullscreen())}),T(),a(26,"svg",17),C(27,Xt,1,0,"path",18),z(28,"async"),C(29,Zt,1,0,"path",19),z(30,"async"),o()(),V(),y(31,"canvas",20),o()()()}e&2&&(l(6),he("ngModel",n.selectedActivityType),l(),d("ngForOf",n.activityTypes),l(),d("ngIf",n.isYearOrCurrentYear()),l(2),d("ngForOf",n.metrics),l(14),ve("aria-label",Z(25,7,n.isFullscreen$)?"Quitter le plein \xE9cran":"Passer en plein \xE9cran"),l(3),d("ngIf",!Z(28,9,n.isFullscreen$)),l(2),d("ngIf",Z(30,11,n.isFullscreen$)))},dependencies:[I,L,F,be,Me,se,le,oe,ae,xe],styles:[".card[_ngcontent-%COMP%]{background:var(--bg-primary);border-radius:var(--radius-lg);box-shadow:var(--shadow-sm);margin:1rem 0;transition:box-shadow .3s ease}.card[_ngcontent-%COMP%]:hover{box-shadow:var(--shadow-md)}.card-header[_ngcontent-%COMP%]{padding:1.5rem;border-bottom:1px solid var(--gray-200);display:flex;justify-content:space-between;align-items:flex-start;flex-wrap:wrap;gap:1rem}.header-main[_ngcontent-%COMP%]{flex:1;min-width:300px}.card-title[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:600;color:var(--text-primary);margin:0}.filters[_ngcontent-%COMP%]{display:flex;gap:1rem;align-items:center}.select[_ngcontent-%COMP%]{padding:.5rem;border:1px solid var(--gray-300);border-radius:var(--radius-sm);background-color:var(--bg-primary);color:var(--text-primary);font-size:.875rem;cursor:pointer;transition:all .2s ease;min-width:120px}.select[_ngcontent-%COMP%]:hover{border-color:var(--primary-500)}.select[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--primary-500);box-shadow:0 0 0 2px #2196f31a}.metrics-toggles[_ngcontent-%COMP%]{display:flex;gap:.5rem;flex-wrap:wrap}.metric-toggle[_ngcontent-%COMP%]{padding:.5rem 1rem;border:1px solid var(--gray-300);border-radius:6px;background:var(--bg-primary);color:var(--text-secondary);cursor:pointer;transition:all .2s;font-size:.875rem}.metric-toggle[_ngcontent-%COMP%]:hover{background:var(--gray-100);color:#fff}.metric-toggle.active[_ngcontent-%COMP%]{background:var(--primary-500);color:var(--bg-primary);border-color:var(--primary-600)}.card-content[_ngcontent-%COMP%]{padding:1.5rem;background:var(--bg-primary)}.chart-container[_ngcontent-%COMP%]{position:relative;height:400px}.fullscreen-button[_ngcontent-%COMP%]{position:absolute;top:1rem;right:1rem;z-index:10;background:var(--bg-primary);border:1px solid var(--gray-200);border-radius:var(--radius-md);padding:.5rem;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s ease}.fullscreen-button[_ngcontent-%COMP%]:hover{background:var(--bg-secondary);transform:scale(1.1)}.fullscreen-icon[_ngcontent-%COMP%]{width:20px;height:20px;fill:var(--text-primary)}[_ngcontent-%COMP%]:fullscreen   .chart-container[_ngcontent-%COMP%]{height:100vh;width:100vw;display:flex;align-items:center;justify-content:center;background-color:var(--bg-primary)}[_ngcontent-%COMP%]:fullscreen   canvas[_ngcontent-%COMP%]{width:100%!important;height:100%!important;max-height:100vh}@media screen and (orientation: landscape){[_ngcontent-%COMP%]:fullscreen   canvas[_ngcontent-%COMP%]{width:auto!important;height:100%!important}}.primary-controls[_ngcontent-%COMP%]{display:flex;gap:1rem;align-items:center;flex-wrap:wrap;margin-top:1rem}.zoom-controls[_ngcontent-%COMP%]{display:flex;gap:.5rem;align-items:flex-start}.zoom-button[_ngcontent-%COMP%]{width:36px;height:36px;padding:0;border:1px solid var(--gray-300);border-radius:var(--radius-sm);background:var(--bg-primary);color:var(--text-primary);cursor:pointer;transition:all .2s;display:flex;align-items:center;justify-content:center}.zoom-button[_ngcontent-%COMP%]:hover{background:var(--bg-secondary);border-color:var(--primary-500);color:var(--primary-500)}.zoom-icon[_ngcontent-%COMP%]{font-size:1rem;line-height:1}@media (max-width: 768px){.card-header[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch}.zoom-controls[_ngcontent-%COMP%]{justify-content:flex-end}}@media (max-width: 768px){.card-header[_ngcontent-%COMP%]{flex-direction:column;gap:1rem}.filters[_ngcontent-%COMP%]{width:100%;flex-direction:column}.select[_ngcontent-%COMP%]{width:100%}.metrics-toggles[_ngcontent-%COMP%]{width:100%;justify-content:center}}.grouping-control[_ngcontent-%COMP%]{display:flex;align-items:center;margin:0 1rem}.grouping-options[_ngcontent-%COMP%]{display:flex;gap:1rem;align-items:center}.grouping-label[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;font-size:.875rem;color:var(--text-secondary);cursor:pointer;transition:color .2s}.grouping-label[_ngcontent-%COMP%]:hover{color:var(--text-primary)}.grouping-label[_ngcontent-%COMP%]   input[type=radio][_ngcontent-%COMP%]{width:1rem;height:1rem;accent-color:var(--primary-500);cursor:pointer}@media (max-width: 768px){.grouping-control[_ngcontent-%COMP%]{width:100%;margin:.5rem 0}.grouping-options[_ngcontent-%COMP%]{width:100%;flex-direction:row;gap:.5rem;justify-content:space-around}.grouping-label[_ngcontent-%COMP%]{font-size:.8rem;white-space:nowrap}.primary-controls[_ngcontent-%COMP%]{flex-direction:column;gap:1rem;width:100%}.primary-controls[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:100%}}"]})};var Jt=["chartContainer"];function en(r,t){if(r&1&&(a(0,"option",17),c(1),o()),r&2){let e=t.$implicit;d("value",e),l(),S(" ",e," ")}}function tn(r,t){r&1&&(T(),y(0,"path",18))}function nn(r,t){r&1&&(T(),y(0,"path",19))}ce.register(Ee,Te,Ct,De,Pe,Oe,Ie,ke,Ae);var Le=class r{constructor(t){this.fullscreenService=t;this.isFullscreen$=this.fullscreenService.isFullscreen$}activities=[];selectedActivityType="Run";chart=null;activityTypes=["Run","Ride","Walk/Hike"];chartContainer;isFullscreen$;toggleFullscreen(){this.chartContainer&&this.fullscreenService.toggleFullscreen(this.chartContainer.nativeElement)}ngOnChanges(t){t.activities&&this.activities&&this.updateChart()}onActivityTypeChange(t){this.selectedActivityType=t,this.updateChart()}zoomIn(){this.chart&&this.chart.zoom(1.2)}zoomOut(){this.chart&&this.chart.zoom(.8)}resetZoom(){this.chart&&this.chart.resetZoom()}roundDistance(t){return Math.round(t*10)/10}getFilteredActivities(){if(!this.activities)return[];let t=[...this.activities];switch(this.selectedActivityType){case"Run":t=t.filter(e=>e.type.includes("Run"));break;case"Ride":t=t.filter(e=>e.type.includes("Ride"));break;case"Walk/Hike":t=t.filter(e=>e.type.includes("Hike")||e.type.includes("Walk"));break}return t.sort((e,n)=>new Date(e.start_date).getTime()-new Date(n.start_date).getTime())}convertSpeedToPace(t){return 60/t}formatPace(t){let e=Math.floor(t),n=Math.round((t-e)*60);return`${e}'${n.toString().padStart(2,"0")}"`}calculateTrendLine(t){let e=t.length;if(e<2)return{slope:0,intercept:0};let n=0,i=0,s=0,m=0;t.forEach(p=>{n+=p.x,i+=p.y,s+=p.x*p.y,m+=p.x*p.x});let g=(e*s-n*i)/(e*m-n*n),u=(i-g*n)/e;return{slope:g,intercept:u}}generateTrendLineData(t){if(t.length<2)return[];let{slope:e,intercept:n}=this.calculateTrendLine(t),i=Math.min(...t.map(m=>m.x)),s=Math.max(...t.map(m=>m.x));return[{x:i,y:e*i+n,date:new Date,name:"Trend"},{x:s,y:e*s+n,date:new Date,name:"Trend"}]}updateChart(){let t=document.getElementById("paceScatterChart");if(!t)return;this.chart&&this.chart.destroy();let n=this.getFilteredActivities().map(u=>({x:this.roundDistance(u.distance),y:this.selectedActivityType==="Ride"?u.average_speed:this.convertSpeedToPace(u.average_speed),date:new Date(u.start_date),name:u.name})),i=this.generateTrendLineData(n),s=this.selectedActivityType==="Ride"?"Vitesse (km/h)":"Allure (min/km)",m=0,g=Math.max(...n.map(u=>u.x))+1;this.chart=new ce(t,{type:"scatter",data:{datasets:[{label:this.selectedActivityType,data:n,backgroundColor:"rgba(33, 150, 243, 0.6)",borderColor:"rgba(33, 150, 243, 1)",borderWidth:1,pointRadius:4,pointHoverRadius:6},{label:"Tendance",data:i,type:"line",borderColor:"rgba(255, 99, 132, 0.8)",borderWidth:2,pointRadius:0,fill:!1}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{x:{title:{display:!0,text:"Distance (km)"},min:m,max:g},y:{title:{display:!0,text:s},reverse:this.selectedActivityType==="Ride",ticks:{callback:u=>this.selectedActivityType==="Ride"?`${u} km/h`:u%1===0?this.formatPace(Number(u)):""}}},plugins:{tooltip:{enabled:!0,callbacks:{label:u=>{if(u.datasetIndex===1)return"";let p=n[u.dataIndex],f=`${p.name}
`;return f+=`Distance: ${p.x.toFixed(1)} km
`,this.selectedActivityType==="Ride"?f+=`Vitesse: ${p.y.toFixed(1)} km/h`:f+=`Allure: ${this.formatPace(p.y)}/km`,f+=`
Date: ${p.date.toLocaleDateString()}`,f}}},zoom:{pan:{enabled:!0,mode:"xy"},zoom:{wheel:{enabled:!0},pinch:{enabled:!0},mode:"xy"}}}}})}static \u0275fac=function(e){return new(e||r)(A(de))};static \u0275cmp=k({type:r,selectors:[["app-pace-scatter"]],viewQuery:function(e,n){if(e&1&&Q(Jt,5),e&2){let i;U(i=X())&&(n.chartContainer=i.first)}},inputs:{activities:"activities"},standalone:!0,features:[K,O],decls:28,vars:11,consts:[["chartContainer",""],[1,"scatter-card"],[1,"card-header"],[1,"header-main"],[1,"card-title"],[1,"controls"],[1,"select",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],[1,"zoom-controls"],[1,"zoom-button",3,"click"],[1,"zoom-icon"],[1,"chart-container"],[1,"fullscreen-button",3,"click"],["viewBox","0 0 24 24",1,"fullscreen-icon"],["d","M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z",4,"ngIf"],["d","M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z",4,"ngIf"],["id","paceScatterChart"],[3,"value"],["d","M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"],["d","M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"]],template:function(e,n){if(e&1){let i=E();a(0,"div",1)(1,"div",2)(2,"div",3)(3,"h2",4),c(4,"Distance vs Allure"),o(),a(5,"div",5)(6,"select",6),ye("ngModelChange",function(m){return x(i),_e(n.selectedActivityType,m)||(n.selectedActivityType=m),M(m)}),b("ngModelChange",function(m){return x(i),M(n.onActivityTypeChange(m))}),C(7,en,2,2,"option",7),o(),a(8,"div",8)(9,"button",9),b("click",function(){return x(i),M(n.resetZoom())}),a(10,"span",10),c(11,"\u{1F504}"),o()(),a(12,"button",9),b("click",function(){return x(i),M(n.zoomIn())}),a(13,"span",10),c(14,"+"),o()(),a(15,"button",9),b("click",function(){return x(i),M(n.zoomOut())}),a(16,"span",10),c(17,"-"),o()()()()()(),a(18,"div",11,0)(20,"button",12),z(21,"async"),b("click",function(){return x(i),M(n.toggleFullscreen())}),T(),a(22,"svg",13),C(23,tn,1,0,"path",14),z(24,"async"),C(25,nn,1,0,"path",15),z(26,"async"),o()(),V(),y(27,"canvas",16),o()()}e&2&&(l(6),he("ngModel",n.selectedActivityType),l(),d("ngForOf",n.activityTypes),l(13),ve("aria-label",Z(21,5,n.isFullscreen$)?"Quitter le plein \xE9cran":"Passer en plein \xE9cran"),l(3),d("ngIf",!Z(24,7,n.isFullscreen$)),l(2),d("ngIf",Z(26,9,n.isFullscreen$)))},dependencies:[I,L,F,be,Me,se,le,oe,ae,xe],styles:[".scatter-card[_ngcontent-%COMP%]{background:var(--bg-primary);border-radius:var(--radius-lg);box-shadow:var(--shadow-sm);margin:1rem 0;transition:box-shadow .3s ease}.scatter-card[_ngcontent-%COMP%]:hover{box-shadow:var(--shadow-md)}.card-header[_ngcontent-%COMP%]{padding:1.5rem;border-bottom:1px solid var(--gray-200)}.header-main[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:1rem}.card-title[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:600;color:var(--text-primary);margin:0}.controls[_ngcontent-%COMP%]{display:flex;gap:1rem;align-items:center}.select[_ngcontent-%COMP%]{padding:.5rem;border:1px solid var(--gray-300);border-radius:var(--radius-sm);background-color:var(--bg-primary);color:var(--text-primary);font-size:.875rem;cursor:pointer;transition:all .2s ease;min-width:120px}.select[_ngcontent-%COMP%]:hover{border-color:var(--primary-500)}.select[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--primary-500);box-shadow:0 0 0 2px #2196f31a}.zoom-controls[_ngcontent-%COMP%]{display:flex;gap:.5rem;align-items:center}.zoom-button[_ngcontent-%COMP%]{width:36px;height:36px;padding:0;border:1px solid var(--gray-300);border-radius:var(--radius-sm);background:var(--bg-primary);color:var(--text-primary);cursor:pointer;transition:all .2s;display:flex;align-items:center;justify-content:center}.zoom-button[_ngcontent-%COMP%]:hover{background:var(--bg-secondary);border-color:var(--primary-500);color:var(--primary-500)}.zoom-icon[_ngcontent-%COMP%]{font-size:1rem;line-height:1}.chart-container[_ngcontent-%COMP%]{position:relative;height:400px}.fullscreen-button[_ngcontent-%COMP%]{position:absolute;top:1rem;right:1rem;z-index:10;background:var(--bg-primary);border:1px solid var(--gray-200);border-radius:var(--radius-md);padding:.5rem;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s ease}.fullscreen-button[_ngcontent-%COMP%]:hover{background:var(--bg-secondary);transform:scale(1.1)}.fullscreen-icon[_ngcontent-%COMP%]{width:20px;height:20px;fill:var(--text-primary)}[_ngcontent-%COMP%]:fullscreen   .chart-container[_ngcontent-%COMP%]{height:100vh;width:100vw;display:flex;align-items:center;justify-content:center;background-color:var(--bg-primary)}[_ngcontent-%COMP%]:fullscreen   canvas[_ngcontent-%COMP%]{width:100%!important;height:100%!important;max-height:100vh}@media screen and (orientation: landscape){[_ngcontent-%COMP%]:fullscreen   canvas[_ngcontent-%COMP%]{width:auto!important;height:100%!important}}@media (max-width: 768px){.header-main[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch}.controls[_ngcontent-%COMP%]{flex-direction:column;gap:.5rem}.zoom-controls[_ngcontent-%COMP%]{justify-content:flex-end}.select[_ngcontent-%COMP%]{width:100%}}"]})};function rn(r,t){if(r&1&&(a(0,"div",13),c(1),o()),r&2){let e=v(2);l(),S(" ",e.formatDateRange(e.streakInfo==null?null:e.streakInfo.currentStreakStart,e.streakInfo==null?null:e.streakInfo.currentStreakEnd)," ")}}function an(r,t){r&1&&(a(0,"div",14),c(1," Commencez votre streak aujourd'hui ! "),o())}function on(r,t){if(r&1&&(a(0,"div",4)(1,"div",5),c(2,"\u{1F525}"),o(),a(3,"div",6)(4,"div",7),c(5,"Streak Actuel"),o(),a(6,"div",8)(7,"span",9),c(8),o(),a(9,"span",10),c(10),o()(),C(11,rn,2,1,"div",11)(12,an,2,0,"div",12),o()()),r&2){let e=v();l(8),P((e.streakInfo==null?null:e.streakInfo.currentStreak)||0),l(2),P(e.getDayLabel((e.streakInfo==null?null:e.streakInfo.currentStreak)||0)),l(),d("ngIf",e.hasCurrentStreak),l(),d("ngIf",!e.hasCurrentStreak)}}function sn(r,t){if(r&1&&(a(0,"div",13),c(1),o()),r&2){let e=v(2);l(),S(" ",e.formatDateRange(e.streakInfo==null?null:e.streakInfo.longestStreakStart,e.streakInfo==null?null:e.streakInfo.longestStreakEnd)," ")}}function ln(r,t){r&1&&(a(0,"div",14),c(1," Aucune activit\xE9 pour le moment "),o())}function cn(r,t){if(r&1&&(a(0,"div",15)(1,"div",5),c(2,"\u{1F3C6}"),o(),a(3,"div",6)(4,"div",7),c(5,"Meilleur Streak"),o(),a(6,"div",8)(7,"span",9),c(8),o(),a(9,"span",10),c(10),o()(),C(11,sn,2,1,"div",11)(12,ln,2,0,"div",12),o()()),r&2){let e=v();l(8),P((e.streakInfo==null?null:e.streakInfo.longestStreak)||0),l(2),P(e.getDayLabel((e.streakInfo==null?null:e.streakInfo.longestStreak)||0)),l(),d("ngIf",e.hasLongestStreak),l(),d("ngIf",!e.hasLongestStreak)}}function dn(r,t){r&1&&(a(0,"div",16),y(1,"div",17),o())}var je=class r{streakInfo=null;loading=!1;get hasCurrentStreak(){return!!this.streakInfo&&this.streakInfo.currentStreak>0}get hasLongestStreak(){return!!this.streakInfo&&this.streakInfo.longestStreak>0}formatDateRange(t,e){return!t||!e?"":t.getTime()===e.getTime()?this.formatDate(t):`${this.formatDate(t)} - ${this.formatDate(e)}`}formatDate(t){let e={month:"short",day:"numeric",year:t.getFullYear()!==new Date().getFullYear()?"numeric":void 0};return t.toLocaleDateString("fr-FR",e)}getDayLabel(t){return t===1?"jour":"jours"}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=k({type:r,selectors:[["app-streak-badge"]],inputs:{streakInfo:"streakInfo",loading:"loading"},standalone:!0,features:[O],decls:4,vars:3,consts:[[1,"streak-container"],["class","streak-card current-streak",4,"ngIf"],["class","streak-card longest-streak",4,"ngIf"],["class","streak-loading",4,"ngIf"],[1,"streak-card","current-streak"],[1,"streak-icon"],[1,"streak-content"],[1,"streak-label"],[1,"streak-value"],[1,"streak-number"],[1,"streak-unit"],["class","streak-date",4,"ngIf"],["class","streak-empty",4,"ngIf"],[1,"streak-date"],[1,"streak-empty"],[1,"streak-card","longest-streak"],[1,"streak-loading"],[1,"loading-spinner"]],template:function(e,n){e&1&&(a(0,"div",0),C(1,on,13,4,"div",1)(2,cn,13,4,"div",2)(3,dn,2,0,"div",3),o()),e&2&&(l(),d("ngIf",!n.loading),l(),d("ngIf",!n.loading),l(),d("ngIf",n.loading))},dependencies:[I,F],styles:[".streak-container[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:1rem;width:100%}.streak-card[_ngcontent-%COMP%]{background:var(--bg-primary);border:1px solid var(--gray-200);border-radius:var(--radius-md);box-shadow:var(--shadow-sm);padding:1.5rem;display:flex;align-items:center;gap:1rem;transition:transform .3s,box-shadow .3s}.streak-card[_ngcontent-%COMP%]:hover{box-shadow:var(--shadow-md);transform:translateY(-2px)}.streak-card.current-streak[_ngcontent-%COMP%]{border-left:4px solid var(--orange-500)}.streak-card.longest-streak[_ngcontent-%COMP%]{border-left:4px solid var(--yellow-500)}.streak-icon[_ngcontent-%COMP%]{font-size:2.5rem;line-height:1;flex-shrink:0}.streak-content[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;gap:.25rem}.streak-label[_ngcontent-%COMP%]{color:var(--text-secondary);font-size:.75rem;font-weight:600;text-transform:uppercase;letter-spacing:.5px}.streak-value[_ngcontent-%COMP%]{display:flex;align-items:baseline;gap:.5rem}.streak-number[_ngcontent-%COMP%]{color:var(--primary-500);font-size:2rem;font-weight:700;line-height:1;font-variant-numeric:tabular-nums}.streak-unit[_ngcontent-%COMP%]{color:var(--text-secondary);font-size:.875rem;font-weight:500}.streak-date[_ngcontent-%COMP%]{color:var(--text-tertiary);font-size:.75rem;margin-top:.25rem}.streak-empty[_ngcontent-%COMP%]{color:var(--text-tertiary);font-size:.75rem;font-style:italic;margin-top:.25rem}.streak-loading[_ngcontent-%COMP%]{grid-column:1 / -1;display:flex;justify-content:center;align-items:center;padding:2rem}.loading-spinner[_ngcontent-%COMP%]{width:40px;height:40px;border:3px solid var(--gray-200);border-top:3px solid var(--primary-500);border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}@media (max-width: 768px){.streak-container[_ngcontent-%COMP%]{grid-template-columns:1fr}.streak-card[_ngcontent-%COMP%]{padding:1rem}.streak-icon[_ngcontent-%COMP%]{font-size:2rem}.streak-number[_ngcontent-%COMP%]{font-size:1.5rem}}"]})};function mn(r,t){if(r&1){let e=E();a(0,"div",24)(1,"button",25),b("click",function(){x(e);let i=v(2);return M(i.onEdit())}),T(),a(2,"svg",26),y(3,"path",27),o()(),V(),a(4,"button",28),b("click",function(){x(e);let i=v(2);return M(i.onDelete())}),T(),a(5,"svg",26),y(6,"path",29),o()()()}}function pn(r,t){if(r&1&&(a(0,"span"),c(1),o()),r&2){let e=v(2);l(),Ye(" \xC0 ce rythme : ",e.formatValue(e.progress.projection,e.progress.goal.type)," (",e.progress.projectionPercentage.toFixed(0),"%) ")}}function gn(r,t){r&1&&(a(0,"span",30),c(1," \u{1F389} Objectif atteint ! "),o())}function un(r,t){if(r&1&&(a(0,"span"),c(1),o()),r&2){let e=v(2);l(),Ze(" ",e.progress.daysRemaining," jour",e.progress.daysRemaining>1?"s":""," restant",e.progress.daysRemaining>1?"s":""," ")}}function vn(r,t){r&1&&(a(0,"span"),c(1," Dernier jour ! "),o())}function fn(r,t){if(r&1&&(a(0,"div",2)(1,"div",3)(2,"div",4)(3,"span",5),c(4),o(),a(5,"div",6)(6,"h3",7),c(7),o(),a(8,"p",8),c(9),o()()(),C(10,mn,7,0,"div",9),o(),a(11,"div",10)(12,"div",11)(13,"span",12),c(14,"Progression"),o(),a(15,"span",13),c(16),o()(),a(17,"div",11)(18,"span",12),c(19,"Compl\xE9t\xE9"),o(),a(20,"span",13),c(21),o()()(),a(22,"div",14)(23,"div",15),y(24,"div",16),o()(),a(25,"div",17)(26,"div",18),T(),a(27,"svg",19),y(28,"path",20),o(),C(29,pn,2,2,"span",21)(30,gn,2,0,"span",22),o(),V(),a(31,"div",23),C(32,un,2,3,"span",21)(33,vn,2,0,"span",21),o()()()),r&2){let e=v();l(4),P(e.statusIcon),l(3),P(e.progress.goal.name),l(2),P(e.getPeriodLabel(e.progress.goal.period)),l(),d("ngIf",e.showActions),l(6),Ye(" ",e.formatValue(e.progress.current,e.progress.goal.type)," / ",e.formatValue(e.progress.goal.target,e.progress.goal.type)," "),l(5),S("",e.progress.percentage.toFixed(1),"%"),l(3),J("width",e.progress.percentage,"%")("background-color",e.progressBarColor),l(2),J("color",e.projectionColor),l(3),d("ngIf",!e.progress.isCompleted),l(),d("ngIf",e.progress.isCompleted),l(2),d("ngIf",e.progress.daysRemaining>0),l(),d("ngIf",e.progress.daysRemaining===0)}}function hn(r,t){r&1&&(a(0,"div",31)(1,"p"),c(2,"Aucun objectif d\xE9fini"),o()())}var He=class r{progress=null;showActions=!0;edit=new q;delete=new q;get progressBarColor(){return this.progress?this.progress.isCompleted?"var(--green-500)":this.progress.isOnTrack?"var(--primary-500)":"var(--orange-500)":"var(--gray-300)"}get projectionColor(){return this.progress?this.progress.isOnTrack?"var(--green-600)":"var(--orange-600)":"var(--text-secondary)"}get statusIcon(){return this.progress?this.progress.isCompleted?"\u2705":this.progress.isOnTrack?"\u{1F4C8}":"\u26A0\uFE0F":"\u{1F3AF}"}formatValue(t,e){switch(e){case"distance":return`${t.toFixed(1)} km`;case"time":let n=Math.floor(t/3600),i=Math.floor(t%3600/60);return`${n}h ${i}min`;case"count":return`${Math.floor(t)} activit\xE9${Math.floor(t)>1?"s":""}`;default:return t.toFixed(1)}}getPeriodLabel(t){return{week:"cette semaine",month:"ce mois",year:"cette ann\xE9e",custom:"p\xE9riode personnalis\xE9e"}[t]||t}onEdit(){this.progress&&this.edit.emit(this.progress.goal.id)}onDelete(){this.progress&&confirm("\xCAtes-vous s\xFBr de vouloir supprimer cet objectif ?")&&this.delete.emit(this.progress.goal.id)}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=k({type:r,selectors:[["app-goal-card"]],inputs:{progress:"progress",showActions:"showActions"},outputs:{edit:"edit",delete:"delete"},standalone:!0,features:[O],decls:2,vars:2,consts:[["class","goal-card",4,"ngIf"],["class","goal-card-empty",4,"ngIf"],[1,"goal-card"],[1,"goal-header"],[1,"goal-title-section"],[1,"goal-icon"],[1,"goal-info"],[1,"goal-name"],[1,"goal-period"],["class","goal-actions",4,"ngIf"],[1,"goal-stats"],[1,"stat"],[1,"stat-label"],[1,"stat-value"],[1,"progress-bar-container"],[1,"progress-bar-bg"],[1,"progress-bar-fill"],[1,"goal-projection"],[1,"projection-text"],["viewBox","0 0 24 24","width","16","height","16",1,"projection-icon"],["fill","currentColor","d","M16 6l2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"],[4,"ngIf"],["class","completed-text",4,"ngIf"],[1,"days-remaining"],[1,"goal-actions"],["title","Modifier",1,"action-btn","edit-btn",3,"click"],["viewBox","0 0 24 24","width","16","height","16"],["fill","currentColor","d","M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"],["title","Supprimer",1,"action-btn","delete-btn",3,"click"],["fill","currentColor","d","M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"],[1,"completed-text"],[1,"goal-card-empty"]],template:function(e,n){e&1&&C(0,fn,34,17,"div",0)(1,hn,3,0,"div",1),e&2&&(d("ngIf",n.progress),l(),d("ngIf",!n.progress))},dependencies:[I,F],styles:['.goal-card[_ngcontent-%COMP%]{background:var(--bg-primary);border:1px solid var(--gray-200);border-radius:var(--radius-md);box-shadow:var(--shadow-sm);padding:1.5rem;transition:transform .2s,box-shadow .2s}.goal-card[_ngcontent-%COMP%]:hover{box-shadow:var(--shadow-md);transform:translateY(-2px)}.goal-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:1.25rem}.goal-title-section[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:.75rem;flex:1}.goal-icon[_ngcontent-%COMP%]{font-size:1.5rem;line-height:1;flex-shrink:0}.goal-info[_ngcontent-%COMP%]{flex:1;min-width:0}.goal-name[_ngcontent-%COMP%]{color:var(--text-primary);font-size:1.125rem;font-weight:600;margin:0 0 .25rem}.goal-period[_ngcontent-%COMP%]{color:var(--text-secondary);font-size:.875rem;margin:0}.goal-actions[_ngcontent-%COMP%]{display:flex;gap:.5rem;flex-shrink:0}.action-btn[_ngcontent-%COMP%]{background:transparent;border:1px solid var(--gray-300);border-radius:var(--radius-sm);padding:.5rem;cursor:pointer;color:var(--text-secondary);transition:all .2s;display:flex;align-items:center;justify-content:center}.action-btn[_ngcontent-%COMP%]:hover{background:var(--gray-100);border-color:var(--gray-400);color:var(--text-primary)}.edit-btn[_ngcontent-%COMP%]:hover{border-color:var(--primary-500);color:var(--primary-500)}.delete-btn[_ngcontent-%COMP%]:hover{border-color:var(--orange-500);color:var(--orange-500)}.goal-stats[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:1rem;margin-bottom:1rem}.stat[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem}.stat-label[_ngcontent-%COMP%]{color:var(--text-secondary);font-size:.75rem;font-weight:500;text-transform:uppercase;letter-spacing:.5px}.stat-value[_ngcontent-%COMP%]{color:var(--text-primary);font-size:1.125rem;font-weight:600;font-variant-numeric:tabular-nums}.progress-bar-container[_ngcontent-%COMP%]{margin-bottom:1rem}.progress-bar-bg[_ngcontent-%COMP%]{background:var(--gray-200);border-radius:var(--radius-sm);height:12px;overflow:hidden;position:relative}.progress-bar-fill[_ngcontent-%COMP%]{height:100%;border-radius:var(--radius-sm);transition:width .5s ease,background-color .3s ease;position:relative}.progress-bar-fill[_ngcontent-%COMP%]:after{content:"";position:absolute;inset:0;background:linear-gradient(90deg,transparent,rgba(255,255,255,.2),transparent);animation:_ngcontent-%COMP%_shimmer 2s infinite}@keyframes _ngcontent-%COMP%_shimmer{0%{transform:translate(-100%)}to{transform:translate(100%)}}.goal-projection[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding-top:1rem;border-top:1px solid var(--gray-200);gap:1rem}.projection-text[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;font-size:.875rem;font-weight:500;flex:1}.projection-icon[_ngcontent-%COMP%]{flex-shrink:0}.completed-text[_ngcontent-%COMP%]{font-weight:600}.days-remaining[_ngcontent-%COMP%]{color:var(--text-tertiary);font-size:.75rem;font-weight:500;white-space:nowrap}.goal-card-empty[_ngcontent-%COMP%]{background:var(--bg-secondary);border:2px dashed var(--gray-300);border-radius:var(--radius-md);padding:2rem;text-align:center;color:var(--text-secondary)}.goal-card-empty[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:.875rem}@media (max-width: 768px){.goal-card[_ngcontent-%COMP%]{padding:1rem}.goal-name[_ngcontent-%COMP%]{font-size:1rem}.goal-stats[_ngcontent-%COMP%]{gap:.75rem}.stat-value[_ngcontent-%COMP%]{font-size:1rem}.goal-projection[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:.5rem}.days-remaining[_ngcontent-%COMP%]{align-self:flex-end}}']})};function _n(r,t){r&1&&(a(0,"div",26),c(1," Le nom est requis (max 50 caract\xE8res) "),o())}function yn(r,t){if(r&1&&(a(0,"label",27),y(1,"input",28),a(2,"span"),c(3),o()()),r&2){let e=t.$implicit;l(),d("value",e.value),l(2),P(e.label)}}function Cn(r,t){r&1&&(a(0,"div",26),c(1," L'objectif doit \xEAtre sup\xE9rieur \xE0 0 "),o())}function bn(r,t){if(r&1&&(a(0,"option",29),c(1),o()),r&2){let e=t.$implicit;d("value",e.value),l(),S(" ",e.label," ")}}function xn(r,t){r&1&&(a(0,"div",30)(1,"div",8)(2,"label",31),c(3,"Date de d\xE9but"),o(),y(4,"input",32),o(),a(5,"div",8)(6,"label",33),c(7,"Date de fin"),o(),y(8,"input",34),o()())}function Mn(r,t){if(r&1){let e=E();a(0,"button",35),b("click",function(){let i=x(e).$implicit,s=v();return M(s.onSportToggle(i))}),c(1),o()}if(r&2){let e=t.$implicit,n=v();N("selected",n.isSportSelected(e)),l(),S(" ",n.getSportLabel(e)," ")}}var $e=class r{constructor(t){this.fb=t}goal=null;availableSports=[];save=new q;cancel=new q;goalForm;isEditMode=!1;goalTypes=[{value:"distance",label:"Distance",unit:"km"},{value:"time",label:"Temps",unit:"heures"},{value:"count",label:"Nombre d'activit\xE9s",unit:"activit\xE9s"}];periods=[{value:"week",label:"Cette semaine"},{value:"month",label:"Ce mois"},{value:"year",label:"Cette ann\xE9e"},{value:"custom",label:"P\xE9riode personnalis\xE9e"}];ngOnInit(){this.isEditMode=!!this.goal,this.initForm()}initForm(){this.goalForm=this.fb.group({name:[this.goal?.name||"",[$.required,$.maxLength(50)]],type:[this.goal?.type||"distance",$.required],target:[this.goal?.target||100,[$.required,$.min(1)]],period:[this.goal?.period||"month",$.required],sportTypes:[this.goal?.sportTypes||[]],startDate:[this.goal?.startDate?this.formatDateForInput(this.goal.startDate):""],endDate:[this.goal?.endDate?this.formatDateForInput(this.goal.endDate):""]}),this.goalForm.get("period")?.valueChanges.subscribe(t=>{t==="custom"?(this.goalForm.get("startDate")?.setValidators($.required),this.goalForm.get("endDate")?.setValidators($.required)):(this.goalForm.get("startDate")?.clearValidators(),this.goalForm.get("endDate")?.clearValidators()),this.goalForm.get("startDate")?.updateValueAndValidity(),this.goalForm.get("endDate")?.updateValueAndValidity()})}get selectedType(){return this.goalForm.get("type")?.value}get selectedPeriod(){return this.goalForm.get("period")?.value}get currentUnit(){return this.goalTypes.find(e=>e.value===this.selectedType)?.unit||""}onSportToggle(t){let e=this.goalForm.get("sportTypes")?.value||[],n=e.indexOf(t);n===-1?e.push(t):e.splice(n,1),this.goalForm.patchValue({sportTypes:e})}isSportSelected(t){return(this.goalForm.get("sportTypes")?.value||[]).includes(t)}getSportLabel(t){return Se(t).label}onSubmit(){if(this.goalForm.valid){let t=this.goalForm.value,e={name:t.name,type:t.type,target:t.type==="time"?t.target*3600:t.target,period:t.period,sportTypes:t.sportTypes.length>0?t.sportTypes:void 0};t.period==="custom"&&(e.startDate=new Date(t.startDate),e.endDate=new Date(t.endDate)),this.save.emit(e)}}onCancel(){this.cancel.emit()}onOverlayMouseDown(t){t.target===t.currentTarget&&this.onCancel()}formatDateForInput(t){let e=new Date(t),n=e.getFullYear(),i=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0");return`${n}-${i}-${s}`}static \u0275fac=function(e){return new(e||r)(A(ct))};static \u0275cmp=k({type:r,selectors:[["app-goal-form"]],inputs:{goal:"goal",availableSports:"availableSports"},outputs:{save:"save",cancel:"cancel"},standalone:!0,features:[O],decls:42,vars:13,consts:[[1,"modal-overlay",3,"mousedown"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button",1,"close-btn",3,"click"],["viewBox","0 0 24 24","width","24","height","24"],["fill","currentColor","d","M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"],[1,"goal-form",3,"ngSubmit","formGroup"],[1,"form-group"],["for","name"],["type","text","id","name","formControlName","name","placeholder","Ex: 100 km ce mois",1,"form-input"],["class","error-message",4,"ngIf"],[1,"radio-group"],["class","radio-label",4,"ngFor","ngForOf"],["for","target"],["type","number","id","target","formControlName","target",1,"form-input",3,"min","step"],["for","period"],["id","period","formControlName","period",1,"form-select"],[3,"value",4,"ngFor","ngForOf"],["class","custom-dates",4,"ngIf"],[1,"hint"],[1,"sport-chips"],["type","button","class","sport-chip",3,"selected","click",4,"ngFor","ngForOf"],[1,"form-actions"],["type","button",1,"btn","btn-secondary",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled"],[1,"error-message"],[1,"radio-label"],["type","radio","formControlName","type",3,"value"],[3,"value"],[1,"custom-dates"],["for","startDate"],["type","date","id","startDate","formControlName","startDate",1,"form-input"],["for","endDate"],["type","date","id","endDate","formControlName","endDate",1,"form-input"],["type","button",1,"sport-chip",3,"click"]],template:function(e,n){if(e&1&&(a(0,"div",0),b("mousedown",function(s){return n.onOverlayMouseDown(s)}),a(1,"div",1)(2,"div",2)(3,"h2",3),c(4),o(),a(5,"button",4),b("click",function(){return n.onCancel()}),T(),a(6,"svg",5),y(7,"path",6),o()()(),V(),a(8,"form",7),b("ngSubmit",function(){return n.onSubmit()}),a(9,"div",8)(10,"label",9),c(11,"Nom de l'objectif"),o(),y(12,"input",10),C(13,_n,2,0,"div",11),o(),a(14,"div",8)(15,"label"),c(16,"Type d'objectif"),o(),a(17,"div",12),C(18,yn,4,2,"label",13),o()(),a(19,"div",8)(20,"label",14),c(21),o(),y(22,"input",15),C(23,Cn,2,0,"div",11),o(),a(24,"div",8)(25,"label",16),c(26,"P\xE9riode"),o(),a(27,"select",17),C(28,bn,2,2,"option",18),o()(),C(29,xn,9,0,"div",19),a(30,"div",8)(31,"label"),c(32,"Sports concern\xE9s (optionnel)"),o(),a(33,"p",20),c(34,"Laisser vide pour tous les sports"),o(),a(35,"div",21),C(36,Mn,2,3,"button",22),o()(),a(37,"div",23)(38,"button",24),b("click",function(){return n.onCancel()}),c(39," Annuler "),o(),a(40,"button",25),c(41),o()()()()()),e&2){let i,s;l(4),P(n.isEditMode?"Modifier l'objectif":"Nouvel objectif"),l(4),d("formGroup",n.goalForm),l(5),d("ngIf",((i=n.goalForm.get("name"))==null?null:i.invalid)&&((i=n.goalForm.get("name"))==null?null:i.touched)),l(5),d("ngForOf",n.goalTypes),l(3),S("Objectif (",n.currentUnit,")"),l(),d("min",1)("step",n.selectedType==="distance"?.1:1),l(),d("ngIf",((s=n.goalForm.get("target"))==null?null:s.invalid)&&((s=n.goalForm.get("target"))==null?null:s.touched)),l(5),d("ngForOf",n.periods),l(),d("ngIf",n.selectedPeriod==="custom"),l(7),d("ngForOf",n.availableSports),l(4),d("disabled",n.goalForm.invalid),l(),S(" ",n.isEditMode?"Enregistrer":"Cr\xE9er l'objectif"," ")}},dependencies:[I,L,F,dt,it,se,le,tt,rt,oe,at,ae,nt,lt,ot,st],styles:[".modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#00000080;display:flex;align-items:center;justify-content:center;z-index:1000;padding:1rem;animation:_ngcontent-%COMP%_fadeIn .2s ease}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}.modal-content[_ngcontent-%COMP%]{background:var(--bg-primary);border-radius:var(--radius-lg);box-shadow:var(--shadow-xl);max-width:600px;width:100%;max-height:90vh;overflow-y:auto;animation:_ngcontent-%COMP%_slideUp .3s ease}@keyframes _ngcontent-%COMP%_slideUp{0%{transform:translateY(20px);opacity:0}to{transform:translateY(0);opacity:1}}.modal-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:1.5rem;border-bottom:1px solid var(--gray-200)}.modal-title[_ngcontent-%COMP%]{color:var(--text-primary);font-size:1.25rem;font-weight:600;margin:0}.close-btn[_ngcontent-%COMP%]{background:transparent;border:none;color:var(--text-secondary);cursor:pointer;padding:.25rem;display:flex;align-items:center;justify-content:center;border-radius:var(--radius-sm);transition:background-color .2s,color .2s}.close-btn[_ngcontent-%COMP%]:hover{background:var(--gray-100);color:var(--text-primary)}.goal-form[_ngcontent-%COMP%]{padding:1.5rem;display:flex;flex-direction:column;gap:1.5rem}.form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{color:var(--text-primary);font-size:.875rem;font-weight:600}.hint[_ngcontent-%COMP%]{color:var(--text-tertiary);font-size:.75rem;margin:-.25rem 0 0}.form-input[_ngcontent-%COMP%], .form-select[_ngcontent-%COMP%]{background:var(--bg-primary);border:1px solid var(--gray-300);border-radius:var(--radius-md);padding:.75rem 1rem;font-size:.875rem;color:var(--text-primary);transition:border-color .2s,box-shadow .2s}.form-input[_ngcontent-%COMP%]:focus, .form-select[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--primary-500);box-shadow:0 0 0 3px #2196f31a}.form-input[_ngcontent-%COMP%]::placeholder{color:var(--text-tertiary)}.error-message[_ngcontent-%COMP%]{color:var(--orange-600);font-size:.75rem;margin-top:-.25rem}.radio-group[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:1rem}.radio-label[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;cursor:pointer;color:var(--text-secondary);font-weight:500;transition:color .2s}.radio-label[_ngcontent-%COMP%]:hover{color:var(--text-primary)}.radio-label[_ngcontent-%COMP%]   input[type=radio][_ngcontent-%COMP%]{cursor:pointer;width:18px;height:18px;accent-color:var(--primary-500)}.custom-dates[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:1rem}.sport-chips[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.5rem}.sport-chip[_ngcontent-%COMP%]{background:var(--bg-secondary);border:1px solid var(--gray-300);border-radius:var(--radius-md);padding:.5rem 1rem;font-size:.875rem;color:var(--text-secondary);cursor:pointer;transition:all .2s}.sport-chip[_ngcontent-%COMP%]:hover{border-color:var(--primary-400);color:var(--text-primary)}.sport-chip.selected[_ngcontent-%COMP%]{background:var(--primary-500);border-color:var(--primary-500);color:#fff}.form-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:1rem;padding-top:1rem;border-top:1px solid var(--gray-200)}.btn[_ngcontent-%COMP%]{padding:.75rem 1.5rem;border-radius:var(--radius-md);font-size:.875rem;font-weight:600;cursor:pointer;transition:all .2s;border:none}.btn-secondary[_ngcontent-%COMP%]{background:var(--bg-secondary);color:var(--text-primary);border:1px solid var(--gray-300)}.btn-secondary[_ngcontent-%COMP%]:hover{background:var(--gray-200)}.btn-primary[_ngcontent-%COMP%]{background:var(--primary-500);color:#fff}.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){background:var(--primary-600)}.btn-primary[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}@media (max-width: 768px){.modal-content[_ngcontent-%COMP%]{max-height:95vh}.modal-header[_ngcontent-%COMP%], .goal-form[_ngcontent-%COMP%]{padding:1rem}.modal-title[_ngcontent-%COMP%]{font-size:1.125rem}.custom-dates[_ngcontent-%COMP%]{grid-template-columns:1fr}.form-actions[_ngcontent-%COMP%]{flex-direction:column-reverse}.btn[_ngcontent-%COMP%]{width:100%}}"]})};var Be=class r{constructor(){}calculateStreaks(t){if(!t||t.length===0)return{currentStreak:0,longestStreak:0};let e=this.groupActivitiesByDate(t),n=Array.from(e.keys()).sort((w,ne)=>w-ne).map(w=>new Date(w));if(n.length===0)return{currentStreak:0,longestStreak:0};let i=this.getDateWithoutTime(new Date),s=0,m,g,u=new Date(i);for(;;){let w=this.getDateWithoutTime(u).getTime();if(e.has(w))s++,m=new Date(u),g||(g=new Date(u)),u.setDate(u.getDate()-1);else break}let p=0,f,_,h=1,D=n[0];for(let w=1;w<n.length;w++){let ne=n[w-1],ie=n[w];Math.floor((ie.getTime()-ne.getTime())/(1e3*60*60*24))===1?h++:(h>p&&(p=h,f=new Date(D),_=new Date(n[w-1])),h=1,D=ie)}return h>p&&(p=h,f=new Date(D),_=new Date(n[n.length-1])),s>p&&(p=s,f=m,_=g),{currentStreak:s,longestStreak:p,currentStreakStart:m,currentStreakEnd:g,longestStreakStart:f,longestStreakEnd:_}}generateHeatmapData(t,e=365){let n=this.groupActivitiesByDate(t),i=[],s=new Date;for(let m=e-1;m>=0;m--){let g=new Date(s);g.setDate(g.getDate()-m);let u=this.getDateWithoutTime(g),p=u.getTime(),f=n.get(p)||[];i.push({date:u,count:f.length,activities:f})}return i}generateMonthHeatmapData(t,e,n){let i=this.groupActivitiesByDate(t),s=[],m=new Date(e,n,1),g=new Date(e,n+1,0);for(let u=1;u<=g.getDate();u++){let p=new Date(e,n,u),f=this.getDateWithoutTime(p),_=f.getTime(),h=i.get(_)||[];s.push({date:f,count:h.length,activities:h})}return s}groupActivitiesByDate(t){let e=new Map;return t.forEach(n=>{let s=this.getDateWithoutTime(new Date(n.start_date)).getTime();e.has(s)||e.set(s,[]),e.get(s).push(n)}),e}getDateWithoutTime(t){return new Date(t.getFullYear(),t.getMonth(),t.getDate())}hasActivitiesOnDate(t,e){let n=this.getDateWithoutTime(e);return t.some(i=>this.getDateWithoutTime(new Date(i.start_date)).getTime()===n.getTime())}getActivitiesForDate(t,e){let n=this.getDateWithoutTime(e);return t.filter(i=>this.getDateWithoutTime(new Date(i.start_date)).getTime()===n.getTime())}static \u0275fac=function(e){return new(e||r)};static \u0275prov=Y({token:r,factory:r.\u0275fac,providedIn:"root"})};var We=class r{STORAGE_KEY="strava_goals";goalsSubject=new ge([]);goals$=this.goalsSubject.asObservable();constructor(){this.loadGoals()}loadGoals(){let t=localStorage.getItem(this.STORAGE_KEY);if(t)try{let e=JSON.parse(t);e.forEach(n=>{n.createdAt=new Date(n.createdAt),n.startDate&&(n.startDate=new Date(n.startDate)),n.endDate&&(n.endDate=new Date(n.endDate))}),this.goalsSubject.next(e)}catch(e){console.error("Error loading goals:",e),this.goalsSubject.next([])}}saveGoals(t){localStorage.setItem(this.STORAGE_KEY,JSON.stringify(t)),this.goalsSubject.next(t)}getGoals(){return this.goalsSubject.value}getGoalById(t){return this.goalsSubject.value.find(e=>e.id===t)}createGoal(t){let e=qe(H({},t),{id:this.generateId(),createdAt:new Date}),n=[...this.goalsSubject.value,e];return this.saveGoals(n),e}updateGoal(t,e){let n=this.goalsSubject.value,i=n.findIndex(m=>m.id===t);if(i===-1)return;let s=H(H({},n[i]),e);return n[i]=s,this.saveGoals(n),s}deleteGoal(t){let e=this.goalsSubject.value.filter(n=>n.id!==t);return e.length===this.goalsSubject.value.length?!1:(this.saveGoals(e),!0)}calculateProgress(t,e){let{startDate:n,endDate:i}=this.getGoalPeriodDates(t),s=new Date,m=e.filter(W=>{let re=new Date(W.start_date);return re>=n&&re<=i}),g=t.sportTypes&&t.sportTypes.length>0?m.filter(W=>t.sportTypes.includes(W.sport_type||W.type)):m,u=0;switch(t.type){case"distance":u=g.reduce((W,re)=>W+re.distance,0);break;case"time":u=g.reduce((W,re)=>W+re.elapsed_time,0);break;case"count":u=g.length;break}let p=u/t.target*100,f=Math.max(0,t.target-u),_=u>=t.target,h=Math.ceil((i.getTime()-n.getTime())/(1e3*60*60*24)),D=Math.max(1,Math.ceil((s.getTime()-n.getTime())/(1e3*60*60*24))),w=Math.max(0,Math.ceil((i.getTime()-s.getTime())/(1e3*60*60*24))),ie=u/D*h,Ke=ie/t.target*100,Pt=ie>=t.target;return{goal:t,current:u,percentage:Math.min(100,p),remaining:f,projection:ie,projectionPercentage:Ke,daysRemaining:w,daysElapsed:D,totalDays:h,isOnTrack:Pt,isCompleted:_}}getGoalPeriodDates(t){let e=new Date,n,i;switch(t.period){case"week":n=new Date(e);let s=n.getDay(),m=n.getDate()-s+(s===0?-6:1);n.setDate(m),n.setHours(0,0,0,0),i=new Date(n),i.setDate(n.getDate()+6),i.setHours(23,59,59,999);break;case"month":n=new Date(e.getFullYear(),e.getMonth(),1,0,0,0,0),i=new Date(e.getFullYear(),e.getMonth()+1,0,23,59,59,999);break;case"year":n=new Date(e.getFullYear(),0,1,0,0,0,0),i=new Date(e.getFullYear(),11,31,23,59,59,999);break;case"custom":if(!t.startDate||!t.endDate)throw new Error("Custom period requires startDate and endDate");n=new Date(t.startDate),n.setHours(0,0,0,0),i=new Date(t.endDate),i.setHours(23,59,59,999);break;default:throw new Error(`Unknown goal period: ${t.period}`)}return{startDate:n,endDate:i}}getActiveGoals(){let t=new Date;return this.goalsSubject.value.filter(e=>{let{startDate:n,endDate:i}=this.getGoalPeriodDates(e);return t>=n&&t<=i})}generateId(){return`goal_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}static \u0275fac=function(e){return new(e||r)};static \u0275prov=Y({token:r,factory:r.\u0275fac,providedIn:"root"})};function Pn(r,t){r&1&&(a(0,"div",6),y(1,"app-spinner"),a(2,"div",7),c(3," Chargement de toutes vos activit\xE9s des deux derni\xE8res ann\xE9es..."),y(4,"br"),a(5,"span",8),c(6,"Cela peut prendre quelques secondes"),o()()())}function Dn(r,t){r&1&&(a(0,"div",9),y(1,"app-spinner"),a(2,"div",10),c(3,"Chargement des activit\xE9s..."),o()())}function kn(r,t){if(r&1){let e=E();a(0,"div",12)(1,"div",13)(2,"p"),c(3,"Votre session a expir\xE9 ou n'est plus valide."),o(),a(4,"button",14),b("click",function(){x(e);let i=v(2);return M(i.reconnectToStrava())}),c(5," Se reconnecter \xE0 Strava "),o()()()}}function On(r,t){if(r&1){let e=E();a(0,"div",12)(1,"div",13)(2,"p"),c(3),o(),a(4,"button",14),b("click",function(){x(e);let i=v(2);return M(i.loadData())}),c(5," R\xE9essayer "),o()()()}if(r&2){let e=v(2);l(3),P(e.error)}}function In(r,t){if(r&1&&(a(0,"div",21),y(1,"app-streak-badge",22),o()),r&2){let e=v(3);l(),d("streakInfo",e.streakInfo)("loading",e.isLoading)}}function Tn(r,t){if(r&1){let e=E();a(0,"app-goal-card",30),b("edit",function(i){x(e);let s=v(4);return M(s.onEditGoal(i))})("delete",function(i){x(e);let s=v(4);return M(s.onDeleteGoal(i))}),o()}if(r&2){let e=t.$implicit;d("progress",e)}}function En(r,t){if(r&1){let e=E();a(0,"div",23)(1,"div",24),C(2,Tn,1,1,"app-goal-card",25),a(3,"button",26),b("click",function(){x(e);let i=v(3);return M(i.openCreateGoalForm())}),T(),a(4,"svg",27),y(5,"path",28),o(),V(),a(6,"span",29),c(7,"Ajouter un objectif"),o()()()()}if(r&2){let e=v(3);l(2),d("ngForOf",e.limitedGoalProgresses)}}function An(r,t){if(r&1&&(ee(0),y(1,"app-stats-list",31),te()),r&2){let e=t.$implicit,n=v(3);l(),d("title",e.group.name)("stats",e.stats)("selectedPeriod",n.selectedPeriod)("groupColor",e.group.color)("groupIcon",e.group.icon)("visibleMetrics",e.group.visibleMetrics)}}function Fn(r,t){if(r&1&&(a(0,"div"),y(1,"app-performance-dashboard",15),C(2,In,2,2,"div",16)(3,En,8,1,"div",17),a(4,"div",18),C(5,An,2,6,"ng-container",19),y(6,"app-modern-activity-chart",20)(7,"app-pace-scatter",15),o()()),r&2){let e=v(2);l(),d("activities",e.runningActivityData),l(),d("ngIf",e.displayPreferences.showStreaks),l(),d("ngIf",e.displayPreferences.showGoals&&!e.isLoading),l(2),d("ngForOf",e.groupedStatsData)("ngForTrackBy",e.trackByGroupId),l(),d("activities",e.allActivities)("period",e.selectedPeriod),l(),d("activities",e.allActivities)}}function Vn(r,t){if(r&1&&(ee(0),C(1,kn,6,0,"div",11)(2,On,6,1,"div",11)(3,Fn,8,8,"div",3),te()),r&2){let e=v();l(),d("ngIf",e.authError),l(),d("ngIf",e.error&&!e.authError),l(),d("ngIf",!e.error&&!e.authError)}}function Gn(r,t){r&1&&(a(0,"div",32)(1,"div",33),T(),a(2,"svg",34),y(3,"path",35),o(),V(),a(4,"span"),c(5,"Application en d\xE9veloppement"),o()()())}function zn(r,t){if(r&1){let e=E();a(0,"app-goal-form",36),b("save",function(i){x(e);let s=v();return M(s.onSaveGoal(i))})("cancel",function(){x(e);let i=v();return M(i.onCancelGoalForm())}),o()}if(r&2){let e=v();d("goal",e.editingGoal)("availableSports",e.availableSports)}}var wt=class r{constructor(t,e,n,i,s,m,g,u,p){this.stravaService=t;this.statsService=e;this.router=n;this.activityCache=i;this.sportConfigService=s;this.periodStateService=m;this.streakService=g;this.goalService=u;this.displayPreferencesService=p}destroy$=new Qe;selectedPeriod="week";isLoading=!1;isInitialLoad=!0;error=null;authError=!1;groupedStatsData=[];runningActivityData=[];allActivities=[];streakInfo=null;goalProgresses=[];showGoalForm=!1;editingGoal=null;availableSports=[];displayPreferences={showStreaks:!0,showGoals:!0};ngOnInit(){this.checkAuth()&&(this.displayPreferencesService.getPreferences().pipe(ue(this.destroy$)).subscribe(t=>{this.displayPreferences=t}),this.sportConfigService.config$.pipe(ue(this.destroy$)).subscribe(()=>{this.allActivities.length>0&&this.updateActivitiesDisplay(this.allActivities)}),this.periodStateService.dashboardPeriod$.pipe(ue(this.destroy$),Ue()).subscribe(t=>{t!==this.selectedPeriod&&(this.selectedPeriod=t,this.allActivities.length>0&&this.loadData())}),this.loadInitialData())}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}onPeriodChange(t){this.selectedPeriod=t,this.checkAuth()&&this.loadData()}reconnectToStrava(){localStorage.clear(),this.stravaService.authenticate()}loadInitialData(){if(this.isLoading=!0,this.isInitialLoad=!0,this.error=null,this.authError=!1,!this.activityCache.needsRefresh(this.selectedPeriod)){let t=this.activityCache.getFilteredActivities(this.selectedPeriod);this.updateActivitiesDisplay(t),this.isLoading=!1,this.isInitialLoad=!1;return}this.stravaService.loadAllRecentActivities().subscribe({next:t=>{let e=this.activityCache.getFilteredActivities(this.selectedPeriod);this.updateActivitiesDisplay(e),this.isLoading=!1,this.isInitialLoad=!1},error:t=>{console.error("Error loading activities:",t),this.isLoading=!1,this.isInitialLoad=!1,t.status===401?this.handleAuthError():(this.error="Une erreur est survenue lors du chargement des donn\xE9es.",this.authError=!1)}})}loadData(){this.isLoading=!0,this.error=null,this.authError=!1,this.stravaService.getActivities(this.selectedPeriod).subscribe({next:t=>{this.updateActivitiesDisplay(t),this.isLoading=!1},error:t=>{console.error("Error loading activities:",t),this.isLoading=!1,t.status===401?this.handleAuthError():(this.error="Une erreur est survenue lors du chargement des donn\xE9es.",this.authError=!1)}})}updateActivitiesDisplay(t){this.allActivities=t,this.streakInfo=this.streakService.calculateStreaks(t),this.updateGoalProgresses(t),this.sportConfigService.detectAvailableTypes(t);let e=this.sportConfigService.getEnabledGroups();this.groupedStatsData=e.map(s=>{let m=this.sportConfigService.filterActivitiesByGroup(t,s);return{group:s,activities:m,stats:this.statsService.calculateStats(m)}});let n=this.sportConfigService.getConfig();for(let s of n.ungroupedSportsEnabled){let m=Se(s),g=t.filter(u=>(u.sport_type||u.type)===s);if(g.length>0){let p=this.sportConfigService.getUngroupedSportConfig(s)?.visibleMetrics||pt([s]),f={id:`individual-${s}`,name:m.label,types:[s],icon:m.icon,color:this.getColorForCategory(m.category),isDefault:!1,isEnabled:!0,order:999,visibleMetrics:p};this.groupedStatsData.push({group:f,activities:g,stats:this.statsService.calculateStats(g)})}}let i=e.find(s=>s.id==="running")||e.find(s=>s.types.some(m=>m.includes("Run")));i?this.runningActivityData=this.sportConfigService.filterActivitiesByGroup(t,i):this.runningActivityData=t.filter(s=>s.type.includes("Run"))}getColorForCategory(t){return{running:"#ef4444",cycling:"#3b82f6",walking:"#22c55e",fitness:"#8b5cf6",water:"#06b6d4",winter:"#64748b",other:"#f97316"}[t]||"#6b7280"}trackByGroupId(t,e){return e.group.id}checkAuth(){let t=localStorage.getItem("strava_token"),e=localStorage.getItem("strava_token_expires_at");return!t||!e||Date.now()/1e3>Number(e)?(this.handleAuthError(),!1):!0}handleAuthError(){this.authError=!0,this.error=null,this.isLoading=!1}updateGoalProgresses(t){let e=this.goalService.getActiveGoals(),n=this.activityCache.getAllActivities();this.goalProgresses=e.map(i=>this.goalService.calculateProgress(i,n))}openCreateGoalForm(){this.editingGoal=null,this.updateAvailableSports(),this.showGoalForm=!0}onEditGoal(t){let e=this.goalService.getGoalById(t);e&&(this.editingGoal=e,this.updateAvailableSports(),this.showGoalForm=!0)}onSaveGoal(t){this.editingGoal?this.goalService.updateGoal(this.editingGoal.id,t):t.name&&t.type&&t.target&&t.period&&this.goalService.createGoal({name:t.name,type:t.type,target:t.target,period:t.period,sportTypes:t.sportTypes,startDate:t.startDate,endDate:t.endDate}),this.showGoalForm=!1,this.editingGoal=null,this.updateGoalProgresses(this.activityCache.getAllActivities())}onCancelGoalForm(){this.showGoalForm=!1,this.editingGoal=null}onDeleteGoal(t){this.goalService.deleteGoal(t),this.updateGoalProgresses(this.activityCache.getAllActivities())}updateAvailableSports(){let t=this.activityCache.getAllActivities(),e=new Set;t.forEach(n=>{e.add(n.sport_type||n.type)}),this.availableSports=Array.from(e).sort()}get limitedGoalProgresses(){return this.goalProgresses.slice(0,4)}static \u0275fac=function(e){return new(e||r)(A(ht),A(xt),A(et),A(ft),A(gt),A(ut),A(Be),A(We),A(vt))};static \u0275cmp=k({type:r,selectors:[["app-dashboard"]],standalone:!0,features:[O],decls:6,vars:5,consts:[[1,"dashboard-container"],["class","initial-load-container",4,"ngIf"],["class","spinner-overlay",4,"ngIf"],[4,"ngIf"],["class","dev-banner",4,"ngIf"],[3,"goal","availableSports","save","cancel",4,"ngIf"],[1,"initial-load-container"],[1,"initial-load-message"],[1,"initial-load-submessage"],[1,"spinner-overlay"],[1,"spinner-text"],["class","error-container",4,"ngIf"],[1,"error-container"],[1,"error-message"],[1,"retry-button",3,"click"],[3,"activities"],["class","streak-section",4,"ngIf"],["class","goals-section",4,"ngIf"],[1,"activity-type-container"],[4,"ngFor","ngForOf","ngForTrackBy"],[3,"activities","period"],[1,"streak-section"],[3,"streakInfo","loading"],[1,"goals-section"],[1,"goals-grid"],[3,"progress","edit","delete",4,"ngFor","ngForOf"],[1,"add-goal-card",3,"click"],["viewBox","0 0 24 24","width","32","height","32",1,"add-icon"],["fill","currentColor","d","M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"],[1,"add-label"],[3,"edit","delete","progress"],[3,"title","stats","selectedPeriod","groupColor","groupIcon","visibleMetrics"],[1,"dev-banner"],[1,"dev-banner-content"],["viewBox","0 0 24 24","width","16","height","16",1,"dev-icon"],["fill","currentColor","d","M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm-1-5h2v2h-2zm0-8h2v6h-2z"],[3,"save","cancel","goal","availableSports"]],template:function(e,n){e&1&&(a(0,"div",0),C(1,Pn,7,0,"div",1)(2,Dn,4,0,"div",2)(3,Vn,4,3,"ng-container",3)(4,Gn,6,0,"div",4)(5,zn,1,2,"app-goal-form",5),o()),e&2&&(l(),d("ngIf",n.isInitialLoad),l(),d("ngIf",n.isLoading&&!n.isInitialLoad),l(),d("ngIf",!n.isLoading),l(),d("ngIf",!n.authError),l(),d("ngIf",n.showGoalForm))},dependencies:[I,L,F,Ge,_t,Re,Ne,Le,je,He,$e],styles:[".dashboard-container[_ngcontent-%COMP%]{padding:20px;max-width:95%;margin:0 auto;min-height:100vh;position:relative}.dev-banner[_ngcontent-%COMP%]{background:var(--bg-secondary);color:var(--text-secondary);padding:.5rem;margin-top:2rem;border-radius:var(--radius-sm);border:1px solid var(--gray-200);opacity:.7;transition:opacity .2s ease}.dev-banner[_ngcontent-%COMP%]:hover{opacity:1}.dev-banner-content[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:.5rem;max-width:1200px;margin:0 auto;font-size:.75rem;line-height:1.3}.dev-icon[_ngcontent-%COMP%]{flex-shrink:0;opacity:.6}.streak-section[_ngcontent-%COMP%], .goals-section[_ngcontent-%COMP%]{margin:2rem 0}.add-goal-card[_ngcontent-%COMP%]{background:var(--bg-primary);border:2px dashed var(--gray-300);border-radius:var(--radius-md);padding:2rem;cursor:pointer;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:1rem;transition:all .2s;min-height:200px;color:var(--text-secondary)}.add-goal-card[_ngcontent-%COMP%]:hover{border-color:var(--primary-500);background:var(--primary-50);transform:translateY(-2px);box-shadow:var(--shadow-md)}.add-goal-card[_ngcontent-%COMP%]   .add-icon[_ngcontent-%COMP%]{color:var(--primary-500);opacity:.8;transition:transform .2s}.add-goal-card[_ngcontent-%COMP%]:hover   .add-icon[_ngcontent-%COMP%]{transform:scale(1.1);opacity:1}.add-goal-card[_ngcontent-%COMP%]   .add-label[_ngcontent-%COMP%]{font-size:.875rem;font-weight:600;color:var(--text-secondary)}.add-goal-card[_ngcontent-%COMP%]:hover   .add-label[_ngcontent-%COMP%]{color:var(--primary-600)}.goals-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:1rem}.activity-type-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:3rem;grid-template-columns:1fr}@keyframes _ngcontent-%COMP%_slideDown{0%{transform:translateY(-100%);opacity:0}to{transform:translateY(0);opacity:1}}@keyframes _ngcontent-%COMP%_pulse{0%{opacity:.6}50%{opacity:1}to{opacity:.6}}@media (max-width: 768px){.dev-banner[_ngcontent-%COMP%]{margin-top:1.5rem}.dev-banner-content[_ngcontent-%COMP%]{font-size:.7rem;gap:.375rem}}.error-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;min-height:200px;width:100%}.error-message[_ngcontent-%COMP%]{background:var(--bg-primary);border:1px solid var(--primary-200);border-radius:var(--radius-lg);padding:1.5rem;text-align:center;max-width:400px;width:90%;color:var(--text-primary);box-shadow:var(--shadow-sm)}.error-icon[_ngcontent-%COMP%]{font-size:24px;margin-bottom:10px}.retry-button[_ngcontent-%COMP%]{background-color:var(--primary-500);color:#fff;border:none;padding:.75rem 1.5rem;border-radius:var(--radius-md);margin-top:1rem;font-size:.95rem;font-weight:500;cursor:pointer;transition:background-color .2s}.retry-button[_ngcontent-%COMP%]:hover{background-color:var(--primary-600)}@media (max-width: 1024px){.goals-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(auto-fill,minmax(260px,1fr))}}@media (max-width: 768px){.dashboard-container[_ngcontent-%COMP%]{padding:10px}.streak-section[_ngcontent-%COMP%], .goals-section[_ngcontent-%COMP%]{margin:1.5rem 0}.activity-type-container[_ngcontent-%COMP%], .goals-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}.add-goal-card[_ngcontent-%COMP%]{min-height:auto;padding:1rem;flex-direction:row;justify-content:center;gap:.75rem}.add-goal-card[_ngcontent-%COMP%]   .add-icon[_ngcontent-%COMP%]{width:24px;height:24px}.add-goal-card[_ngcontent-%COMP%]   .add-label[_ngcontent-%COMP%]{font-size:.8125rem}}@media (max-width: 480px){.dashboard-container[_ngcontent-%COMP%]{padding:5px}h2[_ngcontent-%COMP%]{font-size:1.2rem}}.initial-load-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:60vh;gap:1.5rem}.initial-load-message[_ngcontent-%COMP%]{color:var(--text-primary);font-size:1.1rem;font-weight:500;text-align:center;padding:0 1rem;line-height:1.6}.initial-load-submessage[_ngcontent-%COMP%]{font-size:.9rem;font-weight:400;opacity:.7}.spinner-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#fffc;display:flex;flex-direction:column;justify-content:center;align-items:center;z-index:1000}.spinner-text[_ngcontent-%COMP%]{margin-top:1rem;color:#2196f3;font-weight:500}@media (max-width: 768px){.spinner-text[_ngcontent-%COMP%]{font-size:.9rem}}"]})};export{wt as DashboardComponent};
