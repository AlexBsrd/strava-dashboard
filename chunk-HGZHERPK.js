import{a as Ne}from"./chunk-6AW7VQTK.js";import{b as ce,c as le,d as me,e as de,f as pe,g as ue,h as He,i as We,j as Q,k as ge,l as he,m as $e,n as ve,o as fe,p as _e,q as ye,r as Ce,t as be,u as je}from"./chunk-SAZ7MQNW.js";import{a as Le}from"./chunk-3TRPC32M.js";import{$ as G,A as N,B as y,C,D as T,Da as Ie,E as R,Ea as Y,Fa as I,G as Ee,Ga as se,I as Te,Ja as Fe,Ka as k,M as c,N as F,Sa as Ve,T as x,U as te,V as p,W as Ae,X as L,Xa as Re,Y as a,Z as o,Za as ze,_ as M,a as X,aa as K,ba as E,ca as b,da as _,ea as H,fa as W,ga as $,h as ke,ha as ne,ia as l,ja as A,ka as w,ma as ie,na as ae,oa as re,qa as D,s as ee,sa as V,ta as j,ua as Z,va as oe,x as O}from"./chunk-ZJMJXUHG.js";function Ye(r,t){if(r&1&&(a(0,"div",7)(1,"span",8),l(2),o(),a(3,"span",9),l(4,"h"),o()()),r&2){let e=_(2);c(2),A(e.timeValues.hours)}}function Qe(r,t){if(r&1&&(G(0),a(1,"div",5),x(2,Ye,5,1,"div",6),a(3,"div",7)(4,"span",8),l(5),o(),a(6,"span",9),l(7,"min"),o()()(),K()),r&2){let e=_();c(),L("animating",e.animationFrameId!==null),c(),p("ngIf",e.timeValues.hours>0),c(3),A(e.timeValues.minutes)}}function qe(r,t){if(r&1&&(a(0,"div",10),l(1),a(2,"span",11),l(3),o()()),r&2){let e=_();L("animating",e.animationFrameId!==null),c(),w(" ",e.formattedValue," "),c(2),A(e.unit)}}var xe=class r{constructor(t){this.elementRef=t}title="";value=0;unit="";isTime=!1;currentValue=0;animationFrameId=null;ANIMATION_DURATION=2e3;hasAnimated=!1;startTime=null;observer=null;get timeValues(){if(!this.isTime)return{hours:0,minutes:0};let t=this.currentValue,e=Math.floor(t/3600),n=Math.floor(t%3600/60);return{hours:e,minutes:n}}get formattedValue(){return this.isTime?"":this.currentValue.toFixed(1)}ngOnInit(){}ngAfterViewInit(){this.setupIntersectionObserver()}ngOnChanges(t){t.value&&!t.value.firstChange&&this.startAnimation()}ngOnDestroy(){this.animationFrameId!==null&&cancelAnimationFrame(this.animationFrameId),this.observer&&this.observer.disconnect()}setupIntersectionObserver(){let t={root:null,rootMargin:"0px",threshold:.1};this.observer=new IntersectionObserver(e=>{e.forEach(n=>{n.isIntersecting&&!this.hasAnimated&&(this.startAnimation(),this.hasAnimated=!0)})},t),this.observer.observe(this.elementRef.nativeElement)}startAnimation(){this.animationFrameId!==null&&cancelAnimationFrame(this.animationFrameId);let t=this.currentValue,e=this.value;this.startTime=null;let n=i=>{this.startTime===null&&(this.startTime=i);let s=i-this.startTime,d=Math.min(s/this.ANIMATION_DURATION,1),h=(m=>1-Math.pow(1-m,4))(d);this.currentValue=t+(e-t)*h,d<1?this.animationFrameId=requestAnimationFrame(n):(this.currentValue=e,this.animationFrameId=null)};this.animationFrameId=requestAnimationFrame(n)}static \u0275fac=function(e){return new(e||r)(F(Te))};static \u0275cmp=O({type:r,selectors:[["app-stats-card"]],inputs:{title:"title",value:"value",unit:"unit",isTime:"isTime"},standalone:!0,features:[N,D],decls:7,vars:5,consts:[["defaultValue",""],[1,"stats-card"],[1,"stats-title"],[1,"stats-value"],[4,"ngIf","ngIfElse"],[1,"time-display"],["class","time-group",4,"ngIf"],[1,"time-group"],[1,"time-number"],[1,"time-unit"],[1,"number-display"],[1,"stats-unit"]],template:function(e,n){if(e&1&&(a(0,"div",1)(1,"div",2),l(2),o(),a(3,"div",3),x(4,Qe,8,4,"ng-container",4)(5,qe,4,4,"ng-template",null,0,oe),o()()),e&2){let i=ne(6);L("visible",n.hasAnimated),c(2),A(n.title),c(2),p("ngIf",n.isTime)("ngIfElse",i)}},dependencies:[k,I],styles:[".stats-card[_ngcontent-%COMP%]{background:var(--bg-primary);border:1px solid var(--gray-200);border-radius:var(--radius-md);box-shadow:var(--shadow-sm);display:flex;flex-direction:column;height:100%;justify-content:center;padding:1.5rem;text-align:center;transition:transform .3s,box-shadow .3s}.stats-card[_ngcontent-%COMP%]:hover{box-shadow:var(--shadow-md);transform:translateY(-2px)}.stats-title[_ngcontent-%COMP%]{color:var(--text-secondary);font-size:.875rem;font-weight:500;letter-spacing:.5px;margin-bottom:.75rem;text-transform:uppercase}.stats-value[_ngcontent-%COMP%]{color:var(--primary-500);font-size:2rem;font-weight:600;line-height:1.2;margin-bottom:.25rem}.number-display[_ngcontent-%COMP%], .time-display[_ngcontent-%COMP%]{font-variant-numeric:tabular-nums;transition:color .3s ease}.number-display.animating[_ngcontent-%COMP%], .time-display.animating[_ngcontent-%COMP%]{color:var(--primary-600)}.stats-unit[_ngcontent-%COMP%]{color:var(--text-secondary);font-size:.875rem;margin-left:.25rem}.time-display[_ngcontent-%COMP%]{display:flex;align-items:baseline;justify-content:center;gap:.75rem}.time-group[_ngcontent-%COMP%]{display:flex;align-items:baseline;gap:.15rem}.time-number[_ngcontent-%COMP%]{color:var(--primary-color);font-size:2.25rem;font-weight:600;line-height:1}.time-unit[_ngcontent-%COMP%]{color:var(--gray-600);font-size:1.25rem;font-weight:400}.time-display[_ngcontent-%COMP%]:not(:has(.hours))   .time-number[_ngcontent-%COMP%]{color:var(--primary-color)}@media (max-width: 768px){.time-display[_ngcontent-%COMP%]{gap:.5rem}.time-number[_ngcontent-%COMP%]{font-size:1.75rem}.time-unit[_ngcontent-%COMP%]{font-size:1rem}.stats-card[_ngcontent-%COMP%]{padding:1rem}}","@keyframes _ngcontent-%COMP%_slideInFromBottom{0%{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}@keyframes _ngcontent-%COMP%_countUp{0%{opacity:0;transform:translateY(10px)}20%{opacity:1}to{opacity:1;transform:translateY(0)}}.stats-card[_ngcontent-%COMP%]{opacity:0}.stats-card.visible[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_slideInFromBottom .6s ease-out forwards}.stats-value[_ngcontent-%COMP%]{opacity:0}.stats-card.visible[_ngcontent-%COMP%]   .stats-value[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_countUp .8s ease-out forwards;animation-delay:.3s}.stats-card.visible[_ngcontent-%COMP%]:nth-child(1){animation-delay:.1s}.stats-card.visible[_ngcontent-%COMP%]:nth-child(2){animation-delay:.2s}.stats-card.visible[_ngcontent-%COMP%]:nth-child(3){animation-delay:.3s}.stats-card.visible[_ngcontent-%COMP%]:nth-child(4){animation-delay:.4s}@keyframes _ngcontent-%COMP%_glowPulse{0%{color:var(--primary-500)}50%{color:var(--primary-600)}to{color:var(--primary-500)}}.time-display.animating[_ngcontent-%COMP%]   .time-number[_ngcontent-%COMP%], .number-display.animating[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_glowPulse 2s ease-in-out}"]})};var Ue=["canvas"],J=class r{canvasRef;stats;title;period="7 derniers jours";selectedTheme="modern";themes=[{value:"modern",label:"Moderne"},{value:"minimal",label:"Minimal"},{value:"dark",label:"Sombre"}];CANVAS_WIDTH=1080;CANVAS_HEIGHT=1920;themeConfigs={modern:{value:"modern",label:"Moderne",colors:{background:["#F8F9FF","#E8EFFF"],card:"#FFFFFF",cardBorder:"rgba(147, 157, 255, 0.2)",text:"#1E2243",textSecondary:"#626894",accent:"#5B6CFF",accentGradient:["#5B6CFF","#8595FF"]}},minimal:{value:"minimal",label:"Minimal",colors:{background:["#FFFFFF","#F5F5F5"],card:"#FFFFFF",cardBorder:"rgba(0, 0, 0, 0.1)",text:"#2C2C2C",textSecondary:"#757575",accent:"#2196F3",accentGradient:["#2196F3","#64B5F6"]}},dark:{value:"dark",label:"Sombre",colors:{background:["#13141C","#1C1E2C"],card:"#242736",cardBorder:"rgba(255, 255, 255, 0.1)",text:"#FFFFFF",textSecondary:"#A0A5BD",accent:"#7C85FF",accentGradient:["#7C85FF","#5B6CFF"]}}};ngAfterViewInit(){this.drawCard()}changeTheme(t){this.selectedTheme=t,this.drawCard()}generateAndDownload(){let t=this.canvasRef.nativeElement,e=document.createElement("a");e.download=`strava-stats-${Date.now()}.png`,e.href=t.toDataURL("image/png"),e.click()}createRoundRect(t,e,n,i,s,d){t.beginPath(),t.moveTo(e+d,n),t.lineTo(e+i-d,n),t.quadraticCurveTo(e+i,n,e+i,n+d),t.lineTo(e+i,n+s-d),t.quadraticCurveTo(e+i,n+s,e+i-d,n+s),t.lineTo(e+d,n+s),t.quadraticCurveTo(e,n+s,e,n+s-d),t.lineTo(e,n+d),t.quadraticCurveTo(e,n,e+d,n),t.closePath()}drawCard(){let t=this.canvasRef.nativeElement,e=t.getContext("2d"),n=this.themeConfigs[this.selectedTheme];t.width=this.CANVAS_WIDTH,t.height=this.CANVAS_HEIGHT;let i=e.createLinearGradient(0,0,0,this.CANVAS_HEIGHT);i.addColorStop(0,n.colors.background[0]),i.addColorStop(1,n.colors.background[1]),e.fillStyle=i,e.fillRect(0,0,this.CANVAS_WIDTH,this.CANVAS_HEIGHT),this.drawTexture(e,n),this.drawHeader(e,n),this.drawStats(e,n),this.drawFooter(e,n)}drawTexture(t,e){t.save(),t.globalAlpha=.03;for(let n=0;n<this.CANVAS_HEIGHT;n+=30)t.beginPath(),t.moveTo(0,n),t.lineTo(this.CANVAS_WIDTH,n),t.strokeStyle=e.colors.text,t.lineWidth=1,t.stroke();t.restore()}drawHeader(t,e){t.save(),t.globalAlpha=.1,t.fillStyle=e.colors.accent,t.beginPath(),t.arc(100,100,300,0,Math.PI*2),t.fill(),t.beginPath(),t.arc(this.CANVAS_WIDTH-150,250,200,0,Math.PI*2),t.fill(),t.restore(),t.save(),t.font="bold 92px Inter",t.fillStyle=e.colors.text,t.textAlign="center",t.fillText(this.title.toUpperCase(),this.CANVAS_WIDTH/2,200),t.font="40px Inter",t.fillStyle=e.colors.textSecondary,t.fillText(this.period,this.CANVAS_WIDTH/2,280),t.restore()}drawStats(t,e){let n=[{label:"Distance",value:this.formatDistance(this.stats.totalDistance),icon:"\u{1F3C3}"},{label:"Temps",value:this.formatDuration(this.stats.totalElapsedTime),icon:"\u23F1\uFE0F"},{label:"Vitesse",value:this.formatSpeed(this.stats.averageSpeed),icon:"\u26A1"},{label:"D\xE9nivel\xE9",value:this.formatElevation(this.stats.totalElevation),icon:"\u26F0\uFE0F"}],i=500,s=220,d=40;n.forEach((u,h)=>{let m=i+(s+d)*h;t.save(),t.shadowColor="rgba(0, 0, 0, 0.1)",t.shadowBlur=20,t.shadowOffsetY=10,this.createRoundRect(t,120,m,this.CANVAS_WIDTH-240,s,30),t.fillStyle=e.colors.card,t.fill(),t.strokeStyle=e.colors.cardBorder,t.lineWidth=2,t.stroke(),t.restore(),t.save();let g=180,v=m+s/2-30,f=t.createLinearGradient(g,v,g,v+60);f.addColorStop(0,e.colors.accentGradient[0]),f.addColorStop(1,e.colors.accentGradient[1]),this.createRoundRect(t,g,v,60,60,15),t.fillStyle=f,t.fill(),t.restore(),t.font="30px sans-serif",t.textAlign="center",t.textBaseline="middle",t.fillText(u.icon,g+30,v+30),t.font="bold 64px Inter",t.fillStyle=e.colors.text,t.textAlign="right",t.fillText(u.value,this.CANVAS_WIDTH-180,m+s/2-10),t.font="32px Inter",t.fillStyle=e.colors.textSecondary,t.fillText(u.label,this.CANVAS_WIDTH-180,m+s/2+40)})}drawFooter(t,e){t.font="32px Inter",t.fillStyle=e.colors.textSecondary,t.textAlign="center";let n=this.CANVAS_HEIGHT-100;t.save();let i=t.createLinearGradient(this.CANVAS_WIDTH/2-100,n,this.CANVAS_WIDTH/2+100,n);i.addColorStop(0,e.colors.accentGradient[0]),i.addColorStop(1,e.colors.accentGradient[1]),t.fillStyle=i,t.font="bold 36px Inter",t.fillText("STRAVA DASHBOARD",this.CANVAS_WIDTH/2,n),t.restore()}formatDistance(t){return`${t.toFixed(1)} km`}formatDuration(t){let e=Math.floor(t/3600),n=Math.floor(t%3600/60);return`${e}h ${n}min`}formatSpeed(t){return`${t.toFixed(1)} km/h`}formatElevation(t){return`${Math.round(t)}m`}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=O({type:r,selectors:[["app-instagram-card"]],viewQuery:function(e,n){if(e&1&&H(Ue,5),e&2){let i;W(i=$())&&(n.canvasRef=i.first)}},inputs:{stats:"stats",title:"title",period:"period",selectedTheme:"selectedTheme"},standalone:!0,features:[D],decls:3,vars:0,consts:[["canvas",""],[1,"preview-canvas"]],template:function(e,n){e&1&&(a(0,"div",1),M(1,"canvas",null,0),o())},dependencies:[k],styles:[".preview-canvas[_ngcontent-%COMP%]{display:flex;justify-content:center;margin:1rem 0}canvas[_ngcontent-%COMP%]{width:360px;height:640px;border-radius:var(--radius-md);box-shadow:var(--shadow-lg)}@media (max-width: 768px){canvas[_ngcontent-%COMP%]{width:270px;height:480px}}"]})};function Xe(r,t){if(r&1){let e=E();a(0,"button",16),b("click",function(){let i=y(e).$implicit,s=_(2);return C(s.changeTheme(i.value))}),l(1),o()}if(r&2){let e=t.$implicit,n=_(2);L("active",n.selectedTheme===e.value),c(),w(" ",e.label," ")}}function Ze(r,t){if(r&1){let e=E();a(0,"div",1),b("click",function(){y(e);let i=_();return C(i.close())}),a(1,"div",2),b("click",function(i){return y(e),C(i.stopPropagation())}),a(2,"div",3)(3,"h2",4),l(4,"Cr\xE9er une story Instagram"),o(),a(5,"button",5),b("click",function(){y(e);let i=_();return C(i.close())}),T(),a(6,"svg",6),M(7,"line",7)(8,"line",8),o()()(),R(),a(9,"div",9),x(10,Xe,2,3,"button",10),o(),a(11,"div",11),M(12,"app-instagram-card",12),o(),a(13,"div",13)(14,"button",14),b("click",function(){y(e);let i=_();return C(i.close())}),l(15,"Annuler"),o(),a(16,"button",15),b("click",function(){y(e);let i=_();return C(i.download())}),l(17,"T\xE9l\xE9charger"),o()()()()}if(r&2){let e=_();c(10),p("ngForOf",e.themes),c(2),p("stats",e.stats)("title",e.title)("period",e.period)("selectedTheme",e.selectedTheme)}}var Me=class r{instagramCard;isOpen=!1;stats;title;period;closeModal=new Ee;selectedTheme="modern";themes=[{value:"modern",label:"Moderne"},{value:"minimal",label:"Minimal"},{value:"dark",label:"Sombre"}];close(){this.closeModal.emit()}changeTheme(t){this.selectedTheme=t,this.instagramCard&&setTimeout(()=>{this.instagramCard.changeTheme(t)})}download(){this.instagramCard&&this.instagramCard.generateAndDownload()}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=O({type:r,selectors:[["app-share-modal"]],viewQuery:function(e,n){if(e&1&&H(J,5),e&2){let i;W(i=$())&&(n.instagramCard=i.first)}},inputs:{isOpen:"isOpen",stats:"stats",title:"title",period:"period"},outputs:{closeModal:"closeModal"},standalone:!0,features:[D],decls:1,vars:1,consts:[["class","modal-overlay",3,"click",4,"ngIf"],[1,"modal-overlay",3,"click"],[1,"modal-content",3,"click"],[1,"modal-header"],[1,"modal-title"],[1,"close-button",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["x1","18","y1","6","x2","6","y2","18"],["x1","6","y1","6","x2","18","y2","18"],[1,"theme-selector"],["class","theme-button",3,"active","click",4,"ngFor","ngForOf"],[1,"preview"],[3,"stats","title","period","selectedTheme"],[1,"action-buttons"],[1,"cancel-btn",3,"click"],[1,"generate-btn",3,"click"],[1,"theme-button",3,"click"]],template:function(e,n){e&1&&x(0,Ze,18,5,"div",0),e&2&&p("ngIf",n.isOpen)},dependencies:[k,Y,I,J],styles:[".modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#00000080;display:flex;justify-content:center;align-items:center;z-index:1000;-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px)}.modal-content[_ngcontent-%COMP%]{background:var(--bg-primary);border-radius:var(--radius-lg);padding:2rem;width:90%;max-width:600px;max-height:90vh;overflow-y:auto;box-shadow:var(--shadow-xl)}.modal-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem}.modal-title[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:600;color:var(--text-primary);margin:0}.close-button[_ngcontent-%COMP%]{background:none;border:none;padding:.5rem;cursor:pointer;color:var(--text-secondary);border-radius:var(--radius-sm);transition:all .2s}.close-button[_ngcontent-%COMP%]:hover{background:var(--gray-100);color:var(--text-primary)}.preview[_ngcontent-%COMP%]{display:flex;justify-content:center;margin:1rem 0}.theme-selector[_ngcontent-%COMP%]{display:flex;gap:1rem;margin-bottom:1.5rem;justify-content:center}.theme-button[_ngcontent-%COMP%]{padding:.5rem 1rem;border:2px solid var(--primary-500);border-radius:var(--radius-md);background:transparent;color:var(--text-primary);cursor:pointer;transition:all .2s}.theme-button.active[_ngcontent-%COMP%]{background:var(--primary-500);color:#fff}.action-buttons[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:1rem;margin-top:1.5rem;padding-top:1rem;border-top:1px solid var(--gray-200)}.cancel-btn[_ngcontent-%COMP%], .generate-btn[_ngcontent-%COMP%]{padding:.75rem 1.5rem;border-radius:var(--radius-md);cursor:pointer;border:none;font-weight:500;transition:all .2s}.cancel-btn[_ngcontent-%COMP%]{background:var(--gray-200);color:var(--text-primary)}.generate-btn[_ngcontent-%COMP%]{background:var(--primary-500);color:#fff}.cancel-btn[_ngcontent-%COMP%]:hover{background:var(--gray-300)}.generate-btn[_ngcontent-%COMP%]:hover{background:var(--primary-600)}@media (max-width: 768px){.modal-content[_ngcontent-%COMP%]{width:95%;padding:1.5rem}}"]})};function Je(r,t){if(r&1){let e=E();a(0,"app-share-modal",19),b("closeModal",function(){y(e);let i=_();return C(i.closeShareModal())}),o()}if(r&2){let e=_();p("isOpen",e.showShareModal)("stats",e.stats)("title",e.title)("period",e.getPeriodLabel())}}var we=class r{stats;title;selectedPeriod="week";showShareModal=!1;get activityType(){return this.title.toLowerCase()}openShareModal(){this.showShareModal=!0}closeShareModal(){this.showShareModal=!1}getPeriodLabel(){switch(this.selectedPeriod){case"week":return"7 derniers jours";case"month":return"30 derniers jours";case"current_year":return"Depuis le 1er janvier";case"2024":return"Ann\xE9e 2024";default:return""}}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=O({type:r,selectors:[["app-stats-list"]],inputs:{stats:"stats",title:"title",selectedPeriod:"selectedPeriod"},standalone:!0,features:[D],decls:22,vars:11,consts:[[1,"activity-header"],[1,"title-section"],[1,"activity-icon",3,"ngClass"],[1,"icon"],[1,"activity-info"],[1,"activity-count"],[1,"share-button",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["x","2","y","2","width","20","height","20","rx","5","ry","5"],["cx","12","cy","12","r","4"],["cx","18","cy","6","r","1.5"],[1,"stats-grid"],["title","Temps total","unit","",1,"double-row",3,"value","isTime"],["title","Vitesse moyenne","unit","km/h",1,"double-row",3,"value"],["title","Distance totale","unit","km",3,"value"],["title","Distance moyenne/sortie","unit","km",3,"value"],["title","D\xE9nivel\xE9 total","unit","m",3,"value"],["title","D\xE9nivel\xE9 moyen/sortie","unit","m",3,"value"],[3,"isOpen","stats","title","period","closeModal",4,"ngIf"],[3,"closeModal","isOpen","stats","title","period"]],template:function(e,n){e&1&&(a(0,"div",0)(1,"div",1)(2,"div",2),M(3,"i",3),o(),a(4,"div",4)(5,"h2"),l(6),o(),a(7,"span",5),l(8),o()()(),a(9,"button",6),b("click",function(){return n.openShareModal()}),T(),a(10,"svg",7),M(11,"rect",8)(12,"circle",9)(13,"circle",10),o()()(),R(),a(14,"div",11),M(15,"app-stats-card",12)(16,"app-stats-card",13)(17,"app-stats-card",14)(18,"app-stats-card",15)(19,"app-stats-card",16)(20,"app-stats-card",17),o(),x(21,Je,1,4,"app-share-modal",18)),e&2&&(c(2),p("ngClass",n.activityType.toLowerCase()),c(4),A(n.title),c(2),w("",n.stats.numberOfActivities," activit\xE9(s)"),c(7),p("value",n.stats.totalElapsedTime)("isTime",!0),c(),p("value",n.stats.averageSpeed),c(),p("value",n.stats.totalDistance),c(),p("value",n.stats.averageDistance),c(),p("value",n.stats.totalElevation),c(),p("value",n.stats.averageElevation),c(),p("ngIf",n.showShareModal))},dependencies:[k,Ie,I,xe,Me],styles:[`@media (max-width: 640px){.stats-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}.activity-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;margin-bottom:1rem;margin-top:2rem}.activity-header[_ngcontent-%COMP%]:first-child{margin-top:0}.activity-icon[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:8px;display:flex;align-items:center;justify-content:center;position:relative}.activity-icon[_ngcontent-%COMP%]:before{content:"";position:absolute;inset:0;border-radius:8px;opacity:.15}.activity-info[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-family:Inter,sans-serif;font-size:1.5rem;font-weight:600;color:#2d2d2d;margin:0;padding:0}.activity-count[_ngcontent-%COMP%]{font-size:.9rem;color:var(--gray-600)}.activity-icon[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{width:24px;height:24px;background-repeat:no-repeat;background-position:center;background-size:contain}.activity-icon.run[_ngcontent-%COMP%]{color:#ff5722}.activity-icon.run[_ngcontent-%COMP%]:before{background-color:#ff5722}.activity-icon.run[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23FF5722'%3E%3Cpath d='M13.49 5.48c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm-3.6 13.9l1-4.4 2.1 2v6h2v-7.5l-2.1-2 .6-3c1.3 1.5 3.3 2.5 5.5 2.5v-2c-1.9 0-3.5-1-4.3-2.4l-1-1.6c-.4-.6-1-1-1.7-1-.3 0-.5.1-.8.1l-5.2 2.2v4.7h2v-3.4l1.8-.7-1.6 8.1-4.9-1-.4 2 7 1.4z'/%3E%3C/svg%3E")}.activity-icon.walk[_ngcontent-%COMP%]{color:#4caf50}.activity-icon.walk[_ngcontent-%COMP%]:before{background-color:#4caf50}.activity-icon.walk[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%234CAF50' viewBox='0 0 24 24'%3E%3Cpath d='M13.5 5.5c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zM9.8 8.9L7 23h2.1l1.8-8 2.1 2v6h2v-7.5l-2.1-2 .6-3C14.8 12 16.8 13 19 13v-2c-1.9 0-3.5-1-4.3-2.4l-1-1.6c-.4-.6-1-1-1.7-1-.3 0-.5.1-.8.1L6 8.3V13h2V9.6l1.8-.7'/%3E%3C/svg%3E")}.activity-icon.bike[_ngcontent-%COMP%]{color:#2196f3}.activity-icon.bike[_ngcontent-%COMP%]:before{background-color:#2196f3}.activity-icon.bike[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%232196F3' viewBox='0 0 24 24'%3E%3Cpath d='M15.5 5.5c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zM5 12c-2.8 0-5 2.2-5 5s2.2 5 5 5 5-2.2 5-5-2.2-5-5-5zm0 8.5c-1.9 0-3.5-1.6-3.5-3.5s1.6-3.5 3.5-3.5 3.5 1.6 3.5 3.5-1.6 3.5-3.5 3.5zm5.8-10l2.4-2.4.8.8c1.3 1.3 3 2.1 5.1 2.1V9c-1.5 0-2.7-.6-3.6-1.5l-1.9-1.9c-.5-.4-1-.6-1.6-.6s-1.1.2-1.4.6L7.8 8.4c-.4.4-.6.9-.6 1.4 0 .6.2 1.1.6 1.4L11 14v5h2v-6.2l-2.2-2.3zM19 12c-2.8 0-5 2.2-5 5s2.2 5 5 5 5-2.2 5-5-2.2-5-5-5zm0 8.5c-1.9 0-3.5-1.6-3.5-3.5s1.6-3.5 3.5-3.5 3.5 1.6 3.5 3.5-1.6 3.5-3.5 3.5z'/%3E%3C/svg%3E")}@media (max-width: 768px){.activity-icon[_ngcontent-%COMP%]{width:32px;height:32px}.activity-info[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.25rem}.activity-count[_ngcontent-%COMP%]{font-size:.8rem}}@media (max-width: 1024px){.stats-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr)}.double-row[_ngcontent-%COMP%]{grid-row:span 2;grid-column:span 1}}.activity-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;margin-bottom:1.5rem}.title-section[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem}.activity-icon[_ngcontent-%COMP%]{width:48px;height:48px;border-radius:12px;display:flex;align-items:center;justify-content:center;position:relative}.activity-icon[_ngcontent-%COMP%]:before{content:"";position:absolute;inset:0;border-radius:12px;opacity:.15}.activity-info[_ngcontent-%COMP%]{display:flex;flex-direction:column}.activity-info[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-family:Inter,sans-serif;font-size:1.5rem;font-weight:600;color:var(--text-primary);margin:0}.activity-count[_ngcontent-%COMP%]{font-size:.9rem;color:var(--text-secondary)}.share-button[_ngcontent-%COMP%]{background:linear-gradient(45deg,#f09433,#e6683c,#dc2743,#cc2366,#bc1888);color:#fff;border:none;width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .2s ease;box-shadow:var(--shadow-sm)}.share-button[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:var(--shadow-md);filter:brightness(1.1)}.share-button[_ngcontent-%COMP%]:active{transform:translateY(0)}.share-button[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{filter:drop-shadow(0px 1px 2px rgba(0,0,0,.1))}.stats-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(4,1fr);gap:16px}.double-row[_ngcontent-%COMP%]{grid-row:span 2;grid-column:span 1}@media (max-width: 1024px){.stats-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr)}}@media (max-width: 640px){.stats-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}.double-row[_ngcontent-%COMP%]{grid-row:span 1}}`,"@keyframes _ngcontent-%COMP%_fadeSlideIn{0%{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}.activity-header[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeSlideIn .8s ease-out forwards;opacity:0}.stats-grid[_ngcontent-%COMP%]{opacity:0;animation:_ngcontent-%COMP%_fadeSlideIn .8s ease-out forwards;animation-delay:.2s}@keyframes _ngcontent-%COMP%_rotateIn{0%{opacity:0;transform:rotate(-180deg) scale(.3)}to{opacity:1;transform:rotate(0) scale(1)}}.share-button[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_rotateIn .8s cubic-bezier(.34,1.56,.64,1) backwards;animation-delay:1s}.share-button[_ngcontent-%COMP%]:hover   svg[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_shake .82s cubic-bezier(.36,.07,.19,.97) both;transform:translateZ(0);backface-visibility:hidden;perspective:1000px}@keyframes _ngcontent-%COMP%_shake{10%,90%{transform:translate3d(-1px,0,0)}20%,80%{transform:translate3d(2px,0,0)}30%,50%,70%{transform:translate3d(-4px,0,0)}40%,60%{transform:translate3d(4px,0,0)}}@keyframes _ngcontent-%COMP%_bounceIn{0%{opacity:0;transform:scale(.3)}50%{opacity:.9;transform:scale(1.1)}80%{transform:scale(.89)}to{opacity:1;transform:scale(1)}}.activity-icon[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_bounceIn .8s cubic-bezier(.68,-.55,.265,1.55) forwards}.activity-icon[_ngcontent-%COMP%]:before{animation:_ngcontent-%COMP%_pulseBackground 2s ease-in-out infinite}@keyframes _ngcontent-%COMP%_pulseBackground{0%{opacity:.1}50%{opacity:.2}to{opacity:.1}}"]})};var Se=class r{analyzePerformances(t){let e={value:0,date:new Date,activityName:""},n={fiveKm:X({},e),tenKm:X({},e),semi:X({},e),marathon:X({},e)};return t.forEach(i=>{let s=i.average_speed,d=i.distance;d>=41.695&&(s>n.marathon.value||n.marathon.value===0)&&(n.marathon={value:s,date:new Date(i.start_date),activityName:i.name}),d>=20.6&&(s>n.semi.value||n.semi.value===0)&&(n.semi={value:s,date:new Date(i.start_date),activityName:i.name}),d>=9.5&&(s>n.tenKm.value||n.tenKm.value===0)&&(n.tenKm={value:s,date:new Date(i.start_date),activityName:i.name}),d>=4.7&&(s>n.fiveKm.value||n.fiveKm.value===0)&&(n.fiveKm={value:s,date:new Date(i.start_date),activityName:i.name})}),{bestRaces:n}}static \u0275fac=function(e){return new(e||r)};static \u0275prov=ee({token:r,factory:r.\u0275fac,providedIn:"root"})};function tt(r,t){if(r&1&&(a(0,"div",6)(1,"div",7),l(2,"5 KM"),o(),a(3,"div",8),l(4),V(5,"number"),o(),a(6,"div",9),l(7),o(),a(8,"div",10),l(9),a(10,"small"),l(11),o()()()),r&2){let e=_(2);c(4),w("",Z(5,4,e.metrics.bestRaces.fiveKm.value,"1.1-1")," km/h"),c(3),w("",e.calculatePace(e.metrics.bestRaces.fiveKm.value)," min/km"),c(2),w(" ",e.metrics.bestRaces.fiveKm.activityName," "),c(2),A(e.formatDate(e.metrics.bestRaces.fiveKm.date))}}function nt(r,t){if(r&1&&(a(0,"div",6)(1,"div",7),l(2,"10 KM"),o(),a(3,"div",8),l(4),V(5,"number"),o(),a(6,"div",9),l(7),o(),a(8,"div",10),l(9),a(10,"small"),l(11),o()()()),r&2){let e=_(2);c(4),w("",Z(5,4,e.metrics.bestRaces.tenKm.value,"1.1-1")," km/h"),c(3),w("",e.calculatePace(e.metrics.bestRaces.tenKm.value)," min/km"),c(2),w(" ",e.metrics.bestRaces.tenKm.activityName," "),c(2),A(e.formatDate(e.metrics.bestRaces.tenKm.date))}}function it(r,t){if(r&1&&(a(0,"div",6)(1,"div",7),l(2,"Semi-Marathon"),o(),a(3,"div",8),l(4),V(5,"number"),o(),a(6,"div",9),l(7),o(),a(8,"div",10),l(9),a(10,"small"),l(11),o()()()),r&2){let e=_(2);c(4),w("",Z(5,4,e.metrics.bestRaces.semi.value,"1.1-1")," km/h"),c(3),w("",e.calculatePace(e.metrics.bestRaces.semi.value)," min/km"),c(2),w(" ",e.metrics.bestRaces.semi.activityName," "),c(2),A(e.formatDate(e.metrics.bestRaces.semi.date))}}function at(r,t){if(r&1&&(a(0,"div",6)(1,"div",7),l(2,"Marathon"),o(),a(3,"div",8),l(4),V(5,"number"),o(),a(6,"div",9),l(7),o(),a(8,"div",10),l(9),a(10,"small"),l(11),o()()()),r&2){let e=_(2);c(4),w("",Z(5,4,e.metrics.bestRaces.marathon.value,"1.1-1")," km/h"),c(3),w("",e.calculatePace(e.metrics.bestRaces.marathon.value)," min/km"),c(2),w(" ",e.metrics.bestRaces.marathon.activityName," "),c(2),A(e.formatDate(e.metrics.bestRaces.marathon.date))}}function rt(r,t){if(r&1&&(G(0),a(1,"div",2)(2,"div",3)(3,"h2"),l(4,"Records Personnels (sur la p\xE9riode)"),o(),a(5,"div",4),x(6,tt,12,7,"div",5)(7,nt,12,7,"div",5)(8,it,12,7,"div",5)(9,at,12,7,"div",5),o()()(),K()),r&2){let e=_();c(6),p("ngIf",e.metrics==null||e.metrics.bestRaces==null||e.metrics.bestRaces.fiveKm==null?null:e.metrics.bestRaces.fiveKm.value),c(),p("ngIf",e.metrics==null||e.metrics.bestRaces==null||e.metrics.bestRaces.tenKm==null?null:e.metrics.bestRaces.tenKm.value),c(),p("ngIf",e.metrics==null||e.metrics.bestRaces==null||e.metrics.bestRaces.semi==null?null:e.metrics.bestRaces.semi.value),c(),p("ngIf",e.metrics==null||e.metrics.bestRaces==null||e.metrics.bestRaces.marathon==null?null:e.metrics.bestRaces.marathon.value)}}function ot(r,t){r&1&&(a(0,"div",2)(1,"div",11)(2,"div",12)(3,"i",13),l(4,"\u{1F3C3}"),o(),a(5,"div",14)(6,"h2"),l(7,"Aucun record sur cette p\xE9riode"),o(),a(8,"p"),l(9,"Continuez \xE0 vous entra\xEEner pour \xE9tablir de nouveaux records sur :"),o(),a(10,"ul")(11,"li"),l(12,"5 kilom\xE8tres"),o(),a(13,"li"),l(14,"10 kilom\xE8tres"),o(),a(15,"li"),l(16,"Semi-marathon"),o(),a(17,"li"),l(18,"Marathon"),o()()()()()())}var Pe=class r{constructor(t){this.performanceService=t}activities=[];metrics;ngOnChanges(){this.activities.length&&(this.metrics=this.performanceService.analyzePerformances(this.activities))}hasRecords(){return this.metrics?.bestRaces?!!(this.metrics.bestRaces.fiveKm.value||this.metrics.bestRaces.tenKm.value||this.metrics.bestRaces.semi.value||this.metrics.bestRaces.marathon.value):!1}formatDate(t){return new Date(t).toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric"})}calculatePace(t){let e=60/t,n=Math.floor(e),i=Math.round((e-n)*60);return`${n}'${i.toString().padStart(2,"0")}"`}static \u0275fac=function(e){return new(e||r)(F(Se))};static \u0275cmp=O({type:r,selectors:[["app-performance-dashboard"]],inputs:{activities:"activities"},standalone:!0,features:[N,D],decls:3,vars:2,consts:[["noRecords",""],[4,"ngIf","ngIfElse"],[1,"performance-container"],[1,"section","best-performances"],[1,"records-grid"],["class","record-card",4,"ngIf"],[1,"record-card"],[1,"record-title"],[1,"record-value"],[1,"record-pace"],[1,"record-details"],[1,"section","empty-state"],[1,"empty-state-content"],[1,"empty-state-icon"],[1,"empty-state-text"]],template:function(e,n){if(e&1&&x(0,rt,10,4,"ng-container",1)(1,ot,19,0,"ng-template",null,0,oe),e&2){let i=ne(2);p("ngIf",n.hasRecords())("ngIfElse",i)}},dependencies:[k,I,Fe],styles:['.performance-container[_ngcontent-%COMP%]{padding:.75rem}.section[_ngcontent-%COMP%]{margin-bottom:1rem;background:var(--bg-primary);border-radius:var(--radius-md);padding:1rem;box-shadow:var(--shadow-sm)}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:1.5rem 1rem;display:flex;align-items:center;justify-content:center;background:var(--bg-primary);border-radius:var(--radius-md);box-shadow:var(--shadow-sm)}.empty-state-content[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;max-width:100%}.empty-state-icon[_ngcontent-%COMP%]{font-size:2rem;margin:0}.empty-state-text[_ngcontent-%COMP%]{text-align:left}.empty-state[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:var(--text-primary);font-size:1.1rem;margin-bottom:.5rem}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--text-secondary);margin-bottom:.5rem;font-size:.9rem}.empty-state[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style:none;padding:0;color:var(--text-secondary);margin:0;display:flex;gap:1rem;flex-wrap:wrap}.empty-state[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin:0;font-weight:500;font-size:.9rem}.empty-state[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:not(:last-child):after{content:"\\2022";margin-left:1rem}h2[_ngcontent-%COMP%]{color:var(--text-primary);font-size:1.25rem;margin-bottom:1.5rem;font-weight:600}.records-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:1.5rem}.record-card[_ngcontent-%COMP%]{background:linear-gradient(to bottom right,var(--primary-100),var(--bg-primary));padding:1.5rem;border-radius:var(--radius-md);box-shadow:var(--shadow-sm);transition:transform .2s,box-shadow .2s;position:relative;overflow:hidden}[data-theme=light][_ngcontent-%COMP%]   .record-card[_ngcontent-%COMP%]:before{content:"";position:absolute;inset:0;background:linear-gradient(135deg,#fff3,#fff6,#ffffff1a);pointer-events:none}[data-theme=dark][_ngcontent-%COMP%]   .record-card[_ngcontent-%COMP%]:before{content:"";position:absolute;inset:0;background:linear-gradient(135deg,#ffffff0d,#ffffff1a,#ffffff05);pointer-events:none}.record-card[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:var(--shadow-md)}.record-title[_ngcontent-%COMP%]{font-weight:600;color:var(--primary-500);font-size:1.1rem;margin-bottom:.5rem;position:relative}.record-value[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700;color:var(--text-primary);margin-bottom:.25rem;position:relative}.record-pace[_ngcontent-%COMP%]{font-size:.9rem;color:var(--text-secondary);margin-bottom:.75rem;font-weight:500;position:relative}.record-details[_ngcontent-%COMP%]{font-size:.875rem;color:var(--text-secondary);position:relative}.record-details[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{display:block;margin-top:.25rem}@media (max-width: 768px){.performance-container[_ngcontent-%COMP%], .section[_ngcontent-%COMP%]{padding:1rem}.records-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}.empty-state[_ngcontent-%COMP%]{padding:2rem 1rem}}']})};var U=class r{isFullscreenSubject=new ke(!1);isFullscreen$=this.isFullscreenSubject.asObservable();toggleFullscreen(t){document.fullscreenElement?(document.exitFullscreen(),this.isFullscreenSubject.next(!1)):(t.requestFullscreen().catch(e=>{console.error(`Erreur lors du passage en plein \xE9cran : ${e.message}`)}),this.isFullscreenSubject.next(!0),document.addEventListener("fullscreenchange",this.handleFullscreenChange))}handleFullscreenChange=()=>{document.fullscreenElement||this.isFullscreenSubject.next(!1)};static \u0275fac=function(e){return new(e||r)};static \u0275prov=ee({token:r,factory:r.\u0275fac,providedIn:"root"})};var ct=["chartContainer"];function lt(r,t){if(r&1&&(a(0,"option",21),l(1),o()),r&2){let e=t.$implicit;p("value",e),c(),w(" ",e," ")}}function mt(r,t){if(r&1){let e=E();a(0,"div",22)(1,"div",23)(2,"label",24)(3,"input",25),b("change",function(){y(e);let i=_();return C(i.onGroupingChange("none"))}),o(),l(4," Aucun "),o(),a(5,"label",24)(6,"input",26),b("change",function(){y(e);let i=_();return C(i.onGroupingChange("week"))}),o(),l(7," Par semaine "),o(),a(8,"label",24)(9,"input",27),b("change",function(){y(e);let i=_();return C(i.onGroupingChange("month"))}),o(),l(10," Par mois "),o()()()}if(r&2){let e=_();c(3),p("checked",e.groupingType==="none"),c(3),p("checked",e.groupingType==="week"),c(3),p("checked",e.groupingType==="month")}}function dt(r,t){if(r&1){let e=E();a(0,"button",28),b("click",function(){let i=y(e).$implicit,s=_();return C(s.toggleMetric(i.value))}),l(1),o()}if(r&2){let e=t.$implicit,n=_();Ae("--metric-color",e.color),L("active",n.isMetricSelected(e.value)),c(),w(" ",e.label," ")}}function pt(r,t){r&1&&(T(),M(0,"path",29))}function ut(r,t){r&1&&(T(),M(0,"path",30))}Q.register(Ce,ye,he,ge,He,fe,_e,ve,$e,be);var Oe=class r{constructor(t){this.fullscreenService=t;this.isFullscreen$=this.fullscreenService.isFullscreen$}activities=[];period="week";selectedActivityType="Run";selectedMetrics=["speed"];chart=null;groupingType="none";activityTypes=["Run","Ride","Walk/Hike"];metrics=[{value:"speed",label:"Vitesse (km/h)",color:"#2196F3"},{value:"distance",label:"Distance (km)",color:"#4CAF50"},{value:"elevation",label:"D\xE9nivel\xE9 (m)",color:"#FF9800"},{value:"duration",label:"Dur\xE9e (h)",color:"#9C27B0"}];chartContainer;isFullscreen$;toggleFullscreen(){this.chartContainer&&this.fullscreenService.toggleFullscreen(this.chartContainer.nativeElement)}ngOnChanges(t){(t.activities||t.period)&&this.activities&&this.updateChart()}onActivityTypeChange(t){this.selectedActivityType=t,this.updateChart()}onGroupingChange(t){this.groupingType=t,this.updateChart()}toggleMetric(t){let e=this.selectedMetrics.indexOf(t);e===-1?this.selectedMetrics.push(t):this.selectedMetrics.splice(e,1),this.updateChart()}isMetricSelected(t){return this.selectedMetrics.includes(t)}zoomIn(){this.chart&&this.chart.zoom(1.2)}zoomOut(){this.chart&&this.chart.zoom(.8)}resetZoom(){this.chart&&this.chart.resetZoom()}getWeekNumber(t){let e=new Date(t.getFullYear(),0,1),n=(t.getTime()-e.getTime())/864e5;return Math.ceil((n+e.getDay()+1)/7)}getWeekRange(t){let e=new Date(t);e.setDate(t.getDate()-t.getDay()+1);let n=new Date(e);return n.setDate(e.getDate()+6),{start:e,end:n}}groupActivitiesByWeek(t){if(!t.length)return[];let e=new Map;return t.forEach(n=>{let i=new Date(n.start_date),s=this.getWeekNumber(i),d=this.getWeekRange(i);e.has(s)||e.set(s,{weekNumber:s,weekLabel:`S${s}`,weekStart:d.start,weekEnd:d.end,totalDistance:0,totalDuration:0,averageSpeed:0,totalElevation:0,activitiesCount:0,activities:[]});let u=e.get(s);u.totalDistance+=n.distance,u.totalDuration+=n.elapsed_time,u.totalElevation+=n.total_elevation_gain,u.activitiesCount+=1,u.activities.push({name:n.name,date:new Date(n.start_date)})}),e.forEach(n=>{n.averageSpeed=n.totalDistance/(n.totalDuration/3600)||0,n.activities.sort((i,s)=>s.date.getTime()-i.date.getTime())}),Array.from(e.values()).sort((n,i)=>n.weekNumber-i.weekNumber)}groupActivitiesByMonth(t){if(!t.length)return[];let e=new Map;return t.forEach(n=>{let i=new Date(n.start_date),s=i.getMonth(),d=i.getFullYear(),u=d*100+s;if(!e.has(u)){let m=new Date(d,s,1),g=new Date(d,s+1,0),v=m.toLocaleDateString("fr-FR",{month:"long"});e.set(u,{monthNumber:s,monthLabel:v,monthStart:m,monthEnd:g,totalDistance:0,totalDuration:0,averageSpeed:0,totalElevation:0,activitiesCount:0,activities:[]})}let h=e.get(u);h.totalDistance+=n.distance,h.totalDuration+=n.elapsed_time,h.totalElevation+=n.total_elevation_gain,h.activitiesCount+=1,h.activities.push({name:n.name,date:new Date(n.start_date)})}),e.forEach(n=>{n.averageSpeed=n.totalDistance/(n.totalDuration/3600)||0,n.activities.sort((i,s)=>s.date.getTime()-i.date.getTime())}),Array.from(e.values()).sort((n,i)=>n.monthStart.getTime()-i.monthStart.getTime())}getFilteredActivities(){if(!this.activities)return[];let t=[...this.activities];switch(this.selectedActivityType){case"Run":t=t.filter(e=>e.type.includes("Run"));break;case"Ride":t=t.filter(e=>e.type.includes("Ride"));break;case"Walk/Hike":t=t.filter(e=>e.type.includes("Hike")||e.type.includes("Walk"));break}return t.sort((e,n)=>new Date(e.start_date).getTime()-new Date(n.start_date).getTime())}generateDateLabels(){let t=new Date,e=[],n=[];if((this.period==="current_year"||this.period==="2024")&&this.groupingType==="week"){let i=this.period==="2024"?2024:t.getFullYear(),s=new Date(i,0,1),d=new Date(i,11,31),u=new Date(s);u.setDate(u.getDate()+(8-u.getDay())%7);let h=[],m=new Date(u);for(;m<=d;){let v=this.getWeekNumber(m),f=this.getWeekRange(m);h.push({weekNumber:v,weekLabel:`S${v}`,weekStart:new Date(f.start),weekEnd:new Date(f.end),totalDistance:0,totalDuration:0,averageSpeed:0,totalElevation:0,activitiesCount:0,activities:[]}),m.setDate(m.getDate()+7)}this.getFilteredActivities().forEach(v=>{let f=new Date(v.start_date),S=this.getWeekNumber(f),P=h.find(Ke=>Ke.weekNumber===S);P&&(P.totalDistance+=v.distance,P.totalDuration+=v.elapsed_time,P.totalElevation+=v.total_elevation_gain,P.activitiesCount+=1,P.activities.push({name:v.name,date:new Date(v.start_date)}))}),h.forEach(v=>{v.averageSpeed=v.totalDistance/(v.totalDuration/3600)||0,v.activities.sort((f,S)=>S.date.getTime()-f.date.getTime())}),e.push(...h.map(v=>v.weekStart)),n=h}else if((this.period==="current_year"||this.period==="2024")&&this.groupingType==="month"){let i=this.period==="2024"?2024:t.getFullYear(),s=[];for(let u=0;u<12;u++){let h=new Date(i,u,1),m=new Date(i,u+1,0),g=h.toLocaleDateString("fr-FR",{month:"long"});s.push({monthNumber:u,monthLabel:g,monthStart:h,monthEnd:m,totalDistance:0,totalDuration:0,averageSpeed:0,totalElevation:0,activitiesCount:0,activities:[]})}this.getFilteredActivities().forEach(u=>{let m=new Date(u.start_date).getMonth(),g=s.find(v=>v.monthNumber===m);g&&(g.totalDistance+=u.distance,g.totalDuration+=u.elapsed_time,g.totalElevation+=u.total_elevation_gain,g.activitiesCount+=1,g.activities.push({name:u.name,date:new Date(u.start_date)}))}),s.forEach(u=>{u.averageSpeed=u.totalDistance/(u.totalDuration/3600)||0,u.activities.sort((h,m)=>m.date.getTime()-h.date.getTime())}),e.push(...s.map(u=>u.monthStart)),n=s}else{let i,s=new Date(t);switch(this.period){case"week":i=new Date(t),i.setDate(t.getDate()-6);break;case"month":i=new Date(t),i.setDate(t.getDate()-29);break;case"current_year":i=new Date(t.getFullYear(),0,1),i.setHours(0,0,0,0);break;case"2024":i=new Date(2024,0,1),s=new Date(2024,11,31);break}let d=new Date(i);for(;d<=s;)e.push(new Date(d)),d.setDate(d.getDate()+1);n=this.getFilteredActivities()}return[e,n]}createDataMap(t,e){let n=new Map;return(this.period==="current_year"||this.period==="2024")&&this.groupingType==="week"?e.forEach(i=>{n.set(i.weekNumber.toString(),i)}):(this.period==="current_year"||this.period==="2024")&&this.groupingType==="month"?e.forEach(i=>{n.set(i.monthNumber.toString(),i)}):e.forEach(i=>{let d=new Date(i.start_date).toISOString().split("T")[0];n.set(d,i)}),n}formatDuration(t){let e=Math.round(t*60),n=Math.floor(e/60),i=e%60;return`${n}h${i>0?` ${i}min`:""}`}getMetricValue(t,e){if(!t)return null;if("weekNumber"in t){let n=t;switch(e){case"speed":return n.averageSpeed;case"distance":return n.totalDistance;case"elevation":return n.totalElevation;case"duration":return n.totalDuration/3600;default:return null}}else if("monthNumber"in t){let n=t;switch(e){case"speed":return n.averageSpeed;case"distance":return n.totalDistance;case"elevation":return n.totalElevation;case"duration":return n.totalDuration/3600;default:return null}}else{let n=t;switch(e){case"speed":return n.average_speed;case"distance":return n.distance;case"elevation":return n.total_elevation_gain;case"duration":return n.elapsed_time/3600;default:return null}}}handleLegendClick(t,e){let n=e.datasetIndex;n!==void 0&&n>=0&&n<this.selectedMetrics.length&&this.toggleMetric(this.selectedMetrics[n])}updateChart(){this.chart&&this.chart.destroy();let t=document.getElementById("activityChart");if(!t)return;let[e,n]=this.generateDateLabels(),i=this.createDataMap(e,n),s=this.selectedMetrics.map(m=>{let g=this.metrics.find(f=>f.value===m),v=e.map(f=>{if(!f)return null;if((this.period==="current_year"||this.period==="2024")&&this.groupingType==="week"){let S=this.getWeekNumber(f),P=i.get(S.toString());return this.getMetricValue(P,m)}else if((this.period==="current_year"||this.period==="2024")&&this.groupingType==="month"){let S=f.getMonth(),P=i.get(S.toString());return this.getMetricValue(P,m)}else{let S=f.toISOString().split("T")[0],P=i.get(S);return this.getMetricValue(P,m)}});return{label:g.label,data:v,borderColor:g.color,backgroundColor:`${g.color}33`,borderWidth:2,tension:.1,fill:!1,yAxisID:m,spanGaps:!0,pointRadius:v.map(f=>f===null?0:3)}}),d={labels:e.map(m=>m?(this.period==="current_year"||this.period==="2024")&&this.groupingType==="week"?`Sem. ${this.getWeekNumber(m)}`:(this.period==="current_year"||this.period==="2024")&&this.groupingType==="month"?m.toLocaleDateString("fr-FR",{month:"short"}):m.toLocaleDateString("fr-FR",{month:"short",day:"numeric"}):""),datasets:s},u={x:{type:"category",grid:{color:"rgba(0, 0, 0, 0.05)"}}};this.selectedMetrics.forEach((m,g)=>{let v=this.metrics.find(f=>f.value===m);u[m]={type:"linear",display:!0,position:g%2===0?"left":"right",grid:{color:`${v.color}22`},title:{display:!0,text:v.label},beginAtZero:!0}});let h=(m,g)=>{if((this.period==="current_year"||this.period==="2024")&&this.groupingType==="week"){let v=this.getWeekNumber(m),f=g.get(v.toString());if(!f)return"";let S=`Semaine ${f.weekNumber}
`;return S+=`Du ${f.weekStart.toLocaleDateString("fr-FR")} au ${f.weekEnd.toLocaleDateString("fr-FR")}

`,S+=`Activit\xE9s de la semaine:
`,f.activities.forEach(P=>{S+=`- ${P.date.toLocaleDateString("fr-FR")}: ${P.name}
`}),S}else if((this.period==="current_year"||this.period==="2024")&&this.groupingType==="month"){let v=m.getMonth(),f=g.get(v.toString());if(!f)return"";let S=`${f.monthLabel.charAt(0).toUpperCase()+f.monthLabel.slice(1)}
`;return S+=`Du ${f.monthStart.toLocaleDateString("fr-FR")} au ${f.monthEnd.toLocaleDateString("fr-FR")}

`,S+=`Activit\xE9s du mois:
`,f.activities.forEach(P=>{S+=`- ${P.date.toLocaleDateString("fr-FR")}: ${P.name}
`}),S}else{let v=m.toISOString().split("T")[0],f=g.get(v);return f?`${m.toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long"})}
${f.name}`:""}};this.chart=new Q(t,{type:"line",data:d,options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,position:"top",onClick:(m,g)=>this.handleLegendClick(m,g)},tooltip:{mode:"index",intersect:!1,backgroundColor:"rgba(255, 255, 255, 0.9)",titleColor:"#000",bodyColor:"#666",borderColor:"#ddd",borderWidth:1,callbacks:{title:m=>{let g=m[0].dataIndex;return e[g]?h(e[g],i):""},label:m=>{let g=m.raw;return m.dataset.yAxisID==="duration"?`${m.dataset.label}: ${this.formatDuration(g)}`:`${m.dataset.label}: ${g.toFixed(1)}`}}},zoom:{pan:{enabled:!0,mode:"x",modifierKey:"ctrl"},zoom:{wheel:{enabled:!0,modifierKey:"ctrl"},pinch:{enabled:!0},mode:"x"},limits:{x:{min:"original",max:"original"}}}},scales:u}})}static \u0275fac=function(e){return new(e||r)(F(U))};static \u0275cmp=O({type:r,selectors:[["app-modern-activity-chart"]],viewQuery:function(e,n){if(e&1&&H(ct,5),e&2){let i;W(i=$())&&(n.chartContainer=i.first)}},inputs:{activities:"activities",period:"period"},standalone:!0,features:[N,D],decls:32,vars:13,consts:[["chartContainer",""],[1,"card"],[1,"card-header"],[1,"header-main"],[1,"card-title"],[1,"primary-controls"],[1,"select",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["class","grouping-control",4,"ngIf"],[1,"metrics-toggles"],["class","metric-toggle",3,"active","--metric-color","click",4,"ngFor","ngForOf"],[1,"zoom-controls"],[1,"zoom-button",3,"click"],[1,"zoom-icon"],[1,"card-content"],[1,"chart-container"],[1,"fullscreen-button",3,"click"],["viewBox","0 0 24 24",1,"fullscreen-icon"],["d","M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z",4,"ngIf"],["d","M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z",4,"ngIf"],["id","activityChart"],[3,"value"],[1,"grouping-control"],[1,"grouping-options"],[1,"grouping-label"],["type","radio","name","grouping","value","none",3,"change","checked"],["type","radio","name","grouping","value","week",3,"change","checked"],["type","radio","name","grouping","value","month",3,"change","checked"],[1,"metric-toggle",3,"click"],["d","M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"],["d","M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"]],template:function(e,n){if(e&1){let i=E();a(0,"div",1)(1,"div",2)(2,"div",3)(3,"h2",4),l(4,"\xC9volution des performances"),o(),a(5,"div",5)(6,"select",6),re("ngModelChange",function(d){return y(i),ae(n.selectedActivityType,d)||(n.selectedActivityType=d),C(d)}),b("ngModelChange",function(d){return y(i),C(n.onActivityTypeChange(d))}),x(7,lt,2,2,"option",7),o(),x(8,mt,11,3,"div",8),a(9,"div",9),x(10,dt,2,5,"button",10),o()()(),a(11,"div",11)(12,"button",12),b("click",function(){return y(i),C(n.resetZoom())}),a(13,"span",13),l(14,"\u{1F504}"),o()(),a(15,"button",12),b("click",function(){return y(i),C(n.zoomIn())}),a(16,"span",13),l(17,"+"),o()(),a(18,"button",12),b("click",function(){return y(i),C(n.zoomOut())}),a(19,"span",13),l(20,"-"),o()()()(),a(21,"div",14)(22,"div",15,0)(24,"button",16),V(25,"async"),b("click",function(){return y(i),C(n.toggleFullscreen())}),T(),a(26,"svg",17),x(27,pt,1,0,"path",18),V(28,"async"),x(29,ut,1,0,"path",19),V(30,"async"),o()(),R(),M(31,"canvas",20),o()()()}e&2&&(c(6),ie("ngModel",n.selectedActivityType),c(),p("ngForOf",n.activityTypes),c(),p("ngIf",n.period==="current_year"||n.period==="2024"),c(2),p("ngForOf",n.metrics),c(14),te("aria-label",j(25,7,n.isFullscreen$)?"Quitter le plein \xE9cran":"Passer en plein \xE9cran"),c(3),p("ngIf",!j(28,9,n.isFullscreen$)),c(2),p("ngIf",j(30,11,n.isFullscreen$)))},dependencies:[k,Y,I,se,ue,de,pe,me,ce,le],styles:[".card[_ngcontent-%COMP%]{background:var(--bg-primary);border-radius:var(--radius-lg);box-shadow:var(--shadow-sm);margin:1rem 0;transition:box-shadow .3s ease}.card[_ngcontent-%COMP%]:hover{box-shadow:var(--shadow-md)}.card-header[_ngcontent-%COMP%]{padding:1.5rem;border-bottom:1px solid var(--gray-200);display:flex;justify-content:space-between;align-items:flex-start;flex-wrap:wrap;gap:1rem}.header-main[_ngcontent-%COMP%]{flex:1;min-width:300px}.card-title[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:600;color:var(--text-primary);margin:0}.filters[_ngcontent-%COMP%]{display:flex;gap:1rem;align-items:center}.select[_ngcontent-%COMP%]{padding:.5rem;border:1px solid var(--gray-300);border-radius:var(--radius-sm);background-color:var(--bg-primary);color:var(--text-primary);font-size:.875rem;cursor:pointer;transition:all .2s ease;min-width:120px}.select[_ngcontent-%COMP%]:hover{border-color:var(--primary-500)}.select[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--primary-500);box-shadow:0 0 0 2px #2196f31a}.metrics-toggles[_ngcontent-%COMP%]{display:flex;gap:.5rem;flex-wrap:wrap}.metric-toggle[_ngcontent-%COMP%]{padding:.5rem 1rem;border:1px solid var(--gray-300);border-radius:6px;background:var(--bg-primary);color:var(--text-secondary);cursor:pointer;transition:all .2s;font-size:.875rem}.metric-toggle[_ngcontent-%COMP%]:hover{background:var(--gray-100);color:#fff}.metric-toggle.active[_ngcontent-%COMP%]{background:var(--primary-500);color:var(--bg-primary);border-color:var(--primary-600)}.card-content[_ngcontent-%COMP%]{padding:1.5rem;background:var(--bg-primary)}.chart-container[_ngcontent-%COMP%]{position:relative;height:400px}.fullscreen-button[_ngcontent-%COMP%]{position:absolute;top:1rem;right:1rem;z-index:10;background:var(--bg-primary);border:1px solid var(--gray-200);border-radius:var(--radius-md);padding:.5rem;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s ease}.fullscreen-button[_ngcontent-%COMP%]:hover{background:var(--bg-secondary);transform:scale(1.1)}.fullscreen-icon[_ngcontent-%COMP%]{width:20px;height:20px;fill:var(--text-primary)}[_ngcontent-%COMP%]:fullscreen   .chart-container[_ngcontent-%COMP%]{height:100vh;width:100vw;display:flex;align-items:center;justify-content:center;background-color:var(--bg-primary)}[_ngcontent-%COMP%]:fullscreen   canvas[_ngcontent-%COMP%]{width:100%!important;height:100%!important;max-height:100vh}@media screen and (orientation: landscape){[_ngcontent-%COMP%]:fullscreen   canvas[_ngcontent-%COMP%]{width:auto!important;height:100%!important}}.primary-controls[_ngcontent-%COMP%]{display:flex;gap:1rem;align-items:center;flex-wrap:wrap;margin-top:1rem}.zoom-controls[_ngcontent-%COMP%]{display:flex;gap:.5rem;align-items:flex-start}.zoom-button[_ngcontent-%COMP%]{width:36px;height:36px;padding:0;border:1px solid var(--gray-300);border-radius:var(--radius-sm);background:var(--bg-primary);color:var(--text-primary);cursor:pointer;transition:all .2s;display:flex;align-items:center;justify-content:center}.zoom-button[_ngcontent-%COMP%]:hover{background:var(--bg-secondary);border-color:var(--primary-500);color:var(--primary-500)}.zoom-icon[_ngcontent-%COMP%]{font-size:1rem;line-height:1}@media (max-width: 768px){.card-header[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch}.zoom-controls[_ngcontent-%COMP%]{justify-content:flex-end}}@media (max-width: 768px){.card-header[_ngcontent-%COMP%]{flex-direction:column;gap:1rem}.filters[_ngcontent-%COMP%]{width:100%;flex-direction:column}.select[_ngcontent-%COMP%]{width:100%}.metrics-toggles[_ngcontent-%COMP%]{width:100%;justify-content:center}}.grouping-control[_ngcontent-%COMP%]{display:flex;align-items:center;margin:0 1rem}.grouping-options[_ngcontent-%COMP%]{display:flex;gap:1rem;align-items:center}.grouping-label[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;font-size:.875rem;color:var(--text-secondary);cursor:pointer;transition:color .2s}.grouping-label[_ngcontent-%COMP%]:hover{color:var(--text-primary)}.grouping-label[_ngcontent-%COMP%]   input[type=radio][_ngcontent-%COMP%]{width:1rem;height:1rem;accent-color:var(--primary-500);cursor:pointer}@media (max-width: 768px){.grouping-control[_ngcontent-%COMP%]{width:100%;margin:.5rem 0}.grouping-options[_ngcontent-%COMP%]{width:100%;flex-direction:row;gap:.5rem;justify-content:space-around}.grouping-label[_ngcontent-%COMP%]{font-size:.8rem;white-space:nowrap}.primary-controls[_ngcontent-%COMP%]{flex-direction:column;gap:1rem;width:100%}.primary-controls[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:100%}}"]})};var gt=["chartContainer"];function ht(r,t){if(r&1&&(a(0,"option",17),l(1),o()),r&2){let e=t.$implicit;p("value",e),c(),w(" ",e," ")}}function vt(r,t){r&1&&(T(),M(0,"path",18))}function ft(r,t){r&1&&(T(),M(0,"path",19))}Q.register(Ce,ye,We,he,ge,fe,_e,ve,be);var De=class r{constructor(t){this.fullscreenService=t;this.isFullscreen$=this.fullscreenService.isFullscreen$}activities=[];selectedActivityType="Run";chart=null;activityTypes=["Run","Ride","Walk/Hike"];chartContainer;isFullscreen$;toggleFullscreen(){this.chartContainer&&this.fullscreenService.toggleFullscreen(this.chartContainer.nativeElement)}ngOnChanges(t){t.activities&&this.activities&&this.updateChart()}onActivityTypeChange(t){this.selectedActivityType=t,this.updateChart()}zoomIn(){this.chart&&this.chart.zoom(1.2)}zoomOut(){this.chart&&this.chart.zoom(.8)}resetZoom(){this.chart&&this.chart.resetZoom()}roundDistance(t){return Math.round(t*10)/10}getFilteredActivities(){if(!this.activities)return[];let t=[...this.activities];switch(this.selectedActivityType){case"Run":t=t.filter(e=>e.type.includes("Run"));break;case"Ride":t=t.filter(e=>e.type.includes("Ride"));break;case"Walk/Hike":t=t.filter(e=>e.type.includes("Hike")||e.type.includes("Walk"));break}return t.sort((e,n)=>new Date(e.start_date).getTime()-new Date(n.start_date).getTime())}convertSpeedToPace(t){return 60/t}formatPace(t){let e=Math.floor(t),n=Math.round((t-e)*60);return`${e}'${n.toString().padStart(2,"0")}"`}calculateTrendLine(t){let e=t.length;if(e<2)return{slope:0,intercept:0};let n=0,i=0,s=0,d=0;t.forEach(m=>{n+=m.x,i+=m.y,s+=m.x*m.y,d+=m.x*m.x});let u=(e*s-n*i)/(e*d-n*n),h=(i-u*n)/e;return{slope:u,intercept:h}}generateTrendLineData(t){if(t.length<2)return[];let{slope:e,intercept:n}=this.calculateTrendLine(t),i=Math.min(...t.map(d=>d.x)),s=Math.max(...t.map(d=>d.x));return[{x:i,y:e*i+n,date:new Date,name:"Trend"},{x:s,y:e*s+n,date:new Date,name:"Trend"}]}updateChart(){let t=document.getElementById("paceScatterChart");if(!t)return;this.chart&&this.chart.destroy();let n=this.getFilteredActivities().map(h=>({x:this.roundDistance(h.distance),y:this.selectedActivityType==="Ride"?h.average_speed:this.convertSpeedToPace(h.average_speed),date:new Date(h.start_date),name:h.name})),i=this.generateTrendLineData(n),s=this.selectedActivityType==="Ride"?"Vitesse (km/h)":"Allure (min/km)",d=0,u=Math.max(...n.map(h=>h.x))+1;this.chart=new Q(t,{type:"scatter",data:{datasets:[{label:this.selectedActivityType,data:n,backgroundColor:"rgba(33, 150, 243, 0.6)",borderColor:"rgba(33, 150, 243, 1)",borderWidth:1,pointRadius:4,pointHoverRadius:6},{label:"Tendance",data:i,type:"line",borderColor:"rgba(255, 99, 132, 0.8)",borderWidth:2,pointRadius:0,fill:!1}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{x:{title:{display:!0,text:"Distance (km)"},min:d,max:u},y:{title:{display:!0,text:s},reverse:this.selectedActivityType==="Ride",ticks:{callback:h=>this.selectedActivityType==="Ride"?`${h} km/h`:h%1===0?this.formatPace(Number(h)):""}}},plugins:{tooltip:{enabled:!0,callbacks:{label:h=>{if(h.datasetIndex===1)return"";let m=n[h.dataIndex],g=`${m.name}
`;return g+=`Distance: ${m.x.toFixed(1)} km
`,this.selectedActivityType==="Ride"?g+=`Vitesse: ${m.y.toFixed(1)} km/h`:g+=`Allure: ${this.formatPace(m.y)}/km`,g+=`
Date: ${m.date.toLocaleDateString()}`,g}}},zoom:{pan:{enabled:!0,mode:"xy"},zoom:{wheel:{enabled:!0},pinch:{enabled:!0},mode:"xy"}}}}})}static \u0275fac=function(e){return new(e||r)(F(U))};static \u0275cmp=O({type:r,selectors:[["app-pace-scatter"]],viewQuery:function(e,n){if(e&1&&H(gt,5),e&2){let i;W(i=$())&&(n.chartContainer=i.first)}},inputs:{activities:"activities"},standalone:!0,features:[N,D],decls:28,vars:11,consts:[["chartContainer",""],[1,"scatter-card"],[1,"card-header"],[1,"header-main"],[1,"card-title"],[1,"controls"],[1,"select",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],[1,"zoom-controls"],[1,"zoom-button",3,"click"],[1,"zoom-icon"],[1,"chart-container"],[1,"fullscreen-button",3,"click"],["viewBox","0 0 24 24",1,"fullscreen-icon"],["d","M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z",4,"ngIf"],["d","M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z",4,"ngIf"],["id","paceScatterChart"],[3,"value"],["d","M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"],["d","M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"]],template:function(e,n){if(e&1){let i=E();a(0,"div",1)(1,"div",2)(2,"div",3)(3,"h2",4),l(4,"Distance vs Allure"),o(),a(5,"div",5)(6,"select",6),re("ngModelChange",function(d){return y(i),ae(n.selectedActivityType,d)||(n.selectedActivityType=d),C(d)}),b("ngModelChange",function(d){return y(i),C(n.onActivityTypeChange(d))}),x(7,ht,2,2,"option",7),o(),a(8,"div",8)(9,"button",9),b("click",function(){return y(i),C(n.resetZoom())}),a(10,"span",10),l(11,"\u{1F504}"),o()(),a(12,"button",9),b("click",function(){return y(i),C(n.zoomIn())}),a(13,"span",10),l(14,"+"),o()(),a(15,"button",9),b("click",function(){return y(i),C(n.zoomOut())}),a(16,"span",10),l(17,"-"),o()()()()()(),a(18,"div",11,0)(20,"button",12),V(21,"async"),b("click",function(){return y(i),C(n.toggleFullscreen())}),T(),a(22,"svg",13),x(23,vt,1,0,"path",14),V(24,"async"),x(25,ft,1,0,"path",15),V(26,"async"),o()(),R(),M(27,"canvas",16),o()()}e&2&&(c(6),ie("ngModel",n.selectedActivityType),c(),p("ngForOf",n.activityTypes),c(13),te("aria-label",j(21,5,n.isFullscreen$)?"Quitter le plein \xE9cran":"Passer en plein \xE9cran"),c(3),p("ngIf",!j(24,7,n.isFullscreen$)),c(2),p("ngIf",j(26,9,n.isFullscreen$)))},dependencies:[k,Y,I,se,ue,de,pe,me,ce,le],styles:[".scatter-card[_ngcontent-%COMP%]{background:var(--bg-primary);border-radius:var(--radius-lg);box-shadow:var(--shadow-sm);margin:1rem 0;transition:box-shadow .3s ease}.scatter-card[_ngcontent-%COMP%]:hover{box-shadow:var(--shadow-md)}.card-header[_ngcontent-%COMP%]{padding:1.5rem;border-bottom:1px solid var(--gray-200)}.header-main[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:1rem}.card-title[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:600;color:var(--text-primary);margin:0}.controls[_ngcontent-%COMP%]{display:flex;gap:1rem;align-items:center}.select[_ngcontent-%COMP%]{padding:.5rem;border:1px solid var(--gray-300);border-radius:var(--radius-sm);background-color:var(--bg-primary);color:var(--text-primary);font-size:.875rem;cursor:pointer;transition:all .2s ease;min-width:120px}.select[_ngcontent-%COMP%]:hover{border-color:var(--primary-500)}.select[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--primary-500);box-shadow:0 0 0 2px #2196f31a}.zoom-controls[_ngcontent-%COMP%]{display:flex;gap:.5rem;align-items:center}.zoom-button[_ngcontent-%COMP%]{width:36px;height:36px;padding:0;border:1px solid var(--gray-300);border-radius:var(--radius-sm);background:var(--bg-primary);color:var(--text-primary);cursor:pointer;transition:all .2s;display:flex;align-items:center;justify-content:center}.zoom-button[_ngcontent-%COMP%]:hover{background:var(--bg-secondary);border-color:var(--primary-500);color:var(--primary-500)}.zoom-icon[_ngcontent-%COMP%]{font-size:1rem;line-height:1}.chart-container[_ngcontent-%COMP%]{position:relative;height:400px}.fullscreen-button[_ngcontent-%COMP%]{position:absolute;top:1rem;right:1rem;z-index:10;background:var(--bg-primary);border:1px solid var(--gray-200);border-radius:var(--radius-md);padding:.5rem;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s ease}.fullscreen-button[_ngcontent-%COMP%]:hover{background:var(--bg-secondary);transform:scale(1.1)}.fullscreen-icon[_ngcontent-%COMP%]{width:20px;height:20px;fill:var(--text-primary)}[_ngcontent-%COMP%]:fullscreen   .chart-container[_ngcontent-%COMP%]{height:100vh;width:100vw;display:flex;align-items:center;justify-content:center;background-color:var(--bg-primary)}[_ngcontent-%COMP%]:fullscreen   canvas[_ngcontent-%COMP%]{width:100%!important;height:100%!important;max-height:100vh}@media screen and (orientation: landscape){[_ngcontent-%COMP%]:fullscreen   canvas[_ngcontent-%COMP%]{width:auto!important;height:100%!important}}@media (max-width: 768px){.header-main[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch}.controls[_ngcontent-%COMP%]{flex-direction:column;gap:.5rem}.zoom-controls[_ngcontent-%COMP%]{justify-content:flex-end}.select[_ngcontent-%COMP%]{width:100%}}"]})};function _t(r,t){r&1&&(a(0,"div")(1,"div",4)(2,"div",5),T(),a(3,"svg",6),M(4,"path",7),o(),R(),a(5,"span"),l(6,"Cette application est en cours de d\xE9veloppement. Certaines fonctionnalit\xE9s peuvent \xEAtre instables ou incompl\xE8tes."),o()()()())}function yt(r,t){r&1&&(a(0,"div",8),M(1,"app-spinner"),a(2,"div",9),l(3," Chargement de toutes vos activit\xE9s des deux derni\xE8res ann\xE9es..."),M(4,"br"),a(5,"span",10),l(6,"Cela peut prendre quelques secondes"),o()()())}function Ct(r,t){r&1&&(a(0,"div",11),M(1,"app-spinner"),a(2,"div",12),l(3,"Chargement des activit\xE9s..."),o()())}function bt(r,t){if(r&1){let e=E();a(0,"div",14)(1,"div",15)(2,"p"),l(3,"Votre session a expir\xE9 ou n'est plus valide."),o(),a(4,"button",16),b("click",function(){y(e);let i=_(2);return C(i.reconnectToStrava())}),l(5," Se reconnecter \xE0 Strava "),o()()()}}function xt(r,t){if(r&1){let e=E();a(0,"div",14)(1,"div",15)(2,"p"),l(3),o(),a(4,"button",16),b("click",function(){y(e);let i=_(2);return C(i.loadData())}),l(5," R\xE9essayer "),o()()()}if(r&2){let e=_(2);c(3),A(e.error)}}function Mt(r,t){if(r&1){let e=E();a(0,"div")(1,"app-period-selector",17),b("periodChange",function(i){y(e);let s=_(2);return C(s.onPeriodChange(i))}),o(),M(2,"app-performance-dashboard",18),a(3,"div",19),M(4,"app-stats-list",20)(5,"app-stats-list",21)(6,"app-stats-list",22)(7,"app-modern-activity-chart",23)(8,"app-pace-scatter",18),o()()}if(r&2){let e=_(2);c(),p("selectedPeriod",e.selectedPeriod),c(),p("activities",e.runningActivityData),c(2),p("stats",e.runningStats)("selectedPeriod",e.selectedPeriod),c(),p("stats",e.walkingStats)("selectedPeriod",e.selectedPeriod),c(),p("stats",e.bikingStats)("selectedPeriod",e.selectedPeriod),c(),p("activities",e.allActivities)("period",e.selectedPeriod),c(),p("activities",e.allActivities)}}function wt(r,t){if(r&1&&(G(0),x(1,bt,6,0,"div",13)(2,xt,6,1,"div",13)(3,Mt,9,11,"div",1),K()),r&2){let e=_();c(),p("ngIf",e.authError),c(),p("ngIf",e.error&&!e.authError),c(),p("ngIf",!e.error&&!e.authError)}}var Ge=class r{constructor(t,e,n,i){this.stravaService=t;this.statsService=e;this.router=n;this.activityCache=i;let s={averageSpeed:0,totalDistance:0,averageDistance:0,totalElevation:0,averageElevation:0,totalElapsedTime:0,numberOfActivities:0};this.runningStats=s,this.bikingStats=s,this.walkingStats=s}selectedPeriod="week";isLoading=!1;isInitialLoad=!0;error=null;authError=!1;runningStats;bikingStats;walkingStats;allActivities=[];runningActivityData=[];bikingActivityData=[];walkingActivityData=[];ngOnInit(){this.checkAuth()&&this.loadInitialData()}onPeriodChange(t){this.selectedPeriod=t,this.checkAuth()&&this.loadData()}reconnectToStrava(){localStorage.clear(),this.stravaService.authenticate()}loadInitialData(){this.isLoading=!0,this.isInitialLoad=!0,this.error=null,this.authError=!1,this.stravaService.loadAllRecentActivities().subscribe({next:t=>{let e=this.activityCache.getFilteredActivities(this.selectedPeriod);this.updateActivitiesDisplay(e),this.isLoading=!1,this.isInitialLoad=!1},error:t=>{console.error("Error loading activities:",t),this.isLoading=!1,this.isInitialLoad=!1,t.status===401?this.handleAuthError():(this.error="Une erreur est survenue lors du chargement des donn\xE9es.",this.authError=!1)}})}loadData(){this.isLoading=!0,this.error=null,this.authError=!1,this.stravaService.getActivities(this.selectedPeriod).subscribe({next:t=>{this.updateActivitiesDisplay(t),this.isLoading=!1},error:t=>{console.error("Error loading activities:",t),this.isLoading=!1,t.status===401?this.handleAuthError():(this.error="Une erreur est survenue lors du chargement des donn\xE9es.",this.authError=!1)}})}updateActivitiesDisplay(t){this.allActivities=t,this.runningActivityData=t.filter(e=>e.type.includes("Run")),this.bikingActivityData=t.filter(e=>e.type.includes("Ride")),this.walkingActivityData=t.filter(e=>e.type.includes("Hike")||e.type.includes("Walk")),this.runningStats=this.statsService.calculateStats(this.runningActivityData),this.bikingStats=this.statsService.calculateStats(this.bikingActivityData),this.walkingStats=this.statsService.calculateStats(this.walkingActivityData)}checkAuth(){let t=localStorage.getItem("strava_token"),e=localStorage.getItem("strava_token_expires_at");return!t||!e||Date.now()/1e3>Number(e)?(this.handleAuthError(),!1):!0}handleAuthError(){this.authError=!0,this.error=null,this.isLoading=!1}static \u0275fac=function(e){return new(e||r)(F(ze),F(je),F(Ve),F(Re))};static \u0275cmp=O({type:r,selectors:[["app-dashboard"]],standalone:!0,features:[D],decls:5,vars:4,consts:[[1,"dashboard-container"],[4,"ngIf"],["class","initial-load-container",4,"ngIf"],["class","spinner-overlay",4,"ngIf"],[1,"dev-banner"],[1,"dev-banner-content"],["viewBox","0 0 24 24","width","24","height","24",1,"dev-icon"],["fill","currentColor","d","M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm-1-5h2v2h-2zm0-8h2v6h-2z"],[1,"initial-load-container"],[1,"initial-load-message"],[1,"initial-load-submessage"],[1,"spinner-overlay"],[1,"spinner-text"],["class","error-container",4,"ngIf"],[1,"error-container"],[1,"error-message"],[1,"retry-button",3,"click"],[3,"periodChange","selectedPeriod"],[3,"activities"],[1,"activity-type-container"],["title","Run",3,"stats","selectedPeriod"],["title","Walk",3,"stats","selectedPeriod"],["title","Bike",3,"stats","selectedPeriod"],[3,"activities","period"]],template:function(e,n){e&1&&(a(0,"div",0),x(1,_t,7,0,"div",1)(2,yt,7,0,"div",2)(3,Ct,4,0,"div",3)(4,wt,4,3,"ng-container",1),o()),e&2&&(c(),p("ngIf",!n.authError),c(),p("ngIf",n.isInitialLoad),c(),p("ngIf",n.isLoading&&!n.isInitialLoad),c(),p("ngIf",!n.isLoading))},dependencies:[k,I,Ne,we,Le,Pe,Oe,De],styles:[".dashboard-container[_ngcontent-%COMP%]{padding:20px;max-width:1200px;margin:0 auto;min-height:100vh;position:relative}.dev-banner[_ngcontent-%COMP%]{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;padding:.75rem;margin-bottom:2rem;border-radius:var(--radius-md);box-shadow:var(--shadow-md);animation:_ngcontent-%COMP%_slideDown .5s ease-out}.dev-banner-content[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;max-width:1200px;margin:0 auto;font-size:.95rem;line-height:1.5}.dev-icon[_ngcontent-%COMP%]{flex-shrink:0;animation:_ngcontent-%COMP%_pulse 2s infinite}.activity-type-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:3rem;grid-template-columns:1fr}@keyframes _ngcontent-%COMP%_slideDown{0%{transform:translateY(-100%);opacity:0}to{transform:translateY(0);opacity:1}}@keyframes _ngcontent-%COMP%_pulse{0%{opacity:.6}50%{opacity:1}to{opacity:.6}}@media (max-width: 768px){.dev-banner[_ngcontent-%COMP%]{margin:-1rem -1rem 1rem}.dev-banner-content[_ngcontent-%COMP%]{font-size:.85rem;padding:0 .5rem}}.error-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;min-height:200px;width:100%}.error-message[_ngcontent-%COMP%]{background:var(--bg-primary);border:1px solid var(--primary-200);border-radius:var(--radius-lg);padding:1.5rem;text-align:center;max-width:400px;width:90%;color:var(--text-primary);box-shadow:var(--shadow-sm)}.error-icon[_ngcontent-%COMP%]{font-size:24px;margin-bottom:10px}.retry-button[_ngcontent-%COMP%]{background-color:var(--primary-500);color:#fff;border:none;padding:.75rem 1.5rem;border-radius:var(--radius-md);margin-top:1rem;font-size:.95rem;font-weight:500;cursor:pointer;transition:background-color .2s}.retry-button[_ngcontent-%COMP%]:hover{background-color:var(--primary-600)}@media (max-width: 768px){.dashboard-container[_ngcontent-%COMP%]{padding:10px}.activity-type-container[_ngcontent-%COMP%]{grid-template-columns:1fr}}@media (max-width: 480px){.dashboard-container[_ngcontent-%COMP%]{padding:5px}h2[_ngcontent-%COMP%]{font-size:1.2rem}}.initial-load-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:60vh;gap:1.5rem}.initial-load-message[_ngcontent-%COMP%]{color:var(--text-primary);font-size:1.1rem;font-weight:500;text-align:center;padding:0 1rem;line-height:1.6}.initial-load-submessage[_ngcontent-%COMP%]{font-size:.9rem;font-weight:400;opacity:.7}.spinner-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#fffc;display:flex;flex-direction:column;justify-content:center;align-items:center;z-index:1000}.spinner-text[_ngcontent-%COMP%]{margin-top:1rem;color:#2196f3;font-weight:500}@media (max-width: 768px){.spinner-text[_ngcontent-%COMP%]{font-size:.9rem}}"]})};export{Ge as DashboardComponent};
