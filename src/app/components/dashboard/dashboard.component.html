<div class="dashboard-container">
  <div *ngIf="isInitialLoad" class="initial-load-container">
    <app-spinner></app-spinner>
    <div class="initial-load-message">
      Chargement de toutes vos activités des deux dernières années...<br>
      <span class="initial-load-submessage">Cela peut prendre quelques secondes</span>
    </div>
  </div>

  <div *ngIf="isLoading && !isInitialLoad" class="spinner-overlay">
    <app-spinner></app-spinner>
    <div class="spinner-text">Chargement des activités...</div>
  </div>

  <ng-container *ngIf="!isLoading">
    <div *ngIf="authError" class="error-container">
      <div class="error-message">
        <p>Votre session a expiré ou n'est plus valide.</p>
        <button class="retry-button" (click)="reconnectToStrava()">
          Se reconnecter à Strava
        </button>
      </div>
    </div>

    <div *ngIf="error && !authError" class="error-container">
      <div class="error-message">
        <p>{{ error }}</p>
        <button class="retry-button" (click)="loadData()">
          Réessayer
        </button>
      </div>
    </div>

    <div *ngIf="!error && !authError">
      <app-performance-dashboard
        [activities]="runningActivityData">
      </app-performance-dashboard>

      <div class="activity-type-container">
        <!-- Stats par groupe de sports (dynamique) -->
        <ng-container *ngFor="let groupData of groupedStatsData; trackBy: trackByGroupId">
          <app-stats-list
            [title]="groupData.group.name"
            [stats]="groupData.stats"
            [selectedPeriod]="selectedPeriod"
            [groupColor]="groupData.group.color"
            [groupIcon]="groupData.group.icon"
            [visibleMetrics]="groupData.group.visibleMetrics">
          </app-stats-list>
        </ng-container>

        <app-modern-activity-chart
          [activities]="allActivities"
          [period]="selectedPeriod">
        </app-modern-activity-chart>

        <app-pace-scatter
          [activities]="allActivities">
        </app-pace-scatter>
      </div>
    </div>
  </ng-container>

  <!-- Dev banner déplacé en bas -->
  <div *ngIf="!authError" class="dev-banner">
    <div class="dev-banner-content">
      <svg class="dev-icon" viewBox="0 0 24 24" width="16" height="16">
        <path fill="currentColor"
              d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm-1-5h2v2h-2zm0-8h2v6h-2z"/>
      </svg>
      <span>Application en développement</span>
    </div>
  </div>
</div>
