<div class="comparison-page">
  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <app-spinner></app-spinner>
    <div class="loading-message">Comparaison en cours...</div>
  </div>

  <!-- Error States -->
  <ng-container *ngIf="!isLoading">
    <div *ngIf="authError" class="error-container">
      <div class="error-message">
        <p>Votre session a expir√© ou n'est plus valide.</p>
        <button class="retry-button" (click)="reconnectToStrava()">
          Se reconnecter √† Strava
        </button>
      </div>
    </div>

    <div *ngIf="error && !authError" class="error-container">
      <div class="error-message">
        <p>{{ error }}</p>
        <button class="retry-button" (click)="onCompare()">
          R√©essayer
        </button>
      </div>
    </div>
  </ng-container>

  <!-- Comparison Results -->
  <div *ngIf="hasCompared && !isLoading && !error && !authError" class="comparison-results">
    <!-- Comparaisons par groupe de sports (dynamique) -->
    <ng-container *ngFor="let groupData of groupComparisons; trackBy: trackByGroupId">
      <div *ngIf="hasGroupActivities(groupData)">
        <app-comparison-stats-grid
          [comparison]="groupData.comparison"
          [activityType]="groupData.group.name"
          [groupColor]="groupData.group.color"
          [visibleMetrics]="groupData.group.visibleMetrics">
        </app-comparison-stats-grid>

        <app-comparison-chart
          [activities1]="groupData.activities1"
          [activities2]="groupData.activities2"
          [period1]="period1"
          [period2]="period2"
          [activityType]="groupData.group.name"
          [groupColor]="groupData.group.color">
        </app-comparison-chart>
      </div>
    </ng-container>

    <!-- No activities message -->
    <div *ngIf="!hasAnyActivities()" class="no-activities">
      <div class="no-activities-content">
        <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none"
             stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="10"/>
          <line x1="12" y1="8" x2="12" y2="12"/>
          <line x1="12" y1="16" x2="12.01" y2="16"/>
        </svg>
        <h3>Aucune activit√© trouv√©e</h3>
        <p>Il n'y a pas d'activit√©s pour les p√©riodes s√©lectionn√©es.</p>
      </div>
    </div>
  </div>

  <!-- Initial State -->
  <div *ngIf="!hasCompared && !isLoading" class="initial-state">
    <div class="initial-state-content">
      <div class="empty-icon">üìä</div>
      <h3>Comparez vos performances</h3>
      <p class="main-instruction">Suivez ces √©tapes pour analyser votre progression :</p>

      <div class="steps-container">
        <div class="step">
          <div class="step-number">1</div>
          <div class="step-content">
            <span class="step-title">Ouvrez le menu de r√©glages</span>
            <span class="step-description mobile-text">Cliquez sur l'ic√¥ne ‚öôÔ∏è pour acc√©der aux r√©glages</span>
            <span class="step-description desktop-text">Le menu de r√©glages est d√©j√† ouvert √† gauche</span>
          </div>
        </div>

        <div class="step">
          <div class="step-number">2</div>
          <div class="step-content">
            <span class="step-title">Choisissez deux p√©riodes</span>
            <span class="step-description">S√©lectionnez un preset ou des dates personnalis√©es</span>
          </div>
        </div>

        <div class="step">
          <div class="step-number">3</div>
          <div class="step-content">
            <span class="step-title">Lancez la comparaison</span>
            <span class="step-description">Cliquez sur le bouton "Comparer"</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
