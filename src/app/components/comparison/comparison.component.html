<div class="comparison-page">
  <div class="page-header">
    <h1>Comparaison de périodes</h1>
    <p class="page-description">
      Comparez vos performances entre deux périodes pour suivre votre progression
    </p>
  </div>

  <!-- Period Selector -->
  <app-comparison-period-selector
    [period1]="period1"
    [period2]="period2"
    (period1Change)="onPeriod1Change($event)"
    (period2Change)="onPeriod2Change($event)"
    (compareClick)="onCompare()">
  </app-comparison-period-selector>

  <!-- Loading State -->
  <app-spinner *ngIf="isLoading"></app-spinner>

  <!-- Error States -->
  <ng-container *ngIf="!isLoading">
    <div *ngIf="authError" class="error-container">
      <div class="error-message">
        <p>Votre session a expiré ou n'est plus valide.</p>
        <button class="retry-button" (click)="reconnectToStrava()">
          Se reconnecter à Strava
        </button>
      </div>
    </div>

    <div *ngIf="error && !authError" class="error-container">
      <div class="error-message">
        <p>{{ error }}</p>
        <button class="retry-button" (click)="onCompare()">
          Réessayer
        </button>
      </div>
    </div>
  </ng-container>

  <!-- Comparison Results -->
  <div *ngIf="hasCompared && !isLoading && !error && !authError" class="comparison-results">
    <!-- Running Comparison -->
    <div *ngIf="hasActivities('run')">
      <app-comparison-stats-grid
        [comparison]="runComparison"
        activityType="Run">
      </app-comparison-stats-grid>

      <app-comparison-chart
        [activities1]="runActivities1"
        [activities2]="runActivities2"
        [period1]="period1"
        [period2]="period2"
        activityType="Run">
      </app-comparison-chart>
    </div>

    <!-- Walking Comparison -->
    <div *ngIf="hasActivities('walk')">
      <app-comparison-stats-grid
        [comparison]="walkComparison"
        activityType="Walk">
      </app-comparison-stats-grid>

      <app-comparison-chart
        [activities1]="walkActivities1"
        [activities2]="walkActivities2"
        [period1]="period1"
        [period2]="period2"
        activityType="Walk">
      </app-comparison-chart>
    </div>

    <!-- Biking Comparison -->
    <div *ngIf="hasActivities('bike')">
      <app-comparison-stats-grid
        [comparison]="bikeComparison"
        activityType="Bike">
      </app-comparison-stats-grid>

      <app-comparison-chart
        [activities1]="bikeActivities1"
        [activities2]="bikeActivities2"
        [period1]="period1"
        [period2]="period2"
        activityType="Bike">
      </app-comparison-chart>
    </div>

    <!-- No activities message -->
    <div *ngIf="!hasActivities('run') && !hasActivities('walk') && !hasActivities('bike')" class="no-activities">
      <div class="no-activities-content">
        <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none"
             stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="10"/>
          <line x1="12" y1="8" x2="12" y2="12"/>
          <line x1="12" y1="16" x2="12.01" y2="16"/>
        </svg>
        <h3>Aucune activité trouvée</h3>
        <p>Il n'y a pas d'activités pour les périodes sélectionnées.</p>
      </div>
    </div>
  </div>

  <!-- Initial State -->
  <div *ngIf="!hasCompared && !isLoading" class="initial-state">
    <div class="initial-state-content">
      <svg xmlns="http://www.w3.org/2000/svg" width="80" height="80" viewBox="0 0 24 24" fill="none"
           stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/>
      </svg>
      <h3>Prêt à comparer vos performances ?</h3>
      <p>Sélectionnez deux périodes ci-dessus et cliquez sur "Comparer les périodes" pour voir vos progrès.</p>
    </div>
  </div>
</div>
