<div class="comparison-page">
  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <app-spinner></app-spinner>
    <div class="loading-message">{{ 'comparison.loading.message' | translate }}</div>
  </div>

  <!-- Error States -->
  <ng-container *ngIf="!isLoading">
    <div *ngIf="authError" class="error-container">
      <div class="error-message">
        <p>{{ 'errors.session_expired.title' | translate }}</p>
        <button class="retry-button" (click)="reconnectToStrava()">
          {{ 'errors.session_expired.action' | translate }}
        </button>
      </div>
    </div>

    <div *ngIf="error && !authError" class="error-container">
      <div class="error-message">
        <p>{{ error }}</p>
        <button class="retry-button" (click)="onCompare()">
          {{ 'errors.loading_error.action' | translate }}
        </button>
      </div>
    </div>
  </ng-container>

  <!-- Comparison Results -->
  <div *ngIf="hasCompared && !isLoading && !error && !authError" class="comparison-results">
    <!-- Comparaisons par groupe de sports (dynamique) -->
    <ng-container *ngFor="let groupData of groupComparisons; trackBy: trackByGroupId">
      <div *ngIf="hasGroupActivities(groupData)">
        <app-comparison-stats-grid
          [comparison]="groupData.comparison"
          [activityType]="groupData.group.nameKey | translate"
          [groupColor]="groupData.group.color"
          [visibleMetrics]="groupData.group.visibleMetrics">
        </app-comparison-stats-grid>

        <app-comparison-chart
          [activities1]="groupData.activities1"
          [activities2]="groupData.activities2"
          [period1]="period1"
          [period2]="period2"
          [activityType]="groupData.group.nameKey | translate"
          [groupColor]="groupData.group.color">
        </app-comparison-chart>
      </div>
    </ng-container>

    <!-- No activities message -->
    <div *ngIf="!hasAnyActivities()" class="no-activities">
      <div class="no-activities-content">
        <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none"
             stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="10"/>
          <line x1="12" y1="8" x2="12" y2="12"/>
          <line x1="12" y1="16" x2="12.01" y2="16"/>
        </svg>
        <h3>{{ 'comparison.no_activities.title' | translate }}</h3>
        <p>{{ 'comparison.no_activities.message' | translate }}</p>
      </div>
    </div>
  </div>

  <!-- Initial State -->
  <div *ngIf="!hasCompared && !isLoading" class="initial-state">
    <div class="initial-state-content">
      <div class="empty-icon">ðŸ“Š</div>
      <h3>{{ 'comparison.instructions.title' | translate }}</h3>
      <p class="main-instruction">{{ 'comparison.instructions.subtitle' | translate }}</p>

      <div class="steps-container">
        <div class="step">
          <div class="step-number">1</div>
          <div class="step-content">
            <span class="step-title">{{ 'comparison.instructions.step1_title' | translate }}</span>
            <span class="step-description mobile-text">{{ 'comparison.instructions.step1_mobile' | translate }}</span>
            <span class="step-description desktop-text">{{ 'comparison.instructions.step1_desktop' | translate }}</span>
          </div>
        </div>

        <div class="step">
          <div class="step-number">2</div>
          <div class="step-content">
            <span class="step-title">{{ 'comparison.instructions.step2_title' | translate }}</span>
            <span class="step-description">{{ 'comparison.instructions.step2_description' | translate }}</span>
          </div>
        </div>

        <div class="step">
          <div class="step-number">3</div>
          <div class="step-content">
            <span class="step-title">{{ 'comparison.instructions.step3_title' | translate }}</span>
            <span class="step-description">{{ 'comparison.instructions.step3_description' | translate }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
