<div class="comparison-page">
  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <app-spinner></app-spinner>
    <div class="loading-message">Comparaison en cours...</div>
  </div>

  <!-- Error States -->
  <ng-container *ngIf="!isLoading">
    <div *ngIf="authError" class="error-container">
      <div class="error-message">
        <p>Votre session a expiré ou n'est plus valide.</p>
        <button class="retry-button" (click)="reconnectToStrava()">
          Se reconnecter à Strava
        </button>
      </div>
    </div>

    <div *ngIf="error && !authError" class="error-container">
      <div class="error-message">
        <p>{{ error }}</p>
        <button class="retry-button" (click)="onCompare()">
          Réessayer
        </button>
      </div>
    </div>
  </ng-container>

  <!-- Comparison Results -->
  <div *ngIf="hasCompared && !isLoading && !error && !authError" class="comparison-results">
    <!-- Comparaisons par groupe de sports (dynamique) -->
    <ng-container *ngFor="let groupData of groupComparisons; trackBy: trackByGroupId">
      <div *ngIf="hasGroupActivities(groupData)">
        <app-comparison-stats-grid
          [comparison]="groupData.comparison"
          [activityType]="groupData.group.name"
          [groupColor]="groupData.group.color"
          [visibleMetrics]="groupData.group.visibleMetrics">
        </app-comparison-stats-grid>

        <app-comparison-chart
          [activities1]="groupData.activities1"
          [activities2]="groupData.activities2"
          [period1]="period1"
          [period2]="period2"
          [activityType]="groupData.group.name"
          [groupColor]="groupData.group.color">
        </app-comparison-chart>
      </div>
    </ng-container>

    <!-- No activities message -->
    <div *ngIf="!hasAnyActivities()" class="no-activities">
      <div class="no-activities-content">
        <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none"
             stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="10"/>
          <line x1="12" y1="8" x2="12" y2="12"/>
          <line x1="12" y1="16" x2="12.01" y2="16"/>
        </svg>
        <h3>Aucune activité trouvée</h3>
        <p>Il n'y a pas d'activités pour les périodes sélectionnées.</p>
      </div>
    </div>
  </div>

  <!-- Initial State -->
  <div *ngIf="!hasCompared && !isLoading" class="initial-state">
    <div class="initial-state-content">
      <svg xmlns="http://www.w3.org/2000/svg" width="80" height="80" viewBox="0 0 24 24" fill="none"
           stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/>
      </svg>
      <h3>Prêt à comparer vos performances ?</h3>
      <p>Sélectionnez deux périodes dans le menu et cliquez sur "Comparer" pour voir vos progrès.</p>
    </div>
  </div>
</div>
