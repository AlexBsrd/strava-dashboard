<div class="profile-container">
  <!-- Skeleton Loading - Only shown when profile is loading -->
  <app-profile-skeleton *ngIf="isLoadingProfile"></app-profile-skeleton>

  <!-- Error Message -->
  <div *ngIf="error" class="error-container">
    <div class="error-message">
      <div class="error-icon">‚ö†Ô∏è</div>
      <p>{{ error }}</p>
      <button class="reconnect-button" (click)="reconnect()">
        Se reconnecter √† Strava
      </button>
    </div>
  </div>

  <!-- Actual Content -->
  <div *ngIf="!isLoadingProfile && !error && profile" class="profile-content" @fadeIn>
    <!-- Profile Header -->
    <div class="profile-card">
      <div class="profile-avatar">
        <img [src]="profile.profile || '/assets/images/default-avatar.png'" [alt]="profile.firstname">
      </div>
      <div class="profile-info">
        <h1>{{ profile.firstname }} {{ profile.lastname }}</h1>
        <div class="profile-details">
          <span *ngIf="profile.city || profile.country" class="detail-item">
            <i class="icon">üìç</i>
            {{ profile.city }}, {{ profile.country }}
          </span>
          <span class="detail-item">
            <i class="icon">üéØ</i>
            Membre depuis {{ profile.created_at | date:'MMMM yyyy' }}
          </span>
        </div>
      </div>
    </div>

    <!-- Loading message for statistics -->
    <div *ngIf="isLoadingSummary" class="loading-stats-message" @fadeIn>
      <div class="loading-stats-content">
        <div class="loading-spinner"></div>
        <div class="loading-text">
          <h3>Chargement de vos statistiques...</h3>
          <p>Nous r√©cup√©rons toutes vos activit√©s Strava pour calculer vos totaux et records.</p>
          <p class="loading-subtext">Cette op√©ration peut prendre quelques instants selon le nombre d'activit√©s.</p>
        </div>
      </div>
      <!-- Skeleton for stats cards -->
      <div class="stats-skeleton-grid">
        <div class="stats-skeleton-card">
          <div class="skeleton-header">
            <div class="skeleton-icon"></div>
            <div class="skeleton-title"></div>
          </div>
          <div class="skeleton-body">
            <div class="skeleton-metric"></div>
            <div class="skeleton-metric"></div>
            <div class="skeleton-metric"></div>
            <div class="skeleton-metric"></div>
          </div>
        </div>
        <div class="stats-skeleton-card">
          <div class="skeleton-header">
            <div class="skeleton-icon"></div>
            <div class="skeleton-title"></div>
          </div>
          <div class="skeleton-body">
            <div class="skeleton-metric"></div>
            <div class="skeleton-metric"></div>
            <div class="skeleton-metric"></div>
            <div class="skeleton-metric"></div>
          </div>
        </div>
        <div class="stats-skeleton-card">
          <div class="skeleton-header">
            <div class="skeleton-icon"></div>
            <div class="skeleton-title"></div>
          </div>
          <div class="skeleton-body">
            <div class="skeleton-record"></div>
            <div class="skeleton-record"></div>
          </div>
        </div>
        <div class="stats-skeleton-card">
          <div class="skeleton-header">
            <div class="skeleton-icon"></div>
            <div class="skeleton-title"></div>
          </div>
          <div class="skeleton-body">
            <div class="skeleton-metric"></div>
            <div class="skeleton-metric"></div>
            <div class="skeleton-metric"></div>
            <div class="skeleton-metric"></div>
          </div>
        </div>
        <div class="stats-skeleton-card">
          <div class="skeleton-header">
            <div class="skeleton-icon"></div>
            <div class="skeleton-title"></div>
          </div>
          <div class="skeleton-body">
            <div class="skeleton-metric"></div>
            <div class="skeleton-metric"></div>
            <div class="skeleton-metric"></div>
            <div class="skeleton-metric"></div>
          </div>
        </div>
        <div class="stats-skeleton-card">
          <div class="skeleton-header">
            <div class="skeleton-icon"></div>
            <div class="skeleton-title"></div>
          </div>
          <div class="skeleton-body">
            <div class="skeleton-record"></div>
            <div class="skeleton-record"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Statistics Grid -->
    <div class="stats-container" *ngIf="!isLoadingSummary && summary" @fadeIn>
      <div class="stats-card total-running">
        <div class="stats-header">
          <div class="stats-icon running">üèÉ</div>
          <h3>Course √† pied - Total</h3>
        </div>
        <div class="stats-body">
          <div class="metric">
            <span class="metric-value">{{ formatDistance(summary.all_run_totals.distance) }}</span>
            <span class="metric-label">distance totale</span>
          </div>
          <div class="metric">
            <span class="metric-value">{{ formatDuration(summary.all_run_totals.moving_time) }}</span>
            <span class="metric-label">temps total</span>
          </div>
          <div class="metric">
            <span class="metric-value">{{ summary.all_run_totals.count }}</span>
            <span class="metric-label">sorties</span>
          </div>
          <div class="metric">
            <span class="metric-value">{{ formatElevation(summary.all_run_totals.elevation_gain) }}</span>
            <span class="metric-label">d√©nivel√© total</span>
          </div>
        </div>
      </div>

      <div class="stats-card total-cycling">
        <div class="stats-header">
          <div class="stats-icon cycling">üö¥</div>
          <h3>V√©lo - Total</h3>
        </div>
        <div class="stats-body">
          <div class="metric">
            <span class="metric-value">{{ formatDistance(summary.all_ride_totals.distance) }}</span>
            <span class="metric-label">distance totale</span>
          </div>
          <div class="metric">
            <span class="metric-value">{{ formatDuration(summary.all_ride_totals.moving_time) }}</span>
            <span class="metric-label">temps total</span>
          </div>
          <div class="metric">
            <span class="metric-value">{{ summary.all_ride_totals.count }}</span>
            <span class="metric-label">sorties</span>
          </div>
          <div class="metric">
            <span class="metric-value">{{ formatElevation(summary.all_ride_totals.elevation_gain) }}</span>
            <span class="metric-label">d√©nivel√© total</span>
          </div>
        </div>
      </div>

      <!-- Records -->
      <div class="stats-card">
        <div class="stats-header">
          <div class="stats-icon trophy">üèÜ</div>
          <h3>Records (Course/Marche uniquement)</h3>
        </div>
        <div class="stats-body">
          <div class="record-item">
            <div class="record-info">
              <span class="record-title">Plus grand d√©nivel√©</span>
              <span class="record-value">{{ formatElevation(summary.all_time_records.biggest_climb.value) }}</span>
              <span class="record-details">
                {{ summary.all_time_records.biggest_climb.activity_name }}
                ({{ summary.all_time_records.biggest_climb.activity_type }})
              </span>
              <span class="record-date">{{ formatDate(summary.all_time_records.biggest_climb.activity_date) }}</span>
            </div>
          </div>
          <div class="record-item">
            <div class="record-info">
              <span class="record-title">Plus longue sortie</span>
              <span class="record-value">{{ formatDistance(summary.all_time_records.longest_run.value) }}</span>
              <span class="record-details">
                {{ summary.all_time_records.longest_run.activity_name }}
                ({{ summary.all_time_records.longest_run.activity_type }})
              </span>
              <span class="record-date">{{ formatDate(summary.all_time_records.longest_run.activity_date) }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Yearly Stats Course -->
      <div class="stats-card ytd-running">
        <div class="stats-header">
          <div class="stats-icon running">üèÉ</div>
          <h3>Course √† pied - Cette ann√©e</h3>
        </div>
        <div class="stats-body">
          <div class="metric">
            <span class="metric-value">{{ formatDistance(summary.ytd_run_totals.distance) }}</span>
            <span class="metric-label">distance parcourue</span>
          </div>
          <div class="metric">
            <span class="metric-value">{{ formatDuration(summary.ytd_run_totals.moving_time) }}</span>
            <span class="metric-label">temps total</span>
          </div>
          <div class="metric">
            <span class="metric-value">{{ summary.ytd_run_totals.count }}</span>
            <span class="metric-label">sorties</span>
          </div>
          <div class="metric">
            <span class="metric-value">{{ formatElevation(summary.ytd_run_totals.elevation_gain) }}</span>
            <span class="metric-label">d√©nivel√© total</span>
          </div>
        </div>
      </div>

      <div class="stats-card ytd-cycling">
        <div class="stats-header">
          <div class="stats-icon cycling">üö¥</div>
          <h3>V√©lo - Cette ann√©e</h3>
        </div>
        <div class="stats-body">
          <div class="metric">
            <span class="metric-value">{{ formatDistance(summary.ytd_ride_totals.distance) }}</span>
            <span class="metric-label">distance parcourue</span>
          </div>
          <div class="metric">
            <span class="metric-value">{{ formatDuration(summary.ytd_ride_totals.moving_time) }}</span>
            <span class="metric-label">temps total</span>
          </div>
          <div class="metric">
            <span class="metric-value">{{ summary.ytd_ride_totals.count }}</span>
            <span class="metric-label">sorties</span>
          </div>
          <div class="metric">
            <span class="metric-value">{{ formatElevation(summary.ytd_ride_totals.elevation_gain) }}</span>
            <span class="metric-label">d√©nivel√© total</span>
          </div>
        </div>
      </div>
      <!-- Records V√©lo -->
      <div class="stats-card">
        <div class="stats-header">
          <div class="stats-icon trophy-ride">üèÜ</div>
          <h3>Records (V√©lo uniquement)</h3>
        </div>
        <div class="stats-body">
          <div class="record-item">
            <div class="record-info">
              <span class="record-title">Plus grand d√©nivel√©</span>
              <span class="record-value">{{ formatElevation(summary.all_time_ride_records.biggest_climb.value) }}</span>
              <span class="record-details">
                {{ summary.all_time_ride_records.biggest_climb.activity_name }}
                ({{ summary.all_time_ride_records.biggest_climb.activity_type }})
              </span>
              <span class="record-date">{{ formatDate(summary.all_time_ride_records.biggest_climb.activity_date) }}</span>
            </div>
          </div>
          <div class="record-item">
            <div class="record-info">
              <span class="record-title">Plus longue sortie</span>
              <span class="record-value">{{ formatDistance(summary.all_time_ride_records.longest_ride.value) }}</span>
              <span class="record-details">
                {{ summary.all_time_ride_records.longest_ride.activity_name }}
                ({{ summary.all_time_ride_records.longest_ride.activity_type }})
              </span>
              <span class="record-date">{{ formatDate(summary.all_time_ride_records.longest_ride.activity_date) }}</span>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>
