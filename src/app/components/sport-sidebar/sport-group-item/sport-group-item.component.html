<div class="group-item" [class.disabled]="!group.isEnabled" [class.expanded]="isExpanded">
  <!-- Header du groupe (cliquable pour expand) -->
  <div class="group-header" (click)="onExpand()">
    <!-- Toggle on/off -->
    <button
      class="toggle-switch"
      [class.active]="group.isEnabled"
      (click)="onToggle($event)"
      [attr.aria-label]="(group.isEnabled ? 'sidebar.sports.disable' : 'sidebar.sports.enable') | translate:{ name: (group.nameKey | translate) }"
    >
      <span class="toggle-slider"></span>
    </button>

    <!-- Icône colorée -->
    <div class="group-icon" [style.backgroundColor]="group.color">
      <ng-container [ngSwitch]="group.icon">
        <svg *ngSwitchCase="'run'" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="5" r="2"/>
          <path d="M7 20l3-8 2 2 4-5"/>
          <path d="M12 12l-3 8"/>
          <path d="M15 17l2 3"/>
        </svg>
        <svg *ngSwitchCase="'bike'" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="5" cy="17" r="3"/>
          <circle cx="19" cy="17" r="3"/>
          <path d="M12 17V5l4 6h3"/>
          <path d="M9 9l3 8"/>
        </svg>
        <svg *ngSwitchCase="'walk'" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="5" r="2"/>
          <path d="M9 20l2-8 2 2"/>
          <path d="M15 20l-2-8"/>
          <path d="M10 11l4-1"/>
        </svg>
        <svg *ngSwitchCase="'weight'" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M6 4h4v16H6z"/>
          <path d="M14 4h4v16h-4z"/>
          <line x1="10" y1="12" x2="14" y2="12"/>
        </svg>
        <svg *ngSwitchCase="'swim'" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M2 12c1.5-2 3.5-2 5 0s3.5 2 5 0 3.5-2 5 0 3.5 2 5 0"/>
          <path d="M2 18c1.5-2 3.5-2 5 0s3.5 2 5 0 3.5-2 5 0 3.5 2 5 0"/>
          <circle cx="12" cy="7" r="2"/>
          <path d="M9 10l3 2"/>
        </svg>
        <svg *ngSwitchCase="'ski'" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="4" r="2"/>
          <path d="M6 20l6-12 6 12"/>
          <path d="M4 22l16-4"/>
        </svg>
        <svg *ngSwitchDefault xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"/>
          <path d="M12 6v6l4 2"/>
        </svg>
      </ng-container>
    </div>

    <!-- Nom du groupe -->
    <div class="group-info">
      <span class="group-name">{{ group.nameKey | translate }}</span>
      <div class="group-meta-row">
        <span class="group-meta types-count">{{ 'sidebar.sports.sport_other' | translate:{ count: getTypesCount() } }}</span>
        <span class="group-meta" *ngIf="activityCount > 0">{{ 'sidebar.sports.activity_other' | translate:{ count: activityCount } }}</span>
      </div>
    </div>

    <!-- Edit button -->
    <button class="edit-btn" (click)="onEdit($event)" [attr.aria-label]="'sidebar.sports.editGroup' | translate">
      <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
      </svg>
    </button>

    <!-- Expand icon -->
    <button class="expand-btn" [class.rotated]="isExpanded" [attr.aria-label]="'sidebar.sports.configureMetrics' | translate">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <polyline points="6 9 12 15 18 9"></polyline>
      </svg>
    </button>
  </div>

  <!-- Panel des métriques (expandable) -->
  <div class="metrics-panel" [class.open]="isExpanded">
    <div class="metrics-header">
      <span class="metrics-label">{{ 'sidebar.groups.metricsDisplayed' | translate }}</span>
      <span class="metrics-count">{{ getMetricsCount() }}/{{ allMetrics.length }}</span>
    </div>
    <div class="metrics-list">
      <div
        *ngFor="let metric of allMetrics"
        class="metric-item"
        [class.disabled]="group.visibleMetrics.length === 1 && isMetricEnabled(metric)"
      >
        <button
          class="metric-toggle"
          [class.active]="isMetricEnabled(metric)"
          (click)="onMetricToggle(metric, $event)"
          [disabled]="group.visibleMetrics.length === 1 && isMetricEnabled(metric)"
          [attr.aria-label]="getMetricLabelKey(metric) | translate"
        >
          <span class="metric-slider"></span>
        </button>
        <span class="metric-label">{{ getMetricLabelKey(metric) | translate }}</span>
      </div>
    </div>
  </div>
</div>
