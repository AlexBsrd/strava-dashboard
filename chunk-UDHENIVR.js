import{c as at,l as Pt,m as Ot,n as wt}from"./chunk-HRGRRAKU.js";import{b as Ct,d as xt,e as ht,f as _t}from"./chunk-EQVGKUHK.js";import{a as St}from"./chunk-Y356FJ7L.js";import{a as bt,b as yt}from"./chunk-ZDDGAMWZ.js";import{$ as r,C as lt,D as k,E as I,F as L,G as j,Ia as Y,Ja as ut,Ka as z,O as a,P as E,Sa as B,V as h,X as c,Z as R,_ as o,aa as C,ab as vt,ba as tt,ca as et,da as $,ea as T,fa as v,fb as ft,g as ct,ga as dt,gb as A,ha as mt,ia as gt,ib as V,ka as s,la as g,ma as S,n as pt,na as N,ob as Mt,q as G,ta as D,va as it,xa as l,ya as d,z as w,za as nt}from"./chunk-KXPHHAN7.js";function Dt(i,e){if(i&1&&(o(0,"span",10),s(1),r()),i&2){let t=v();a(),g(t.unit)}}function zt(i,e){if(i&1&&(o(0,"span",10),s(1),r()),i&2){let t=v();a(),g(t.unit)}}function Bt(i,e){if(i&1&&(o(0,"div",11)(1,"div",12),s(2),o(3,"span",13),s(4),r()(),o(5,"div",14),s(6),r()()),i&2){let t=v();c("ngClass",t.trendClass),a(2),S(" ",t.formattedDelta," "),a(2),g(t.trendIcon),a(2),g(t.formattedPercentage)}}function At(i,e){i&1&&(o(0,"div",15)(1,"span"),s(2,"\u2014"),r()())}var K=class i{title="";value1=0;value2=0;unit="";isTime=!1;delta=null;get formattedValue1(){return this.isTime?this.formatTime(this.value1):this.value1.toFixed(1)}get formattedValue2(){return this.isTime?this.formatTime(this.value2):this.value2.toFixed(1)}get formattedDelta(){if(!this.delta)return"";if(this.isTime){let t=Math.floor(Math.abs(this.delta.absolute)/3600),n=Math.floor(Math.abs(this.delta.absolute)%3600/60),p=this.delta.absolute>=0?"+":"-";return t>0?`${p}${t}h${n}min`:`${p}${n}min`}return`${this.delta.absolute>=0?"+":""}${this.delta.absolute} ${this.unit}`}get formattedPercentage(){return this.delta?`${this.delta.percentage>=0?"+":""}${this.delta.percentage}%`:""}get trendIcon(){if(!this.delta)return"";switch(this.delta.trend){case"up":return"\u2191";case"down":return"\u2193";case"stable":return"\u2192";default:return""}}get trendClass(){return this.delta?this.delta.trend:""}formatTime(e){let t=Math.floor(e/3600),n=Math.floor(e%3600/60);return t>0?`${t}h${n}min`:`${n}min`}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=w({type:i,selectors:[["app-comparison-stats-card"]],inputs:{title:"title",value1:"value1",value2:"value2",unit:"unit",isTime:"isTime",delta:"delta"},standalone:!0,features:[D],decls:16,vars:7,consts:[[1,"comparison-card"],[1,"card-title"],[1,"values-container"],[1,"value","period1"],[1,"value-number"],["class","value-unit",4,"ngIf"],[1,"arrow"],[1,"value","period2"],["class","delta-container",3,"ngClass",4,"ngIf"],["class","no-delta",4,"ngIf"],[1,"value-unit"],[1,"delta-container",3,"ngClass"],[1,"delta-value"],[1,"trend-icon"],[1,"delta-percentage"],[1,"no-delta"]],template:function(t,n){t&1&&(o(0,"div",0)(1,"div",1),s(2),r(),o(3,"div",2)(4,"div",3)(5,"span",4),s(6),r(),h(7,Dt,2,1,"span",5),r(),o(8,"div",6),s(9,"\u2192"),r(),o(10,"div",7)(11,"span",4),s(12),r(),h(13,zt,2,1,"span",5),r()(),h(14,Bt,7,4,"div",8)(15,At,3,0,"div",9),r()),t&2&&(a(2),g(n.title),a(4),g(n.formattedValue1),a(),c("ngIf",!n.isTime),a(5),g(n.formattedValue2),a(),c("ngIf",!n.isTime),a(),c("ngIf",n.delta),a(),c("ngIf",!n.delta))},dependencies:[B,Y,z],styles:[".comparison-card[_ngcontent-%COMP%]{background:var(--card-background);border-radius:12px;padding:24px;box-shadow:0 2px 8px #0000001a;transition:all .3s ease;min-height:180px;display:flex;flex-direction:column;justify-content:space-between}.comparison-card[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 4px 16px #00000026}.card-title[_ngcontent-%COMP%]{font-size:14px;font-weight:500;color:var(--text-secondary);margin-bottom:16px;text-transform:uppercase;letter-spacing:.5px}.values-container[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;gap:12px}.value[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;flex:1}.value-number[_ngcontent-%COMP%]{font-size:32px;font-weight:700;color:var(--text-primary);line-height:1.1}.value-unit[_ngcontent-%COMP%]{font-size:14px;color:var(--text-secondary);margin-top:4px}.period1[_ngcontent-%COMP%]   .value-number[_ngcontent-%COMP%]{color:var(--text-secondary)}.period2[_ngcontent-%COMP%]   .value-number[_ngcontent-%COMP%]{color:var(--primary-color)}.arrow[_ngcontent-%COMP%]{font-size:24px;color:var(--text-secondary);opacity:.5}.delta-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:4px;padding:12px;background:var(--background);border-radius:8px;border:2px solid var(--border-color)}.delta-container.up[_ngcontent-%COMP%]{border-color:var(--success-color, #22c55e);background:var(--success-background, rgba(34, 197, 94, .1))}.delta-container.down[_ngcontent-%COMP%]{border-color:var(--danger-color, #ef4444);background:var(--danger-background, rgba(239, 68, 68, .1))}.delta-container.stable[_ngcontent-%COMP%]{border-color:var(--text-secondary);background:var(--background)}.delta-value[_ngcontent-%COMP%]{font-size:18px;font-weight:600;display:flex;align-items:center;gap:6px}.delta-container.up[_ngcontent-%COMP%]   .delta-value[_ngcontent-%COMP%]{color:var(--success-color, #22c55e)}.delta-container.down[_ngcontent-%COMP%]   .delta-value[_ngcontent-%COMP%]{color:var(--danger-color, #ef4444)}.delta-container.stable[_ngcontent-%COMP%]   .delta-value[_ngcontent-%COMP%]{color:var(--text-secondary)}.trend-icon[_ngcontent-%COMP%]{font-size:20px;font-weight:700}.delta-percentage[_ngcontent-%COMP%]{font-size:14px;font-weight:500;opacity:.9}.delta-container.up[_ngcontent-%COMP%]   .delta-percentage[_ngcontent-%COMP%]{color:var(--success-color, #22c55e)}.delta-container.down[_ngcontent-%COMP%]   .delta-percentage[_ngcontent-%COMP%]{color:var(--danger-color, #ef4444)}.delta-container.stable[_ngcontent-%COMP%]   .delta-percentage[_ngcontent-%COMP%]{color:var(--text-secondary)}.no-delta[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;padding:12px;color:var(--text-secondary);font-size:24px;opacity:.3}@media (max-width: 640px){.comparison-card[_ngcontent-%COMP%]{padding:1rem;min-height:auto}.values-container[_ngcontent-%COMP%]{flex-direction:column;gap:8px;align-items:stretch}.value[_ngcontent-%COMP%]{align-items:flex-start}.arrow[_ngcontent-%COMP%]{display:none}.value-number[_ngcontent-%COMP%]{font-size:1.5rem}.value-unit[_ngcontent-%COMP%]{font-size:.75rem}.card-title[_ngcontent-%COMP%]{font-size:.75rem;margin-bottom:.75rem}.delta-container[_ngcontent-%COMP%]{padding:.5rem}.delta-value[_ngcontent-%COMP%]{font-size:.875rem}.delta-percentage[_ngcontent-%COMP%]{font-size:.75rem}}"]})};var kt=i=>({count:i});function Vt(i,e){if(i&1&&(C(0,"app-comparison-stats-card",13),l(1,"translate")),i&2){let t=v(2);c("title",d(1,4,"metrics.labels.totalDistance"))("value1",t.comparison.period1Stats.totalDistance)("value2",t.comparison.period2Stats.totalDistance)("delta",t.comparison.deltas.totalDistance)}}function Gt(i,e){if(i&1&&(C(0,"app-comparison-stats-card",13),l(1,"translate")),i&2){let t=v(2);c("title",d(1,4,"metrics.labels.averageDistance"))("value1",t.comparison.period1Stats.averageDistance)("value2",t.comparison.period2Stats.averageDistance)("delta",t.comparison.deltas.averageDistance)}}function $t(i,e){if(i&1&&(C(0,"app-comparison-stats-card",14),l(1,"translate")),i&2){let t=v(2);c("title",d(1,4,"metrics.labels.averageSpeed"))("value1",t.comparison.period1Stats.averageSpeed)("value2",t.comparison.period2Stats.averageSpeed)("delta",t.comparison.deltas.averageSpeed)}}function Ft(i,e){if(i&1&&(C(0,"app-comparison-stats-card",15),l(1,"translate")),i&2){let t=v(2);c("title",d(1,4,"metrics.labels.totalElevation"))("value1",t.comparison.period1Stats.totalElevation)("value2",t.comparison.period2Stats.totalElevation)("delta",t.comparison.deltas.totalElevation)}}function Lt(i,e){if(i&1&&(C(0,"app-comparison-stats-card",15),l(1,"translate")),i&2){let t=v(2);c("title",d(1,4,"metrics.labels.averageElevation"))("value1",t.comparison.period1Stats.averageElevation)("value2",t.comparison.period2Stats.averageElevation)("delta",t.comparison.deltas.averageElevation)}}function jt(i,e){if(i&1&&(C(0,"app-comparison-stats-card",16),l(1,"translate")),i&2){let t=v(2);c("title",d(1,5,"metrics.labels.totalElapsedTime"))("value1",t.comparison.period1Stats.totalElapsedTime)("value2",t.comparison.period2Stats.totalElapsedTime)("delta",t.comparison.deltas.totalElapsedTime)("isTime",!0)}}function Rt(i,e){if(i&1&&(o(0,"div",2)(1,"div",3)(2,"div",4),C(3,"i",5),r(),o(4,"h2",6),s(5),r(),o(6,"span",7),s(7),l(8,"translate"),l(9,"translate"),r()(),o(10,"div",8),h(11,Vt,2,6,"app-comparison-stats-card",9)(12,Gt,2,6,"app-comparison-stats-card",9)(13,$t,2,6,"app-comparison-stats-card",10)(14,Ft,2,6,"app-comparison-stats-card",11)(15,Lt,2,6,"app-comparison-stats-card",11)(16,jt,2,7,"app-comparison-stats-card",12),r()()),i&2){let t=v();a(2),c("ngClass",t.activityIcon),a(3),g(t.activityType),a(2),N(" ",nt(8,10,"activities.count_other",it(16,kt,t.comparison.period1Stats.numberOfActivities))," \u2192 ",nt(9,13,"activities.count_other",it(18,kt,t.comparison.period2Stats.numberOfActivities))," "),a(4),c("ngIf",t.isMetricVisible("totalDistance")),a(),c("ngIf",t.isMetricVisible("averageDistance")),a(),c("ngIf",t.isMetricVisible("averageSpeed")),a(),c("ngIf",t.isMetricVisible("totalElevation")),a(),c("ngIf",t.isMetricVisible("averageElevation")),a(),c("ngIf",t.isMetricVisible("totalElapsedTime"))}}function Nt(i,e){i&1&&(o(0,"div",17)(1,"p"),s(2),l(3,"translate"),r()()),i&2&&(a(2),g(d(3,1,"comparison.no_activities.message")))}var H=class i{comparison=null;activityType="";groupColor;visibleMetrics;isMetricVisible(e){return(this.visibleMetrics||Ct).includes(e)}get activityIcon(){switch(this.activityType.toLowerCase()){case"run":case"course":return"run";case"walk":case"marche":return"walk";case"bike":case"v\xE9lo":return"bike";default:return"activity"}}get displayColor(){if(this.groupColor)return this.groupColor;switch(this.activityType.toLowerCase()){case"run":case"course":return"#ef4444";case"walk":case"marche":return"#22c55e";case"bike":case"v\xE9lo":return"#3b82f6";default:return"#6366f1"}}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=w({type:i,selectors:[["app-comparison-stats-grid"]],inputs:{comparison:"comparison",activityType:"activityType",groupColor:"groupColor",visibleMetrics:"visibleMetrics"},standalone:!0,features:[D],decls:2,vars:2,consts:[["class","stats-grid-container",4,"ngIf"],["class","no-data",4,"ngIf"],[1,"stats-grid-container"],[1,"activity-header"],[1,"activity-icon",3,"ngClass"],[1,"icon"],[1,"activity-title"],[1,"activity-count"],[1,"comparison-grid"],["unit","km",3,"title","value1","value2","delta",4,"ngIf"],["unit","km/h",3,"title","value1","value2","delta",4,"ngIf"],["unit","m",3,"title","value1","value2","delta",4,"ngIf"],[3,"title","value1","value2","delta","isTime",4,"ngIf"],["unit","km",3,"title","value1","value2","delta"],["unit","km/h",3,"title","value1","value2","delta"],["unit","m",3,"title","value1","value2","delta"],[3,"title","value1","value2","delta","isTime"],[1,"no-data"]],template:function(t,n){t&1&&h(0,Rt,17,20,"div",0)(1,Nt,4,3,"div",1),t&2&&(c("ngIf",n.comparison),a(),c("ngIf",!n.comparison))},dependencies:[B,Y,z,V,A,K],styles:[`.stats-grid-container[_ngcontent-%COMP%]{background:var(--card-background);border-radius:12px;padding:24px;margin-bottom:24px;box-shadow:0 2px 8px #0000001a}.activity-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px;margin-bottom:24px;padding-bottom:16px;border-bottom:2px solid var(--border-color)}.activity-icon[_ngcontent-%COMP%]{width:48px;height:48px;border-radius:50%;display:flex;align-items:center;justify-content:center;flex-shrink:0}.activity-icon.run[_ngcontent-%COMP%]{background:linear-gradient(135deg,#fc4c02,#ff6b35)}.activity-icon.walk[_ngcontent-%COMP%]{background:linear-gradient(135deg,#10b981,#34d399)}.activity-icon.bike[_ngcontent-%COMP%]{background:linear-gradient(135deg,#3b82f6,#60a5fa)}.activity-icon[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{width:24px;height:24px;background:#fff;mask-size:contain;mask-repeat:no-repeat;mask-position:center}.activity-icon.run[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{mask-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor'%3E%3Cpath d='M13 2L3 14h9l-1 8 10-12h-9l1-8z'/%3E%3C/svg%3E")}.activity-icon.walk[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{mask-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor'%3E%3Ccircle cx='12' cy='4' r='2'/%3E%3Cpath d='M10 8v6M14 8v6M10 14l-2 6M14 14l2 6'/%3E%3C/svg%3E")}.activity-icon.bike[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{mask-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor'%3E%3Ccircle cx='18' cy='18' r='3'/%3E%3Ccircle cx='6' cy='18' r='3'/%3E%3Cpath d='M12 6l-2 4h6l-2-4M8 14l4-4 4 4'/%3E%3C/svg%3E")}.activity-title[_ngcontent-%COMP%]{font-size:24px;font-weight:600;color:var(--text-primary);margin:0}.activity-count[_ngcontent-%COMP%]{font-size:14px;color:var(--text-secondary);margin-left:auto}.comparison-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(320px,1fr));gap:20px}.no-data[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;padding:48px;background:var(--card-background);border-radius:12px;margin-bottom:24px}.no-data[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--text-secondary);font-size:16px}@media (max-width: 768px){.stats-grid-container[_ngcontent-%COMP%]{padding:1rem}.comparison-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr);gap:12px}.activity-header[_ngcontent-%COMP%]{flex-wrap:wrap;margin-bottom:16px;padding-bottom:12px}.activity-count[_ngcontent-%COMP%]{margin-left:0;width:100%;text-align:left}}`]})};var Yt=["chartCanvas"];function Kt(i,e){i&1&&(o(0,"span"),s(1),l(2,"translate"),r()),i&2&&(a(),g(d(2,1,"comparison_chart.hint_desktop")))}function Ht(i,e){i&1&&(o(0,"span"),s(1),l(2,"translate"),r()),i&2&&(a(),g(d(2,1,"comparison_chart.hint_mobile")))}function Qt(i,e){i&1&&(o(0,"span",17),s(1),l(2,"translate"),r()),i&2&&(a(),g(d(2,1,"comparison_chart.info_distance")))}function Zt(i,e){i&1&&(o(0,"span",17),s(1),l(2,"translate"),r()),i&2&&(a(),g(d(2,1,"comparison_chart.info_speed")))}function Ut(i,e){i&1&&(o(0,"span",17),s(1),l(2,"translate"),r()),i&2&&(a(),g(d(2,1,"comparison_chart.info_elevation")))}at.register(...Pt,Ot);var Q=class i{chartCanvas;activities1=[];activities2=[];period1=null;period2=null;activityType="Run";groupColor;selectedMetric="distance";chart=null;isMobile=this.detectMobileDevice();ngOnChanges(e){(e.activities1||e.activities2)&&this.activities1.length&&this.activities2.length&&setTimeout(()=>this.createChart(),0)}selectMetric(e){this.selectedMetric=e,this.createChart()}createChart(){if(this.chart&&this.chart.destroy(),!this.chartCanvas?.nativeElement)return;let e=this.chartCanvas.nativeElement.getContext("2d");if(!e)return;let t=this.prepareAlignedChartData(this.activities1,this.activities2,this.period1,this.period2),n={type:"line",data:{labels:t.labels,datasets:[{label:this.period1?.label||"P\xE9riode 1",data:t.data1,borderColor:"rgba(156, 163, 175, 0.8)",backgroundColor:"rgba(156, 163, 175, 0.1)",borderWidth:2,tension:.4,pointRadius:3,pointHoverRadius:5,fill:!0,spanGaps:!0},{label:this.period2?.label||"P\xE9riode 2",data:t.data2,borderColor:"rgba(252, 76, 2, 0.8)",backgroundColor:"rgba(252, 76, 2, 0.1)",borderWidth:2,tension:.4,pointRadius:3,pointHoverRadius:5,fill:!0,spanGaps:!0}]},options:{responsive:!0,maintainAspectRatio:!1,interaction:{mode:"index",intersect:!1},plugins:{legend:{display:!0,position:"top",labels:{color:getComputedStyle(document.documentElement).getPropertyValue("--text-primary").trim(),font:{size:12,weight:500},padding:16,usePointStyle:!0,pointStyle:"circle"}},tooltip:{backgroundColor:"rgba(0, 0, 0, 0.8)",padding:12,titleFont:{size:14,weight:"bold"},bodyFont:{size:13},cornerRadius:8,displayColors:!0,callbacks:{title:p=>p[0].label,label:p=>{let m=p.dataset.label||"";m&&(m+=": ");let u=p.parsed.y;return u===null?m+="Pas de donn\xE9es":m+=this.formatValue(u),m},afterLabel:p=>{let m=p.dataIndex,f=p.datasetIndex===0?this.activities1:this.activities2;return f[m]?`Date: ${new Date(f[m].start_date).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"})}`:""}}},zoom:{zoom:{wheel:{enabled:!0,modifierKey:"ctrl"},pinch:{enabled:!0},mode:"x"},pan:{enabled:!0,mode:"x"}}},scales:{x:{grid:{color:"rgba(156, 163, 175, 0.1)"},ticks:{color:getComputedStyle(document.documentElement).getPropertyValue("--text-secondary").trim(),font:{size:11},maxRotation:45,minRotation:45,autoSkip:!0,autoSkipPadding:15,maxTicksLimit:20}},y:{beginAtZero:!0,grid:{color:"rgba(156, 163, 175, 0.1)"},ticks:{color:getComputedStyle(document.documentElement).getPropertyValue("--text-secondary").trim(),font:{size:11},callback:p=>this.formatValue(Number(p))}}}}};this.chart=new at(e,n)}prepareAlignedChartData(e,t,n,p){if(!n||!p)return{labels:[],data1:[],data2:[]};let m=[...e].sort((y,b)=>new Date(y.start_date).getTime()-new Date(b.start_date).getTime()),u=[...t].sort((y,b)=>new Date(y.start_date).getTime()-new Date(b.start_date).getTime()),f=this.calculateCumulativeValues(m),x=this.calculateCumulativeValues(u),P=new Map,_=new Map;m.forEach((y,b)=>{let M=new Date(y.start_date),F=this.getDayOfYear(M);P.set(F,{date:M,value:f[b]})}),u.forEach((y,b)=>{let M=new Date(y.start_date),F=this.getDayOfYear(M);_.set(F,{date:M,value:x[b]})});let Z=new Set([...P.keys(),..._.keys()]),U=Array.from(Z).sort((y,b)=>y-b),O=[],W=[],q=[],J=0,X=0;return U.forEach(y=>{let b=P.get(y),M=_.get(y),Tt=(b?.date||M?.date||new Date).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit"});O.push(Tt),b&&(J=b.value),W.push(J),M&&(X=M.value),q.push(X)}),{labels:O,data1:W,data2:q}}getDayOfYear(e){let t=new Date(e.getFullYear(),0,0),n=e.getTime()-t.getTime(),p=1e3*60*60*24;return Math.floor(n/p)}calculateCumulativeValues(e){let t=[],n=0;return e.forEach(p=>{switch(this.selectedMetric){case"distance":n+=p.distance;break;case"speed":let m=e.slice(0,e.indexOf(p)+1).reduce((f,x)=>f+x.distance,0),u=e.slice(0,e.indexOf(p)+1).reduce((f,x)=>f+x.average_speed*x.distance,0);n=m>0?u/m:0;break;case"elevation":n+=p.total_elevation_gain;break}t.push(n)}),t}prepareChartData(e,t){let n=[...e].sort((u,f)=>new Date(u.start_date).getTime()-new Date(f.start_date).getTime());if(!t)return{labels:[],values:[]};let p=n.map(u=>new Date(u.start_date).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit"})),m=[];switch(this.selectedMetric){case"distance":let u=0;m=n.map(_=>(u+=_.distance,u));break;case"speed":let f=0,x=0;m=n.map(_=>(f+=_.distance,x+=_.average_speed*_.distance,f>0?x/f:0));break;case"elevation":let P=0;m=n.map(_=>(P+=_.total_elevation_gain,P));break;default:m=n.map(()=>0)}return{labels:p,values:m}}formatValue(e){switch(this.selectedMetric){case"distance":return`${e.toFixed(1)} km`;case"speed":return`${e.toFixed(1)} km/h`;case"elevation":return`${e.toFixed(0)} m`;default:return e.toString()}}resetZoom(){this.chart&&this.chart.resetZoom()}detectMobileDevice(){let e=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),t=window.innerWidth<=768;return e||t}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=w({type:i,selectors:[["app-comparison-chart"]],viewQuery:function(t,n){if(t&1&&dt(Yt,5),t&2){let p;mt(p=gt())&&(n.chartCanvas=p.first)}},inputs:{activities1:"activities1",activities2:"activities2",period1:"period1",period2:"period2",activityType:"activityType",groupColor:"groupColor"},standalone:!0,features:[lt,D],decls:35,vars:36,consts:[["chartCanvas",""],[1,"chart-container"],[1,"chart-header"],[1,"chart-title"],[1,"chart-controls"],[1,"metric-selector"],[1,"metric-button",3,"click","title"],[1,"reset-zoom-button",3,"click","title"],["xmlns","http://www.w3.org/2000/svg","width","18","height","18","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["d","M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"],["d","M21 3v5h-5"],["d","M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"],["d","M3 21v-5h5"],[1,"chart-canvas-wrapper"],[1,"chart-hint"],[4,"ngIf"],["class","metric-info",4,"ngIf"],[1,"metric-info"]],template:function(t,n){if(t&1){let p=$();o(0,"div",1)(1,"div",2)(2,"h3",3),s(3),l(4,"translate"),r(),o(5,"div",4)(6,"div",5)(7,"button",6),l(8,"translate"),T("click",function(){return k(p),I(n.selectMetric("distance"))}),s(9),l(10,"translate"),r(),o(11,"button",6),l(12,"translate"),T("click",function(){return k(p),I(n.selectMetric("speed"))}),s(13),l(14,"translate"),r(),o(15,"button",6),l(16,"translate"),T("click",function(){return k(p),I(n.selectMetric("elevation"))}),s(17),l(18,"translate"),r()(),o(19,"button",7),l(20,"translate"),T("click",function(){return k(p),I(n.resetZoom())}),L(),o(21,"svg",8),C(22,"path",9)(23,"path",10)(24,"path",11)(25,"path",12),r()()()(),j(),o(26,"div",13),C(27,"canvas",null,0),r(),o(29,"div",14),h(30,Kt,3,3,"span",15)(31,Ht,3,3,"span",15)(32,Qt,3,3,"span",16)(33,Zt,3,3,"span",16)(34,Ut,3,3,"span",16),r()()}t&2&&(a(3),N("",d(4,20,"comparison_chart.title")," - ",n.activityType,""),a(4),R("active",n.selectedMetric==="distance"),c("title",d(8,22,"comparison_chart.distance_cumulated")),a(2),S(" ",d(10,24,"metrics.short_labels.distance")," "),a(2),R("active",n.selectedMetric==="speed"),c("title",d(12,26,"comparison_chart.speed_weighted")),a(2),S(" ",d(14,28,"metrics.short_labels.speed")," "),a(2),R("active",n.selectedMetric==="elevation"),c("title",d(16,30,"comparison_chart.elevation_cumulated")),a(2),S(" ",d(18,32,"metrics.short_labels.elevation")," "),a(2),c("title",d(20,34,"comparison_chart.reset_zoom")),a(11),c("ngIf",!n.isMobile),a(),c("ngIf",n.isMobile),a(),c("ngIf",n.selectedMetric==="distance"),a(),c("ngIf",n.selectedMetric==="speed"),a(),c("ngIf",n.selectedMetric==="elevation"))},dependencies:[B,z,V,A],styles:[".chart-container[_ngcontent-%COMP%]{background:var(--card-background);border-radius:12px;padding:24px;margin-bottom:24px;box-shadow:0 2px 8px #0000001a}.chart-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px;flex-wrap:wrap;gap:16px}.chart-title[_ngcontent-%COMP%]{font-size:20px;font-weight:600;color:var(--text-primary);margin:0}.chart-controls[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.metric-selector[_ngcontent-%COMP%]{display:flex;gap:8px;background:var(--background);padding:4px;border-radius:8px}.metric-button[_ngcontent-%COMP%]{padding:8px 16px;background:transparent;border:none;border-radius:6px;font-size:14px;font-weight:500;color:var(--text-secondary);cursor:pointer;transition:all .2s ease}.metric-button[_ngcontent-%COMP%]:hover{background:var(--hover-background);color:var(--text-primary)}.metric-button.active[_ngcontent-%COMP%]{background:#fc4c02;color:#fff}.reset-zoom-button[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:36px;height:36px;background:var(--background);border:1px solid var(--border-color);border-radius:8px;color:var(--text-secondary);cursor:pointer;transition:all .2s ease}.reset-zoom-button[_ngcontent-%COMP%]:hover{background:var(--hover-background);color:var(--primary-color);border-color:var(--primary-color)}.chart-canvas-wrapper[_ngcontent-%COMP%]{position:relative;height:400px;margin-bottom:16px}canvas[_ngcontent-%COMP%]{max-width:100%;height:100%}.chart-hint[_ngcontent-%COMP%]{font-size:12px;color:var(--text-secondary);text-align:center;padding:8px;background:var(--background);border-radius:6px;opacity:.8;display:flex;flex-wrap:wrap;justify-content:center;gap:12px}.metric-info[_ngcontent-%COMP%]{font-weight:500;color:var(--primary-color)}@media (max-width: 768px){.chart-header[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}.chart-controls[_ngcontent-%COMP%]{width:100%;justify-content:space-between}.metric-selector[_ngcontent-%COMP%]{flex:1}.metric-button[_ngcontent-%COMP%]{flex:1;padding:8px 12px;font-size:13px}.chart-canvas-wrapper[_ngcontent-%COMP%]{height:300px}}"]})};function Wt(i,e){i&1&&(o(0,"div",5),C(1,"app-spinner"),o(2,"div",6),s(3),l(4,"translate"),r()()),i&2&&(a(3),g(d(4,1,"comparison.loading.message")))}function qt(i,e){if(i&1){let t=$();o(0,"div",8)(1,"div",9)(2,"p"),s(3),l(4,"translate"),r(),o(5,"button",10),T("click",function(){k(t);let p=v(2);return I(p.reconnectToStrava())}),s(6),l(7,"translate"),r()()()}i&2&&(a(3),g(d(4,2,"errors.session_expired.title")),a(3),S(" ",d(7,4,"errors.session_expired.action")," "))}function Jt(i,e){if(i&1){let t=$();o(0,"div",8)(1,"div",9)(2,"p"),s(3),r(),o(4,"button",10),T("click",function(){k(t);let p=v(2);return I(p.onCompare())}),s(5),l(6,"translate"),r()()()}if(i&2){let t=v(2);a(3),g(t.error),a(2),S(" ",d(6,2,"errors.loading_error.action")," ")}}function Xt(i,e){if(i&1&&(tt(0),h(1,qt,8,6,"div",7)(2,Jt,7,4,"div",7),et()),i&2){let t=v();a(),c("ngIf",t.authError),a(),c("ngIf",t.error&&!t.authError)}}function te(i,e){if(i&1&&(o(0,"div"),C(1,"app-comparison-stats-grid",14),l(2,"translate"),C(3,"app-comparison-chart",15),l(4,"translate"),r()),i&2){let t=v().$implicit,n=v(2);a(),c("comparison",t.comparison)("activityType",d(2,10,t.group.nameKey))("groupColor",t.group.color)("visibleMetrics",t.group.visibleMetrics),a(2),c("activities1",t.activities1)("activities2",t.activities2)("period1",n.period1)("period2",n.period2)("activityType",d(4,12,t.group.nameKey))("groupColor",t.group.color)}}function ee(i,e){if(i&1&&(tt(0),h(1,te,5,14,"div",2),et()),i&2){let t=e.$implicit,n=v(2);a(),c("ngIf",n.hasGroupActivities(t))}}function ie(i,e){i&1&&(o(0,"div",16)(1,"div",17),L(),o(2,"svg",18),C(3,"circle",19)(4,"line",20)(5,"line",21),r(),j(),o(6,"h3"),s(7),l(8,"translate"),r(),o(9,"p"),s(10),l(11,"translate"),r()()()),i&2&&(a(7),g(d(8,2,"comparison.no_activities.title")),a(3),g(d(11,4,"comparison.no_activities.message")))}function ne(i,e){if(i&1&&(o(0,"div",11),h(1,ee,2,1,"ng-container",12)(2,ie,12,6,"div",13),r()),i&2){let t=v();a(),c("ngForOf",t.groupComparisons)("ngForTrackBy",t.trackByGroupId),a(),c("ngIf",!t.hasAnyActivities())}}function ae(i,e){i&1&&(o(0,"div",22)(1,"div",23)(2,"div",24),s(3,"\u{1F4CA}"),r(),o(4,"h3"),s(5),l(6,"translate"),r(),o(7,"p",25),s(8),l(9,"translate"),r(),o(10,"div",26)(11,"div",27)(12,"div",28),s(13,"1"),r(),o(14,"div",29)(15,"span",30),s(16),l(17,"translate"),r(),o(18,"span",31),s(19),l(20,"translate"),r(),o(21,"span",32),s(22),l(23,"translate"),r()()(),o(24,"div",27)(25,"div",28),s(26,"2"),r(),o(27,"div",29)(28,"span",30),s(29),l(30,"translate"),r(),o(31,"span",33),s(32),l(33,"translate"),r()()(),o(34,"div",27)(35,"div",28),s(36,"3"),r(),o(37,"div",29)(38,"span",30),s(39),l(40,"translate"),r(),o(41,"span",33),s(42),l(43,"translate"),r()()()()()()),i&2&&(a(5),g(d(6,9,"comparison.instructions.title")),a(3),g(d(9,11,"comparison.instructions.subtitle")),a(8),g(d(17,13,"comparison.instructions.step1_title")),a(3),g(d(20,15,"comparison.instructions.step1_mobile")),a(3),g(d(23,17,"comparison.instructions.step1_desktop")),a(7),g(d(30,19,"comparison.instructions.step2_title")),a(3),g(d(33,21,"comparison.instructions.step2_description")),a(7),g(d(40,23,"comparison.instructions.step3_title")),a(3),g(d(43,25,"comparison.instructions.step3_description")))}var Et=class i{constructor(e,t,n,p,m,u,f){this.comparisonService=e;this.stravaService=t;this.statsService=n;this.router=p;this.sportConfigService=m;this.periodStateService=u;this.translateService=f}destroy$=new ct;period1=null;period2=null;isLoading=!1;error=null;authError=!1;hasCompared=!1;activities1=[];activities2=[];groupComparisons=[];ngOnInit(){this.sportConfigService.config$.pipe(G(this.destroy$)).subscribe(()=>{this.hasCompared&&this.activities1.length>0&&this.filterAndCalculateComparisons()}),this.periodStateService.comparePeriod1$.pipe(G(this.destroy$)).subscribe(e=>{this.period1=e}),this.periodStateService.comparePeriod2$.pipe(G(this.destroy$)).subscribe(e=>{this.period2=e}),this.periodStateService.compareTriggered$.pipe(G(this.destroy$),pt(e=>e)).subscribe(()=>{this.onCompare()})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}onPeriod1Change(e){this.period1=e}onPeriod2Change(e){this.period2=e}onCompare(){!this.period1||!this.period2||this.checkAuth()&&this.loadComparisonData()}loadComparisonData(){if(this.isLoading=!0,this.error=null,this.authError=!1,this.hasCompared=!1,!this.period1||!this.period2){this.isLoading=!1;return}this.stravaService.loadAllRecentActivities().subscribe({next:e=>{!this.period1||!this.period2||(this.activities1=this.comparisonService.filterActivitiesByPeriod(e,this.period1),this.activities2=this.comparisonService.filterActivitiesByPeriod(e,this.period2),console.log("Period 1:",this.period1.label,"- Activities:",this.activities1.length),console.log("Period 2:",this.period2.label,"- Activities:",this.activities2.length),this.filterAndCalculateComparisons(),this.isLoading=!1,this.hasCompared=!0)},error:e=>{console.error("Error loading activities:",e),this.handleError(e)}})}handleError(e){this.isLoading=!1,e.status===401?this.handleAuthError():(this.error=this.translateService.instant("errors.loading_error.title"),this.authError=!1)}filterAndCalculateComparisons(){let e=this.sportConfigService.getEnabledGroups();this.groupComparisons=e.map(n=>{let p=this.sportConfigService.filterActivitiesByGroup(this.activities1,n),m=this.sportConfigService.filterActivitiesByGroup(this.activities2,n),u=this.statsService.calculateStats(p),f=this.statsService.calculateStats(m),x=this.comparisonService.compareStats(u,f);return{group:n,activities1:p,activities2:m,comparison:x}});let t=this.sportConfigService.getConfig();for(let n of t.ungroupedSportsEnabled){let p=xt(n),m=this.activities1.filter(O=>(O.sport_type||O.type)===n),u=this.activities2.filter(O=>(O.sport_type||O.type)===n);if(m.length===0&&u.length===0)continue;let x=this.sportConfigService.getUngroupedSportConfig(n)?.visibleMetrics||ht([n]),P={id:`individual-${n}`,nameKey:p.labelKey,types:[n],icon:p.icon,color:this.getColorForCategory(p.category),isDefault:!1,isEnabled:!0,order:999,visibleMetrics:x},_=this.statsService.calculateStats(m),Z=this.statsService.calculateStats(u),U=this.comparisonService.compareStats(_,Z);this.groupComparisons.push({group:P,activities1:m,activities2:u,comparison:U})}}getColorForCategory(e){return{running:"#ef4444",cycling:"#3b82f6",walking:"#22c55e",fitness:"#8b5cf6",water:"#06b6d4",winter:"#64748b",other:"#f97316"}[e]||"#6b7280"}checkAuth(){let e=localStorage.getItem("strava_token"),t=localStorage.getItem("strava_token_expires_at");return!e||!t||Date.now()/1e3>Number(t)?(this.handleAuthError(),!1):!0}handleAuthError(){this.authError=!0,this.error=null,this.isLoading=!1}reconnectToStrava(){localStorage.clear(),this.stravaService.authenticate()}hasGroupActivities(e){return e.activities1.length>0||e.activities2.length>0}hasAnyActivities(){return this.groupComparisons.some(e=>this.hasGroupActivities(e))}trackByGroupId(e,t){return t.group.id}static \u0275fac=function(t){return new(t||i)(E(bt),E(Mt),E(wt),E(vt),E(_t),E(yt),E(ft))};static \u0275cmp=w({type:i,selectors:[["app-comparison"]],standalone:!0,features:[D],decls:5,vars:4,consts:[[1,"comparison-page"],["class","loading-container",4,"ngIf"],[4,"ngIf"],["class","comparison-results",4,"ngIf"],["class","initial-state",4,"ngIf"],[1,"loading-container"],[1,"loading-message"],["class","error-container",4,"ngIf"],[1,"error-container"],[1,"error-message"],[1,"retry-button",3,"click"],[1,"comparison-results"],[4,"ngFor","ngForOf","ngForTrackBy"],["class","no-activities",4,"ngIf"],[3,"comparison","activityType","groupColor","visibleMetrics"],[3,"activities1","activities2","period1","period2","activityType","groupColor"],[1,"no-activities"],[1,"no-activities-content"],["xmlns","http://www.w3.org/2000/svg","width","64","height","64","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["cx","12","cy","12","r","10"],["x1","12","y1","8","x2","12","y2","12"],["x1","12","y1","16","x2","12.01","y2","16"],[1,"initial-state"],[1,"initial-state-content"],[1,"empty-icon"],[1,"main-instruction"],[1,"steps-container"],[1,"step"],[1,"step-number"],[1,"step-content"],[1,"step-title"],[1,"step-description","mobile-text"],[1,"step-description","desktop-text"],[1,"step-description"]],template:function(t,n){t&1&&(o(0,"div",0),h(1,Wt,5,3,"div",1)(2,Xt,3,2,"ng-container",2)(3,ne,3,3,"div",3)(4,ae,44,27,"div",4),r()),t&2&&(a(),c("ngIf",n.isLoading),a(),c("ngIf",!n.isLoading),a(),c("ngIf",n.hasCompared&&!n.isLoading&&!n.error&&!n.authError),a(),c("ngIf",!n.hasCompared&&!n.isLoading))},dependencies:[B,ut,z,V,A,H,Q,St],styles:[".comparison-page[_ngcontent-%COMP%]{max-width:95%;margin:0 auto;padding:24px}.page-header[_ngcontent-%COMP%]{margin-bottom:32px;text-align:center}.page-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:32px;font-weight:700;color:var(--text-primary);margin:0 0 12px}.page-description[_ngcontent-%COMP%]{font-size:16px;color:var(--text-secondary);margin:0}.loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;padding:80px 24px;min-height:400px}.loading-message[_ngcontent-%COMP%]{margin-top:24px;font-size:16px;font-weight:500;color:var(--text-secondary);text-align:center}.error-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;padding:48px 24px;margin:24px 0}.error-message[_ngcontent-%COMP%]{text-align:center;background:var(--card-background);padding:32px;border-radius:12px;box-shadow:0 2px 8px #0000001a;max-width:500px}.error-message[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px;color:var(--text-primary);margin:0 0 24px}.retry-button[_ngcontent-%COMP%]{padding:12px 24px;background:var(--primary-500, #3b82f6);color:#fff;border:none;border-radius:8px;font-size:15px;font-weight:600;cursor:pointer;transition:all .2s ease}.retry-button[_ngcontent-%COMP%]:hover{background:var(--primary-hover);transform:translateY(-1px)}.comparison-results[_ngcontent-%COMP%]{margin-top:32px}.no-activities[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;padding:64px 24px;margin:24px 0}.no-activities-content[_ngcontent-%COMP%]{text-align:center;max-width:500px}.no-activities-content[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{color:var(--text-secondary);opacity:.5;margin-bottom:24px}.no-activities-content[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:24px;font-weight:600;color:var(--text-primary);margin:0 0 12px}.no-activities-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px;color:var(--text-secondary);margin:0}.initial-state[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;padding:80px 24px;margin:24px 0}.initial-state-content[_ngcontent-%COMP%]{text-align:center;max-width:700px}.empty-icon[_ngcontent-%COMP%]{font-size:64px;margin-bottom:24px;animation:_ngcontent-%COMP%_float 3s ease-in-out infinite}@keyframes _ngcontent-%COMP%_float{0%,to{transform:translateY(0)}50%{transform:translateY(-10px)}}.initial-state-content[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:28px;font-weight:600;color:var(--text-primary);margin:0 0 12px}.main-instruction[_ngcontent-%COMP%]{font-size:16px;color:var(--text-secondary);margin:0 0 32px}.steps-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:20px;text-align:left}.step[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:16px;padding:20px;background:var(--card-background);border-radius:12px;border:2px solid var(--border-color);transition:all .2s ease}.step[_ngcontent-%COMP%]:hover{border-color:var(--primary-500, #3b82f6);transform:translate(4px);box-shadow:0 4px 12px #0000001a}.step-number[_ngcontent-%COMP%]{flex-shrink:0;width:32px;height:32px;background:var(--primary-500, #3b82f6);color:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:600;font-size:16px}.step-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px}.step-title[_ngcontent-%COMP%]{font-size:16px;font-weight:600;color:var(--text-primary)}.step-description[_ngcontent-%COMP%]{font-size:14px;color:var(--text-secondary);line-height:1.5}.mobile-text[_ngcontent-%COMP%]{display:none}.desktop-text[_ngcontent-%COMP%]{display:block}@media (max-width: 768px){.comparison-page[_ngcontent-%COMP%]{padding:20px}.page-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:24px}.page-description[_ngcontent-%COMP%]{font-size:14px}.initial-state[_ngcontent-%COMP%]{padding:48px 12px}.initial-state-content[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:22px}.empty-icon[_ngcontent-%COMP%]{font-size:48px}.step[_ngcontent-%COMP%]{padding:16px}.step-number[_ngcontent-%COMP%]{width:28px;height:28px;font-size:14px}.step-title[_ngcontent-%COMP%]{font-size:15px}.step-description[_ngcontent-%COMP%]{font-size:13px}.mobile-text[_ngcontent-%COMP%]{display:block}.desktop-text[_ngcontent-%COMP%]{display:none}.no-activities[_ngcontent-%COMP%]{padding:48px 12px}.no-activities-content[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:48px;height:48px}}"]})};export{Et as ComparisonComponent};
