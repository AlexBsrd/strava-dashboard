import{a as B}from"./chunk-VHH4DTTK.js";import{$ as o,D as f,E as _,Fa as H,Ga as P,Ha as z,I as A,K as T,N as D,Na as N,O as a,P as h,Pa as w,V as g,X as d,Z as x,_ as r,a as I,aa as F,ab as E,b as k,ba as O,ca as M,da as y,ea as v,fa as c,fb as $,ka as s,la as C,ma as l,sa as b,ua as Y,wa as L,z as u}from"./chunk-YDMMZ2T4.js";function W(n,e){if(n&1){let t=y();r(0,"button",6),v("click",function(){let p=f(t).$implicit,m=c();return _(m.onChange(p.value))}),s(1),o()}if(n&2){let t=e.$implicit,i=c();x("active",i.selectedPeriod===t.value),a(),l(" ",t.label," ")}}function q(n,e){if(n&1&&(r(0,"option",7),s(1),o()),n&2){let t=e.$implicit;d("value",t),a(),l(" Ann\xE9e ",t," ")}}var S=class n{constructor(e){this.elementRef=e}selectedPeriod="week";periodChange=new A;isHidden=!1;periods=[{value:"week",label:"7 derniers jours"},{value:"month",label:"30 derniers jours"},{value:"current_year",label:"Depuis le 1er janvier"}];availableYears=[];selectedYear=null;lastScrollTop=0;scrollThreshold=50;ngOnInit(){let e=new Date().getFullYear(),t=2020;for(let i=e;i>=t;i--)this.availableYears.push(i);E(this.selectedPeriod)&&(this.selectedYear=parseInt(this.selectedPeriod,10))}onScroll(){let e=window.scrollY;e>this.scrollThreshold?e>this.lastScrollTop?this.isHidden=!0:this.isHidden=!1:this.isHidden=!1,this.lastScrollTop=e}onChange(e){this.selectedPeriod=e,this.selectedYear=null,this.periodChange.emit(e)}onYearChange(e){this.selectedYear=e,this.selectedPeriod=e.toString(),this.periodChange.emit(e.toString())}isYearSelected(){return E(this.selectedPeriod)}static \u0275fac=function(t){return new(t||n)(h(T))};static \u0275cmp=u({type:n,selectors:[["app-period-selector"]],hostBindings:function(t,i){t&1&&v("scroll",function(m){return i.onScroll(m)},!1,D)},inputs:{selectedPeriod:"selectedPeriod"},outputs:{periodChange:"periodChange"},standalone:!0,features:[b],decls:7,vars:7,consts:[[1,"period-selector-wrapper"],[1,"period-buttons"],["class","period-button",3,"active","click",4,"ngFor","ngForOf"],[1,"period-button","year-selector",3,"change","value"],["value","","disabled",""],[3,"value",4,"ngFor","ngForOf"],[1,"period-button",3,"click"],[3,"value"]],template:function(t,i){t&1&&(r(0,"div",0)(1,"div",1),g(2,W,2,3,"button",2),r(3,"select",3),v("change",function(m){return i.onYearChange(+m.target.value)}),r(4,"option",4),s(5,"S\xE9lectionner une ann\xE9e"),o(),g(6,q,2,2,"option",5),o()()()),t&2&&(x("hidden",i.isHidden),a(2),d("ngForOf",i.periods),a(),x("active",i.isYearSelected()),d("value",i.selectedYear||""),a(3),d("ngForOf",i.availableYears))},dependencies:[w,P],styles:[`.period-selector-wrapper[_ngcontent-%COMP%]{position:sticky;top:120px;z-index:90;padding:1rem;display:flex;justify-content:center;transition:transform .3s ease}.period-selector-wrapper.hidden[_ngcontent-%COMP%]{transform:translateY(-150%)}.period-buttons[_ngcontent-%COMP%]{display:flex;gap:.75rem;padding:.75rem;background:rgba(var(--bg-primary-rgb),.95);-webkit-backdrop-filter:blur(8px);backdrop-filter:blur(8px);border-radius:var(--radius-lg);box-shadow:0 2px 8px #0000001a,0 0 1px #00000026}.period-button[_ngcontent-%COMP%]{padding:.75rem 1.25rem;border:1px solid var(--gray-200);background:var(--bg-primary);border-radius:var(--radius-md);color:var(--text-primary);font-weight:500;font-size:.95rem;cursor:pointer;transition:all .2s ease;white-space:nowrap;min-height:44px}.period-button[_ngcontent-%COMP%]:hover{background:var(--primary-50);border-color:var(--primary-200);transform:translateY(-1px);box-shadow:0 2px 4px #0000000d}.period-button.active[_ngcontent-%COMP%]{background:var(--primary-500);border-color:var(--primary-600);color:#fff}.year-selector[_ngcontent-%COMP%]{appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23666' d='M6 9L1 4h10z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right .75rem center;padding-right:2.5rem}.year-selector.active[_ngcontent-%COMP%]{background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='white' d='M6 9L1 4h10z'/%3E%3C/svg%3E")}@media (max-width: 768px){.period-selector-wrapper[_ngcontent-%COMP%]{top:180px;padding:.5rem}.period-buttons[_ngcontent-%COMP%]{flex-direction:column;width:calc(100% - 2rem);max-width:400px}.period-button[_ngcontent-%COMP%]{width:100%;text-align:center}}`]})};function G(n,e){n&1&&F(0,"app-spinner")}function J(n,e){if(n&1&&(r(0,"div",3),s(1),o()),n&2){let t=c();a(),l(" ",t.error," ")}}function Q(n,e){if(n&1&&(O(0),r(1,"div",19)(2,"span",20),s(3,"Distance"),o(),r(4,"span",21),s(5),o()(),r(6,"div",19)(7,"span",20),s(8,"Dur\xE9e"),o(),r(9,"span",21),s(10),o()(),r(11,"div",19)(12,"span",20),s(13,"Vitesse moy."),o(),r(14,"span",21),s(15),o()(),r(16,"div",19)(17,"span",20),s(18,"D\xE9nivel\xE9"),o(),r(19,"span",21),s(20),o()(),M()),n&2){let t=c().$implicit,i=c(3);a(5),l("",t.distance.toFixed(1)," km"),a(5),C(i.formatDuration(t.elapsed_time)),a(5),l("",t.average_speed.toFixed(1)," km/h"),a(5),l("",t.total_elevation_gain,"m")}}function X(n,e){if(n&1&&(O(0),r(1,"div",22)(2,"span",20),s(3,"Dur\xE9e de s\xE9ance"),o(),r(4,"span",21),s(5),o()(),M()),n&2){let t=c().$implicit,i=c(3);a(5),C(i.formatDuration(t.elapsed_time))}}function Z(n,e){if(n&1&&(r(0,"div",13)(1,"div",14)(2,"div",15),s(3),o(),r(4,"div",16),s(5),o()(),r(6,"h3",17),s(7),o(),r(8,"div",18),g(9,Q,21,4,"ng-container",1)(10,X,6,1,"ng-container",1),o()()),n&2){let t=e.$implicit,i=c(3);d("ngClass",t.type.toLowerCase()),a(3),l(" ",t.type," "),a(2),l(" ",i.formatTime(t.start_date)," "),a(2),C(t.name),a(2),d("ngIf",i.isCardioActivity(t.type)),a(),d("ngIf",!i.isCardioActivity(t.type))}}function ee(n,e){if(n&1&&(r(0,"div",8)(1,"div",9)(2,"div",10),s(3),o()(),r(4,"div",11),g(5,Z,11,6,"div",12),o()()),n&2){let t=e.$implicit,i=c(2);a(3),l(" ",i.formatDayHeader(t.key)," "),a(2),d("ngForOf",t.value)}}function te(n,e){if(n&1){let t=y();r(0,"div")(1,"header",4)(2,"h1"),s(3,"Mes Activit\xE9s"),o(),r(4,"app-period-selector",5),v("periodChange",function(p){f(t);let m=c();return _(m.onPeriodChange(p))}),o()(),r(5,"div",6),g(6,ee,6,2,"div",7),Y(7,"keyvalue"),o()()}if(n&2){let t=c();a(4),d("selectedPeriod",t.selectedPeriod),a(2),d("ngForOf",L(7,2,t.groupedActivities,t.reverseOrder))}}var R=class n{constructor(e){this.stravaService=e}activities=[];groupedActivities={};isLoading=!1;error=null;selectedPeriod="week";cardioActivities=["RUN","RIDE","WALK","HIKE","ALPINESKI","BACKCOUNTRYSKI"];ngOnInit(){this.loadActivities()}onPeriodChange(e){this.selectedPeriod=e,this.loadActivities()}isCardioActivity(e){return this.cardioActivities.includes(e.toUpperCase())}formatDuration(e){let t=Math.floor(e/3600),i=Math.floor(e%3600/60);return t>0?`${t}h ${i}min`:`${i}min`}formatDayHeader(e){return new Date(e).toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long"})}formatTime(e){return new Date(e).toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"})}reverseOrder=(e,t)=>e.key>t.key?-1:1;loadActivities(){this.isLoading=!0,this.error=null,this.stravaService.getActivities(this.selectedPeriod).subscribe({next:e=>{this.activities=e,this.groupActivitiesByDay(),this.isLoading=!1},error:e=>{console.error("Error loading activities:",e),this.isLoading=!1,this.error="Une erreur est survenue lors du chargement des activit\xE9s."}})}groupActivitiesByDay(){this.groupedActivities=this.activities.reduce((e,t)=>{let p=new Date(t.start_date).toISOString().split("T")[0];return e[p]||(e[p]=[]),e[p].push(k(I({},t),{start_date:new Date(t.start_date)})),e[p].sort((m,V)=>new Date(V.start_date).getTime()-new Date(m.start_date).getTime()),e},{})}static \u0275fac=function(t){return new(t||n)(h($))};static \u0275cmp=u({type:n,selectors:[["app-activities"]],standalone:!0,features:[b],decls:4,vars:3,consts:[[1,"activities-container"],[4,"ngIf"],["class","error-message",4,"ngIf"],[1,"error-message"],[1,"activities-header"],[3,"periodChange","selectedPeriod"],[1,"timeline"],["class","day-group",4,"ngFor","ngForOf"],[1,"day-group"],[1,"day-header"],[1,"date-badge"],[1,"activities-group"],["class","activity-card",3,"ngClass",4,"ngFor","ngForOf"],[1,"activity-card",3,"ngClass"],[1,"activity-header"],[1,"activity-type"],[1,"activity-time"],[1,"activity-name"],[1,"activity-stats"],[1,"stat"],[1,"stat-label"],[1,"stat-value"],[1,"stat","full-width"]],template:function(t,i){t&1&&(r(0,"div",0),g(1,G,1,0,"app-spinner",1)(2,J,2,1,"div",2)(3,te,8,5,"div",1),o()),t&2&&(a(),d("ngIf",i.isLoading),a(),d("ngIf",i.error),a(),d("ngIf",!i.isLoading&&!i.error))},dependencies:[w,H,P,z,N,S,B],styles:[".activities-container[_ngcontent-%COMP%]{padding:2rem;max-width:1200px;margin:0 auto}.activities-header[_ngcontent-%COMP%]{margin-bottom:2rem}.activities-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:2rem;color:var(--text-primary);margin-bottom:1rem}.timeline[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2rem}.day-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.day-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem}.date-badge[_ngcontent-%COMP%]{background:var(--bg-primary);padding:.5rem 1rem;border-radius:20px;font-weight:500;color:var(--text-primary);font-size:.9rem;box-shadow:var(--shadow-sm)}.activities-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem;margin-left:1rem}.activity-card[_ngcontent-%COMP%]{background:var(--bg-primary);border-radius:12px;padding:1.5rem;box-shadow:var(--shadow-sm);border-left:4px solid var(--gray-300);transition:transform .2s,box-shadow .2s}.activity-card[_ngcontent-%COMP%]:hover{transform:translate(4px);box-shadow:var(--shadow-md)}.activity-card.run[_ngcontent-%COMP%]{border-left-color:#ff5722}.activity-card.ride[_ngcontent-%COMP%]{border-left-color:#4caf50}.activity-card.walk[_ngcontent-%COMP%], .activity-card.hike[_ngcontent-%COMP%]{border-left-color:#ff9800}.activity-card.weighttraining[_ngcontent-%COMP%]{border-left-color:#9c27b0}.activity-card.alpineski[_ngcontent-%COMP%]{border-left-color:#2196f3}.activity-card.backcountryski[_ngcontent-%COMP%]{border-left-color:#1976d2}.activity-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:.75rem;color:var(--text-secondary)}.activity-type[_ngcontent-%COMP%]{font-size:.85rem;font-weight:500;text-transform:uppercase;color:#666}.activity-time[_ngcontent-%COMP%]{font-size:.85rem;color:#666}.activity-name[_ngcontent-%COMP%]{font-size:1.1rem;font-weight:600;color:var(--text-primary);margin-bottom:1rem}.activity-stats[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:1rem}.stat[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem}.stat.full-width[_ngcontent-%COMP%]{grid-column:1 / -1}.stat-label[_ngcontent-%COMP%]{font-size:.75rem;color:#666;text-transform:uppercase}.stat-value[_ngcontent-%COMP%]{font-size:1rem;font-weight:500;color:#2d3748}.error-message[_ngcontent-%COMP%]{text-align:center;padding:2rem;color:var(--danger-color);background-color:#ffebee;border-radius:var(--radius-md);margin:2rem 0}@media (max-width: 768px){.activities-container[_ngcontent-%COMP%]{padding:1rem}.activity-stats[_ngcontent-%COMP%]{grid-template-columns:1fr}}"]})};export{R as ActivitiesComponent};
