import{c as W,l as xt,m as ht,n as _t}from"./chunk-PSEWUJ6B.js";import{b as pt,d as dt,e as mt,f as ut}from"./chunk-M74YWQY7.js";import{a as Ct}from"./chunk-JZY57ICF.js";import{a as gt,b as vt}from"./chunk-E4KTUAA4.js";import{$ as o,C as it,D as P,E as O,F as V,G,Ga as L,Ha as ct,Ia as k,O as r,P as I,Qa as D,V as f,X as l,Z as F,Za as lt,_ as a,aa as g,ba as U,ca as Z,da as z,ea as E,fa as m,g as et,ga as at,gb as ft,ha as ot,ia as rt,ka as s,la as _,ma as $,n as nt,na as st,q as T,ta as w,z as S}from"./chunk-AMP4RADT.js";function Mt(n,e){if(n&1&&(a(0,"span",10),s(1),o()),n&2){let t=m();r(),_(t.unit)}}function St(n,e){if(n&1&&(a(0,"span",10),s(1),o()),n&2){let t=m();r(),_(t.unit)}}function Pt(n,e){if(n&1&&(a(0,"div",11)(1,"div",12),s(2),a(3,"span",13),s(4),o()(),a(5,"div",14),s(6),o()()),n&2){let t=m();l("ngClass",t.trendClass),r(2),$(" ",t.formattedDelta," "),r(2),_(t.trendIcon),r(2),_(t.formattedPercentage)}}function Ot(n,e){n&1&&(a(0,"div",15)(1,"span"),s(2,"\u2014"),o()())}var j=class n{title="";value1=0;value2=0;unit="";isTime=!1;delta=null;get formattedValue1(){return this.isTime?this.formatTime(this.value1):this.value1.toFixed(1)}get formattedValue2(){return this.isTime?this.formatTime(this.value2):this.value2.toFixed(1)}get formattedDelta(){if(!this.delta)return"";if(this.isTime){let t=Math.floor(Math.abs(this.delta.absolute)/3600),i=Math.floor(Math.abs(this.delta.absolute)%3600/60),c=this.delta.absolute>=0?"+":"-";return t>0?`${c}${t}h${i}min`:`${c}${i}min`}return`${this.delta.absolute>=0?"+":""}${this.delta.absolute} ${this.unit}`}get formattedPercentage(){return this.delta?`${this.delta.percentage>=0?"+":""}${this.delta.percentage}%`:""}get trendIcon(){if(!this.delta)return"";switch(this.delta.trend){case"up":return"\u2191";case"down":return"\u2193";case"stable":return"\u2192";default:return""}}get trendClass(){return this.delta?this.delta.trend:""}formatTime(e){let t=Math.floor(e/3600),i=Math.floor(e%3600/60);return t>0?`${t}h${i}min`:`${i}min`}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=S({type:n,selectors:[["app-comparison-stats-card"]],inputs:{title:"title",value1:"value1",value2:"value2",unit:"unit",isTime:"isTime",delta:"delta"},standalone:!0,features:[w],decls:16,vars:7,consts:[[1,"comparison-card"],[1,"card-title"],[1,"values-container"],[1,"value","period1"],[1,"value-number"],["class","value-unit",4,"ngIf"],[1,"arrow"],[1,"value","period2"],["class","delta-container",3,"ngClass",4,"ngIf"],["class","no-delta",4,"ngIf"],[1,"value-unit"],[1,"delta-container",3,"ngClass"],[1,"delta-value"],[1,"trend-icon"],[1,"delta-percentage"],[1,"no-delta"]],template:function(t,i){t&1&&(a(0,"div",0)(1,"div",1),s(2),o(),a(3,"div",2)(4,"div",3)(5,"span",4),s(6),o(),f(7,Mt,2,1,"span",5),o(),a(8,"div",6),s(9,"\u2192"),o(),a(10,"div",7)(11,"span",4),s(12),o(),f(13,St,2,1,"span",5),o()(),f(14,Pt,7,4,"div",8)(15,Ot,3,0,"div",9),o()),t&2&&(r(2),_(i.title),r(4),_(i.formattedValue1),r(),l("ngIf",!i.isTime),r(5),_(i.formattedValue2),r(),l("ngIf",!i.isTime),r(),l("ngIf",i.delta),r(),l("ngIf",!i.delta))},dependencies:[D,L,k],styles:[".comparison-card[_ngcontent-%COMP%]{background:var(--card-background);border-radius:12px;padding:24px;box-shadow:0 2px 8px #0000001a;transition:all .3s ease;min-height:180px;display:flex;flex-direction:column;justify-content:space-between}.comparison-card[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 4px 16px #00000026}.card-title[_ngcontent-%COMP%]{font-size:14px;font-weight:500;color:var(--text-secondary);margin-bottom:16px;text-transform:uppercase;letter-spacing:.5px}.values-container[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;gap:12px}.value[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;flex:1}.value-number[_ngcontent-%COMP%]{font-size:32px;font-weight:700;color:var(--text-primary);line-height:1.1}.value-unit[_ngcontent-%COMP%]{font-size:14px;color:var(--text-secondary);margin-top:4px}.period1[_ngcontent-%COMP%]   .value-number[_ngcontent-%COMP%]{color:var(--text-secondary)}.period2[_ngcontent-%COMP%]   .value-number[_ngcontent-%COMP%]{color:var(--primary-color)}.arrow[_ngcontent-%COMP%]{font-size:24px;color:var(--text-secondary);opacity:.5}.delta-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:4px;padding:12px;background:var(--background);border-radius:8px;border:2px solid var(--border-color)}.delta-container.up[_ngcontent-%COMP%]{border-color:var(--success-color, #22c55e);background:var(--success-background, rgba(34, 197, 94, .1))}.delta-container.down[_ngcontent-%COMP%]{border-color:var(--danger-color, #ef4444);background:var(--danger-background, rgba(239, 68, 68, .1))}.delta-container.stable[_ngcontent-%COMP%]{border-color:var(--text-secondary);background:var(--background)}.delta-value[_ngcontent-%COMP%]{font-size:18px;font-weight:600;display:flex;align-items:center;gap:6px}.delta-container.up[_ngcontent-%COMP%]   .delta-value[_ngcontent-%COMP%]{color:var(--success-color, #22c55e)}.delta-container.down[_ngcontent-%COMP%]   .delta-value[_ngcontent-%COMP%]{color:var(--danger-color, #ef4444)}.delta-container.stable[_ngcontent-%COMP%]   .delta-value[_ngcontent-%COMP%]{color:var(--text-secondary)}.trend-icon[_ngcontent-%COMP%]{font-size:20px;font-weight:700}.delta-percentage[_ngcontent-%COMP%]{font-size:14px;font-weight:500;opacity:.9}.delta-container.up[_ngcontent-%COMP%]   .delta-percentage[_ngcontent-%COMP%]{color:var(--success-color, #22c55e)}.delta-container.down[_ngcontent-%COMP%]   .delta-percentage[_ngcontent-%COMP%]{color:var(--danger-color, #ef4444)}.delta-container.stable[_ngcontent-%COMP%]   .delta-percentage[_ngcontent-%COMP%]{color:var(--text-secondary)}.no-delta[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;padding:12px;color:var(--text-secondary);font-size:24px;opacity:.3}@media (max-width: 640px){.comparison-card[_ngcontent-%COMP%]{padding:1rem;min-height:auto}.values-container[_ngcontent-%COMP%]{flex-direction:column;gap:8px;align-items:stretch}.value[_ngcontent-%COMP%]{align-items:flex-start}.arrow[_ngcontent-%COMP%]{display:none}.value-number[_ngcontent-%COMP%]{font-size:1.5rem}.value-unit[_ngcontent-%COMP%]{font-size:.75rem}.card-title[_ngcontent-%COMP%]{font-size:.75rem;margin-bottom:.75rem}.delta-container[_ngcontent-%COMP%]{padding:.5rem}.delta-value[_ngcontent-%COMP%]{font-size:.875rem}.delta-percentage[_ngcontent-%COMP%]{font-size:.75rem}}"]})};function Et(n,e){if(n&1&&g(0,"app-comparison-stats-card",15),n&2){let t=m(2);l("value1",t.comparison.period1Stats.totalDistance)("value2",t.comparison.period2Stats.totalDistance)("delta",t.comparison.deltas.totalDistance)}}function wt(n,e){if(n&1&&g(0,"app-comparison-stats-card",16),n&2){let t=m(2);l("value1",t.comparison.period1Stats.averageDistance)("value2",t.comparison.period2Stats.averageDistance)("delta",t.comparison.deltas.averageDistance)}}function kt(n,e){if(n&1&&g(0,"app-comparison-stats-card",17),n&2){let t=m(2);l("value1",t.comparison.period1Stats.averageSpeed)("value2",t.comparison.period2Stats.averageSpeed)("delta",t.comparison.deltas.averageSpeed)}}function Dt(n,e){if(n&1&&g(0,"app-comparison-stats-card",18),n&2){let t=m(2);l("value1",t.comparison.period1Stats.totalElevation)("value2",t.comparison.period2Stats.totalElevation)("delta",t.comparison.deltas.totalElevation)}}function It(n,e){if(n&1&&g(0,"app-comparison-stats-card",19),n&2){let t=m(2);l("value1",t.comparison.period1Stats.averageElevation)("value2",t.comparison.period2Stats.averageElevation)("delta",t.comparison.deltas.averageElevation)}}function Tt(n,e){if(n&1&&g(0,"app-comparison-stats-card",20),n&2){let t=m(2);l("value1",t.comparison.period1Stats.totalElapsedTime)("value2",t.comparison.period2Stats.totalElapsedTime)("delta",t.comparison.deltas.totalElapsedTime)("isTime",!0)}}function zt(n,e){if(n&1&&(a(0,"div",2)(1,"div",3)(2,"div",4),g(3,"i",5),o(),a(4,"h2",6),s(5),o(),a(6,"span",7),s(7),o()(),a(8,"div",8),f(9,Et,1,3,"app-comparison-stats-card",9)(10,wt,1,3,"app-comparison-stats-card",10)(11,kt,1,3,"app-comparison-stats-card",11)(12,Dt,1,3,"app-comparison-stats-card",12)(13,It,1,3,"app-comparison-stats-card",13)(14,Tt,1,4,"app-comparison-stats-card",14),o()()),n&2){let t=m();r(2),l("ngClass",t.activityIcon),r(3),_(t.activityType),r(2),st(" ",t.comparison.period1Stats.numberOfActivities," activit\xE9(s) \u2192 ",t.comparison.period2Stats.numberOfActivities," activit\xE9(s) "),r(2),l("ngIf",t.isMetricVisible("totalDistance")),r(),l("ngIf",t.isMetricVisible("averageDistance")),r(),l("ngIf",t.isMetricVisible("averageSpeed")),r(),l("ngIf",t.isMetricVisible("totalElevation")),r(),l("ngIf",t.isMetricVisible("averageElevation")),r(),l("ngIf",t.isMetricVisible("totalElapsedTime"))}}function At(n,e){n&1&&(a(0,"div",21)(1,"p"),s(2,"Aucune donn\xE9e disponible pour cette comparaison."),o()())}var R=class n{comparison=null;activityType="";groupColor;visibleMetrics;isMetricVisible(e){return(this.visibleMetrics||pt).includes(e)}get activityIcon(){switch(this.activityType.toLowerCase()){case"run":case"course":return"run";case"walk":case"marche":return"walk";case"bike":case"v\xE9lo":return"bike";default:return"activity"}}get displayColor(){if(this.groupColor)return this.groupColor;switch(this.activityType.toLowerCase()){case"run":case"course":return"#ef4444";case"walk":case"marche":return"#22c55e";case"bike":case"v\xE9lo":return"#3b82f6";default:return"#6366f1"}}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=S({type:n,selectors:[["app-comparison-stats-grid"]],inputs:{comparison:"comparison",activityType:"activityType",groupColor:"groupColor",visibleMetrics:"visibleMetrics"},standalone:!0,features:[w],decls:2,vars:2,consts:[["class","stats-grid-container",4,"ngIf"],["class","no-data",4,"ngIf"],[1,"stats-grid-container"],[1,"activity-header"],[1,"activity-icon",3,"ngClass"],[1,"icon"],[1,"activity-title"],[1,"activity-count"],[1,"comparison-grid"],["title","Distance totale","unit","km",3,"value1","value2","delta",4,"ngIf"],["title","Distance moyenne/sortie","unit","km",3,"value1","value2","delta",4,"ngIf"],["title","Vitesse moyenne","unit","km/h",3,"value1","value2","delta",4,"ngIf"],["title","D\xE9nivel\xE9 total","unit","m",3,"value1","value2","delta",4,"ngIf"],["title","D\xE9nivel\xE9 moyen/sortie","unit","m",3,"value1","value2","delta",4,"ngIf"],["title","Temps total",3,"value1","value2","delta","isTime",4,"ngIf"],["title","Distance totale","unit","km",3,"value1","value2","delta"],["title","Distance moyenne/sortie","unit","km",3,"value1","value2","delta"],["title","Vitesse moyenne","unit","km/h",3,"value1","value2","delta"],["title","D\xE9nivel\xE9 total","unit","m",3,"value1","value2","delta"],["title","D\xE9nivel\xE9 moyen/sortie","unit","m",3,"value1","value2","delta"],["title","Temps total",3,"value1","value2","delta","isTime"],[1,"no-data"]],template:function(t,i){t&1&&f(0,zt,15,10,"div",0)(1,At,3,0,"div",1),t&2&&(l("ngIf",i.comparison),r(),l("ngIf",!i.comparison))},dependencies:[D,L,k,j],styles:[`.stats-grid-container[_ngcontent-%COMP%]{background:var(--card-background);border-radius:12px;padding:24px;margin-bottom:24px;box-shadow:0 2px 8px #0000001a}.activity-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px;margin-bottom:24px;padding-bottom:16px;border-bottom:2px solid var(--border-color)}.activity-icon[_ngcontent-%COMP%]{width:48px;height:48px;border-radius:50%;display:flex;align-items:center;justify-content:center;flex-shrink:0}.activity-icon.run[_ngcontent-%COMP%]{background:linear-gradient(135deg,#fc4c02,#ff6b35)}.activity-icon.walk[_ngcontent-%COMP%]{background:linear-gradient(135deg,#10b981,#34d399)}.activity-icon.bike[_ngcontent-%COMP%]{background:linear-gradient(135deg,#3b82f6,#60a5fa)}.activity-icon[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{width:24px;height:24px;background:#fff;mask-size:contain;mask-repeat:no-repeat;mask-position:center}.activity-icon.run[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{mask-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor'%3E%3Cpath d='M13 2L3 14h9l-1 8 10-12h-9l1-8z'/%3E%3C/svg%3E")}.activity-icon.walk[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{mask-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor'%3E%3Ccircle cx='12' cy='4' r='2'/%3E%3Cpath d='M10 8v6M14 8v6M10 14l-2 6M14 14l2 6'/%3E%3C/svg%3E")}.activity-icon.bike[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{mask-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor'%3E%3Ccircle cx='18' cy='18' r='3'/%3E%3Ccircle cx='6' cy='18' r='3'/%3E%3Cpath d='M12 6l-2 4h6l-2-4M8 14l4-4 4 4'/%3E%3C/svg%3E")}.activity-title[_ngcontent-%COMP%]{font-size:24px;font-weight:600;color:var(--text-primary);margin:0}.activity-count[_ngcontent-%COMP%]{font-size:14px;color:var(--text-secondary);margin-left:auto}.comparison-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(320px,1fr));gap:20px}.no-data[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;padding:48px;background:var(--card-background);border-radius:12px;margin-bottom:24px}.no-data[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--text-secondary);font-size:16px}@media (max-width: 768px){.stats-grid-container[_ngcontent-%COMP%]{padding:1rem}.comparison-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr);gap:12px}.activity-header[_ngcontent-%COMP%]{flex-wrap:wrap;margin-bottom:16px;padding-bottom:12px}.activity-count[_ngcontent-%COMP%]{margin-left:0;width:100%;text-align:left}}`]})};var Vt=["chartCanvas"];function Gt(n,e){n&1&&(a(0,"span"),s(1,"\u{1F4A1} Astuce : Maintenez Ctrl + Molette pour zoomer, cliquez-glissez pour naviguer"),o())}function Ft(n,e){n&1&&(a(0,"span"),s(1,"\u{1F4A1} Astuce : Pincez pour zoomer, glissez pour naviguer"),o())}function $t(n,e){n&1&&(a(0,"span",19),s(1,"\u2022 Distance cumul\xE9e affich\xE9e"),o())}function Lt(n,e){n&1&&(a(0,"span",19),s(1,"\u2022 Vitesse moyenne pond\xE9r\xE9e par distance"),o())}function jt(n,e){n&1&&(a(0,"span",19),s(1,"\u2022 D\xE9nivel\xE9 cumul\xE9 affich\xE9"),o())}W.register(...xt,ht);var N=class n{chartCanvas;activities1=[];activities2=[];period1=null;period2=null;activityType="Run";groupColor;selectedMetric="distance";chart=null;isMobile=this.detectMobileDevice();ngOnChanges(e){(e.activities1||e.activities2)&&this.activities1.length&&this.activities2.length&&setTimeout(()=>this.createChart(),0)}selectMetric(e){this.selectedMetric=e,this.createChart()}createChart(){if(this.chart&&this.chart.destroy(),!this.chartCanvas?.nativeElement)return;let e=this.chartCanvas.nativeElement.getContext("2d");if(!e)return;let t=this.prepareAlignedChartData(this.activities1,this.activities2,this.period1,this.period2),i={type:"line",data:{labels:t.labels,datasets:[{label:this.period1?.label||"P\xE9riode 1",data:t.data1,borderColor:"rgba(156, 163, 175, 0.8)",backgroundColor:"rgba(156, 163, 175, 0.1)",borderWidth:2,tension:.4,pointRadius:3,pointHoverRadius:5,fill:!0,spanGaps:!0},{label:this.period2?.label||"P\xE9riode 2",data:t.data2,borderColor:"rgba(252, 76, 2, 0.8)",backgroundColor:"rgba(252, 76, 2, 0.1)",borderWidth:2,tension:.4,pointRadius:3,pointHoverRadius:5,fill:!0,spanGaps:!0}]},options:{responsive:!0,maintainAspectRatio:!1,interaction:{mode:"index",intersect:!1},plugins:{legend:{display:!0,position:"top",labels:{color:getComputedStyle(document.documentElement).getPropertyValue("--text-primary").trim(),font:{size:12,weight:500},padding:16,usePointStyle:!0,pointStyle:"circle"}},tooltip:{backgroundColor:"rgba(0, 0, 0, 0.8)",padding:12,titleFont:{size:14,weight:"bold"},bodyFont:{size:13},cornerRadius:8,displayColors:!0,callbacks:{title:c=>c[0].label,label:c=>{let p=c.dataset.label||"";p&&(p+=": ");let d=c.parsed.y;return d===null?p+="Pas de donn\xE9es":p+=this.formatValue(d),p},afterLabel:c=>{let p=c.dataIndex,u=c.datasetIndex===0?this.activities1:this.activities2;return u[p]?`Date: ${new Date(u[p].start_date).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"})}`:""}}},zoom:{zoom:{wheel:{enabled:!0,modifierKey:"ctrl"},pinch:{enabled:!0},mode:"x"},pan:{enabled:!0,mode:"x"}}},scales:{x:{grid:{color:"rgba(156, 163, 175, 0.1)"},ticks:{color:getComputedStyle(document.documentElement).getPropertyValue("--text-secondary").trim(),font:{size:11},maxRotation:45,minRotation:45,autoSkip:!0,autoSkipPadding:15,maxTicksLimit:20}},y:{beginAtZero:!0,grid:{color:"rgba(156, 163, 175, 0.1)"},ticks:{color:getComputedStyle(document.documentElement).getPropertyValue("--text-secondary").trim(),font:{size:11},callback:c=>this.formatValue(Number(c))}}}}};this.chart=new W(e,i)}prepareAlignedChartData(e,t,i,c){if(!i||!c)return{labels:[],data1:[],data2:[]};let p=[...e].sort((h,x)=>new Date(h.start_date).getTime()-new Date(x.start_date).getTime()),d=[...t].sort((h,x)=>new Date(h.start_date).getTime()-new Date(x.start_date).getTime()),u=this.calculateCumulativeValues(p),v=this.calculateCumulativeValues(d),b=new Map,C=new Map;p.forEach((h,x)=>{let y=new Date(h.start_date),A=this.getDayOfYear(y);b.set(A,{date:y,value:u[x]})}),d.forEach((h,x)=>{let y=new Date(h.start_date),A=this.getDayOfYear(y);C.set(A,{date:y,value:v[x]})});let B=new Set([...b.keys(),...C.keys()]),Y=Array.from(B).sort((h,x)=>h-x),M=[],H=[],q=[],K=0,Q=0;return Y.forEach(h=>{let x=b.get(h),y=C.get(h),bt=(x?.date||y?.date||new Date).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit"});M.push(bt),x&&(K=x.value),H.push(K),y&&(Q=y.value),q.push(Q)}),{labels:M,data1:H,data2:q}}getDayOfYear(e){let t=new Date(e.getFullYear(),0,0),i=e.getTime()-t.getTime(),c=1e3*60*60*24;return Math.floor(i/c)}calculateCumulativeValues(e){let t=[],i=0;return e.forEach(c=>{switch(this.selectedMetric){case"distance":i+=c.distance;break;case"speed":let p=e.slice(0,e.indexOf(c)+1).reduce((u,v)=>u+v.distance,0),d=e.slice(0,e.indexOf(c)+1).reduce((u,v)=>u+v.average_speed*v.distance,0);i=p>0?d/p:0;break;case"elevation":i+=c.total_elevation_gain;break}t.push(i)}),t}prepareChartData(e,t){let i=[...e].sort((d,u)=>new Date(d.start_date).getTime()-new Date(u.start_date).getTime());if(!t)return{labels:[],values:[]};let c=i.map(d=>new Date(d.start_date).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit"})),p=[];switch(this.selectedMetric){case"distance":let d=0;p=i.map(C=>(d+=C.distance,d));break;case"speed":let u=0,v=0;p=i.map(C=>(u+=C.distance,v+=C.average_speed*C.distance,u>0?v/u:0));break;case"elevation":let b=0;p=i.map(C=>(b+=C.total_elevation_gain,b));break;default:p=i.map(()=>0)}return{labels:c,values:p}}formatValue(e){switch(this.selectedMetric){case"distance":return`${e.toFixed(1)} km`;case"speed":return`${e.toFixed(1)} km/h`;case"elevation":return`${e.toFixed(0)} m`;default:return e.toString()}}resetZoom(){this.chart&&this.chart.resetZoom()}detectMobileDevice(){let e=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),t=window.innerWidth<=768;return e||t}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=S({type:n,selectors:[["app-comparison-chart"]],viewQuery:function(t,i){if(t&1&&at(Vt,5),t&2){let c;ot(c=rt())&&(i.chartCanvas=c.first)}},inputs:{activities1:"activities1",activities2:"activities2",period1:"period1",period2:"period2",activityType:"activityType",groupColor:"groupColor"},standalone:!0,features:[it,w],decls:27,vars:12,consts:[["chartCanvas",""],[1,"chart-container"],[1,"chart-header"],[1,"chart-title"],[1,"chart-controls"],[1,"metric-selector"],["title","Distance cumul\xE9e",1,"metric-button",3,"click"],["title","Vitesse moyenne pond\xE9r\xE9e",1,"metric-button",3,"click"],["title","D\xE9nivel\xE9 cumul\xE9",1,"metric-button",3,"click"],["title","R\xE9initialiser le zoom",1,"reset-zoom-button",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","18","height","18","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["d","M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"],["d","M21 3v5h-5"],["d","M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"],["d","M3 21v-5h5"],[1,"chart-canvas-wrapper"],[1,"chart-hint"],[4,"ngIf"],["class","metric-info",4,"ngIf"],[1,"metric-info"]],template:function(t,i){if(t&1){let c=z();a(0,"div",1)(1,"div",2)(2,"h3",3),s(3),o(),a(4,"div",4)(5,"div",5)(6,"button",6),E("click",function(){return P(c),O(i.selectMetric("distance"))}),s(7," Distance "),o(),a(8,"button",7),E("click",function(){return P(c),O(i.selectMetric("speed"))}),s(9," Vitesse "),o(),a(10,"button",8),E("click",function(){return P(c),O(i.selectMetric("elevation"))}),s(11," D\xE9nivel\xE9 "),o()(),a(12,"button",9),E("click",function(){return P(c),O(i.resetZoom())}),V(),a(13,"svg",10),g(14,"path",11)(15,"path",12)(16,"path",13)(17,"path",14),o()()()(),G(),a(18,"div",15),g(19,"canvas",null,0),o(),a(21,"div",16),f(22,Gt,2,0,"span",17)(23,Ft,2,0,"span",17)(24,$t,2,0,"span",18)(25,Lt,2,0,"span",18)(26,jt,2,0,"span",18),o()()}t&2&&(r(3),$("\xC9volution comparative - ",i.activityType,""),r(3),F("active",i.selectedMetric==="distance"),r(2),F("active",i.selectedMetric==="speed"),r(2),F("active",i.selectedMetric==="elevation"),r(12),l("ngIf",!i.isMobile),r(),l("ngIf",i.isMobile),r(),l("ngIf",i.selectedMetric==="distance"),r(),l("ngIf",i.selectedMetric==="speed"),r(),l("ngIf",i.selectedMetric==="elevation"))},dependencies:[D,k],styles:[".chart-container[_ngcontent-%COMP%]{background:var(--card-background);border-radius:12px;padding:24px;margin-bottom:24px;box-shadow:0 2px 8px #0000001a}.chart-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px;flex-wrap:wrap;gap:16px}.chart-title[_ngcontent-%COMP%]{font-size:20px;font-weight:600;color:var(--text-primary);margin:0}.chart-controls[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.metric-selector[_ngcontent-%COMP%]{display:flex;gap:8px;background:var(--background);padding:4px;border-radius:8px}.metric-button[_ngcontent-%COMP%]{padding:8px 16px;background:transparent;border:none;border-radius:6px;font-size:14px;font-weight:500;color:var(--text-secondary);cursor:pointer;transition:all .2s ease}.metric-button[_ngcontent-%COMP%]:hover{background:var(--hover-background);color:var(--text-primary)}.metric-button.active[_ngcontent-%COMP%]{background:#fc4c02;color:#fff}.reset-zoom-button[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:36px;height:36px;background:var(--background);border:1px solid var(--border-color);border-radius:8px;color:var(--text-secondary);cursor:pointer;transition:all .2s ease}.reset-zoom-button[_ngcontent-%COMP%]:hover{background:var(--hover-background);color:var(--primary-color);border-color:var(--primary-color)}.chart-canvas-wrapper[_ngcontent-%COMP%]{position:relative;height:400px;margin-bottom:16px}canvas[_ngcontent-%COMP%]{max-width:100%;height:100%}.chart-hint[_ngcontent-%COMP%]{font-size:12px;color:var(--text-secondary);text-align:center;padding:8px;background:var(--background);border-radius:6px;opacity:.8;display:flex;flex-wrap:wrap;justify-content:center;gap:12px}.metric-info[_ngcontent-%COMP%]{font-weight:500;color:var(--primary-color)}@media (max-width: 768px){.chart-header[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}.chart-controls[_ngcontent-%COMP%]{width:100%;justify-content:space-between}.metric-selector[_ngcontent-%COMP%]{flex:1}.metric-button[_ngcontent-%COMP%]{flex:1;padding:8px 12px;font-size:13px}.chart-canvas-wrapper[_ngcontent-%COMP%]{height:300px}}"]})};function Rt(n,e){n&1&&(a(0,"div",5),g(1,"app-spinner"),a(2,"div",6),s(3,"Comparaison en cours..."),o()())}function Nt(n,e){if(n&1){let t=z();a(0,"div",8)(1,"div",9)(2,"p"),s(3,"Votre session a expir\xE9 ou n'est plus valide."),o(),a(4,"button",10),E("click",function(){P(t);let c=m(2);return O(c.reconnectToStrava())}),s(5," Se reconnecter \xE0 Strava "),o()()()}}function Bt(n,e){if(n&1){let t=z();a(0,"div",8)(1,"div",9)(2,"p"),s(3),o(),a(4,"button",10),E("click",function(){P(t);let c=m(2);return O(c.onCompare())}),s(5," R\xE9essayer "),o()()()}if(n&2){let t=m(2);r(3),_(t.error)}}function Yt(n,e){if(n&1&&(U(0),f(1,Nt,6,0,"div",7)(2,Bt,6,1,"div",7),Z()),n&2){let t=m();r(),l("ngIf",t.authError),r(),l("ngIf",t.error&&!t.authError)}}function Ht(n,e){if(n&1&&(a(0,"div"),g(1,"app-comparison-stats-grid",14)(2,"app-comparison-chart",15),o()),n&2){let t=m().$implicit,i=m(2);r(),l("comparison",t.comparison)("activityType",t.group.name)("groupColor",t.group.color)("visibleMetrics",t.group.visibleMetrics),r(),l("activities1",t.activities1)("activities2",t.activities2)("period1",i.period1)("period2",i.period2)("activityType",t.group.name)("groupColor",t.group.color)}}function qt(n,e){if(n&1&&(U(0),f(1,Ht,3,10,"div",2),Z()),n&2){let t=e.$implicit,i=m(2);r(),l("ngIf",i.hasGroupActivities(t))}}function Kt(n,e){n&1&&(a(0,"div",16)(1,"div",17),V(),a(2,"svg",18),g(3,"circle",19)(4,"line",20)(5,"line",21),o(),G(),a(6,"h3"),s(7,"Aucune activit\xE9 trouv\xE9e"),o(),a(8,"p"),s(9,"Il n'y a pas d'activit\xE9s pour les p\xE9riodes s\xE9lectionn\xE9es."),o()()())}function Qt(n,e){if(n&1&&(a(0,"div",11),f(1,qt,2,1,"ng-container",12)(2,Kt,10,0,"div",13),o()),n&2){let t=m();r(),l("ngForOf",t.groupComparisons)("ngForTrackBy",t.trackByGroupId),r(),l("ngIf",!t.hasAnyActivities())}}function Ut(n,e){n&1&&(a(0,"div",22)(1,"div",23)(2,"div",24),s(3,"\u{1F4CA}"),o(),a(4,"h3"),s(5,"Comparez vos performances"),o(),a(6,"p",25),s(7,"Suivez ces \xE9tapes pour analyser votre progression :"),o(),a(8,"div",26)(9,"div",27)(10,"div",28),s(11,"1"),o(),a(12,"div",29)(13,"span",30),s(14,"Ouvrez le menu de r\xE9glages"),o(),a(15,"span",31),s(16,"Cliquez sur l'ic\xF4ne \u2699\uFE0F pour acc\xE9der aux r\xE9glages"),o(),a(17,"span",32),s(18,"Le menu de r\xE9glages est d\xE9j\xE0 ouvert \xE0 gauche"),o()()(),a(19,"div",27)(20,"div",28),s(21,"2"),o(),a(22,"div",29)(23,"span",30),s(24,"Choisissez deux p\xE9riodes"),o(),a(25,"span",33),s(26,"S\xE9lectionnez un preset ou des dates personnalis\xE9es"),o()()(),a(27,"div",27)(28,"div",28),s(29,"3"),o(),a(30,"div",29)(31,"span",30),s(32,"Lancez la comparaison"),o(),a(33,"span",33),s(34,'Cliquez sur le bouton "Comparer"'),o()()()()()())}var yt=class n{constructor(e,t,i,c,p,d){this.comparisonService=e;this.stravaService=t;this.statsService=i;this.router=c;this.sportConfigService=p;this.periodStateService=d}destroy$=new et;period1=null;period2=null;isLoading=!1;error=null;authError=!1;hasCompared=!1;activities1=[];activities2=[];groupComparisons=[];ngOnInit(){this.sportConfigService.config$.pipe(T(this.destroy$)).subscribe(()=>{this.hasCompared&&this.activities1.length>0&&this.filterAndCalculateComparisons()}),this.periodStateService.comparePeriod1$.pipe(T(this.destroy$)).subscribe(e=>{this.period1=e}),this.periodStateService.comparePeriod2$.pipe(T(this.destroy$)).subscribe(e=>{this.period2=e}),this.periodStateService.compareTriggered$.pipe(T(this.destroy$),nt(e=>e)).subscribe(()=>{this.onCompare()})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}onPeriod1Change(e){this.period1=e}onPeriod2Change(e){this.period2=e}onCompare(){!this.period1||!this.period2||this.checkAuth()&&this.loadComparisonData()}loadComparisonData(){if(this.isLoading=!0,this.error=null,this.authError=!1,this.hasCompared=!1,!this.period1||!this.period2){this.isLoading=!1;return}this.stravaService.loadAllRecentActivities().subscribe({next:e=>{!this.period1||!this.period2||(this.activities1=this.comparisonService.filterActivitiesByPeriod(e,this.period1),this.activities2=this.comparisonService.filterActivitiesByPeriod(e,this.period2),console.log("Period 1:",this.period1.label,"- Activities:",this.activities1.length),console.log("Period 2:",this.period2.label,"- Activities:",this.activities2.length),this.filterAndCalculateComparisons(),this.isLoading=!1,this.hasCompared=!0)},error:e=>{console.error("Error loading activities:",e),this.handleError(e)}})}handleError(e){this.isLoading=!1,e.status===401?this.handleAuthError():(this.error="Une erreur est survenue lors du chargement des donn\xE9es.",this.authError=!1)}filterAndCalculateComparisons(){let e=this.sportConfigService.getEnabledGroups();this.groupComparisons=e.map(i=>{let c=this.sportConfigService.filterActivitiesByGroup(this.activities1,i),p=this.sportConfigService.filterActivitiesByGroup(this.activities2,i),d=this.statsService.calculateStats(c),u=this.statsService.calculateStats(p),v=this.comparisonService.compareStats(d,u);return{group:i,activities1:c,activities2:p,comparison:v}});let t=this.sportConfigService.getConfig();for(let i of t.ungroupedSportsEnabled){let c=dt(i),p=this.activities1.filter(M=>(M.sport_type||M.type)===i),d=this.activities2.filter(M=>(M.sport_type||M.type)===i);if(p.length===0&&d.length===0)continue;let v=this.sportConfigService.getUngroupedSportConfig(i)?.visibleMetrics||mt([i]),b={id:`individual-${i}`,name:c.label,types:[i],icon:c.icon,color:this.getColorForCategory(c.category),isDefault:!1,isEnabled:!0,order:999,visibleMetrics:v},C=this.statsService.calculateStats(p),B=this.statsService.calculateStats(d),Y=this.comparisonService.compareStats(C,B);this.groupComparisons.push({group:b,activities1:p,activities2:d,comparison:Y})}}getColorForCategory(e){return{running:"#ef4444",cycling:"#3b82f6",walking:"#22c55e",fitness:"#8b5cf6",water:"#06b6d4",winter:"#64748b",other:"#f97316"}[e]||"#6b7280"}checkAuth(){let e=localStorage.getItem("strava_token"),t=localStorage.getItem("strava_token_expires_at");return!e||!t||Date.now()/1e3>Number(t)?(this.handleAuthError(),!1):!0}handleAuthError(){this.authError=!0,this.error=null,this.isLoading=!1}reconnectToStrava(){localStorage.clear(),this.stravaService.authenticate()}hasGroupActivities(e){return e.activities1.length>0||e.activities2.length>0}hasAnyActivities(){return this.groupComparisons.some(e=>this.hasGroupActivities(e))}trackByGroupId(e,t){return t.group.id}static \u0275fac=function(t){return new(t||n)(I(gt),I(ft),I(_t),I(lt),I(ut),I(vt))};static \u0275cmp=S({type:n,selectors:[["app-comparison"]],standalone:!0,features:[w],decls:5,vars:4,consts:[[1,"comparison-page"],["class","loading-container",4,"ngIf"],[4,"ngIf"],["class","comparison-results",4,"ngIf"],["class","initial-state",4,"ngIf"],[1,"loading-container"],[1,"loading-message"],["class","error-container",4,"ngIf"],[1,"error-container"],[1,"error-message"],[1,"retry-button",3,"click"],[1,"comparison-results"],[4,"ngFor","ngForOf","ngForTrackBy"],["class","no-activities",4,"ngIf"],[3,"comparison","activityType","groupColor","visibleMetrics"],[3,"activities1","activities2","period1","period2","activityType","groupColor"],[1,"no-activities"],[1,"no-activities-content"],["xmlns","http://www.w3.org/2000/svg","width","64","height","64","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["cx","12","cy","12","r","10"],["x1","12","y1","8","x2","12","y2","12"],["x1","12","y1","16","x2","12.01","y2","16"],[1,"initial-state"],[1,"initial-state-content"],[1,"empty-icon"],[1,"main-instruction"],[1,"steps-container"],[1,"step"],[1,"step-number"],[1,"step-content"],[1,"step-title"],[1,"step-description","mobile-text"],[1,"step-description","desktop-text"],[1,"step-description"]],template:function(t,i){t&1&&(a(0,"div",0),f(1,Rt,4,0,"div",1)(2,Yt,3,2,"ng-container",2)(3,Qt,3,3,"div",3)(4,Ut,35,0,"div",4),o()),t&2&&(r(),l("ngIf",i.isLoading),r(),l("ngIf",!i.isLoading),r(),l("ngIf",i.hasCompared&&!i.isLoading&&!i.error&&!i.authError),r(),l("ngIf",!i.hasCompared&&!i.isLoading))},dependencies:[D,ct,k,R,N,Ct],styles:[".comparison-page[_ngcontent-%COMP%]{max-width:95%;margin:0 auto;padding:24px}.page-header[_ngcontent-%COMP%]{margin-bottom:32px;text-align:center}.page-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:32px;font-weight:700;color:var(--text-primary);margin:0 0 12px}.page-description[_ngcontent-%COMP%]{font-size:16px;color:var(--text-secondary);margin:0}.loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;padding:80px 24px;min-height:400px}.loading-message[_ngcontent-%COMP%]{margin-top:24px;font-size:16px;font-weight:500;color:var(--text-secondary);text-align:center}.error-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;padding:48px 24px;margin:24px 0}.error-message[_ngcontent-%COMP%]{text-align:center;background:var(--card-background);padding:32px;border-radius:12px;box-shadow:0 2px 8px #0000001a;max-width:500px}.error-message[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px;color:var(--text-primary);margin:0 0 24px}.retry-button[_ngcontent-%COMP%]{padding:12px 24px;background:var(--primary-500, #3b82f6);color:#fff;border:none;border-radius:8px;font-size:15px;font-weight:600;cursor:pointer;transition:all .2s ease}.retry-button[_ngcontent-%COMP%]:hover{background:var(--primary-hover);transform:translateY(-1px)}.comparison-results[_ngcontent-%COMP%]{margin-top:32px}.no-activities[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;padding:64px 24px;margin:24px 0}.no-activities-content[_ngcontent-%COMP%]{text-align:center;max-width:500px}.no-activities-content[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{color:var(--text-secondary);opacity:.5;margin-bottom:24px}.no-activities-content[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:24px;font-weight:600;color:var(--text-primary);margin:0 0 12px}.no-activities-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px;color:var(--text-secondary);margin:0}.initial-state[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;padding:80px 24px;margin:24px 0}.initial-state-content[_ngcontent-%COMP%]{text-align:center;max-width:700px}.empty-icon[_ngcontent-%COMP%]{font-size:64px;margin-bottom:24px;animation:_ngcontent-%COMP%_float 3s ease-in-out infinite}@keyframes _ngcontent-%COMP%_float{0%,to{transform:translateY(0)}50%{transform:translateY(-10px)}}.initial-state-content[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:28px;font-weight:600;color:var(--text-primary);margin:0 0 12px}.main-instruction[_ngcontent-%COMP%]{font-size:16px;color:var(--text-secondary);margin:0 0 32px}.steps-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:20px;text-align:left}.step[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:16px;padding:20px;background:var(--card-background);border-radius:12px;border:2px solid var(--border-color);transition:all .2s ease}.step[_ngcontent-%COMP%]:hover{border-color:var(--primary-500, #3b82f6);transform:translate(4px);box-shadow:0 4px 12px #0000001a}.step-number[_ngcontent-%COMP%]{flex-shrink:0;width:32px;height:32px;background:var(--primary-500, #3b82f6);color:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:600;font-size:16px}.step-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px}.step-title[_ngcontent-%COMP%]{font-size:16px;font-weight:600;color:var(--text-primary)}.step-description[_ngcontent-%COMP%]{font-size:14px;color:var(--text-secondary);line-height:1.5}.mobile-text[_ngcontent-%COMP%]{display:none}.desktop-text[_ngcontent-%COMP%]{display:block}@media (max-width: 768px){.comparison-page[_ngcontent-%COMP%]{padding:20px}.page-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:24px}.page-description[_ngcontent-%COMP%]{font-size:14px}.initial-state[_ngcontent-%COMP%]{padding:48px 12px}.initial-state-content[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:22px}.empty-icon[_ngcontent-%COMP%]{font-size:48px}.step[_ngcontent-%COMP%]{padding:16px}.step-number[_ngcontent-%COMP%]{width:28px;height:28px;font-size:14px}.step-title[_ngcontent-%COMP%]{font-size:15px}.step-description[_ngcontent-%COMP%]{font-size:13px}.mobile-text[_ngcontent-%COMP%]{display:block}.desktop-text[_ngcontent-%COMP%]{display:none}.no-activities[_ngcontent-%COMP%]{padding:48px 12px}.no-activities-content[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:48px;height:48px}}"]})};export{yt as ComparisonComponent};
