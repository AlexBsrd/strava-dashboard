import{a as o,b as l,h as p,l as D,u,x as T}from"./chunk-YDMMZ2T4.js";var W={totalElapsedTime:{label:"Temps total",unit:"",isTime:!0},averageSpeed:{label:"Vitesse moyenne",unit:"km/h"},totalDistance:{label:"Distance totale",unit:"km"},averageDistance:{label:"Distance moyenne/sortie",unit:"km"},totalElevation:{label:"D\xE9nivel\xE9 total",unit:"m"},averageElevation:{label:"D\xE9nivel\xE9 moyen/sortie",unit:"m"}},d=["totalElapsedTime","averageSpeed","totalDistance","averageDistance","totalElevation","averageElevation"],K={Run:{type:"Run",label:"Course",icon:"run",category:"running",hasDistance:!0,hasElevation:!0},VirtualRun:{type:"VirtualRun",label:"Course virtuelle",icon:"run",category:"running",hasDistance:!0,hasElevation:!1},TrailRun:{type:"TrailRun",label:"Trail",icon:"trail",category:"running",hasDistance:!0,hasElevation:!0},Ride:{type:"Ride",label:"V\xE9lo",icon:"bike",category:"cycling",hasDistance:!0,hasElevation:!0},MountainBikeRide:{type:"MountainBikeRide",label:"VTT",icon:"mtb",category:"cycling",hasDistance:!0,hasElevation:!0},GravelRide:{type:"GravelRide",label:"Gravel",icon:"bike",category:"cycling",hasDistance:!0,hasElevation:!0},VirtualRide:{type:"VirtualRide",label:"V\xE9lo virtuel",icon:"bike",category:"cycling",hasDistance:!0,hasElevation:!1},EBikeRide:{type:"EBikeRide",label:"V\xE9lo \xE9lectrique",icon:"ebike",category:"cycling",hasDistance:!0,hasElevation:!0},Walk:{type:"Walk",label:"Marche",icon:"walk",category:"walking",hasDistance:!0,hasElevation:!0},Hike:{type:"Hike",label:"Randonn\xE9e",icon:"hike",category:"walking",hasDistance:!0,hasElevation:!0},WeightTraining:{type:"WeightTraining",label:"Musculation",icon:"weight",category:"fitness",hasDistance:!1,hasElevation:!1},Yoga:{type:"Yoga",label:"Yoga",icon:"yoga",category:"fitness",hasDistance:!1,hasElevation:!1},Workout:{type:"Workout",label:"Entra\xEEnement",icon:"workout",category:"fitness",hasDistance:!1,hasElevation:!1},CrossFit:{type:"CrossFit",label:"CrossFit",icon:"crossfit",category:"fitness",hasDistance:!1,hasElevation:!1},Elliptical:{type:"Elliptical",label:"Elliptique",icon:"elliptical",category:"fitness",hasDistance:!1,hasElevation:!1},StairStepper:{type:"StairStepper",label:"Stepper",icon:"stairs",category:"fitness",hasDistance:!1,hasElevation:!1},Swim:{type:"Swim",label:"Natation",icon:"swim",category:"water",hasDistance:!0,hasElevation:!1},Rowing:{type:"Rowing",label:"Aviron",icon:"rowing",category:"water",hasDistance:!0,hasElevation:!1},Kayaking:{type:"Kayaking",label:"Kayak",icon:"kayak",category:"water",hasDistance:!0,hasElevation:!1},Canoeing:{type:"Canoeing",label:"Cano\xEB",icon:"canoe",category:"water",hasDistance:!0,hasElevation:!1},StandUpPaddling:{type:"StandUpPaddling",label:"Paddle",icon:"paddle",category:"water",hasDistance:!0,hasElevation:!1},Surfing:{type:"Surfing",label:"Surf",icon:"surf",category:"water",hasDistance:!1,hasElevation:!1},AlpineSki:{type:"AlpineSki",label:"Ski alpin",icon:"ski",category:"winter",hasDistance:!0,hasElevation:!0},BackcountrySki:{type:"BackcountrySki",label:"Ski de randonn\xE9e",icon:"ski",category:"winter",hasDistance:!0,hasElevation:!0},NordicSki:{type:"NordicSki",label:"Ski de fond",icon:"nordic",category:"winter",hasDistance:!0,hasElevation:!0},Snowboard:{type:"Snowboard",label:"Snowboard",icon:"snowboard",category:"winter",hasDistance:!0,hasElevation:!0},IceSkate:{type:"IceSkate",label:"Patinage",icon:"skate",category:"winter",hasDistance:!0,hasElevation:!1},Skateboard:{type:"Skateboard",label:"Skateboard",icon:"skateboard",category:"other",hasDistance:!0,hasElevation:!1},InlineSkate:{type:"InlineSkate",label:"Roller",icon:"roller",category:"other",hasDistance:!0,hasElevation:!1},RockClimbing:{type:"RockClimbing",label:"Escalade",icon:"climbing",category:"other",hasDistance:!1,hasElevation:!0},Golf:{type:"Golf",label:"Golf",icon:"golf",category:"other",hasDistance:!0,hasElevation:!1},Tennis:{type:"Tennis",label:"Tennis",icon:"tennis",category:"other",hasDistance:!1,hasElevation:!1},Soccer:{type:"Soccer",label:"Football",icon:"soccer",category:"other",hasDistance:!0,hasElevation:!1}},E=[{id:"running",name:"Course",types:["Run","VirtualRun","TrailRun"],icon:"run",color:"#ef4444",isDefault:!0,isEnabled:!0,order:0,visibleMetrics:[...d]},{id:"walking",name:"Marche",types:["Walk","Hike"],icon:"walk",color:"#22c55e",isDefault:!0,isEnabled:!0,order:1,visibleMetrics:[...d]},{id:"cycling",name:"V\xE9lo",types:["Ride","MountainBikeRide","GravelRide","VirtualRide","EBikeRide"],icon:"bike",color:"#3b82f6",isDefault:!0,isEnabled:!0,order:2,visibleMetrics:[...d]}],h={version:3,groups:E,showUngroupedSports:!1,ungroupedSportsEnabled:[],ungroupedSportsConfig:{}},_=["#ef4444","#f97316","#f59e0b","#eab308","#84cc16","#22c55e","#10b981","#14b8a6","#06b6d4","#0ea5e9","#3b82f6","#6366f1","#8b5cf6","#a855f7","#d946ef","#ec4899"];function f(s){return K[s]||{type:s,label:s,icon:"activity",category:"other",hasDistance:!1,hasElevation:!1}}function y(s){let e=["totalElapsedTime"];return s.some(r=>f(r).hasDistance)&&e.push("averageSpeed","totalDistance","averageDistance"),s.some(r=>f(r).hasElevation)&&e.push("totalElevation","averageElevation"),e}function C(){return`custom-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}var w=class s{STORAGE_KEY="sport_config";config=new p(h);availableTypes=new p([]);config$=this.config.asObservable();availableTypes$=this.availableTypes.asObservable();enabledGroups$=this.config$.pipe(D(e=>e.groups.filter(t=>t.isEnabled).sort((t,a)=>t.order-a.order)));allGroups$=this.config$.pipe(D(e=>[...e.groups].sort((t,a)=>t.order-a.order)));constructor(){this.loadConfig()}loadConfig(){try{let e=localStorage.getItem(this.STORAGE_KEY);if(e){let t=JSON.parse(e),a=this.migrateConfig(t);this.config.next(a)}}catch(e){console.warn("Erreur lors du chargement de la configuration des sports:",e),this.config.next(o({},h))}}saveConfig(){try{localStorage.setItem(this.STORAGE_KEY,JSON.stringify(this.config.value))}catch(e){console.error("Erreur lors de la sauvegarde de la configuration des sports:",e)}}migrateConfig(e){let t=o({},e);if(t.version<2&&(t=l(o({},t),{version:2,groups:t.groups.map(a=>l(o({},a),{visibleMetrics:a.visibleMetrics||[...d]}))})),t.version<3){let a={};(t.ungroupedSportsEnabled||[]).forEach(i=>{a[i]={type:i,isEnabled:!0,visibleMetrics:y([i])}}),t=l(o({},t),{version:3,ungroupedSportsConfig:a})}return t}getConfig(){return this.config.value}getEnabledGroups(){return this.config.value.groups.filter(e=>e.isEnabled).sort((e,t)=>e.order-t.order)}getAllGroups(){return[...this.config.value.groups].sort((e,t)=>e.order-t.order)}getGroupById(e){return this.config.value.groups.find(t=>t.id===e)}toggleGroup(e){let t=this.config.value,a=t.groups.findIndex(r=>r.id===e);if(a!==-1){let r=[...t.groups];r[a]=l(o({},r[a]),{isEnabled:!r[a].isEnabled}),this.config.next(l(o({},t),{groups:r})),this.saveConfig()}}reorderGroups(e){let t=this.config.value,a=t.groups.map(r=>{let i=e.indexOf(r.id);return l(o({},r),{order:i!==-1?i:r.order})});this.config.next(l(o({},t),{groups:a})),this.saveConfig()}moveGroup(e,t){let a=this.getAllGroups(),r=a.findIndex(c=>c.id===e);if(r===-1)return;let i=t==="up"?r-1:r+1;if(i<0||i>=a.length)return;let n=a.map(c=>c.id);[n[r],n[i]]=[n[i],n[r]],this.reorderGroups(n)}createGroup(e,t,a,r,i){let n=this.config.value,c={id:C(),name:e,types:t,icon:a,color:r,isDefault:!1,isEnabled:!0,order:n.groups.length,visibleMetrics:i||[...d]};return this.config.next(l(o({},n),{groups:[...n.groups,c]})),this.saveConfig(),c}updateGroup(e,t){let a=this.config.value,r=a.groups.findIndex(n=>n.id===e);if(r===-1)return!1;let i=[...a.groups];return i[r]=o(o({},i[r]),t),this.config.next(l(o({},a),{groups:i})),this.saveConfig(),!0}deleteGroup(e){let t=this.config.value,a=t.groups.find(i=>i.id===e);if(!a||a.isDefault)return!1;let r=t.groups.filter(i=>i.id!==e);return r.forEach((i,n)=>{i.order=n}),this.config.next(l(o({},t),{groups:r})),this.saveConfig(),!0}resetToDefaults(){this.config.next(l(o({},h),{groups:[...E]})),this.saveConfig()}detectAvailableTypes(e){let t=new Set;e.forEach(r=>t.add(r.sport_type||r.type));let a=Array.from(t).sort();return this.availableTypes.next(a),a}getAvailableTypes(){return this.availableTypes.value}filterActivitiesByGroup(e,t){return e.filter(a=>{let r=a.sport_type||a.type;return!!(t.types.includes(r)||!a.sport_type&&t.types.includes(a.type))})}filterActivitiesByEnabledGroups(e){return this.getEnabledGroups().map(a=>({group:a,activities:this.filterActivitiesByGroup(e,a)}))}getUngroupedTypes(e){let t=this.detectAvailableTypes(e),a=new Set;return this.config.value.groups.forEach(r=>{r.types.forEach(i=>{a.add(i)})}),t.filter(r=>!a.has(r))}toggleUngroupedSport(e){let t=this.config.value,a=[...t.ungroupedSportsEnabled],r=o({},t.ungroupedSportsConfig),i=a.indexOf(e);i===-1?(a.push(e),r[e]?r[e]=l(o({},r[e]),{isEnabled:!0}):r[e]={type:e,isEnabled:!0,visibleMetrics:y([e])}):(a.splice(i,1),r[e]&&(r[e]=l(o({},r[e]),{isEnabled:!1}))),this.config.next(l(o({},t),{ungroupedSportsEnabled:a,ungroupedSportsConfig:r})),this.saveConfig()}isUngroupedSportEnabled(e){return this.config.value.ungroupedSportsEnabled.includes(e)}getUngroupedSportConfig(e){return this.config.value.ungroupedSportsConfig[e]}updateUngroupedSportMetrics(e,t){let a=this.config.value,r=o({},a.ungroupedSportsConfig);r[e]?r[e]=l(o({},r[e]),{visibleMetrics:t}):r[e]={type:e,isEnabled:this.isUngroupedSportEnabled(e),visibleMetrics:t},this.config.next(l(o({},a),{ungroupedSportsConfig:r})),this.saveConfig()}toggleUngroupedSportMetric(e,t){let r=this.getUngroupedSportConfig(e)?.visibleMetrics||y([e]),i;r.includes(t)?i=r.filter(n=>n!==t):i=[...r,t],this.updateUngroupedSportMetrics(e,i)}toggleShowUngroupedSports(){let e=this.config.value;this.config.next(l(o({},e),{showUngroupedSports:!e.showUngroupedSports})),this.saveConfig()}getSportMetadata(e){return f(e)}isTypeCoveredByGroups(e){return this.config.value.groups.some(t=>t.types.some(a=>e===a||e.includes(a)))}isTypeInAnyGroup(e){return this.config.value.groups.some(t=>t.types.includes(e))}getGroupContainingType(e){return this.config.value.groups.find(t=>t.types.includes(e))||null}static \u0275fac=function(t){return new(t||s)};static \u0275prov=u({token:s,factory:s.\u0275fac,providedIn:"root"})};var S=class s{calculateDelta(e,t){let a=t-e,r=e===0?t>0?100:0:a/e*100,i;return Math.abs(r)<.5?i="stable":a>0?i="up":i="down",{absolute:Number(a.toFixed(2)),percentage:Number(r.toFixed(1)),trend:i}}compareStats(e,t){return{period1Stats:e,period2Stats:t,deltas:{totalDistance:this.calculateDelta(e.totalDistance,t.totalDistance),averageDistance:this.calculateDelta(e.averageDistance,t.averageDistance),averageSpeed:this.calculateDelta(e.averageSpeed,t.averageSpeed),totalElevation:this.calculateDelta(e.totalElevation,t.totalElevation),averageElevation:this.calculateDelta(e.averageElevation,t.averageElevation),totalElapsedTime:this.calculateDelta(e.totalElapsedTime,t.totalElapsedTime),numberOfActivities:this.calculateDelta(e.numberOfActivities,t.numberOfActivities)}}}getComparisonPresets(){let e=new Date,t=[],a=this.getStartOfWeek(e),r=new Date(e),i=new Date(a);i.setDate(i.getDate()-7);let n=new Date(a);n.setSeconds(n.getSeconds()-1),t.push({label:"Semaine actuelle vs Semaine pr\xE9c\xE9dente",period1:{type:"custom",label:"Semaine pr\xE9c\xE9dente",startDate:i,endDate:n},period2:{type:"custom",label:"Semaine actuelle",startDate:a,endDate:r}});let c=new Date(e.getFullYear(),e.getMonth(),1),M=new Date(e),P=new Date(e.getFullYear(),e.getMonth()-1,1),R=new Date(e.getFullYear(),e.getMonth(),0,23,59,59);t.push({label:"Mois actuel vs Mois pr\xE9c\xE9dent",period1:{type:"custom",label:"Mois pr\xE9c\xE9dent",startDate:P,endDate:R},period2:{type:"custom",label:"Mois actuel",startDate:c,endDate:M}});let b=new Date(e);b.setDate(b.getDate()-30);let G=new Date(e),m=new Date(e);m.setDate(m.getDate()-60);let g=new Date(e);g.setDate(g.getDate()-30),g.setSeconds(g.getSeconds()-1),t.push({label:"30 derniers jours vs 30 jours pr\xE9c\xE9dents",period1:{type:"custom",label:"30 jours pr\xE9c\xE9dents",startDate:m,endDate:g},period2:{type:"custom",label:"30 derniers jours",startDate:b,endDate:G}});let x=new Date(e.getFullYear(),0,1),F=new Date(e),I=new Date(e.getFullYear()-1,0,1),O=new Date(e.getFullYear()-1,e.getMonth(),e.getDate(),23,59,59);t.push({label:"Cette ann\xE9e vs Ann\xE9e pr\xE9c\xE9dente",period1:{type:"custom",label:`Ann\xE9e ${e.getFullYear()-1}`,startDate:I,endDate:O},period2:{type:"custom",label:`Ann\xE9e ${e.getFullYear()}`,startDate:x,endDate:F}});let Y=new Date(e.getFullYear(),e.getMonth(),1),U=new Date(e),$=new Date(e.getFullYear()-1,e.getMonth(),1),B=new Date(e.getFullYear()-1,e.getMonth(),e.getDate(),23,59,59),v=e.toLocaleDateString("fr-FR",{month:"long"});return t.push({label:`${v} ${e.getFullYear()} vs ${v} ${e.getFullYear()-1}`,period1:{type:"custom",label:`${v} ${e.getFullYear()-1}`,startDate:$,endDate:B},period2:{type:"custom",label:`${v} ${e.getFullYear()}`,startDate:Y,endDate:U}}),t}getStartOfWeek(e){let t=new Date(e),a=t.getDay(),r=t.getDate()-a+(a===0?-6:1);return new Date(t.setDate(r))}filterActivitiesByPeriod(e,t){return e.filter(a=>{let r=new Date(a.start_date);return r>=t.startDate&&r<=t.endDate})}formatPeriodLabel(e){let t=e.startDate.toLocaleDateString("fr-FR",{day:"numeric",month:"short",year:"numeric"}),a=e.endDate.toLocaleDateString("fr-FR",{day:"numeric",month:"short",year:"numeric"});return`${t} - ${a}`}static \u0275fac=function(t){return new(t||s)};static \u0275prov=u({token:s,factory:s.\u0275fac,providedIn:"root"})};var A=class s{constructor(e){this.comparisonService=e;this.comparisonPresets=this.comparisonService.getComparisonPresets()}dashboardPeriod=new p("week");dashboardPeriod$=this.dashboardPeriod.asObservable();comparePeriod1=new p(null);comparePeriod2=new p(null);compareTriggered=new p(!1);comparePeriod1$=this.comparePeriod1.asObservable();comparePeriod2$=this.comparePeriod2.asObservable();compareTriggered$=this.compareTriggered.asObservable();comparisonPresets=[];setDashboardPeriod(e){this.dashboardPeriod.next(e)}getDashboardPeriod(){return this.dashboardPeriod.value}setComparePeriod1(e){this.comparePeriod1.next(e)}setComparePeriod2(e){this.comparePeriod2.next(e)}getComparePeriod1(){return this.comparePeriod1.value}getComparePeriod2(){return this.comparePeriod2.value}triggerCompare(){this.comparePeriod1.value&&this.comparePeriod2.value&&(this.compareTriggered.next(!0),setTimeout(()=>this.compareTriggered.next(!1),100))}canCompare(){return!!(this.comparePeriod1.value&&this.comparePeriod2.value)}formatPeriodLabel(e){return e?this.comparisonService.formatPeriodLabel(e):"S\xE9lectionnez une p\xE9riode"}static \u0275fac=function(t){return new(t||s)(T(S))};static \u0275prov=u({token:s,factory:s.\u0275fac,providedIn:"root"})};export{W as a,d as b,_ as c,f as d,y as e,w as f,S as g,A as h};
