import{fb as p,h as n,u as c,x as l}from"./chunk-KXPHHAN7.js";var m=class i{constructor(e){this.translateService=e}calculateDelta(e,t){let a=t-e,r=e===0?t>0?100:0:a/e*100,o;return Math.abs(r)<.5?o="stable":a>0?o="up":o="down",{absolute:Number(a.toFixed(2)),percentage:Number(r.toFixed(1)),trend:o}}compareStats(e,t){return{period1Stats:e,period2Stats:t,deltas:{totalDistance:this.calculateDelta(e.totalDistance,t.totalDistance),averageDistance:this.calculateDelta(e.averageDistance,t.averageDistance),averageSpeed:this.calculateDelta(e.averageSpeed,t.averageSpeed),totalElevation:this.calculateDelta(e.totalElevation,t.totalElevation),averageElevation:this.calculateDelta(e.averageElevation,t.averageElevation),totalElapsedTime:this.calculateDelta(e.totalElapsedTime,t.totalElapsedTime),numberOfActivities:this.calculateDelta(e.numberOfActivities,t.numberOfActivities)}}}getComparisonPresets(){let e=new Date,t=[],a=this.getStartOfWeek(e),r=new Date(e),o=new Date(a);o.setDate(o.getDate()-7);let d=new Date(a);d.setSeconds(d.getSeconds()-1),t.push({label:"Current week vs Previous week",labelKey:"comparison_presets.current_week_vs_previous",period1:{type:"custom",label:"Previous week",labelKey:"comparison_labels.previous_week",startDate:o,endDate:d},period2:{type:"custom",label:"Current week",labelKey:"comparison_labels.current_week",startDate:a,endDate:r}});let b=new Date(e.getFullYear(),e.getMonth(),1),h=new Date(e),P=new Date(e.getFullYear(),e.getMonth()-1,1),g=new Date(e.getFullYear(),e.getMonth(),0,23,59,59);t.push({label:"Current month vs Previous month",labelKey:"comparison_presets.current_month_vs_previous",period1:{type:"custom",label:"Previous month",labelKey:"comparison_labels.previous_month",startDate:P,endDate:g},period2:{type:"custom",label:"Current month",labelKey:"comparison_labels.current_month",startDate:b,endDate:h}});let u=new Date(e);u.setDate(u.getDate()-30);let y=new Date(e),v=new Date(e);v.setDate(v.getDate()-60);let s=new Date(e);s.setDate(s.getDate()-30),s.setSeconds(s.getSeconds()-1),t.push({label:"Last 30 days vs Previous 30 days",labelKey:"comparison_presets.last_30_vs_previous_30",period1:{type:"custom",label:"Previous 30 days",labelKey:"comparison_labels.previous_30_days",startDate:v,endDate:s},period2:{type:"custom",label:"Last 30 days",labelKey:"comparison_labels.last_30_days",startDate:u,endDate:y}});let S=new Date(e.getFullYear(),0,1),f=new Date(e),w=new Date(e.getFullYear()-1,0,1),C=new Date(e.getFullYear()-1,e.getMonth(),e.getDate(),23,59,59);return t.push({label:"This year vs Last year",labelKey:"comparison_presets.current_year_vs_previous",period1:{type:"custom",label:`Year ${e.getFullYear()-1}`,labelKey:"comparison_labels.year",startDate:w,endDate:C},period2:{type:"custom",label:`Year ${e.getFullYear()}`,labelKey:"comparison_labels.year",startDate:S,endDate:f}}),t}getStartOfWeek(e){let t=new Date(e),a=t.getDay(),r=t.getDate()-a+(a===0?-6:1);return new Date(t.setDate(r))}filterActivitiesByPeriod(e,t){return e.filter(a=>{let r=new Date(a.start_date);return r>=t.startDate&&r<=t.endDate})}formatPeriodLabel(e){let t=this.translateService.currentLang==="en"?"en-US":"fr-FR",a=e.startDate.toLocaleDateString(t,{day:"numeric",month:"short",year:"numeric"}),r=e.endDate.toLocaleDateString(t,{day:"numeric",month:"short",year:"numeric"});return`${a} - ${r}`}static \u0275fac=function(t){return new(t||i)(l(p))};static \u0275prov=c({token:i,factory:i.\u0275fac,providedIn:"root"})};var D=class i{constructor(e,t){this.comparisonService=e;this.translateService=t;this.comparisonPresets=this.comparisonService.getComparisonPresets()}dashboardPeriod=new n("week");dashboardPeriod$=this.dashboardPeriod.asObservable();comparePeriod1=new n(null);comparePeriod2=new n(null);compareTriggered=new n(!1);comparePeriod1$=this.comparePeriod1.asObservable();comparePeriod2$=this.comparePeriod2.asObservable();compareTriggered$=this.compareTriggered.asObservable();comparisonPresets=[];setDashboardPeriod(e){this.dashboardPeriod.next(e)}getDashboardPeriod(){return this.dashboardPeriod.value}setComparePeriod1(e){this.comparePeriod1.next(e)}setComparePeriod2(e){this.comparePeriod2.next(e)}getComparePeriod1(){return this.comparePeriod1.value}getComparePeriod2(){return this.comparePeriod2.value}triggerCompare(){this.comparePeriod1.value&&this.comparePeriod2.value&&(this.compareTriggered.next(!0),setTimeout(()=>this.compareTriggered.next(!1),100))}canCompare(){return!!(this.comparePeriod1.value&&this.comparePeriod2.value)}formatPeriodLabel(e){return e?this.comparisonService.formatPeriodLabel(e):this.translateService.instant("sidebar.comparison.selectPeriod")}static \u0275fac=function(t){return new(t||i)(l(m),l(p))};static \u0275prov=c({token:i,factory:i.\u0275fac,providedIn:"root"})};export{m as a,D as b};
