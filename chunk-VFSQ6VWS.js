import{h as s,u as c,x as D}from"./chunk-WWAAJI6Y.js";var d=class n{calculateDelta(e,t){let a=t-e,r=e===0?t>0?100:0:a/e*100,o;return Math.abs(r)<.5?o="stable":a>0?o="up":o="down",{absolute:Number(a.toFixed(2)),percentage:Number(r.toFixed(1)),trend:o}}compareStats(e,t){return{period1Stats:e,period2Stats:t,deltas:{totalDistance:this.calculateDelta(e.totalDistance,t.totalDistance),averageDistance:this.calculateDelta(e.averageDistance,t.averageDistance),averageSpeed:this.calculateDelta(e.averageSpeed,t.averageSpeed),totalElevation:this.calculateDelta(e.totalElevation,t.totalElevation),averageElevation:this.calculateDelta(e.averageElevation,t.averageElevation),totalElapsedTime:this.calculateDelta(e.totalElapsedTime,t.totalElapsedTime),numberOfActivities:this.calculateDelta(e.numberOfActivities,t.numberOfActivities)}}}getComparisonPresets(){let e=new Date,t=[],a=this.getStartOfWeek(e),r=new Date(e),o=new Date(a);o.setDate(o.getDate()-7);let p=new Date(a);p.setSeconds(p.getSeconds()-1),t.push({label:"Semaine actuelle vs Semaine pr\xE9c\xE9dente",period1:{type:"custom",label:"Semaine pr\xE9c\xE9dente",startDate:o,endDate:p},period2:{type:"custom",label:"Semaine actuelle",startDate:a,endDate:r}});let g=new Date(e.getFullYear(),e.getMonth(),1),v=new Date(e),P=new Date(e.getFullYear(),e.getMonth()-1,1),b=new Date(e.getFullYear(),e.getMonth(),0,23,59,59);t.push({label:"Mois actuel vs Mois pr\xE9c\xE9dent",period1:{type:"custom",label:"Mois pr\xE9c\xE9dent",startDate:P,endDate:b},period2:{type:"custom",label:"Mois actuel",startDate:g,endDate:v}});let m=new Date(e);m.setDate(m.getDate()-30);let S=new Date(e),u=new Date(e);u.setDate(u.getDate()-60);let i=new Date(e);i.setDate(i.getDate()-30),i.setSeconds(i.getSeconds()-1),t.push({label:"30 derniers jours vs 30 jours pr\xE9c\xE9dents",period1:{type:"custom",label:"30 jours pr\xE9c\xE9dents",startDate:u,endDate:i},period2:{type:"custom",label:"30 derniers jours",startDate:m,endDate:S}});let f=new Date(e.getFullYear(),0,1),w=new Date(e),C=new Date(e.getFullYear()-1,0,1),y=new Date(e.getFullYear()-1,e.getMonth(),e.getDate(),23,59,59);t.push({label:"Cette ann\xE9e vs Ann\xE9e pr\xE9c\xE9dente",period1:{type:"custom",label:`Ann\xE9e ${e.getFullYear()-1}`,startDate:C,endDate:y},period2:{type:"custom",label:`Ann\xE9e ${e.getFullYear()}`,startDate:f,endDate:w}});let Y=new Date(e.getFullYear(),e.getMonth(),1),F=new Date(e),M=new Date(e.getFullYear()-1,e.getMonth(),1),E=new Date(e.getFullYear()-1,e.getMonth(),e.getDate(),23,59,59),l=e.toLocaleDateString("fr-FR",{month:"long"});return t.push({label:`${l} ${e.getFullYear()} vs ${l} ${e.getFullYear()-1}`,period1:{type:"custom",label:`${l} ${e.getFullYear()-1}`,startDate:M,endDate:E},period2:{type:"custom",label:`${l} ${e.getFullYear()}`,startDate:Y,endDate:F}}),t}getStartOfWeek(e){let t=new Date(e),a=t.getDay(),r=t.getDate()-a+(a===0?-6:1);return new Date(t.setDate(r))}filterActivitiesByPeriod(e,t){return e.filter(a=>{let r=new Date(a.start_date);return r>=t.startDate&&r<=t.endDate})}formatPeriodLabel(e){let t=e.startDate.toLocaleDateString("fr-FR",{day:"numeric",month:"short",year:"numeric"}),a=e.endDate.toLocaleDateString("fr-FR",{day:"numeric",month:"short",year:"numeric"});return`${t} - ${a}`}static \u0275fac=function(t){return new(t||n)};static \u0275prov=c({token:n,factory:n.\u0275fac,providedIn:"root"})};var h=class n{constructor(e){this.comparisonService=e;this.comparisonPresets=this.comparisonService.getComparisonPresets()}dashboardPeriod=new s("week");dashboardPeriod$=this.dashboardPeriod.asObservable();comparePeriod1=new s(null);comparePeriod2=new s(null);compareTriggered=new s(!1);comparePeriod1$=this.comparePeriod1.asObservable();comparePeriod2$=this.comparePeriod2.asObservable();compareTriggered$=this.compareTriggered.asObservable();comparisonPresets=[];setDashboardPeriod(e){this.dashboardPeriod.next(e)}getDashboardPeriod(){return this.dashboardPeriod.value}setComparePeriod1(e){this.comparePeriod1.next(e)}setComparePeriod2(e){this.comparePeriod2.next(e)}getComparePeriod1(){return this.comparePeriod1.value}getComparePeriod2(){return this.comparePeriod2.value}triggerCompare(){this.comparePeriod1.value&&this.comparePeriod2.value&&(this.compareTriggered.next(!0),setTimeout(()=>this.compareTriggered.next(!1),100))}canCompare(){return!!(this.comparePeriod1.value&&this.comparePeriod2.value)}formatPeriodLabel(e){return e?this.comparisonService.formatPeriodLabel(e):"S\xE9lectionnez une p\xE9riode"}static \u0275fac=function(t){return new(t||n)(D(d))};static \u0275prov=c({token:n,factory:n.\u0275fac,providedIn:"root"})};export{d as a,h as b};
