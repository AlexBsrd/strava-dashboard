import{c as W,l as ht,m as xt,n as _t}from"./chunk-XN23GATK.js";import{b as pt,d as dt,e as mt,f as ut}from"./chunk-TDIOE2MP.js";import{a as Ct}from"./chunk-KFEAXAMW.js";import{a as gt,b as vt}from"./chunk-VFSQ6VWS.js";import{$ as g,C as nt,D as P,E as w,Ea as L,F as z,Fa as ct,G as A,Ga as k,N as o,O as T,Oa as D,U as f,W as c,Xa as lt,Y as $,Z as a,_ as r,aa as Z,ba as q,ca as V,da as O,ea as m,eb as ft,fa as at,g as et,ga as ot,ha as rt,ja as l,ka as _,la as F,ma as st,n as it,q as I,ra as E,z as S}from"./chunk-WWAAJI6Y.js";function Mt(i,e){if(i&1&&(a(0,"span",10),l(1),r()),i&2){let t=m();o(),_(t.unit)}}function St(i,e){if(i&1&&(a(0,"span",10),l(1),r()),i&2){let t=m();o(),_(t.unit)}}function Pt(i,e){if(i&1&&(a(0,"div",11)(1,"div",12),l(2),a(3,"span",13),l(4),r()(),a(5,"div",14),l(6),r()()),i&2){let t=m();c("ngClass",t.trendClass),o(2),F(" ",t.formattedDelta," "),o(2),_(t.trendIcon),o(2),_(t.formattedPercentage)}}function wt(i,e){i&1&&(a(0,"div",15)(1,"span"),l(2,"\u2014"),r()())}var R=class i{title="";value1=0;value2=0;unit="";isTime=!1;delta=null;get formattedValue1(){return this.isTime?this.formatTime(this.value1):this.value1.toFixed(1)}get formattedValue2(){return this.isTime?this.formatTime(this.value2):this.value2.toFixed(1)}get formattedDelta(){if(!this.delta)return"";if(this.isTime){let t=Math.floor(Math.abs(this.delta.absolute)/3600),n=Math.floor(Math.abs(this.delta.absolute)%3600/60),s=this.delta.absolute>=0?"+":"-";return t>0?`${s}${t}h${n}min`:`${s}${n}min`}return`${this.delta.absolute>=0?"+":""}${this.delta.absolute} ${this.unit}`}get formattedPercentage(){return this.delta?`${this.delta.percentage>=0?"+":""}${this.delta.percentage}%`:""}get trendIcon(){if(!this.delta)return"";switch(this.delta.trend){case"up":return"\u2191";case"down":return"\u2193";case"stable":return"\u2192";default:return""}}get trendClass(){return this.delta?this.delta.trend:""}formatTime(e){let t=Math.floor(e/3600),n=Math.floor(e%3600/60);return t>0?`${t}h${n}min`:`${n}min`}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=S({type:i,selectors:[["app-comparison-stats-card"]],inputs:{title:"title",value1:"value1",value2:"value2",unit:"unit",isTime:"isTime",delta:"delta"},standalone:!0,features:[E],decls:16,vars:7,consts:[[1,"comparison-card"],[1,"card-title"],[1,"values-container"],[1,"value","period1"],[1,"value-number"],["class","value-unit",4,"ngIf"],[1,"arrow"],[1,"value","period2"],["class","delta-container",3,"ngClass",4,"ngIf"],["class","no-delta",4,"ngIf"],[1,"value-unit"],[1,"delta-container",3,"ngClass"],[1,"delta-value"],[1,"trend-icon"],[1,"delta-percentage"],[1,"no-delta"]],template:function(t,n){t&1&&(a(0,"div",0)(1,"div",1),l(2),r(),a(3,"div",2)(4,"div",3)(5,"span",4),l(6),r(),f(7,Mt,2,1,"span",5),r(),a(8,"div",6),l(9,"\u2192"),r(),a(10,"div",7)(11,"span",4),l(12),r(),f(13,St,2,1,"span",5),r()(),f(14,Pt,7,4,"div",8)(15,wt,3,0,"div",9),r()),t&2&&(o(2),_(n.title),o(4),_(n.formattedValue1),o(),c("ngIf",!n.isTime),o(5),_(n.formattedValue2),o(),c("ngIf",!n.isTime),o(),c("ngIf",n.delta),o(),c("ngIf",!n.delta))},dependencies:[D,L,k],styles:[".comparison-card[_ngcontent-%COMP%]{background:var(--card-background);border-radius:12px;padding:24px;box-shadow:0 2px 8px #0000001a;transition:all .3s ease;min-height:180px;display:flex;flex-direction:column;justify-content:space-between}.comparison-card[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 4px 16px #00000026}.card-title[_ngcontent-%COMP%]{font-size:14px;font-weight:500;color:var(--text-secondary);margin-bottom:16px;text-transform:uppercase;letter-spacing:.5px}.values-container[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;gap:12px}.value[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;flex:1}.value-number[_ngcontent-%COMP%]{font-size:32px;font-weight:700;color:var(--text-primary);line-height:1.1}.value-unit[_ngcontent-%COMP%]{font-size:14px;color:var(--text-secondary);margin-top:4px}.period1[_ngcontent-%COMP%]   .value-number[_ngcontent-%COMP%]{color:var(--text-secondary)}.period2[_ngcontent-%COMP%]   .value-number[_ngcontent-%COMP%]{color:var(--primary-color)}.arrow[_ngcontent-%COMP%]{font-size:24px;color:var(--text-secondary);opacity:.5}.delta-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:4px;padding:12px;background:var(--background);border-radius:8px;border:2px solid var(--border-color)}.delta-container.up[_ngcontent-%COMP%]{border-color:var(--success-color, #22c55e);background:var(--success-background, rgba(34, 197, 94, .1))}.delta-container.down[_ngcontent-%COMP%]{border-color:var(--danger-color, #ef4444);background:var(--danger-background, rgba(239, 68, 68, .1))}.delta-container.stable[_ngcontent-%COMP%]{border-color:var(--text-secondary);background:var(--background)}.delta-value[_ngcontent-%COMP%]{font-size:18px;font-weight:600;display:flex;align-items:center;gap:6px}.delta-container.up[_ngcontent-%COMP%]   .delta-value[_ngcontent-%COMP%]{color:var(--success-color, #22c55e)}.delta-container.down[_ngcontent-%COMP%]   .delta-value[_ngcontent-%COMP%]{color:var(--danger-color, #ef4444)}.delta-container.stable[_ngcontent-%COMP%]   .delta-value[_ngcontent-%COMP%]{color:var(--text-secondary)}.trend-icon[_ngcontent-%COMP%]{font-size:20px;font-weight:700}.delta-percentage[_ngcontent-%COMP%]{font-size:14px;font-weight:500;opacity:.9}.delta-container.up[_ngcontent-%COMP%]   .delta-percentage[_ngcontent-%COMP%]{color:var(--success-color, #22c55e)}.delta-container.down[_ngcontent-%COMP%]   .delta-percentage[_ngcontent-%COMP%]{color:var(--danger-color, #ef4444)}.delta-container.stable[_ngcontent-%COMP%]   .delta-percentage[_ngcontent-%COMP%]{color:var(--text-secondary)}.no-delta[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;padding:12px;color:var(--text-secondary);font-size:24px;opacity:.3}@media (max-width: 640px){.comparison-card[_ngcontent-%COMP%]{padding:1rem;min-height:auto}.values-container[_ngcontent-%COMP%]{flex-direction:column;gap:8px;align-items:stretch}.value[_ngcontent-%COMP%]{align-items:flex-start}.arrow[_ngcontent-%COMP%]{display:none}.value-number[_ngcontent-%COMP%]{font-size:1.5rem}.value-unit[_ngcontent-%COMP%]{font-size:.75rem}.card-title[_ngcontent-%COMP%]{font-size:.75rem;margin-bottom:.75rem}.delta-container[_ngcontent-%COMP%]{padding:.5rem}.delta-value[_ngcontent-%COMP%]{font-size:.875rem}.delta-percentage[_ngcontent-%COMP%]{font-size:.75rem}}"]})};function Ot(i,e){if(i&1&&g(0,"app-comparison-stats-card",15),i&2){let t=m(2);c("value1",t.comparison.period1Stats.totalDistance)("value2",t.comparison.period2Stats.totalDistance)("delta",t.comparison.deltas.totalDistance)}}function Et(i,e){if(i&1&&g(0,"app-comparison-stats-card",16),i&2){let t=m(2);c("value1",t.comparison.period1Stats.averageDistance)("value2",t.comparison.period2Stats.averageDistance)("delta",t.comparison.deltas.averageDistance)}}function kt(i,e){if(i&1&&g(0,"app-comparison-stats-card",17),i&2){let t=m(2);c("value1",t.comparison.period1Stats.averageSpeed)("value2",t.comparison.period2Stats.averageSpeed)("delta",t.comparison.deltas.averageSpeed)}}function Dt(i,e){if(i&1&&g(0,"app-comparison-stats-card",18),i&2){let t=m(2);c("value1",t.comparison.period1Stats.totalElevation)("value2",t.comparison.period2Stats.totalElevation)("delta",t.comparison.deltas.totalElevation)}}function Tt(i,e){if(i&1&&g(0,"app-comparison-stats-card",19),i&2){let t=m(2);c("value1",t.comparison.period1Stats.averageElevation)("value2",t.comparison.period2Stats.averageElevation)("delta",t.comparison.deltas.averageElevation)}}function It(i,e){if(i&1&&g(0,"app-comparison-stats-card",20),i&2){let t=m(2);c("value1",t.comparison.period1Stats.totalElapsedTime)("value2",t.comparison.period2Stats.totalElapsedTime)("delta",t.comparison.deltas.totalElapsedTime)("isTime",!0)}}function zt(i,e){if(i&1&&(a(0,"div",2)(1,"div",3)(2,"div",4),g(3,"i",5),r(),a(4,"h2",6),l(5),r(),a(6,"span",7),l(7),r()(),a(8,"div",8),f(9,Ot,1,3,"app-comparison-stats-card",9)(10,Et,1,3,"app-comparison-stats-card",10)(11,kt,1,3,"app-comparison-stats-card",11)(12,Dt,1,3,"app-comparison-stats-card",12)(13,Tt,1,3,"app-comparison-stats-card",13)(14,It,1,4,"app-comparison-stats-card",14),r()()),i&2){let t=m();o(2),c("ngClass",t.activityIcon),o(3),_(t.activityType),o(2),st(" ",t.comparison.period1Stats.numberOfActivities," activit\xE9(s) \u2192 ",t.comparison.period2Stats.numberOfActivities," activit\xE9(s) "),o(2),c("ngIf",t.isMetricVisible("totalDistance")),o(),c("ngIf",t.isMetricVisible("averageDistance")),o(),c("ngIf",t.isMetricVisible("averageSpeed")),o(),c("ngIf",t.isMetricVisible("totalElevation")),o(),c("ngIf",t.isMetricVisible("averageElevation")),o(),c("ngIf",t.isMetricVisible("totalElapsedTime"))}}function At(i,e){i&1&&(a(0,"div",21)(1,"p"),l(2,"Aucune donn\xE9e disponible pour cette comparaison."),r()())}var j=class i{comparison=null;activityType="";groupColor;visibleMetrics;isMetricVisible(e){return(this.visibleMetrics||pt).includes(e)}get activityIcon(){switch(this.activityType.toLowerCase()){case"run":case"course":return"run";case"walk":case"marche":return"walk";case"bike":case"v\xE9lo":return"bike";default:return"activity"}}get displayColor(){if(this.groupColor)return this.groupColor;switch(this.activityType.toLowerCase()){case"run":case"course":return"#ef4444";case"walk":case"marche":return"#22c55e";case"bike":case"v\xE9lo":return"#3b82f6";default:return"#6366f1"}}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=S({type:i,selectors:[["app-comparison-stats-grid"]],inputs:{comparison:"comparison",activityType:"activityType",groupColor:"groupColor",visibleMetrics:"visibleMetrics"},standalone:!0,features:[E],decls:2,vars:2,consts:[["class","stats-grid-container",4,"ngIf"],["class","no-data",4,"ngIf"],[1,"stats-grid-container"],[1,"activity-header"],[1,"activity-icon",3,"ngClass"],[1,"icon"],[1,"activity-title"],[1,"activity-count"],[1,"comparison-grid"],["title","Distance totale","unit","km",3,"value1","value2","delta",4,"ngIf"],["title","Distance moyenne/sortie","unit","km",3,"value1","value2","delta",4,"ngIf"],["title","Vitesse moyenne","unit","km/h",3,"value1","value2","delta",4,"ngIf"],["title","D\xE9nivel\xE9 total","unit","m",3,"value1","value2","delta",4,"ngIf"],["title","D\xE9nivel\xE9 moyen/sortie","unit","m",3,"value1","value2","delta",4,"ngIf"],["title","Temps total",3,"value1","value2","delta","isTime",4,"ngIf"],["title","Distance totale","unit","km",3,"value1","value2","delta"],["title","Distance moyenne/sortie","unit","km",3,"value1","value2","delta"],["title","Vitesse moyenne","unit","km/h",3,"value1","value2","delta"],["title","D\xE9nivel\xE9 total","unit","m",3,"value1","value2","delta"],["title","D\xE9nivel\xE9 moyen/sortie","unit","m",3,"value1","value2","delta"],["title","Temps total",3,"value1","value2","delta","isTime"],[1,"no-data"]],template:function(t,n){t&1&&f(0,zt,15,10,"div",0)(1,At,3,0,"div",1),t&2&&(c("ngIf",n.comparison),o(),c("ngIf",!n.comparison))},dependencies:[D,L,k,R],styles:[`.stats-grid-container[_ngcontent-%COMP%]{background:var(--card-background);border-radius:12px;padding:24px;margin-bottom:24px;box-shadow:0 2px 8px #0000001a}.activity-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px;margin-bottom:24px;padding-bottom:16px;border-bottom:2px solid var(--border-color)}.activity-icon[_ngcontent-%COMP%]{width:48px;height:48px;border-radius:50%;display:flex;align-items:center;justify-content:center;flex-shrink:0}.activity-icon.run[_ngcontent-%COMP%]{background:linear-gradient(135deg,#fc4c02,#ff6b35)}.activity-icon.walk[_ngcontent-%COMP%]{background:linear-gradient(135deg,#10b981,#34d399)}.activity-icon.bike[_ngcontent-%COMP%]{background:linear-gradient(135deg,#3b82f6,#60a5fa)}.activity-icon[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{width:24px;height:24px;background:#fff;mask-size:contain;mask-repeat:no-repeat;mask-position:center}.activity-icon.run[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{mask-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor'%3E%3Cpath d='M13 2L3 14h9l-1 8 10-12h-9l1-8z'/%3E%3C/svg%3E")}.activity-icon.walk[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{mask-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor'%3E%3Ccircle cx='12' cy='4' r='2'/%3E%3Cpath d='M10 8v6M14 8v6M10 14l-2 6M14 14l2 6'/%3E%3C/svg%3E")}.activity-icon.bike[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{mask-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor'%3E%3Ccircle cx='18' cy='18' r='3'/%3E%3Ccircle cx='6' cy='18' r='3'/%3E%3Cpath d='M12 6l-2 4h6l-2-4M8 14l4-4 4 4'/%3E%3C/svg%3E")}.activity-title[_ngcontent-%COMP%]{font-size:24px;font-weight:600;color:var(--text-primary);margin:0}.activity-count[_ngcontent-%COMP%]{font-size:14px;color:var(--text-secondary);margin-left:auto}.comparison-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(320px,1fr));gap:20px}.no-data[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;padding:48px;background:var(--card-background);border-radius:12px;margin-bottom:24px}.no-data[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--text-secondary);font-size:16px}@media (max-width: 768px){.stats-grid-container[_ngcontent-%COMP%]{padding:1rem}.comparison-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr);gap:12px}.activity-header[_ngcontent-%COMP%]{flex-wrap:wrap;margin-bottom:16px;padding-bottom:12px}.activity-count[_ngcontent-%COMP%]{margin-left:0;width:100%;text-align:left}}`]})};var Vt=["chartCanvas"];function Gt(i,e){i&1&&(a(0,"span"),l(1,"\u{1F4A1} Astuce : Maintenez Ctrl + Molette pour zoomer, cliquez-glissez pour naviguer"),r())}function $t(i,e){i&1&&(a(0,"span"),l(1,"\u{1F4A1} Astuce : Pincez pour zoomer, glissez pour naviguer"),r())}function Ft(i,e){i&1&&(a(0,"span",19),l(1,"\u2022 Distance cumul\xE9e affich\xE9e"),r())}function Lt(i,e){i&1&&(a(0,"span",19),l(1,"\u2022 Vitesse moyenne pond\xE9r\xE9e par distance"),r())}function Rt(i,e){i&1&&(a(0,"span",19),l(1,"\u2022 D\xE9nivel\xE9 cumul\xE9 affich\xE9"),r())}W.register(...ht,xt);var N=class i{chartCanvas;activities1=[];activities2=[];period1=null;period2=null;activityType="Run";groupColor;selectedMetric="distance";chart=null;isMobile=this.detectMobileDevice();ngOnChanges(e){(e.activities1||e.activities2)&&this.activities1.length&&this.activities2.length&&setTimeout(()=>this.createChart(),0)}selectMetric(e){this.selectedMetric=e,this.createChart()}createChart(){if(this.chart&&this.chart.destroy(),!this.chartCanvas?.nativeElement)return;let e=this.chartCanvas.nativeElement.getContext("2d");if(!e)return;let t=this.prepareAlignedChartData(this.activities1,this.activities2,this.period1,this.period2),n={type:"line",data:{labels:t.labels,datasets:[{label:this.period1?.label||"P\xE9riode 1",data:t.data1,borderColor:"rgba(156, 163, 175, 0.8)",backgroundColor:"rgba(156, 163, 175, 0.1)",borderWidth:2,tension:.4,pointRadius:3,pointHoverRadius:5,fill:!0,spanGaps:!0},{label:this.period2?.label||"P\xE9riode 2",data:t.data2,borderColor:"rgba(252, 76, 2, 0.8)",backgroundColor:"rgba(252, 76, 2, 0.1)",borderWidth:2,tension:.4,pointRadius:3,pointHoverRadius:5,fill:!0,spanGaps:!0}]},options:{responsive:!0,maintainAspectRatio:!1,interaction:{mode:"index",intersect:!1},plugins:{legend:{display:!0,position:"top",labels:{color:getComputedStyle(document.documentElement).getPropertyValue("--text-primary").trim(),font:{size:12,weight:500},padding:16,usePointStyle:!0,pointStyle:"circle"}},tooltip:{backgroundColor:"rgba(0, 0, 0, 0.8)",padding:12,titleFont:{size:14,weight:"bold"},bodyFont:{size:13},cornerRadius:8,displayColors:!0,callbacks:{title:s=>s[0].label,label:s=>{let p=s.dataset.label||"";p&&(p+=": ");let d=s.parsed.y;return d===null?p+="Pas de donn\xE9es":p+=this.formatValue(d),p},afterLabel:s=>{let p=s.dataIndex,u=s.datasetIndex===0?this.activities1:this.activities2;return u[p]?`Date: ${new Date(u[p].start_date).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"})}`:""}}},zoom:{zoom:{wheel:{enabled:!0,modifierKey:"ctrl"},pinch:{enabled:!0},mode:"x"},pan:{enabled:!0,mode:"x"}}},scales:{x:{grid:{color:"rgba(156, 163, 175, 0.1)"},ticks:{color:getComputedStyle(document.documentElement).getPropertyValue("--text-secondary").trim(),font:{size:11},maxRotation:45,minRotation:45,autoSkip:!0,autoSkipPadding:15,maxTicksLimit:20}},y:{beginAtZero:!0,grid:{color:"rgba(156, 163, 175, 0.1)"},ticks:{color:getComputedStyle(document.documentElement).getPropertyValue("--text-secondary").trim(),font:{size:11},callback:s=>this.formatValue(Number(s))}}}}};this.chart=new W(e,n)}prepareAlignedChartData(e,t,n,s){if(!n||!s)return{labels:[],data1:[],data2:[]};let p=[...e].sort((x,h)=>new Date(x.start_date).getTime()-new Date(h.start_date).getTime()),d=[...t].sort((x,h)=>new Date(x.start_date).getTime()-new Date(h.start_date).getTime()),u=this.calculateCumulativeValues(p),v=this.calculateCumulativeValues(d),b=new Map,C=new Map;p.forEach((x,h)=>{let y=new Date(x.start_date),G=this.getDayOfYear(y);b.set(G,{date:y,value:u[h]})}),d.forEach((x,h)=>{let y=new Date(x.start_date),G=this.getDayOfYear(y);C.set(G,{date:y,value:v[h]})});let B=new Set([...b.keys(),...C.keys()]),Y=Array.from(B).sort((x,h)=>x-h),M=[],H=[],K=[],Q=0,U=0;return Y.forEach(x=>{let h=b.get(x),y=C.get(x),bt=(h?.date||y?.date||new Date).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit"});M.push(bt),h&&(Q=h.value),H.push(Q),y&&(U=y.value),K.push(U)}),{labels:M,data1:H,data2:K}}getDayOfYear(e){let t=new Date(e.getFullYear(),0,0),n=e.getTime()-t.getTime(),s=1e3*60*60*24;return Math.floor(n/s)}calculateCumulativeValues(e){let t=[],n=0;return e.forEach(s=>{switch(this.selectedMetric){case"distance":n+=s.distance;break;case"speed":let p=e.slice(0,e.indexOf(s)+1).reduce((u,v)=>u+v.distance,0),d=e.slice(0,e.indexOf(s)+1).reduce((u,v)=>u+v.average_speed*v.distance,0);n=p>0?d/p:0;break;case"elevation":n+=s.total_elevation_gain;break}t.push(n)}),t}prepareChartData(e,t){let n=[...e].sort((d,u)=>new Date(d.start_date).getTime()-new Date(u.start_date).getTime());if(!t)return{labels:[],values:[]};let s=n.map(d=>new Date(d.start_date).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit"})),p=[];switch(this.selectedMetric){case"distance":let d=0;p=n.map(C=>(d+=C.distance,d));break;case"speed":let u=0,v=0;p=n.map(C=>(u+=C.distance,v+=C.average_speed*C.distance,u>0?v/u:0));break;case"elevation":let b=0;p=n.map(C=>(b+=C.total_elevation_gain,b));break;default:p=n.map(()=>0)}return{labels:s,values:p}}formatValue(e){switch(this.selectedMetric){case"distance":return`${e.toFixed(1)} km`;case"speed":return`${e.toFixed(1)} km/h`;case"elevation":return`${e.toFixed(0)} m`;default:return e.toString()}}resetZoom(){this.chart&&this.chart.resetZoom()}detectMobileDevice(){let e=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),t=window.innerWidth<=768;return e||t}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=S({type:i,selectors:[["app-comparison-chart"]],viewQuery:function(t,n){if(t&1&&at(Vt,5),t&2){let s;ot(s=rt())&&(n.chartCanvas=s.first)}},inputs:{activities1:"activities1",activities2:"activities2",period1:"period1",period2:"period2",activityType:"activityType",groupColor:"groupColor"},standalone:!0,features:[nt,E],decls:27,vars:12,consts:[["chartCanvas",""],[1,"chart-container"],[1,"chart-header"],[1,"chart-title"],[1,"chart-controls"],[1,"metric-selector"],["title","Distance cumul\xE9e",1,"metric-button",3,"click"],["title","Vitesse moyenne pond\xE9r\xE9e",1,"metric-button",3,"click"],["title","D\xE9nivel\xE9 cumul\xE9",1,"metric-button",3,"click"],["title","R\xE9initialiser le zoom",1,"reset-zoom-button",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","18","height","18","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["d","M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"],["d","M21 3v5h-5"],["d","M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"],["d","M3 21v-5h5"],[1,"chart-canvas-wrapper"],[1,"chart-hint"],[4,"ngIf"],["class","metric-info",4,"ngIf"],[1,"metric-info"]],template:function(t,n){if(t&1){let s=V();a(0,"div",1)(1,"div",2)(2,"h3",3),l(3),r(),a(4,"div",4)(5,"div",5)(6,"button",6),O("click",function(){return P(s),w(n.selectMetric("distance"))}),l(7," Distance "),r(),a(8,"button",7),O("click",function(){return P(s),w(n.selectMetric("speed"))}),l(9," Vitesse "),r(),a(10,"button",8),O("click",function(){return P(s),w(n.selectMetric("elevation"))}),l(11," D\xE9nivel\xE9 "),r()(),a(12,"button",9),O("click",function(){return P(s),w(n.resetZoom())}),z(),a(13,"svg",10),g(14,"path",11)(15,"path",12)(16,"path",13)(17,"path",14),r()()()(),A(),a(18,"div",15),g(19,"canvas",null,0),r(),a(21,"div",16),f(22,Gt,2,0,"span",17)(23,$t,2,0,"span",17)(24,Ft,2,0,"span",18)(25,Lt,2,0,"span",18)(26,Rt,2,0,"span",18),r()()}t&2&&(o(3),F("\xC9volution comparative - ",n.activityType,""),o(3),$("active",n.selectedMetric==="distance"),o(2),$("active",n.selectedMetric==="speed"),o(2),$("active",n.selectedMetric==="elevation"),o(12),c("ngIf",!n.isMobile),o(),c("ngIf",n.isMobile),o(),c("ngIf",n.selectedMetric==="distance"),o(),c("ngIf",n.selectedMetric==="speed"),o(),c("ngIf",n.selectedMetric==="elevation"))},dependencies:[D,k],styles:[".chart-container[_ngcontent-%COMP%]{background:var(--card-background);border-radius:12px;padding:24px;margin-bottom:24px;box-shadow:0 2px 8px #0000001a}.chart-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px;flex-wrap:wrap;gap:16px}.chart-title[_ngcontent-%COMP%]{font-size:20px;font-weight:600;color:var(--text-primary);margin:0}.chart-controls[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.metric-selector[_ngcontent-%COMP%]{display:flex;gap:8px;background:var(--background);padding:4px;border-radius:8px}.metric-button[_ngcontent-%COMP%]{padding:8px 16px;background:transparent;border:none;border-radius:6px;font-size:14px;font-weight:500;color:var(--text-secondary);cursor:pointer;transition:all .2s ease}.metric-button[_ngcontent-%COMP%]:hover{background:var(--hover-background);color:var(--text-primary)}.metric-button.active[_ngcontent-%COMP%]{background:#fc4c02;color:#fff}.reset-zoom-button[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:36px;height:36px;background:var(--background);border:1px solid var(--border-color);border-radius:8px;color:var(--text-secondary);cursor:pointer;transition:all .2s ease}.reset-zoom-button[_ngcontent-%COMP%]:hover{background:var(--hover-background);color:var(--primary-color);border-color:var(--primary-color)}.chart-canvas-wrapper[_ngcontent-%COMP%]{position:relative;height:400px;margin-bottom:16px}canvas[_ngcontent-%COMP%]{max-width:100%;height:100%}.chart-hint[_ngcontent-%COMP%]{font-size:12px;color:var(--text-secondary);text-align:center;padding:8px;background:var(--background);border-radius:6px;opacity:.8;display:flex;flex-wrap:wrap;justify-content:center;gap:12px}.metric-info[_ngcontent-%COMP%]{font-weight:500;color:var(--primary-color)}@media (max-width: 768px){.chart-header[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}.chart-controls[_ngcontent-%COMP%]{width:100%;justify-content:space-between}.metric-selector[_ngcontent-%COMP%]{flex:1}.metric-button[_ngcontent-%COMP%]{flex:1;padding:8px 12px;font-size:13px}.chart-canvas-wrapper[_ngcontent-%COMP%]{height:300px}}"]})};function jt(i,e){i&1&&(a(0,"div",5),g(1,"app-spinner"),a(2,"div",6),l(3,"Comparaison en cours..."),r()())}function Nt(i,e){if(i&1){let t=V();a(0,"div",8)(1,"div",9)(2,"p"),l(3,"Votre session a expir\xE9 ou n'est plus valide."),r(),a(4,"button",10),O("click",function(){P(t);let s=m(2);return w(s.reconnectToStrava())}),l(5," Se reconnecter \xE0 Strava "),r()()()}}function Bt(i,e){if(i&1){let t=V();a(0,"div",8)(1,"div",9)(2,"p"),l(3),r(),a(4,"button",10),O("click",function(){P(t);let s=m(2);return w(s.onCompare())}),l(5," R\xE9essayer "),r()()()}if(i&2){let t=m(2);o(3),_(t.error)}}function Yt(i,e){if(i&1&&(Z(0),f(1,Nt,6,0,"div",7)(2,Bt,6,1,"div",7),q()),i&2){let t=m();o(),c("ngIf",t.authError),o(),c("ngIf",t.error&&!t.authError)}}function Ht(i,e){if(i&1&&(a(0,"div"),g(1,"app-comparison-stats-grid",14)(2,"app-comparison-chart",15),r()),i&2){let t=m().$implicit,n=m(2);o(),c("comparison",t.comparison)("activityType",t.group.name)("groupColor",t.group.color)("visibleMetrics",t.group.visibleMetrics),o(),c("activities1",t.activities1)("activities2",t.activities2)("period1",n.period1)("period2",n.period2)("activityType",t.group.name)("groupColor",t.group.color)}}function Kt(i,e){if(i&1&&(Z(0),f(1,Ht,3,10,"div",2),q()),i&2){let t=e.$implicit,n=m(2);o(),c("ngIf",n.hasGroupActivities(t))}}function Qt(i,e){i&1&&(a(0,"div",16)(1,"div",17),z(),a(2,"svg",18),g(3,"circle",19)(4,"line",20)(5,"line",21),r(),A(),a(6,"h3"),l(7,"Aucune activit\xE9 trouv\xE9e"),r(),a(8,"p"),l(9,"Il n'y a pas d'activit\xE9s pour les p\xE9riodes s\xE9lectionn\xE9es."),r()()())}function Ut(i,e){if(i&1&&(a(0,"div",11),f(1,Kt,2,1,"ng-container",12)(2,Qt,10,0,"div",13),r()),i&2){let t=m();o(),c("ngForOf",t.groupComparisons)("ngForTrackBy",t.trackByGroupId),o(),c("ngIf",!t.hasAnyActivities())}}function Zt(i,e){i&1&&(a(0,"div",22)(1,"div",23),z(),a(2,"svg",24),g(3,"path",25),r(),A(),a(4,"h3"),l(5,"Pr\xEAt \xE0 comparer vos performances ?"),r(),a(6,"p"),l(7,'S\xE9lectionnez deux p\xE9riodes dans le menu et cliquez sur "Comparer" pour voir vos progr\xE8s.'),r()()())}var yt=class i{constructor(e,t,n,s,p,d){this.comparisonService=e;this.stravaService=t;this.statsService=n;this.router=s;this.sportConfigService=p;this.periodStateService=d}destroy$=new et;period1=null;period2=null;isLoading=!1;error=null;authError=!1;hasCompared=!1;activities1=[];activities2=[];groupComparisons=[];ngOnInit(){this.sportConfigService.config$.pipe(I(this.destroy$)).subscribe(()=>{this.hasCompared&&this.activities1.length>0&&this.filterAndCalculateComparisons()}),this.periodStateService.comparePeriod1$.pipe(I(this.destroy$)).subscribe(e=>{this.period1=e}),this.periodStateService.comparePeriod2$.pipe(I(this.destroy$)).subscribe(e=>{this.period2=e}),this.periodStateService.compareTriggered$.pipe(I(this.destroy$),it(e=>e)).subscribe(()=>{this.onCompare()})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}onPeriod1Change(e){this.period1=e}onPeriod2Change(e){this.period2=e}onCompare(){!this.period1||!this.period2||this.checkAuth()&&this.loadComparisonData()}loadComparisonData(){if(this.isLoading=!0,this.error=null,this.authError=!1,this.hasCompared=!1,!this.period1||!this.period2){this.isLoading=!1;return}this.stravaService.loadAllRecentActivities().subscribe({next:e=>{!this.period1||!this.period2||(this.activities1=this.comparisonService.filterActivitiesByPeriod(e,this.period1),this.activities2=this.comparisonService.filterActivitiesByPeriod(e,this.period2),console.log("Period 1:",this.period1.label,"- Activities:",this.activities1.length),console.log("Period 2:",this.period2.label,"- Activities:",this.activities2.length),this.filterAndCalculateComparisons(),this.isLoading=!1,this.hasCompared=!0)},error:e=>{console.error("Error loading activities:",e),this.handleError(e)}})}handleError(e){this.isLoading=!1,e.status===401?this.handleAuthError():(this.error="Une erreur est survenue lors du chargement des donn\xE9es.",this.authError=!1)}filterAndCalculateComparisons(){let e=this.sportConfigService.getEnabledGroups();this.groupComparisons=e.map(n=>{let s=this.sportConfigService.filterActivitiesByGroup(this.activities1,n),p=this.sportConfigService.filterActivitiesByGroup(this.activities2,n),d=this.statsService.calculateStats(s),u=this.statsService.calculateStats(p),v=this.comparisonService.compareStats(d,u);return{group:n,activities1:s,activities2:p,comparison:v}});let t=this.sportConfigService.getConfig();for(let n of t.ungroupedSportsEnabled){let s=dt(n),p=this.activities1.filter(M=>(M.sport_type||M.type)===n),d=this.activities2.filter(M=>(M.sport_type||M.type)===n);if(p.length===0&&d.length===0)continue;let v=this.sportConfigService.getUngroupedSportConfig(n)?.visibleMetrics||mt([n]),b={id:`individual-${n}`,name:s.label,types:[n],icon:s.icon,color:this.getColorForCategory(s.category),isDefault:!1,isEnabled:!0,order:999,visibleMetrics:v},C=this.statsService.calculateStats(p),B=this.statsService.calculateStats(d),Y=this.comparisonService.compareStats(C,B);this.groupComparisons.push({group:b,activities1:p,activities2:d,comparison:Y})}}getColorForCategory(e){return{running:"#ef4444",cycling:"#3b82f6",walking:"#22c55e",fitness:"#8b5cf6",water:"#06b6d4",winter:"#64748b",other:"#f97316"}[e]||"#6b7280"}checkAuth(){let e=localStorage.getItem("strava_token"),t=localStorage.getItem("strava_token_expires_at");return!e||!t||Date.now()/1e3>Number(t)?(this.handleAuthError(),!1):!0}handleAuthError(){this.authError=!0,this.error=null,this.isLoading=!1}reconnectToStrava(){localStorage.clear(),this.stravaService.authenticate()}hasGroupActivities(e){return e.activities1.length>0||e.activities2.length>0}hasAnyActivities(){return this.groupComparisons.some(e=>this.hasGroupActivities(e))}trackByGroupId(e,t){return t.group.id}static \u0275fac=function(t){return new(t||i)(T(gt),T(ft),T(_t),T(lt),T(ut),T(vt))};static \u0275cmp=S({type:i,selectors:[["app-comparison"]],standalone:!0,features:[E],decls:5,vars:4,consts:[[1,"comparison-page"],["class","loading-container",4,"ngIf"],[4,"ngIf"],["class","comparison-results",4,"ngIf"],["class","initial-state",4,"ngIf"],[1,"loading-container"],[1,"loading-message"],["class","error-container",4,"ngIf"],[1,"error-container"],[1,"error-message"],[1,"retry-button",3,"click"],[1,"comparison-results"],[4,"ngFor","ngForOf","ngForTrackBy"],["class","no-activities",4,"ngIf"],[3,"comparison","activityType","groupColor","visibleMetrics"],[3,"activities1","activities2","period1","period2","activityType","groupColor"],[1,"no-activities"],[1,"no-activities-content"],["xmlns","http://www.w3.org/2000/svg","width","64","height","64","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["cx","12","cy","12","r","10"],["x1","12","y1","8","x2","12","y2","12"],["x1","12","y1","16","x2","12.01","y2","16"],[1,"initial-state"],[1,"initial-state-content"],["xmlns","http://www.w3.org/2000/svg","width","80","height","80","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["d","M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"]],template:function(t,n){t&1&&(a(0,"div",0),f(1,jt,4,0,"div",1)(2,Yt,3,2,"ng-container",2)(3,Ut,3,3,"div",3)(4,Zt,8,0,"div",4),r()),t&2&&(o(),c("ngIf",n.isLoading),o(),c("ngIf",!n.isLoading),o(),c("ngIf",n.hasCompared&&!n.isLoading&&!n.error&&!n.authError),o(),c("ngIf",!n.hasCompared&&!n.isLoading))},dependencies:[D,ct,k,j,N,Ct],styles:[".comparison-page[_ngcontent-%COMP%]{max-width:95%;margin:0 auto;padding:24px}.page-header[_ngcontent-%COMP%]{margin-bottom:32px;text-align:center}.page-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:32px;font-weight:700;color:var(--text-primary);margin:0 0 12px}.page-description[_ngcontent-%COMP%]{font-size:16px;color:var(--text-secondary);margin:0}.loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;padding:80px 24px;min-height:400px}.loading-message[_ngcontent-%COMP%]{margin-top:24px;font-size:16px;font-weight:500;color:var(--text-secondary);text-align:center}.error-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;padding:48px 24px;margin:24px 0}.error-message[_ngcontent-%COMP%]{text-align:center;background:var(--card-background);padding:32px;border-radius:12px;box-shadow:0 2px 8px #0000001a;max-width:500px}.error-message[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px;color:var(--text-primary);margin:0 0 24px}.retry-button[_ngcontent-%COMP%]{padding:12px 24px;background:var(--primary-color);color:#fff;border:none;border-radius:8px;font-size:15px;font-weight:600;cursor:pointer;transition:all .2s ease}.retry-button[_ngcontent-%COMP%]:hover{background:var(--primary-hover);transform:translateY(-1px)}.comparison-results[_ngcontent-%COMP%]{margin-top:32px}.no-activities[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;padding:64px 24px;margin:24px 0}.no-activities-content[_ngcontent-%COMP%]{text-align:center;max-width:500px}.no-activities-content[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{color:var(--text-secondary);opacity:.5;margin-bottom:24px}.no-activities-content[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:24px;font-weight:600;color:var(--text-primary);margin:0 0 12px}.no-activities-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px;color:var(--text-secondary);margin:0}.initial-state[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;padding:80px 24px;margin:24px 0}.initial-state-content[_ngcontent-%COMP%]{text-align:center;max-width:600px}.initial-state-content[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{color:var(--primary-color);opacity:.8;margin-bottom:32px}.initial-state-content[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:28px;font-weight:600;color:var(--text-primary);margin:0 0 16px}.initial-state-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px;color:var(--text-secondary);line-height:1.6;margin:0}@media (max-width: 768px){.comparison-page[_ngcontent-%COMP%]{padding:20px}.page-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:24px}.page-description[_ngcontent-%COMP%]{font-size:14px}.initial-state[_ngcontent-%COMP%]{padding:48px 12px}.initial-state-content[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:22px}.initial-state-content[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:64px;height:64px}.no-activities[_ngcontent-%COMP%]{padding:48px 12px}.no-activities-content[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:48px;height:48px}}"]})};export{yt as ComparisonComponent};
