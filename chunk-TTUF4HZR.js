import{a as H}from"./chunk-T5GMLBAE.js";import{$a as n,A as S,Aa as P,Fb as U,Gb as $,Jb as Y,Ka as b,M as R,Ma as d,Ob as B,Pa as i,Q as x,Qa as t,Ra as I,V as T,Wa as u,Y as k,ab as s,bb as D,cb as f,h as M,hb as F,jb as z,k as O,kb as L,l as A,p as h,s as w,wa as j,za as o}from"./chunk-S2QCSSTB.js";var C=class l{constructor(r){this.http=r}apiUrl="https://www.strava.com/api/v3";getAthleteProfile(){return this.http.get(`${this.apiUrl}/athlete`).pipe(S(r=>(console.error("Erreur lors de la r\xE9cup\xE9ration du profil:",r),h(()=>new Error("Impossible de r\xE9cup\xE9rer le profil de l'athl\xE8te")))))}getAthleteSummary(){return localStorage.getItem("strava_athlete_id")?this.getAllActivities().pipe(w(e=>{let a=new Date().getFullYear(),m=e.filter(c=>new Date(c.start_date).getFullYear()===a),p=e.filter(c=>c.type==="Run"),V=e.filter(c=>c.type==="Ride"),W=m.filter(c=>c.type==="Run"),G=m.filter(c=>c.type==="Ride"),g=this.findBiggestClimb(m),v=this.findLongestRun(m),_=this.findBiggestClimb(e),y=this.findLongestRun(e);return{all_run_totals:this.calculateTotals(p),all_ride_totals:this.calculateTotals(V),ytd_run_totals:this.calculateTotals(W),ytd_ride_totals:this.calculateTotals(G),current_year_records:{biggest_climb:{value:g?.total_elevation_gain||0,activity_type:g?.type||"",activity_name:g?.name||"Aucune activit\xE9",activity_date:g?.start_date.toString()||"",activity_period:"current_year"},longest_run:{value:v?.distance||0,activity_type:v?.type||"",activity_name:v?.name||"Aucune activit\xE9",activity_date:v?.start_date.toString()||"",activity_period:"current_year"}},all_time_records:{biggest_climb:{value:_?.total_elevation_gain||0,activity_type:_?.type||"",activity_name:_?.name||"Aucune activit\xE9",activity_date:_?.start_date.toString()||"",activity_period:"all_time"},longest_run:{value:y?.distance||0,activity_type:y?.type||"",activity_name:y?.name||"Aucune activit\xE9",activity_date:y?.start_date.toString()||"",activity_period:"all_time"}}}}),S(e=>(console.error("Erreur lors de la r\xE9cup\xE9ration des statistiques:",e),h(()=>new Error("Impossible de r\xE9cup\xE9rer les statistiques de l'athl\xE8te"))))):h(()=>new Error("ID de l'athl\xE8te non trouv\xE9"))}getAllActivities(){return new M(r=>{let e=(a,m=[])=>{this.http.get(`${this.apiUrl}/athlete/activities`,{params:{per_page:"200",page:a.toString()}}).subscribe({next:p=>{p.length===0?(r.next(m),r.complete()):e(a+1,[...m,...p])},error:p=>r.error(p)})};e(1)})}filterCurrentYear(r){let e=new Date().getFullYear();return r.filter(a=>new Date(a.start_date).getFullYear()===e)}calculateTotals(r){return{count:r.length,distance:r.reduce((e,a)=>e+(a.distance||0),0),moving_time:r.reduce((e,a)=>e+(a.moving_time||0),0),elapsed_time:r.reduce((e,a)=>e+(a.elapsed_time||0),0),elevation_gain:r.reduce((e,a)=>e+(a.total_elevation_gain||0),0)}}findBiggestClimb(r){let e=r.filter(a=>a.type==="Run"||a.type==="Walk"||a.type==="Hike");if(e.length!==0)return e.reduce((a,m)=>!a||m.total_elevation_gain>a.total_elevation_gain?m:a,e[0])}findLongestRun(r){let e=r.filter(a=>a.type==="Run"||a.type==="Walk"||a.type==="Hike");if(e.length!==0)return e.reduce((a,m)=>!a||m.distance>a.distance?m:a,e[0])}static \u0275fac=function(e){return new(e||l)(T(B))};static \u0275prov=x({token:l,factory:l.\u0275fac,providedIn:"root"})};var E=class l{cache={profile:null,summary:null,lastUpdate:null};profileSubject=new A(this.cache);setProfileData(r,e){this.cache={profile:r,summary:e,lastUpdate:new Date},this.profileSubject.next(this.cache)}getProfileData$(){return this.profileSubject.asObservable()}needsRefresh(){if(!this.cache.lastUpdate||!this.cache.profile||!this.cache.summary)return!0;let r=new Date(Date.now()-30*60*1e3);return this.cache.lastUpdate<r}clear(){this.cache={profile:null,summary:null,lastUpdate:null},this.profileSubject.next(this.cache)}static \u0275fac=function(e){return new(e||l)};static \u0275prov=x({token:l,factory:l.\u0275fac,providedIn:"root"})};function Q(l,r){l&1&&I(0,"app-spinner")}function X(l,r){if(l&1&&(i(0,"div",4),n(1),t()),l&2){let e=u();o(),D(" ",e.error," ")}}function Z(l,r){if(l&1&&(i(0,"span",12)(1,"i",13),n(2,"\u{1F4CD}"),t(),n(3),t()),l&2){let e=u(2);o(3),f(" ",e.profile.city,", ",e.profile.country," ")}}function ee(l,r){if(l&1&&(i(0,"div",15)(1,"div",16)(2,"div",17)(3,"div",18),n(4,"\u{1F3C3}"),t(),i(5,"h3"),n(6,"Course \xE0 pied - Total"),t()(),i(7,"div",19)(8,"div",20)(9,"span",21),n(10),t(),i(11,"span",22),n(12,"distance totale"),t()(),i(13,"div",20)(14,"span",21),n(15),t(),i(16,"span",22),n(17,"temps total"),t()(),i(18,"div",20)(19,"span",21),n(20),t(),i(21,"span",22),n(22,"sorties"),t()(),i(23,"div",20)(24,"span",21),n(25),t(),i(26,"span",22),n(27,"d\xE9nivel\xE9 total"),t()()()(),i(28,"div",23)(29,"div",17)(30,"div",24),n(31,"\u{1F6B4}"),t(),i(32,"h3"),n(33,"V\xE9lo - Total"),t()(),i(34,"div",19)(35,"div",20)(36,"span",21),n(37),t(),i(38,"span",22),n(39,"distance totale"),t()(),i(40,"div",20)(41,"span",21),n(42),t(),i(43,"span",22),n(44,"temps total"),t()(),i(45,"div",20)(46,"span",21),n(47),t(),i(48,"span",22),n(49,"sorties"),t()(),i(50,"div",20)(51,"span",21),n(52),t(),i(53,"span",22),n(54,"d\xE9nivel\xE9 total"),t()()()(),i(55,"div",25)(56,"div",17)(57,"div",26),n(58,"\u{1F3C6}"),t(),i(59,"h3"),n(60,"Records (Course/Marche uniquement)"),t()(),i(61,"div",19)(62,"div",27)(63,"div",28)(64,"span",29),n(65,"Plus grand d\xE9nivel\xE9"),t(),i(66,"span",30),n(67),t(),i(68,"span",31),n(69),t(),i(70,"span",32),n(71),t()()(),i(72,"div",27)(73,"div",28)(74,"span",29),n(75,"Plus longue sortie"),t(),i(76,"span",30),n(77),t(),i(78,"span",31),n(79),t(),i(80,"span",32),n(81),t()()()()(),i(82,"div",33)(83,"div",17)(84,"div",18),n(85,"\u{1F3C3}"),t(),i(86,"h3"),n(87,"Course \xE0 pied - Cette ann\xE9e"),t()(),i(88,"div",19)(89,"div",20)(90,"span",21),n(91),t(),i(92,"span",22),n(93,"distance parcourue"),t()(),i(94,"div",20)(95,"span",21),n(96),t(),i(97,"span",22),n(98,"temps total"),t()(),i(99,"div",20)(100,"span",21),n(101),t(),i(102,"span",22),n(103,"sorties"),t()(),i(104,"div",20)(105,"span",21),n(106),t(),i(107,"span",22),n(108,"d\xE9nivel\xE9 total"),t()()()(),i(109,"div",34)(110,"div",17)(111,"div",24),n(112,"\u{1F6B4}"),t(),i(113,"h3"),n(114,"V\xE9lo - Cette ann\xE9e"),t()(),i(115,"div",19)(116,"div",20)(117,"span",21),n(118),t(),i(119,"span",22),n(120,"distance parcourue"),t()(),i(121,"div",20)(122,"span",21),n(123),t(),i(124,"span",22),n(125,"temps total"),t()(),i(126,"div",20)(127,"span",21),n(128),t(),i(129,"span",22),n(130,"sorties"),t()(),i(131,"div",20)(132,"span",21),n(133),t(),i(134,"span",22),n(135,"d\xE9nivel\xE9 total"),t()()()()()),l&2){let e=u(2);o(10),s(e.formatDistance(e.summary.all_run_totals.distance)),o(5),s(e.formatDuration(e.summary.all_run_totals.moving_time)),o(5),s(e.summary.all_run_totals.count),o(5),s(e.formatElevation(e.summary.all_run_totals.elevation_gain)),o(12),s(e.formatDistance(e.summary.all_ride_totals.distance)),o(5),s(e.formatDuration(e.summary.all_ride_totals.moving_time)),o(5),s(e.summary.all_ride_totals.count),o(5),s(e.formatElevation(e.summary.all_ride_totals.elevation_gain)),o(15),s(e.formatElevation(e.summary.all_time_records.biggest_climb.value)),o(2),f(" ",e.summary.all_time_records.biggest_climb.activity_name," (",e.summary.all_time_records.biggest_climb.activity_type,") "),o(2),s(e.formatDate(e.summary.all_time_records.biggest_climb.activity_date)),o(6),s(e.formatDistance(e.summary.all_time_records.longest_run.value)),o(2),f(" ",e.summary.all_time_records.longest_run.activity_name," (",e.summary.all_time_records.longest_run.activity_type,") "),o(2),s(e.formatDate(e.summary.all_time_records.longest_run.activity_date)),o(10),s(e.formatDistance(e.summary.ytd_run_totals.distance)),o(5),s(e.formatDuration(e.summary.ytd_run_totals.moving_time)),o(5),s(e.summary.ytd_run_totals.count),o(5),s(e.formatElevation(e.summary.ytd_run_totals.elevation_gain)),o(12),s(e.formatDistance(e.summary.ytd_ride_totals.distance)),o(5),s(e.formatDuration(e.summary.ytd_ride_totals.moving_time)),o(5),s(e.summary.ytd_ride_totals.count),o(5),s(e.formatElevation(e.summary.ytd_ride_totals.elevation_gain))}}function te(l,r){if(l&1&&(i(0,"div",5)(1,"div",6)(2,"div",7),I(3,"img",8),t(),i(4,"div",9)(5,"h1"),n(6),t(),i(7,"div",10),b(8,Z,4,2,"span",11),i(9,"span",12)(10,"i",13),n(11,"\u{1F3AF}"),t(),n(12),z(13,"date"),t()()()(),b(14,ee,136,24,"div",14),t()),l&2){let e=u();o(3),d("src",e.profile.profile||"/assets/images/default-avatar.png",j)("alt",e.profile.firstname),o(3),f("",e.profile.firstname," ",e.profile.lastname,""),o(2),d("ngIf",e.profile.city||e.profile.country),o(4),D(" Membre depuis ",L(13,7,e.profile.created_at,"MMMM yyyy")," "),o(2),d("ngIf",e.summary)}}var N=class l{constructor(r,e){this.athleteService=r;this.profileCache=e}profile=null;summary=null;isLoading=!0;error=null;destroy$=new O;ngOnInit(){this.profileCache.getProfileData$().pipe(R(this.destroy$)).subscribe(r=>{r.profile&&r.summary&&(this.profile=r.profile,this.summary=r.summary,this.isLoading=!1)}),this.loadProfile()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}formatDistance(r){return(r/1e3).toFixed(1)+" km"}formatDuration(r){let e=Math.floor(r/3600),a=Math.floor(r%3600/60);return`${e}h ${a}min`}formatElevation(r){return Math.round(r)+" m"}formatDate(r){return new Date(r).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}loadProfile(){if(!this.profileCache.needsRefresh()){this.isLoading=!1;return}this.isLoading=!0,this.error=null,Promise.all([this.athleteService.getAthleteProfile().toPromise(),this.athleteService.getAthleteSummary().toPromise()]).then(([r,e])=>{r&&e&&this.profileCache.setProfileData(r,e),this.isLoading=!1}).catch(r=>{console.error("Error loading profile:",r),this.error="Une erreur est survenue lors du chargement du profil.",this.isLoading=!1})}static \u0275fac=function(e){return new(e||l)(P(C),P(E))};static \u0275cmp=k({type:l,selectors:[["app-profile"]],standalone:!0,features:[F],decls:4,vars:3,consts:[[1,"profile-container"],[4,"ngIf"],["class","error-message",4,"ngIf"],["class","profile-content",4,"ngIf"],[1,"error-message"],[1,"profile-content"],[1,"profile-card"],[1,"profile-avatar"],[3,"src","alt"],[1,"profile-info"],[1,"profile-details"],["class","detail-item",4,"ngIf"],[1,"detail-item"],[1,"icon"],["class","stats-container",4,"ngIf"],[1,"stats-container"],[1,"stats-card","total-running"],[1,"stats-header"],[1,"stats-icon","running"],[1,"stats-body"],[1,"metric"],[1,"metric-value"],[1,"metric-label"],[1,"stats-card","total-cycling"],[1,"stats-icon","cycling"],[1,"stats-card"],[1,"stats-icon","trophy"],[1,"record-item"],[1,"record-info"],[1,"record-title"],[1,"record-value"],[1,"record-details"],[1,"record-date"],[1,"stats-card","ytd-running"],[1,"stats-card","ytd-cycling"]],template:function(e,a){e&1&&(i(0,"div",0),b(1,Q,1,0,"app-spinner",1)(2,X,2,1,"div",2)(3,te,15,10,"div",3),t()),e&2&&(o(),d("ngIf",a.isLoading),o(),d("ngIf",a.error),o(),d("ngIf",!a.isLoading&&!a.error&&a.profile))},dependencies:[Y,U,$,H],styles:[".profile-container[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto;padding:2rem}.profile-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2rem}.profile-card[_ngcontent-%COMP%]{display:flex;align-items:center;gap:2rem;background:#fff;padding:2rem;border-radius:16px;box-shadow:0 2px 4px #0000001a}.profile-avatar[_ngcontent-%COMP%]{width:150px;height:150px;border-radius:50%;overflow:hidden;flex-shrink:0}.profile-avatar[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.profile-info[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:2rem;color:var(--gray-800);margin-bottom:1rem}.profile-details[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:1.5rem}.detail-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;color:var(--gray-600);font-size:.95rem}.icon[_ngcontent-%COMP%]{font-size:1.2rem}.stats-container[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(350px,1fr));gap:1.5rem}.stats-card[_ngcontent-%COMP%]{background:#fff;border-radius:12px;padding:1.5rem;box-shadow:0 2px 4px #0000000d;display:flex;flex-direction:column;gap:1.5rem;transition:transform .2s,box-shadow .2s}.stats-card[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 4px 6px #0000001a}.stats-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem}.stats-icon[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:1.5rem;flex-shrink:0}.stats-icon.running[_ngcontent-%COMP%]{background-color:#ffe0b2}.stats-icon.cycling[_ngcontent-%COMP%]{background-color:#b3e5fc}.stats-icon.trophy[_ngcontent-%COMP%]{background-color:#ffe0b2}.stats-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.1rem;color:var(--gray-800);margin:0}.stats-body[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:1rem}.metric[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.metric-value[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:600;color:var(--gray-800)}.metric-label[_ngcontent-%COMP%]{font-size:.85rem;color:var(--gray-600)}.record-item[_ngcontent-%COMP%]{border-left:3px solid var(--primary-color);padding-left:1rem;margin-bottom:1rem}.record-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem}.record-title[_ngcontent-%COMP%]{font-size:.9rem;color:var(--gray-600);text-transform:uppercase}.record-value[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:600;color:var(--gray-800)}.record-details[_ngcontent-%COMP%]{font-size:.9rem;color:var(--gray-800)}.record-date[_ngcontent-%COMP%]{font-size:.85rem;color:var(--gray-600);font-style:italic}.error-message[_ngcontent-%COMP%]{text-align:center;padding:2rem;color:var(--danger-color);background-color:#ffebee;border-radius:8px;margin:2rem 0}@media (max-width: 768px){.profile-container[_ngcontent-%COMP%]{padding:1rem}.profile-card[_ngcontent-%COMP%]{flex-direction:column;text-align:center;padding:1.5rem}.profile-avatar[_ngcontent-%COMP%]{width:120px;height:120px}.profile-details[_ngcontent-%COMP%]{justify-content:center}.stats-container[_ngcontent-%COMP%]{grid-template-columns:1fr}.stats-card[_ngcontent-%COMP%]{padding:1rem}.stats-body[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr)}}@media (max-width: 480px){.stats-body[_ngcontent-%COMP%]{grid-template-columns:1fr}}"]})};export{N as ProfileComponent};
